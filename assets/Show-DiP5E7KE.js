const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-DPOGvi3a.js","./index-ArAQ9-7r.css"])))=>i.map(i=>d[i]);
import{s as Ft,r as Pn,k as qo,q as Yo,a as Xo,b as Qo,c as Zo,S as De,d as Tn,F as An,R as Jo,m as es,_ as ts,C as rs,p as ns,e as is,f as os,g as R,h as ss,i as re,j as Je,l as G,o as Xn,n as $t,t as fe,u as Qn,v as as,w as Mn,x as ls,y as On,z as K,A as Z,B as _t,D as Lt,E as xe,G as je,H as cs,I as Br,J as us,K as Zn,L as jr,M as Wr,N as Rn,O as ds,P as Cr,Q as fs,T as Jt,U as hs,V as ps,W as ms,X as gs,Y as Fn}from"./index-DPOGvi3a.js";const _s=(e,t)=>{let r="";{const i=e.board.getRole(t.from);if(!i)return"--";if(i==="king"&&(e.board[e.turn].has(t.to)||Math.abs(t.to-t.from)===2))r=t.to>t.from?"O-O":"O-O-O";else{const s=e.board.occupied.has(t.to)||i==="pawn"&&Ft(t.from)!==Ft(t.to);if(i!=="pawn"){r=Pn(i).toUpperCase();let l;if(i==="king"?l=qo(t.to).intersect(e.board.king):i==="queen"?l=Yo(t.to,e.board.occupied).intersect(e.board.queen):i==="rook"?l=Xo(t.to,e.board.occupied).intersect(e.board.rook):i==="bishop"?l=Qo(t.to,e.board.occupied).intersect(e.board.bishop):l=Zo(t.to).intersect(e.board.knight),l=l.intersect(e.board[e.turn]).without(t.from),l.nonEmpty()){const d=e.ctx();for(const f of l)e.dests(f,d).has(t.to)||(l=l.without(f));if(l.nonEmpty()){let f=!1,m=l.intersects(De.fromRank(Tn(t.from)));l.intersects(De.fromFile(Ft(t.from)))?f=!0:m=!0,m&&(r+=An[Ft(t.from)]),f&&(r+=Jo[Tn(t.from)])}}}else s&&(r=An[Ft(t.from)]);s&&(r+="x"),r+=es(t.to),t.promotion&&(r+="="+Pn(t.promotion).toUpperCase())}}return r},vs=(e,t)=>{const r=_s(e,t);return e.play(t),e.outcome()?.winner?r+"#":e.isCheck()?r+"+":r},Pr=(e,t)=>vs(e.clone(),t);var ws=(()=>{var e=import.meta.url;return async function(t={}){var r,i=t,s,l,d=new Promise((n,o)=>{s=n,l=o});["_get_attacks","_get_occupied","_get_pieces_color_bb","_get_fen","_get_pieces_bb","_get_turn","_is_checkmate","_pos_attacks_to","_pos_attacks","_get_at","_create_position","_delete_position","_make_move","_unmake_move","_get_legal_moves","_free_legal_moves","_init","_malloc","_free","setValue","getValue","stringToUTF8","UTF8ToString","_memory","___indirect_function_table","onRuntimeInitialized"].forEach(n=>{Object.getOwnPropertyDescriptor(d,n)||Object.defineProperty(d,n,{get:()=>ie("You are getting "+n+" on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js"),set:()=>ie("You are setting "+n+" on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")})});var f=typeof window=="object",m=typeof WorkerGlobalScope<"u",p=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string"&&process.type!="renderer",v=!f&&!p&&!m;if(p){const{createRequire:n}=await ts(async()=>{const{createRequire:a}=await import("./index-DPOGvi3a.js").then(u=>u.Z);return{createRequire:a}},__vite__mapDeps([0,1]),import.meta.url);let o=import.meta.url;o.startsWith("data:")&&(o="/");var w=n(o)}var S=Object.assign({},i),A="./this.program",k="";function E(n){return i.locateFile?i.locateFile(n,k):k+n}var O,T;if(p){if(typeof process>"u"||!process.release||process.release.name!=="node")throw new Error("not compiled for this environment (did you build to HTML and try to run it not on the web, or set ENVIRONMENT to something - like node - and run it someplace else - like on the web?)");var P=process.versions.node,I=P.split(".").slice(0,3);if(I=I[0]*1e4+I[1]*100+I[2].split("-")[0]*1,I<16e4)throw new Error("This emscripten-generated code requires node v16.0.0 (detected v"+P+")");var te=w("fs"),x=w("path");import.meta.url.startsWith("data:")||(k=x.dirname(w("url").fileURLToPath(import.meta.url))+"/"),T=n=>{n=Ct(n)?new URL(n):x.normalize(n);var o=te.readFileSync(n);return C(o.buffer),o},O=(n,o=!0)=>(n=Ct(n)?new URL(n):x.normalize(n),new Promise((a,u)=>{te.readFile(n,o?void 0:"utf8",(h,g)=>{h?u(h):a(o?g.buffer:g)})})),!i.thisProgram&&process.argv.length>1&&(A=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2)}else if(v){if(typeof process=="object"&&typeof w=="function"||typeof window=="object"||typeof WorkerGlobalScope<"u")throw new Error("not compiled for this environment (did you build to HTML and try to run it not on the web, or set ENVIRONMENT to something - like node - and run it someplace else - like on the web?)")}else if(f||m){if(m?k=self.location.href:typeof document<"u"&&document.currentScript&&(k=document.currentScript.src),e&&(k=e),k.startsWith("blob:")?k="":k=k.substr(0,k.replace(/[?#].*/,"").lastIndexOf("/")+1),!(typeof window=="object"||typeof WorkerGlobalScope<"u"))throw new Error("not compiled for this environment (did you build to HTML and try to run it not on the web, or set ENVIRONMENT to something - like node - and run it someplace else - like on the web?)");m&&(T=n=>{var o=new XMLHttpRequest;return o.open("GET",n,!1),o.responseType="arraybuffer",o.send(null),new Uint8Array(o.response)}),O=n=>Ct(n)?new Promise((o,a)=>{var u=new XMLHttpRequest;u.open("GET",n,!0),u.responseType="arraybuffer",u.onload=()=>{if(u.status==200||u.status==0&&u.response){o(u.response);return}a(u.status)},u.onerror=a,u.send(null)}):fetch(n,{credentials:"same-origin"}).then(o=>o.ok?o.arrayBuffer():Promise.reject(new Error(o.status+" : "+o.url)))}else throw new Error("environment detection error");var ne=i.print||console.log.bind(console),U=i.printErr||console.error.bind(console);Object.assign(i,S),S=null,jo(),i.arguments&&i.arguments,qe("arguments","arguments_"),i.thisProgram&&(A=i.thisProgram),qe("thisProgram","thisProgram"),C(typeof i.memoryInitializerPrefixURL>"u","Module.memoryInitializerPrefixURL option was removed, use Module.locateFile instead"),C(typeof i.pthreadMainPrefixURL>"u","Module.pthreadMainPrefixURL option was removed, use Module.locateFile instead"),C(typeof i.cdInitializerPrefixURL>"u","Module.cdInitializerPrefixURL option was removed, use Module.locateFile instead"),C(typeof i.filePackagePrefixURL>"u","Module.filePackagePrefixURL option was removed, use Module.locateFile instead"),C(typeof i.read>"u","Module.read option was removed"),C(typeof i.readAsync>"u","Module.readAsync option was removed (modify readAsync in JS)"),C(typeof i.readBinary>"u","Module.readBinary option was removed (modify readBinary in JS)"),C(typeof i.setWindowTitle>"u","Module.setWindowTitle option was removed (modify emscripten_set_window_title in JS)"),C(typeof i.TOTAL_MEMORY>"u","Module.TOTAL_MEMORY has been renamed Module.INITIAL_MEMORY"),qe("asm","wasmExports"),qe("readAsync","readAsync"),qe("readBinary","readBinary"),qe("setWindowTitle","setWindowTitle"),C(!v,"shell environment detected but not enabled at build time.  Add `shell` to `-sENVIRONMENT` to enable.");var z=i.wasmBinary;qe("wasmBinary","wasmBinary"),typeof WebAssembly!="object"&&U("no native wasm support detected");var oe,se=!1;function C(n,o){n||ie("Assertion failed"+(o?": "+o:""))}var Y,be,B,W,L,Ee,Ie;function at(){var n=oe.buffer;i.HEAP8=Y=new Int8Array(n),i.HEAP16=B=new Int16Array(n),i.HEAPU8=be=new Uint8Array(n),i.HEAPU16=new Uint16Array(n),i.HEAP32=W=new Int32Array(n),i.HEAPU32=L=new Uint32Array(n),i.HEAPF32=Ee=new Float32Array(n),i.HEAPF64=Ie=new Float64Array(n)}C(!i.STACK_SIZE,"STACK_SIZE can no longer be set at runtime.  Use -sSTACK_SIZE at link time"),C(typeof Int32Array<"u"&&typeof Float64Array<"u"&&Int32Array.prototype.subarray!=null&&Int32Array.prototype.set!=null,"JS engine does not provide full typed array support"),C(!i.wasmMemory,"Use of `wasmMemory` detected.  Use -sIMPORTED_MEMORY to define wasmMemory externally"),C(!i.INITIAL_MEMORY,"Detected runtime INITIAL_MEMORY setting.  Use -sIMPORTED_MEMORY to define wasmMemory dynamically");function ur(){var n=vr();C((n&3)==0),n==0&&(n+=4),L[n>>2]=34821223,L[n+4>>2]=2310721022,L[0]=1668509029}function lt(){if(!se){var n=vr();n==0&&(n+=4);var o=L[n>>2],a=L[n+4>>2];(o!=34821223||a!=2310721022)&&ie(`Stack overflow! Stack cookie has been overwritten at ${Tt(n)}, expected hex dwords 0x89BACDFE and 0x2135467, but received ${Tt(a)} ${Tt(o)}`),L[0]!=1668509029&&ie("Runtime error: The application has corrupted its heap memory area (address zero)!")}}var Gt=[],ct=[],yt=[],ut=!1;function Kt(){if(i.preRun)for(typeof i.preRun=="function"&&(i.preRun=[i.preRun]);i.preRun.length;)dr(i.preRun.shift());hr(Gt)}function Vt(){C(!ut),ut=!0,lt(),!i.noFSInit&&!c.initialized&&c.init(),c.ignorePermissions=!1,hr(ct)}function qt(){if(lt(),i.postRun)for(typeof i.postRun=="function"&&(i.postRun=[i.postRun]);i.postRun.length;)eo(i.postRun.shift());hr(yt)}function dr(n){Gt.unshift(n)}function Et(n){ct.unshift(n)}function eo(n){yt.unshift(n)}C(Math.imul,"This browser does not support Math.imul(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),C(Math.fround,"This browser does not support Math.fround(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),C(Math.clz32,"This browser does not support Math.clz32(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),C(Math.trunc,"This browser does not support Math.trunc(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill");var Ke=0,Ve=null,St=null,dt={};function un(n){for(var o=n;;){if(!dt[n])return n;n=o+Math.random()}}function fr(n){Ke++,i.monitorRunDependencies?.(Ke),n?(C(!dt[n]),dt[n]=1,Ve===null&&typeof setInterval<"u"&&(Ve=setInterval(()=>{if(se){clearInterval(Ve),Ve=null;return}var o=!1;for(var a in dt)o||(o=!0,U("still waiting on run dependencies:")),U(`dependency: ${a}`);o&&U("(end of list)")},1e4))):U("warning: run dependency added without ID")}function Yt(n){if(Ke--,i.monitorRunDependencies?.(Ke),n?(C(dt[n]),delete dt[n]):U("warning: run dependency removed without ID"),Ke==0&&(Ve!==null&&(clearInterval(Ve),Ve=null),St)){var o=St;St=null,o()}}function ie(n){i.onAbort?.(n),n="Aborted("+n+")",U(n),se=!0;var o=new WebAssembly.RuntimeError(n);throw l(o),o}var to="data:application/octet-stream;base64,",dn=n=>n.startsWith(to),Ct=n=>n.startsWith("file://");function ee(n,o){return(...a)=>{C(ut,`native function \`${n}\` called before runtime initialization`);var u=Qe[n];return C(u,`exported native function \`${n}\` not found`),C(a.length<=o,`native function \`${n}\` called with ${a.length} args but expects ${o}`),u(...a)}}function ro(){if(i.locateFile){var n="hopefox.wasm";return dn(n)?n:E(n)}return new URL("hopefox.wasm",import.meta.url).href}var Pt;function fn(n){if(n==Pt&&z)return new Uint8Array(z);if(T)return T(n);throw"both async and sync fetching of the wasm failed"}function no(n){return z?Promise.resolve().then(()=>fn(n)):O(n).then(o=>new Uint8Array(o),()=>fn(n))}function hn(n,o,a){return no(n).then(u=>WebAssembly.instantiate(u,o)).then(a,u=>{U(`failed to asynchronously prepare wasm: ${u}`),Ct(Pt)&&U(`warning: Loading from a file URI (${Pt}) is not supported in most browsers. See https://emscripten.org/docs/getting_started/FAQ.html#how-do-i-run-a-local-webserver-for-testing-why-does-my-program-stall-in-downloading-or-preparing`),ie(u)})}function io(n,o,a,u){return!n&&typeof WebAssembly.instantiateStreaming=="function"&&!dn(o)&&!Ct(o)&&!p&&typeof fetch=="function"?fetch(o,{credentials:"same-origin"}).then(h=>{var g=WebAssembly.instantiateStreaming(h,a);return g.then(u,function(_){return U(`wasm streaming compile failed: ${_}`),U("falling back to ArrayBuffer instantiation"),hn(o,a,u)})}):hn(o,a,u)}function oo(){return{env:En,wasi_snapshot_preview1:En}}function so(){function n(h,g){return Qe=h.exports,oe=Qe.memory,C(oe,"memory not found in wasm exports"),at(),Et(Qe.__wasm_call_ctors),Yt("wasm-instantiate"),Qe}fr("wasm-instantiate");var o=i;function a(h){C(i===o,"the Module object should not be replaced during async compilation - perhaps the order of HTML elements is wrong?"),o=null,n(h.instance)}var u=oo();if(i.instantiateWasm)try{return i.instantiateWasm(u,n)}catch(h){U(`Module.instantiateWasm callback failed with error: ${h}`),l(h)}return Pt??=ro(),io(z,Pt,u,a).catch(l),{}}var j,de;if((()=>{var n=new Int16Array(1),o=new Int8Array(n.buffer);if(n[0]=25459,o[0]!==115||o[1]!==99)throw"Runtime error: expected the system to be little-endian! (Run with -sSUPPORT_BIG_ENDIAN to bypass)"})(),i.ENVIRONMENT)throw new Error("Module.ENVIRONMENT has been deprecated. To force the environment, use the ENVIRONMENT compile-time option (for example, -sENVIRONMENT=web or -sENVIRONMENT=node)");function qe(n,o,a=!0){Object.getOwnPropertyDescriptor(i,n)||Object.defineProperty(i,n,{configurable:!0,get(){let u=a?" (the initial value can be provided on Module, but after startup the value is only looked for on a local variable of that name)":"";ie(`\`Module.${n}\` has been replaced by \`${o}\``+u)}})}function ao(n){Object.getOwnPropertyDescriptor(i,n)&&ie(`\`Module.${n}\` was supplied but \`${n}\` not included in INCOMING_MODULE_JS_API`)}function pn(n){return n==="FS_createPath"||n==="FS_createDataFile"||n==="FS_createPreloadedFile"||n==="FS_unlink"||n==="addRunDependency"||n==="FS_createLazyFile"||n==="FS_createDevice"||n==="removeRunDependency"}function mn(n,o){typeof globalThis<"u"&&!Object.getOwnPropertyDescriptor(globalThis,n)&&Object.defineProperty(globalThis,n,{configurable:!0,get(){o()}})}function gn(n,o){mn(n,()=>{Ye(`\`${n}\` is not longer defined by emscripten. ${o}`)})}gn("buffer","Please use HEAP8.buffer or wasmMemory.buffer"),gn("asm","Please use wasmExports instead");function lo(n){mn(n,()=>{var o=`\`${n}\` is a library symbol and not included by default; add it to your library.js __deps or to DEFAULT_LIBRARY_FUNCS_TO_INCLUDE on the command line`,a=n;a.startsWith("_")||(a="$"+n),o+=` (e.g. -sDEFAULT_LIBRARY_FUNCS_TO_INCLUDE='${a}')`,pn(n)&&(o+=". Alternatively, forcing filesystem support (-sFORCE_FILESYSTEM) can export this for you"),Ye(o)}),_n(n)}function _n(n){Object.getOwnPropertyDescriptor(i,n)||Object.defineProperty(i,n,{configurable:!0,get(){var o=`'${n}' was not exported. add it to EXPORTED_RUNTIME_METHODS (see the Emscripten FAQ)`;pn(n)&&(o+=". Alternatively, forcing filesystem support (-sFORCE_FILESYSTEM) can export this for you"),ie(o)}})}var hr=n=>{for(;n.length>0;)n.shift()(i)};function co(n,o="i8"){switch(o.endsWith("*")&&(o="*"),o){case"i1":return Y[n];case"i8":return Y[n];case"i16":return B[n>>1];case"i32":return W[n>>2];case"i64":ie("to do getValue(i64) use WASM_BIGINT");case"float":return Ee[n>>2];case"double":return Ie[n>>3];case"*":return L[n>>2];default:ie(`invalid type for getValue: ${o}`)}}i.getValue=co,i.noExitRuntime;var Tt=n=>(C(typeof n=="number"),n>>>=0,"0x"+n.toString(16).padStart(8,"0"));function uo(n,o,a="i8"){switch(a.endsWith("*")&&(a="*"),a){case"i1":Y[n]=o;break;case"i8":Y[n]=o;break;case"i16":B[n>>1]=o;break;case"i32":W[n>>2]=o;break;case"i64":ie("to do setValue(i64) use WASM_BIGINT");case"float":Ee[n>>2]=o;break;case"double":Ie[n>>3]=o;break;case"*":L[n>>2]=o;break;default:ie(`invalid type for setValue: ${a}`)}}i.setValue=uo;var Ye=n=>{Ye.shown||={},Ye.shown[n]||(Ye.shown[n]=1,p&&(n="warning: "+n),U(n))},vn=typeof TextDecoder<"u"?new TextDecoder:void 0,ft=(n,o=0,a=NaN)=>{for(var u=o+a,h=o;n[h]&&!(h>=u);)++h;if(h-o>16&&n.buffer&&vn)return vn.decode(n.subarray(o,h));for(var g="";o<h;){var _=n[o++];if(!(_&128)){g+=String.fromCharCode(_);continue}var b=n[o++]&63;if((_&224)==192){g+=String.fromCharCode((_&31)<<6|b);continue}var M=n[o++]&63;if((_&240)==224?_=(_&15)<<12|b<<6|M:((_&248)!=240&&Ye("Invalid UTF-8 leading byte "+Tt(_)+" encountered when deserializing a UTF-8 string in wasm memory to a JS string!"),_=(_&7)<<18|b<<12|M<<6|n[o++]&63),_<65536)g+=String.fromCharCode(_);else{var V=_-65536;g+=String.fromCharCode(55296|V>>10,56320|V&1023)}}return g},ht=(n,o)=>(C(typeof n=="number",`UTF8ToString expects a number (got ${typeof n})`),n?ft(be,n,o):"");i.UTF8ToString=ht;var fo=(n,o,a,u)=>ie(`Assertion failed: ${ht(n)}, at: `+[o?ht(o):"unknown filename",a,u?ht(u):"unknown function"]);class ho{constructor(o){this.excPtr=o,this.ptr=o-24}set_type(o){L[this.ptr+4>>2]=o}get_type(){return L[this.ptr+4>>2]}set_destructor(o){L[this.ptr+8>>2]=o}get_destructor(){return L[this.ptr+8>>2]}set_caught(o){o=o?1:0,Y[this.ptr+12]=o}get_caught(){return Y[this.ptr+12]!=0}set_rethrown(o){o=o?1:0,Y[this.ptr+13]=o}get_rethrown(){return Y[this.ptr+13]!=0}init(o,a){this.set_adjusted_ptr(0),this.set_type(o),this.set_destructor(a)}set_adjusted_ptr(o){L[this.ptr+16>>2]=o}get_adjusted_ptr(){return L[this.ptr+16>>2]}}var po=(n,o,a)=>{var u=new ho(n);u.init(o,a),C(!1,"Exception thrown, but exception catching is not enabled. Compile with -sNO_DISABLE_EXCEPTION_CATCHING or -sEXCEPTION_CATCHING_ALLOWED=[..] to catch.")},mo=()=>ie("native code called abort()"),go=(n,o,a)=>be.copyWithin(n,o,o+a),pr=(n,o,a,u)=>{if(C(typeof n=="string",`stringToUTF8Array expects a string (got ${typeof n})`),!(u>0))return 0;for(var h=a,g=a+u-1,_=0;_<n.length;++_){var b=n.charCodeAt(_);if(b>=55296&&b<=57343){var M=n.charCodeAt(++_);b=65536+((b&1023)<<10)|M&1023}if(b<=127){if(a>=g)break;o[a++]=b}else if(b<=2047){if(a+1>=g)break;o[a++]=192|b>>6,o[a++]=128|b&63}else if(b<=65535){if(a+2>=g)break;o[a++]=224|b>>12,o[a++]=128|b>>6&63,o[a++]=128|b&63}else{if(a+3>=g)break;b>1114111&&Ye("Invalid Unicode code point "+Tt(b)+" encountered when serializing a JS string to a UTF-8 string in wasm memory! (Valid unicode code points should be in range 0-0x10FFFF)."),o[a++]=240|b>>18,o[a++]=128|b>>12&63,o[a++]=128|b>>6&63,o[a++]=128|b&63}}return o[a]=0,a-h},At=(n,o,a)=>(C(typeof a=="number","stringToUTF8(str, outPtr, maxBytesToWrite) is missing the third parameter that specifies the length of the output buffer!"),pr(n,be,o,a));i.stringToUTF8=At;var Xt=n=>{for(var o=0,a=0;a<n.length;++a){var u=n.charCodeAt(a);u<=127?o++:u<=2047?o+=2:u>=55296&&u<=57343?(o+=4,++a):o+=3}return o},_o=(n,o,a,u)=>{var h=new Date().getFullYear(),g=new Date(h,0,1),_=new Date(h,6,1),b=g.getTimezoneOffset(),M=_.getTimezoneOffset(),V=Math.max(b,M);L[n>>2]=V*60,W[o>>2]=+(b!=M);var X=F=>{var H=F>=0?"-":"+",he=Math.abs(F),Te=String(Math.floor(he/60)).padStart(2,"0"),ke=String(he%60).padStart(2,"0");return`UTC${H}${Te}${ke}`},Q=X(b),q=X(M);C(Q),C(q),C(Xt(Q)<=16,`timezone name truncated to fit in TZNAME_MAX (${Q})`),C(Xt(q)<=16,`timezone name truncated to fit in TZNAME_MAX (${q})`),M<b?(At(Q,a,17),At(q,u,17)):(At(Q,u,17),At(q,a,17))},vo=()=>2147483648,wo=(n,o)=>(C(o,"alignment argument is required"),Math.ceil(n/o)*o),bo=n=>{var o=oe.buffer,a=(n-o.byteLength+65535)/65536|0;try{return oe.grow(a),at(),1}catch(u){U(`growMemory: Attempted to grow heap from ${o.byteLength} bytes to ${n} bytes, but got error: ${u}`)}},ko=n=>{var o=be.length;n>>>=0,C(n>o);var a=vo();if(n>a)return U(`Cannot enlarge memory, requested ${n} bytes, but the limit is ${a} bytes!`),!1;for(var u=1;u<=4;u*=2){var h=o*(1+.2/u);h=Math.min(h,n+100663296);var g=Math.min(a,wo(Math.max(n,h),65536)),_=bo(g);if(_)return!0}return U(`Failed to grow the heap from ${o} bytes to ${g} bytes, not enough memory!`),!1},mr={},yo=()=>A||"./this.program",Mt=()=>{if(!Mt.strings){var n=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",o={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:n,_:yo()};for(var a in mr)mr[a]===void 0?delete o[a]:o[a]=mr[a];var u=[];for(var a in o)u.push(`${a}=${o[a]}`);Mt.strings=u}return Mt.strings},Eo=(n,o)=>{for(var a=0;a<n.length;++a)C(n.charCodeAt(a)===(n.charCodeAt(a)&255)),Y[o++]=n.charCodeAt(a);Y[o]=0},So=(n,o)=>{var a=0;return Mt().forEach((u,h)=>{var g=o+a;L[n+h*4>>2]=g,Eo(u,g),a+=u.length+1}),0},Co=(n,o)=>{var a=Mt();L[n>>2]=a.length;var u=0;return a.forEach(h=>u+=h.length+1),L[o>>2]=u,0},J={isAbs:n=>n.charAt(0)==="/",splitPath:n=>{var o=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;return o.exec(n).slice(1)},normalizeArray:(n,o)=>{for(var a=0,u=n.length-1;u>=0;u--){var h=n[u];h==="."?n.splice(u,1):h===".."?(n.splice(u,1),a++):a&&(n.splice(u,1),a--)}if(o)for(;a;a--)n.unshift("..");return n},normalize:n=>{var o=J.isAbs(n),a=n.substr(-1)==="/";return n=J.normalizeArray(n.split("/").filter(u=>!!u),!o).join("/"),!n&&!o&&(n="."),n&&a&&(n+="/"),(o?"/":"")+n},dirname:n=>{var o=J.splitPath(n),a=o[0],u=o[1];return!a&&!u?".":(u&&(u=u.substr(0,u.length-1)),a+u)},basename:n=>{if(n==="/")return"/";n=J.normalize(n),n=n.replace(/\/$/,"");var o=n.lastIndexOf("/");return o===-1?n:n.substr(o+1)},join:(...n)=>J.normalize(n.join("/")),join2:(n,o)=>J.normalize(n+"/"+o)},Po=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return u=>crypto.getRandomValues(u);if(p)try{var n=w("crypto"),o=n.randomFillSync;if(o)return u=>n.randomFillSync(u);var a=n.randomBytes;return u=>(u.set(a(u.byteLength)),u)}catch{}ie("no cryptographic support found for randomDevice. consider polyfilling it if you want to use something insecure like Math.random(), e.g. put this in a --pre-js: var crypto = { getRandomValues: (array) => { for (var i = 0; i < array.length; i++) array[i] = (Math.random()*256)|0 } };")},wn=n=>(wn=Po())(n),Ue={resolve:(...n)=>{for(var o="",a=!1,u=n.length-1;u>=-1&&!a;u--){var h=u>=0?n[u]:c.cwd();if(typeof h!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!h)return"";o=h+"/"+o,a=J.isAbs(h)}return o=J.normalizeArray(o.split("/").filter(g=>!!g),!a).join("/"),(a?"/":"")+o||"."},relative:(n,o)=>{n=Ue.resolve(n).substr(1),o=Ue.resolve(o).substr(1);function a(V){for(var X=0;X<V.length&&V[X]==="";X++);for(var Q=V.length-1;Q>=0&&V[Q]==="";Q--);return X>Q?[]:V.slice(X,Q-X+1)}for(var u=a(n.split("/")),h=a(o.split("/")),g=Math.min(u.length,h.length),_=g,b=0;b<g;b++)if(u[b]!==h[b]){_=b;break}for(var M=[],b=_;b<u.length;b++)M.push("..");return M=M.concat(h.slice(_)),M.join("/")}},gr=[];function bn(n,o,a){var u=Xt(n)+1,h=new Array(u),g=pr(n,h,0,h.length);return h.length=g,h}var To=()=>{if(!gr.length){var n=null;if(p){var o=256,a=Buffer.alloc(o),u=0,h=process.stdin.fd;try{u=te.readSync(h,a,0,o)}catch(g){if(g.toString().includes("EOF"))u=0;else throw g}u>0&&(n=a.slice(0,u).toString("utf-8"))}else typeof window<"u"&&typeof window.prompt=="function"&&(n=window.prompt("Input: "),n!==null&&(n+=`
`));if(!n)return null;gr=bn(n)}return gr.shift()},Xe={ttys:[],init(){},shutdown(){},register(n,o){Xe.ttys[n]={input:[],output:[],ops:o},c.registerDevice(n,Xe.stream_ops)},stream_ops:{open(n){var o=Xe.ttys[n.node.rdev];if(!o)throw new c.ErrnoError(43);n.tty=o,n.seekable=!1},close(n){n.tty.ops.fsync(n.tty)},fsync(n){n.tty.ops.fsync(n.tty)},read(n,o,a,u,h){if(!n.tty||!n.tty.ops.get_char)throw new c.ErrnoError(60);for(var g=0,_=0;_<u;_++){var b;try{b=n.tty.ops.get_char(n.tty)}catch{throw new c.ErrnoError(29)}if(b===void 0&&g===0)throw new c.ErrnoError(6);if(b==null)break;g++,o[a+_]=b}return g&&(n.node.timestamp=Date.now()),g},write(n,o,a,u,h){if(!n.tty||!n.tty.ops.put_char)throw new c.ErrnoError(60);try{for(var g=0;g<u;g++)n.tty.ops.put_char(n.tty,o[a+g])}catch{throw new c.ErrnoError(29)}return u&&(n.node.timestamp=Date.now()),g}},default_tty_ops:{get_char(n){return To()},put_char(n,o){o===null||o===10?(ne(ft(n.output)),n.output=[]):o!=0&&n.output.push(o)},fsync(n){n.output&&n.output.length>0&&(ne(ft(n.output)),n.output=[])},ioctl_tcgets(n){return{c_iflag:25856,c_oflag:5,c_cflag:191,c_lflag:35387,c_cc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},ioctl_tcsets(n,o,a){return 0},ioctl_tiocgwinsz(n){return[24,80]}},default_tty1_ops:{put_char(n,o){o===null||o===10?(U(ft(n.output)),n.output=[]):o!=0&&n.output.push(o)},fsync(n){n.output&&n.output.length>0&&(U(ft(n.output)),n.output=[])}}},kn=n=>{ie("internal error: mmapAlloc called but `emscripten_builtin_memalign` native symbol not exported")},D={ops_table:null,mount(n){return D.createNode(null,"/",16895,0)},createNode(n,o,a,u){if(c.isBlkdev(a)||c.isFIFO(a))throw new c.ErrnoError(63);D.ops_table||={dir:{node:{getattr:D.node_ops.getattr,setattr:D.node_ops.setattr,lookup:D.node_ops.lookup,mknod:D.node_ops.mknod,rename:D.node_ops.rename,unlink:D.node_ops.unlink,rmdir:D.node_ops.rmdir,readdir:D.node_ops.readdir,symlink:D.node_ops.symlink},stream:{llseek:D.stream_ops.llseek}},file:{node:{getattr:D.node_ops.getattr,setattr:D.node_ops.setattr},stream:{llseek:D.stream_ops.llseek,read:D.stream_ops.read,write:D.stream_ops.write,allocate:D.stream_ops.allocate,mmap:D.stream_ops.mmap,msync:D.stream_ops.msync}},link:{node:{getattr:D.node_ops.getattr,setattr:D.node_ops.setattr,readlink:D.node_ops.readlink},stream:{}},chrdev:{node:{getattr:D.node_ops.getattr,setattr:D.node_ops.setattr},stream:c.chrdev_stream_ops}};var h=c.createNode(n,o,a,u);return c.isDir(h.mode)?(h.node_ops=D.ops_table.dir.node,h.stream_ops=D.ops_table.dir.stream,h.contents={}):c.isFile(h.mode)?(h.node_ops=D.ops_table.file.node,h.stream_ops=D.ops_table.file.stream,h.usedBytes=0,h.contents=null):c.isLink(h.mode)?(h.node_ops=D.ops_table.link.node,h.stream_ops=D.ops_table.link.stream):c.isChrdev(h.mode)&&(h.node_ops=D.ops_table.chrdev.node,h.stream_ops=D.ops_table.chrdev.stream),h.timestamp=Date.now(),n&&(n.contents[o]=h,n.timestamp=h.timestamp),h},getFileDataAsTypedArray(n){return n.contents?n.contents.subarray?n.contents.subarray(0,n.usedBytes):new Uint8Array(n.contents):new Uint8Array(0)},expandFileStorage(n,o){var a=n.contents?n.contents.length:0;if(!(a>=o)){var u=1024*1024;o=Math.max(o,a*(a<u?2:1.125)>>>0),a!=0&&(o=Math.max(o,256));var h=n.contents;n.contents=new Uint8Array(o),n.usedBytes>0&&n.contents.set(h.subarray(0,n.usedBytes),0)}},resizeFileStorage(n,o){if(n.usedBytes!=o)if(o==0)n.contents=null,n.usedBytes=0;else{var a=n.contents;n.contents=new Uint8Array(o),a&&n.contents.set(a.subarray(0,Math.min(o,n.usedBytes))),n.usedBytes=o}},node_ops:{getattr(n){var o={};return o.dev=c.isChrdev(n.mode)?n.id:1,o.ino=n.id,o.mode=n.mode,o.nlink=1,o.uid=0,o.gid=0,o.rdev=n.rdev,c.isDir(n.mode)?o.size=4096:c.isFile(n.mode)?o.size=n.usedBytes:c.isLink(n.mode)?o.size=n.link.length:o.size=0,o.atime=new Date(n.timestamp),o.mtime=new Date(n.timestamp),o.ctime=new Date(n.timestamp),o.blksize=4096,o.blocks=Math.ceil(o.size/o.blksize),o},setattr(n,o){o.mode!==void 0&&(n.mode=o.mode),o.timestamp!==void 0&&(n.timestamp=o.timestamp),o.size!==void 0&&D.resizeFileStorage(n,o.size)},lookup(n,o){throw new c.ErrnoError(44)},mknod(n,o,a,u){return D.createNode(n,o,a,u)},rename(n,o,a){if(c.isDir(n.mode)){var u;try{u=c.lookupNode(o,a)}catch{}if(u)for(var h in u.contents)throw new c.ErrnoError(55)}delete n.parent.contents[n.name],n.parent.timestamp=Date.now(),n.name=a,o.contents[a]=n,o.timestamp=n.parent.timestamp},unlink(n,o){delete n.contents[o],n.timestamp=Date.now()},rmdir(n,o){var a=c.lookupNode(n,o);for(var u in a.contents)throw new c.ErrnoError(55);delete n.contents[o],n.timestamp=Date.now()},readdir(n){var o=[".",".."];for(var a of Object.keys(n.contents))o.push(a);return o},symlink(n,o,a){var u=D.createNode(n,o,41471,0);return u.link=a,u},readlink(n){if(!c.isLink(n.mode))throw new c.ErrnoError(28);return n.link}},stream_ops:{read(n,o,a,u,h){var g=n.node.contents;if(h>=n.node.usedBytes)return 0;var _=Math.min(n.node.usedBytes-h,u);if(C(_>=0),_>8&&g.subarray)o.set(g.subarray(h,h+_),a);else for(var b=0;b<_;b++)o[a+b]=g[h+b];return _},write(n,o,a,u,h,g){if(C(!(o instanceof ArrayBuffer)),o.buffer===Y.buffer&&(g=!1),!u)return 0;var _=n.node;if(_.timestamp=Date.now(),o.subarray&&(!_.contents||_.contents.subarray)){if(g)return C(h===0,"canOwn must imply no weird position inside the file"),_.contents=o.subarray(a,a+u),_.usedBytes=u,u;if(_.usedBytes===0&&h===0)return _.contents=o.slice(a,a+u),_.usedBytes=u,u;if(h+u<=_.usedBytes)return _.contents.set(o.subarray(a,a+u),h),u}if(D.expandFileStorage(_,h+u),_.contents.subarray&&o.subarray)_.contents.set(o.subarray(a,a+u),h);else for(var b=0;b<u;b++)_.contents[h+b]=o[a+b];return _.usedBytes=Math.max(_.usedBytes,h+u),u},llseek(n,o,a){var u=o;if(a===1?u+=n.position:a===2&&c.isFile(n.node.mode)&&(u+=n.node.usedBytes),u<0)throw new c.ErrnoError(28);return u},allocate(n,o,a){D.expandFileStorage(n.node,o+a),n.node.usedBytes=Math.max(n.node.usedBytes,o+a)},mmap(n,o,a,u,h){if(!c.isFile(n.node.mode))throw new c.ErrnoError(43);var g,_,b=n.node.contents;if(!(h&2)&&b&&b.buffer===Y.buffer)_=!1,g=b.byteOffset;else{if(_=!0,g=kn(),!g)throw new c.ErrnoError(48);b&&((a>0||a+o<b.length)&&(b.subarray?b=b.subarray(a,a+o):b=Array.prototype.slice.call(b,a,a+o)),Y.set(b,g))}return{ptr:g,allocated:_}},msync(n,o,a,u,h){return D.stream_ops.write(n,o,0,u,a,!1),0}}},Ao=(n,o,a,u)=>{var h=un(`al ${n}`);O(n).then(g=>{C(g,`Loading data file "${n}" failed (no arrayBuffer).`),o(new Uint8Array(g)),h&&Yt(h)},g=>{if(a)a();else throw`Loading data file "${n}" failed.`}),h&&fr(h)},Mo=(n,o,a,u,h,g)=>{c.createDataFile(n,o,a,u,h,g)},Oo=i.preloadPlugins||[],Ro=(n,o,a,u)=>{typeof Browser<"u"&&Browser.init();var h=!1;return Oo.forEach(g=>{h||g.canHandle(o)&&(g.handle(n,o,a,u),h=!0)}),h},Fo=(n,o,a,u,h,g,_,b,M,V)=>{var X=o?Ue.resolve(J.join2(n,o)):n,Q=un(`cp ${X}`);function q(F){function H(he){V?.(),b||Mo(n,o,he,u,h,M),g?.(),Yt(Q)}Ro(F,X,H,()=>{_?.(),Yt(Q)})||H(F)}fr(Q),typeof a=="string"?Ao(a,q,_):q(a)},xo=n=>{var o={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},a=o[n];if(typeof a>"u")throw new Error(`Unknown file open mode: ${n}`);return a},_r=(n,o)=>{var a=0;return n&&(a|=365),o&&(a|=146),a},No=n=>ht(Ho(n)),yn={EPERM:63,ENOENT:44,ESRCH:71,EINTR:27,EIO:29,ENXIO:60,E2BIG:1,ENOEXEC:45,EBADF:8,ECHILD:12,EAGAIN:6,EWOULDBLOCK:6,ENOMEM:48,EACCES:2,EFAULT:21,ENOTBLK:105,EBUSY:10,EEXIST:20,EXDEV:75,ENODEV:43,ENOTDIR:54,EISDIR:31,EINVAL:28,ENFILE:41,EMFILE:33,ENOTTY:59,ETXTBSY:74,EFBIG:22,ENOSPC:51,ESPIPE:70,EROFS:69,EMLINK:34,EPIPE:64,EDOM:18,ERANGE:68,ENOMSG:49,EIDRM:24,ECHRNG:106,EL2NSYNC:156,EL3HLT:107,EL3RST:108,ELNRNG:109,EUNATCH:110,ENOCSI:111,EL2HLT:112,EDEADLK:16,ENOLCK:46,EBADE:113,EBADR:114,EXFULL:115,ENOANO:104,EBADRQC:103,EBADSLT:102,EDEADLOCK:16,EBFONT:101,ENOSTR:100,ENODATA:116,ETIME:117,ENOSR:118,ENONET:119,ENOPKG:120,EREMOTE:121,ENOLINK:47,EADV:122,ESRMNT:123,ECOMM:124,EPROTO:65,EMULTIHOP:36,EDOTDOT:125,EBADMSG:9,ENOTUNIQ:126,EBADFD:127,EREMCHG:128,ELIBACC:129,ELIBBAD:130,ELIBSCN:131,ELIBMAX:132,ELIBEXEC:133,ENOSYS:52,ENOTEMPTY:55,ENAMETOOLONG:37,ELOOP:32,EOPNOTSUPP:138,EPFNOSUPPORT:139,ECONNRESET:15,ENOBUFS:42,EAFNOSUPPORT:5,EPROTOTYPE:67,ENOTSOCK:57,ENOPROTOOPT:50,ESHUTDOWN:140,ECONNREFUSED:14,EADDRINUSE:3,ECONNABORTED:13,ENETUNREACH:40,ENETDOWN:38,ETIMEDOUT:73,EHOSTDOWN:142,EHOSTUNREACH:23,EINPROGRESS:26,EALREADY:7,EDESTADDRREQ:17,EMSGSIZE:35,EPROTONOSUPPORT:66,ESOCKTNOSUPPORT:137,EADDRNOTAVAIL:4,ENETRESET:39,EISCONN:30,ENOTCONN:53,ETOOMANYREFS:141,EUSERS:136,EDQUOT:19,ESTALE:72,ENOTSUP:138,ENOMEDIUM:148,EILSEQ:25,EOVERFLOW:61,ECANCELED:11,ENOTRECOVERABLE:56,EOWNERDEAD:62,ESTRPIPE:135},c={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,ErrnoError:class extends Error{name="ErrnoError";constructor(n){super(ut?No(n):""),this.errno=n;for(var o in yn)if(yn[o]===n){this.code=o;break}}},filesystems:null,syncFSRequests:0,readFiles:{},FSStream:class{shared={};get object(){return this.node}set object(n){this.node=n}get isRead(){return(this.flags&2097155)!==1}get isWrite(){return(this.flags&2097155)!==0}get isAppend(){return this.flags&1024}get flags(){return this.shared.flags}set flags(n){this.shared.flags=n}get position(){return this.shared.position}set position(n){this.shared.position=n}},FSNode:class{node_ops={};stream_ops={};readMode=365;writeMode=146;mounted=null;constructor(n,o,a,u){n||(n=this),this.parent=n,this.mount=n.mount,this.id=c.nextInode++,this.name=o,this.mode=a,this.rdev=u}get read(){return(this.mode&this.readMode)===this.readMode}set read(n){n?this.mode|=this.readMode:this.mode&=~this.readMode}get write(){return(this.mode&this.writeMode)===this.writeMode}set write(n){n?this.mode|=this.writeMode:this.mode&=~this.writeMode}get isFolder(){return c.isDir(this.mode)}get isDevice(){return c.isChrdev(this.mode)}},lookupPath(n,o={}){if(n=Ue.resolve(n),!n)return{path:"",node:null};var a={follow_mount:!0,recurse_count:0};if(o=Object.assign(a,o),o.recurse_count>8)throw new c.ErrnoError(32);for(var u=n.split("/").filter(Q=>!!Q),h=c.root,g="/",_=0;_<u.length;_++){var b=_===u.length-1;if(b&&o.parent)break;if(h=c.lookupNode(h,u[_]),g=J.join2(g,u[_]),c.isMountpoint(h)&&(!b||b&&o.follow_mount)&&(h=h.mounted.root),!b||o.follow)for(var M=0;c.isLink(h.mode);){var V=c.readlink(g);g=Ue.resolve(J.dirname(g),V);var X=c.lookupPath(g,{recurse_count:o.recurse_count+1});if(h=X.node,M++>40)throw new c.ErrnoError(32)}}return{path:g,node:h}},getPath(n){for(var o;;){if(c.isRoot(n)){var a=n.mount.mountpoint;return o?a[a.length-1]!=="/"?`${a}/${o}`:a+o:a}o=o?`${n.name}/${o}`:n.name,n=n.parent}},hashName(n,o){for(var a=0,u=0;u<o.length;u++)a=(a<<5)-a+o.charCodeAt(u)|0;return(n+a>>>0)%c.nameTable.length},hashAddNode(n){var o=c.hashName(n.parent.id,n.name);n.name_next=c.nameTable[o],c.nameTable[o]=n},hashRemoveNode(n){var o=c.hashName(n.parent.id,n.name);if(c.nameTable[o]===n)c.nameTable[o]=n.name_next;else for(var a=c.nameTable[o];a;){if(a.name_next===n){a.name_next=n.name_next;break}a=a.name_next}},lookupNode(n,o){var a=c.mayLookup(n);if(a)throw new c.ErrnoError(a);for(var u=c.hashName(n.id,o),h=c.nameTable[u];h;h=h.name_next){var g=h.name;if(h.parent.id===n.id&&g===o)return h}return c.lookup(n,o)},createNode(n,o,a,u){C(typeof n=="object");var h=new c.FSNode(n,o,a,u);return c.hashAddNode(h),h},destroyNode(n){c.hashRemoveNode(n)},isRoot(n){return n===n.parent},isMountpoint(n){return!!n.mounted},isFile(n){return(n&61440)===32768},isDir(n){return(n&61440)===16384},isLink(n){return(n&61440)===40960},isChrdev(n){return(n&61440)===8192},isBlkdev(n){return(n&61440)===24576},isFIFO(n){return(n&61440)===4096},isSocket(n){return(n&49152)===49152},flagsToPermissionString(n){var o=["r","w","rw"][n&3];return n&512&&(o+="w"),o},nodePermissions(n,o){return c.ignorePermissions?0:o.includes("r")&&!(n.mode&292)||o.includes("w")&&!(n.mode&146)||o.includes("x")&&!(n.mode&73)?2:0},mayLookup(n){if(!c.isDir(n.mode))return 54;var o=c.nodePermissions(n,"x");return o||(n.node_ops.lookup?0:2)},mayCreate(n,o){try{var a=c.lookupNode(n,o);return 20}catch{}return c.nodePermissions(n,"wx")},mayDelete(n,o,a){var u;try{u=c.lookupNode(n,o)}catch(g){return g.errno}var h=c.nodePermissions(n,"wx");if(h)return h;if(a){if(!c.isDir(u.mode))return 54;if(c.isRoot(u)||c.getPath(u)===c.cwd())return 10}else if(c.isDir(u.mode))return 31;return 0},mayOpen(n,o){return n?c.isLink(n.mode)?32:c.isDir(n.mode)&&(c.flagsToPermissionString(o)!=="r"||o&512)?31:c.nodePermissions(n,c.flagsToPermissionString(o)):44},MAX_OPEN_FDS:4096,nextfd(){for(var n=0;n<=c.MAX_OPEN_FDS;n++)if(!c.streams[n])return n;throw new c.ErrnoError(33)},getStreamChecked(n){var o=c.getStream(n);if(!o)throw new c.ErrnoError(8);return o},getStream:n=>c.streams[n],createStream(n,o=-1){return C(o>=-1),n=Object.assign(new c.FSStream,n),o==-1&&(o=c.nextfd()),n.fd=o,c.streams[o]=n,n},closeStream(n){c.streams[n]=null},dupStream(n,o=-1){var a=c.createStream(n,o);return a.stream_ops?.dup?.(a),a},chrdev_stream_ops:{open(n){var o=c.getDevice(n.node.rdev);n.stream_ops=o.stream_ops,n.stream_ops.open?.(n)},llseek(){throw new c.ErrnoError(70)}},major:n=>n>>8,minor:n=>n&255,makedev:(n,o)=>n<<8|o,registerDevice(n,o){c.devices[n]={stream_ops:o}},getDevice:n=>c.devices[n],getMounts(n){for(var o=[],a=[n];a.length;){var u=a.pop();o.push(u),a.push(...u.mounts)}return o},syncfs(n,o){typeof n=="function"&&(o=n,n=!1),c.syncFSRequests++,c.syncFSRequests>1&&U(`warning: ${c.syncFSRequests} FS.syncfs operations in flight at once, probably just doing extra work`);var a=c.getMounts(c.root.mount),u=0;function h(_){return C(c.syncFSRequests>0),c.syncFSRequests--,o(_)}function g(_){if(_)return g.errored?void 0:(g.errored=!0,h(_));++u>=a.length&&h(null)}a.forEach(_=>{if(!_.type.syncfs)return g(null);_.type.syncfs(_,n,g)})},mount(n,o,a){if(typeof n=="string")throw n;var u=a==="/",h=!a,g;if(u&&c.root)throw new c.ErrnoError(10);if(!u&&!h){var _=c.lookupPath(a,{follow_mount:!1});if(a=_.path,g=_.node,c.isMountpoint(g))throw new c.ErrnoError(10);if(!c.isDir(g.mode))throw new c.ErrnoError(54)}var b={type:n,opts:o,mountpoint:a,mounts:[]},M=n.mount(b);return M.mount=b,b.root=M,u?c.root=M:g&&(g.mounted=b,g.mount&&g.mount.mounts.push(b)),M},unmount(n){var o=c.lookupPath(n,{follow_mount:!1});if(!c.isMountpoint(o.node))throw new c.ErrnoError(28);var a=o.node,u=a.mounted,h=c.getMounts(u);Object.keys(c.nameTable).forEach(_=>{for(var b=c.nameTable[_];b;){var M=b.name_next;h.includes(b.mount)&&c.destroyNode(b),b=M}}),a.mounted=null;var g=a.mount.mounts.indexOf(u);C(g!==-1),a.mount.mounts.splice(g,1)},lookup(n,o){return n.node_ops.lookup(n,o)},mknod(n,o,a){var u=c.lookupPath(n,{parent:!0}),h=u.node,g=J.basename(n);if(!g||g==="."||g==="..")throw new c.ErrnoError(28);var _=c.mayCreate(h,g);if(_)throw new c.ErrnoError(_);if(!h.node_ops.mknod)throw new c.ErrnoError(63);return h.node_ops.mknod(h,g,o,a)},statfs(n){var o={bsize:4096,frsize:4096,blocks:1e6,bfree:5e5,bavail:5e5,files:c.nextInode,ffree:c.nextInode-1,fsid:42,flags:2,namelen:255},a=c.lookupPath(n,{follow:!0}).node;return a?.node_ops.statfs&&Object.assign(o,a.node_ops.statfs(a.mount.opts.root)),o},create(n,o=438){return o&=4095,o|=32768,c.mknod(n,o,0)},mkdir(n,o=511){return o&=1023,o|=16384,c.mknod(n,o,0)},mkdirTree(n,o){for(var a=n.split("/"),u="",h=0;h<a.length;++h)if(a[h]){u+="/"+a[h];try{c.mkdir(u,o)}catch(g){if(g.errno!=20)throw g}}},mkdev(n,o,a){return typeof a>"u"&&(a=o,o=438),o|=8192,c.mknod(n,o,a)},symlink(n,o){if(!Ue.resolve(n))throw new c.ErrnoError(44);var a=c.lookupPath(o,{parent:!0}),u=a.node;if(!u)throw new c.ErrnoError(44);var h=J.basename(o),g=c.mayCreate(u,h);if(g)throw new c.ErrnoError(g);if(!u.node_ops.symlink)throw new c.ErrnoError(63);return u.node_ops.symlink(u,h,n)},rename(n,o){var a=J.dirname(n),u=J.dirname(o),h=J.basename(n),g=J.basename(o),_,b,M;if(_=c.lookupPath(n,{parent:!0}),b=_.node,_=c.lookupPath(o,{parent:!0}),M=_.node,!b||!M)throw new c.ErrnoError(44);if(b.mount!==M.mount)throw new c.ErrnoError(75);var V=c.lookupNode(b,h),X=Ue.relative(n,u);if(X.charAt(0)!==".")throw new c.ErrnoError(28);if(X=Ue.relative(o,a),X.charAt(0)!==".")throw new c.ErrnoError(55);var Q;try{Q=c.lookupNode(M,g)}catch{}if(V!==Q){var q=c.isDir(V.mode),F=c.mayDelete(b,h,q);if(F)throw new c.ErrnoError(F);if(F=Q?c.mayDelete(M,g,q):c.mayCreate(M,g),F)throw new c.ErrnoError(F);if(!b.node_ops.rename)throw new c.ErrnoError(63);if(c.isMountpoint(V)||Q&&c.isMountpoint(Q))throw new c.ErrnoError(10);if(M!==b&&(F=c.nodePermissions(b,"w"),F))throw new c.ErrnoError(F);c.hashRemoveNode(V);try{b.node_ops.rename(V,M,g),V.parent=M}catch(H){throw H}finally{c.hashAddNode(V)}}},rmdir(n){var o=c.lookupPath(n,{parent:!0}),a=o.node,u=J.basename(n),h=c.lookupNode(a,u),g=c.mayDelete(a,u,!0);if(g)throw new c.ErrnoError(g);if(!a.node_ops.rmdir)throw new c.ErrnoError(63);if(c.isMountpoint(h))throw new c.ErrnoError(10);a.node_ops.rmdir(a,u),c.destroyNode(h)},readdir(n){var o=c.lookupPath(n,{follow:!0}),a=o.node;if(!a.node_ops.readdir)throw new c.ErrnoError(54);return a.node_ops.readdir(a)},unlink(n){var o=c.lookupPath(n,{parent:!0}),a=o.node;if(!a)throw new c.ErrnoError(44);var u=J.basename(n),h=c.lookupNode(a,u),g=c.mayDelete(a,u,!1);if(g)throw new c.ErrnoError(g);if(!a.node_ops.unlink)throw new c.ErrnoError(63);if(c.isMountpoint(h))throw new c.ErrnoError(10);a.node_ops.unlink(a,u),c.destroyNode(h)},readlink(n){var o=c.lookupPath(n),a=o.node;if(!a)throw new c.ErrnoError(44);if(!a.node_ops.readlink)throw new c.ErrnoError(28);return a.node_ops.readlink(a)},stat(n,o){var a=c.lookupPath(n,{follow:!o}),u=a.node;if(!u)throw new c.ErrnoError(44);if(!u.node_ops.getattr)throw new c.ErrnoError(63);return u.node_ops.getattr(u)},lstat(n){return c.stat(n,!0)},chmod(n,o,a){var u;if(typeof n=="string"){var h=c.lookupPath(n,{follow:!a});u=h.node}else u=n;if(!u.node_ops.setattr)throw new c.ErrnoError(63);u.node_ops.setattr(u,{mode:o&4095|u.mode&-4096,timestamp:Date.now()})},lchmod(n,o){c.chmod(n,o,!0)},fchmod(n,o){var a=c.getStreamChecked(n);c.chmod(a.node,o)},chown(n,o,a,u){var h;if(typeof n=="string"){var g=c.lookupPath(n,{follow:!u});h=g.node}else h=n;if(!h.node_ops.setattr)throw new c.ErrnoError(63);h.node_ops.setattr(h,{timestamp:Date.now()})},lchown(n,o,a){c.chown(n,o,a,!0)},fchown(n,o,a){var u=c.getStreamChecked(n);c.chown(u.node,o,a)},truncate(n,o){if(o<0)throw new c.ErrnoError(28);var a;if(typeof n=="string"){var u=c.lookupPath(n,{follow:!0});a=u.node}else a=n;if(!a.node_ops.setattr)throw new c.ErrnoError(63);if(c.isDir(a.mode))throw new c.ErrnoError(31);if(!c.isFile(a.mode))throw new c.ErrnoError(28);var h=c.nodePermissions(a,"w");if(h)throw new c.ErrnoError(h);a.node_ops.setattr(a,{size:o,timestamp:Date.now()})},ftruncate(n,o){var a=c.getStreamChecked(n);if((a.flags&2097155)===0)throw new c.ErrnoError(28);c.truncate(a.node,o)},utime(n,o,a){var u=c.lookupPath(n,{follow:!0}),h=u.node;h.node_ops.setattr(h,{timestamp:Math.max(o,a)})},open(n,o,a=438){if(n==="")throw new c.ErrnoError(44);o=typeof o=="string"?xo(o):o,o&64?a=a&4095|32768:a=0;var u;if(typeof n=="object")u=n;else{n=J.normalize(n);try{var h=c.lookupPath(n,{follow:!(o&131072)});u=h.node}catch{}}var g=!1;if(o&64)if(u){if(o&128)throw new c.ErrnoError(20)}else u=c.mknod(n,a,0),g=!0;if(!u)throw new c.ErrnoError(44);if(c.isChrdev(u.mode)&&(o&=-513),o&65536&&!c.isDir(u.mode))throw new c.ErrnoError(54);if(!g){var _=c.mayOpen(u,o);if(_)throw new c.ErrnoError(_)}o&512&&!g&&c.truncate(u,0),o&=-131713;var b=c.createStream({node:u,path:c.getPath(u),flags:o,seekable:!0,position:0,stream_ops:u.stream_ops,ungotten:[],error:!1});return b.stream_ops.open&&b.stream_ops.open(b),i.logReadFiles&&!(o&1)&&(n in c.readFiles||(c.readFiles[n]=1)),b},close(n){if(c.isClosed(n))throw new c.ErrnoError(8);n.getdents&&(n.getdents=null);try{n.stream_ops.close&&n.stream_ops.close(n)}catch(o){throw o}finally{c.closeStream(n.fd)}n.fd=null},isClosed(n){return n.fd===null},llseek(n,o,a){if(c.isClosed(n))throw new c.ErrnoError(8);if(!n.seekable||!n.stream_ops.llseek)throw new c.ErrnoError(70);if(a!=0&&a!=1&&a!=2)throw new c.ErrnoError(28);return n.position=n.stream_ops.llseek(n,o,a),n.ungotten=[],n.position},read(n,o,a,u,h){if(C(a>=0),u<0||h<0)throw new c.ErrnoError(28);if(c.isClosed(n))throw new c.ErrnoError(8);if((n.flags&2097155)===1)throw new c.ErrnoError(8);if(c.isDir(n.node.mode))throw new c.ErrnoError(31);if(!n.stream_ops.read)throw new c.ErrnoError(28);var g=typeof h<"u";if(!g)h=n.position;else if(!n.seekable)throw new c.ErrnoError(70);var _=n.stream_ops.read(n,o,a,u,h);return g||(n.position+=_),_},write(n,o,a,u,h,g){if(C(a>=0),u<0||h<0)throw new c.ErrnoError(28);if(c.isClosed(n))throw new c.ErrnoError(8);if((n.flags&2097155)===0)throw new c.ErrnoError(8);if(c.isDir(n.node.mode))throw new c.ErrnoError(31);if(!n.stream_ops.write)throw new c.ErrnoError(28);n.seekable&&n.flags&1024&&c.llseek(n,0,2);var _=typeof h<"u";if(!_)h=n.position;else if(!n.seekable)throw new c.ErrnoError(70);var b=n.stream_ops.write(n,o,a,u,h,g);return _||(n.position+=b),b},allocate(n,o,a){if(c.isClosed(n))throw new c.ErrnoError(8);if(o<0||a<=0)throw new c.ErrnoError(28);if((n.flags&2097155)===0)throw new c.ErrnoError(8);if(!c.isFile(n.node.mode)&&!c.isDir(n.node.mode))throw new c.ErrnoError(43);if(!n.stream_ops.allocate)throw new c.ErrnoError(138);n.stream_ops.allocate(n,o,a)},mmap(n,o,a,u,h){if((u&2)!==0&&(h&2)===0&&(n.flags&2097155)!==2)throw new c.ErrnoError(2);if((n.flags&2097155)===1)throw new c.ErrnoError(2);if(!n.stream_ops.mmap)throw new c.ErrnoError(43);if(!o)throw new c.ErrnoError(28);return n.stream_ops.mmap(n,o,a,u,h)},msync(n,o,a,u,h){return C(a>=0),n.stream_ops.msync?n.stream_ops.msync(n,o,a,u,h):0},ioctl(n,o,a){if(!n.stream_ops.ioctl)throw new c.ErrnoError(59);return n.stream_ops.ioctl(n,o,a)},readFile(n,o={}){if(o.flags=o.flags||0,o.encoding=o.encoding||"binary",o.encoding!=="utf8"&&o.encoding!=="binary")throw new Error(`Invalid encoding type "${o.encoding}"`);var a,u=c.open(n,o.flags),h=c.stat(n),g=h.size,_=new Uint8Array(g);return c.read(u,_,0,g,0),o.encoding==="utf8"?a=ft(_):o.encoding==="binary"&&(a=_),c.close(u),a},writeFile(n,o,a={}){a.flags=a.flags||577;var u=c.open(n,a.flags,a.mode);if(typeof o=="string"){var h=new Uint8Array(Xt(o)+1),g=pr(o,h,0,h.length);c.write(u,h,0,g,void 0,a.canOwn)}else if(ArrayBuffer.isView(o))c.write(u,o,0,o.byteLength,void 0,a.canOwn);else throw new Error("Unsupported data type");c.close(u)},cwd:()=>c.currentPath,chdir(n){var o=c.lookupPath(n,{follow:!0});if(o.node===null)throw new c.ErrnoError(44);if(!c.isDir(o.node.mode))throw new c.ErrnoError(54);var a=c.nodePermissions(o.node,"x");if(a)throw new c.ErrnoError(a);c.currentPath=o.path},createDefaultDirectories(){c.mkdir("/tmp"),c.mkdir("/home"),c.mkdir("/home/web_user")},createDefaultDevices(){c.mkdir("/dev"),c.registerDevice(c.makedev(1,3),{read:()=>0,write:(u,h,g,_,b)=>_,llseek:()=>0}),c.mkdev("/dev/null",c.makedev(1,3)),Xe.register(c.makedev(5,0),Xe.default_tty_ops),Xe.register(c.makedev(6,0),Xe.default_tty1_ops),c.mkdev("/dev/tty",c.makedev(5,0)),c.mkdev("/dev/tty1",c.makedev(6,0));var n=new Uint8Array(1024),o=0,a=()=>(o===0&&(o=wn(n).byteLength),n[--o]);c.createDevice("/dev","random",a),c.createDevice("/dev","urandom",a),c.mkdir("/dev/shm"),c.mkdir("/dev/shm/tmp")},createSpecialDirectories(){c.mkdir("/proc");var n=c.mkdir("/proc/self");c.mkdir("/proc/self/fd"),c.mount({mount(){var o=c.createNode(n,"fd",16895,73);return o.node_ops={lookup(a,u){var h=+u,g=c.getStreamChecked(h),_={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>g.path}};return _.parent=_,_}},o}},{},"/proc/self/fd")},createStandardStreams(n,o,a){n?c.createDevice("/dev","stdin",n):c.symlink("/dev/tty","/dev/stdin"),o?c.createDevice("/dev","stdout",null,o):c.symlink("/dev/tty","/dev/stdout"),a?c.createDevice("/dev","stderr",null,a):c.symlink("/dev/tty1","/dev/stderr");var u=c.open("/dev/stdin",0),h=c.open("/dev/stdout",1),g=c.open("/dev/stderr",1);C(u.fd===0,`invalid handle for stdin (${u.fd})`),C(h.fd===1,`invalid handle for stdout (${h.fd})`),C(g.fd===2,`invalid handle for stderr (${g.fd})`)},staticInit(){c.nameTable=new Array(4096),c.mount(D,{},"/"),c.createDefaultDirectories(),c.createDefaultDevices(),c.createSpecialDirectories(),c.filesystems={MEMFS:D}},init(n,o,a){C(!c.initialized,"FS.init was previously called. If you want to initialize later with custom parameters, remove any earlier calls (note that one is automatically added to the generated code)"),c.initialized=!0,n??=i.stdin,o??=i.stdout,a??=i.stderr,c.createStandardStreams(n,o,a)},quit(){c.initialized=!1,Wo(0);for(var n=0;n<c.streams.length;n++){var o=c.streams[n];o&&c.close(o)}},findObject(n,o){var a=c.analyzePath(n,o);return a.exists?a.object:null},analyzePath(n,o){try{var a=c.lookupPath(n,{follow:!o});n=a.path}catch{}var u={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var a=c.lookupPath(n,{parent:!0});u.parentExists=!0,u.parentPath=a.path,u.parentObject=a.node,u.name=J.basename(n),a=c.lookupPath(n,{follow:!o}),u.exists=!0,u.path=a.path,u.object=a.node,u.name=a.node.name,u.isRoot=a.path==="/"}catch(h){u.error=h.errno}return u},createPath(n,o,a,u){n=typeof n=="string"?n:c.getPath(n);for(var h=o.split("/").reverse();h.length;){var g=h.pop();if(g){var _=J.join2(n,g);try{c.mkdir(_)}catch{}n=_}}return _},createFile(n,o,a,u,h){var g=J.join2(typeof n=="string"?n:c.getPath(n),o),_=_r(u,h);return c.create(g,_)},createDataFile(n,o,a,u,h,g){var _=o;n&&(n=typeof n=="string"?n:c.getPath(n),_=o?J.join2(n,o):n);var b=_r(u,h),M=c.create(_,b);if(a){if(typeof a=="string"){for(var V=new Array(a.length),X=0,Q=a.length;X<Q;++X)V[X]=a.charCodeAt(X);a=V}c.chmod(M,b|146);var q=c.open(M,577);c.write(q,a,0,a.length,0,g),c.close(q),c.chmod(M,b)}},createDevice(n,o,a,u){var h=J.join2(typeof n=="string"?n:c.getPath(n),o),g=_r(!!a,!!u);c.createDevice.major??=64;var _=c.makedev(c.createDevice.major++,0);return c.registerDevice(_,{open(b){b.seekable=!1},close(b){u?.buffer?.length&&u(10)},read(b,M,V,X,Q){for(var q=0,F=0;F<X;F++){var H;try{H=a()}catch{throw new c.ErrnoError(29)}if(H===void 0&&q===0)throw new c.ErrnoError(6);if(H==null)break;q++,M[V+F]=H}return q&&(b.node.timestamp=Date.now()),q},write(b,M,V,X,Q){for(var q=0;q<X;q++)try{u(M[V+q])}catch{throw new c.ErrnoError(29)}return X&&(b.node.timestamp=Date.now()),q}}),c.mkdev(h,g,_)},forceLoadFile(n){if(n.isDevice||n.isFolder||n.link||n.contents)return!0;if(typeof XMLHttpRequest<"u")throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");try{n.contents=T(n.url),n.usedBytes=n.contents.length}catch{throw new c.ErrnoError(29)}},createLazyFile(n,o,a,u,h){class g{lengthKnown=!1;chunks=[];get(F){if(!(F>this.length-1||F<0)){var H=F%this.chunkSize,he=F/this.chunkSize|0;return this.getter(he)[H]}}setDataGetter(F){this.getter=F}cacheLength(){var F=new XMLHttpRequest;if(F.open("HEAD",a,!1),F.send(null),!(F.status>=200&&F.status<300||F.status===304))throw new Error("Couldn't load "+a+". Status: "+F.status);var H=Number(F.getResponseHeader("Content-length")),he,Te=(he=F.getResponseHeader("Accept-Ranges"))&&he==="bytes",ke=(he=F.getResponseHeader("Content-Encoding"))&&he==="gzip",Se=1024*1024;Te||(Se=H);var Ae=(Oe,pt)=>{if(Oe>pt)throw new Error("invalid range ("+Oe+", "+pt+") or no bytes requested!");if(pt>H-1)throw new Error("only "+H+" bytes available! programmer error!");var pe=new XMLHttpRequest;if(pe.open("GET",a,!1),H!==Se&&pe.setRequestHeader("Range","bytes="+Oe+"-"+pt),pe.responseType="arraybuffer",pe.overrideMimeType&&pe.overrideMimeType("text/plain; charset=x-user-defined"),pe.send(null),!(pe.status>=200&&pe.status<300||pe.status===304))throw new Error("Couldn't load "+a+". Status: "+pe.status);return pe.response!==void 0?new Uint8Array(pe.response||[]):bn(pe.responseText||"")},Rt=this;Rt.setDataGetter(Oe=>{var pt=Oe*Se,pe=(Oe+1)*Se-1;if(pe=Math.min(pe,H-1),typeof Rt.chunks[Oe]>"u"&&(Rt.chunks[Oe]=Ae(pt,pe)),typeof Rt.chunks[Oe]>"u")throw new Error("doXHR failed!");return Rt.chunks[Oe]}),(ke||!H)&&(Se=H=1,H=this.getter(0).length,Se=H,ne("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=H,this._chunkSize=Se,this.lengthKnown=!0}get length(){return this.lengthKnown||this.cacheLength(),this._length}get chunkSize(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}if(typeof XMLHttpRequest<"u"){if(!m)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var _=new g,b={isDevice:!1,contents:_}}else var b={isDevice:!1,url:a};var M=c.createFile(n,o,b,u,h);b.contents?M.contents=b.contents:b.url&&(M.contents=null,M.url=b.url),Object.defineProperties(M,{usedBytes:{get:function(){return this.contents.length}}});var V={},X=Object.keys(M.stream_ops);X.forEach(q=>{var F=M.stream_ops[q];V[q]=(...H)=>(c.forceLoadFile(M),F(...H))});function Q(q,F,H,he,Te){var ke=q.node.contents;if(Te>=ke.length)return 0;var Se=Math.min(ke.length-Te,he);if(C(Se>=0),ke.slice)for(var Ae=0;Ae<Se;Ae++)F[H+Ae]=ke[Te+Ae];else for(var Ae=0;Ae<Se;Ae++)F[H+Ae]=ke.get(Te+Ae);return Se}return V.read=(q,F,H,he,Te)=>(c.forceLoadFile(M),Q(q,F,H,he,Te)),V.mmap=(q,F,H,he,Te)=>{c.forceLoadFile(M);var ke=kn();if(!ke)throw new c.ErrnoError(48);return Q(q,Y,ke,F,H),{ptr:ke,allocated:!0}},M.stream_ops=V,M},absolutePath(){ie("FS.absolutePath has been removed; use PATH_FS.resolve instead")},createFolder(){ie("FS.createFolder has been removed; use FS.mkdir instead")},createLink(){ie("FS.createLink has been removed; use FS.symlink instead")},joinPath(){ie("FS.joinPath has been removed; use PATH.join instead")},mmapAlloc(){ie("FS.mmapAlloc has been replaced by the top level function mmapAlloc")},standardizePath(){ie("FS.standardizePath has been removed; use PATH.normalize instead")}},Ot={DEFAULT_POLLMASK:5,calculateAt(n,o,a){if(J.isAbs(o))return o;var u;if(n===-100)u=c.cwd();else{var h=Ot.getStreamFromFD(n);u=h.path}if(o.length==0){if(!a)throw new c.ErrnoError(44);return u}return J.join2(u,o)},doStat(n,o,a){var u=n(o);W[a>>2]=u.dev,W[a+4>>2]=u.mode,L[a+8>>2]=u.nlink,W[a+12>>2]=u.uid,W[a+16>>2]=u.gid,W[a+20>>2]=u.rdev,de=[u.size>>>0,(j=u.size,+Math.abs(j)>=1?j>0?+Math.floor(j/4294967296)>>>0:~~+Math.ceil((j-+(~~j>>>0))/4294967296)>>>0:0)],W[a+24>>2]=de[0],W[a+28>>2]=de[1],W[a+32>>2]=4096,W[a+36>>2]=u.blocks;var h=u.atime.getTime(),g=u.mtime.getTime(),_=u.ctime.getTime();return de=[Math.floor(h/1e3)>>>0,(j=Math.floor(h/1e3),+Math.abs(j)>=1?j>0?+Math.floor(j/4294967296)>>>0:~~+Math.ceil((j-+(~~j>>>0))/4294967296)>>>0:0)],W[a+40>>2]=de[0],W[a+44>>2]=de[1],L[a+48>>2]=h%1e3*1e3*1e3,de=[Math.floor(g/1e3)>>>0,(j=Math.floor(g/1e3),+Math.abs(j)>=1?j>0?+Math.floor(j/4294967296)>>>0:~~+Math.ceil((j-+(~~j>>>0))/4294967296)>>>0:0)],W[a+56>>2]=de[0],W[a+60>>2]=de[1],L[a+64>>2]=g%1e3*1e3*1e3,de=[Math.floor(_/1e3)>>>0,(j=Math.floor(_/1e3),+Math.abs(j)>=1?j>0?+Math.floor(j/4294967296)>>>0:~~+Math.ceil((j-+(~~j>>>0))/4294967296)>>>0:0)],W[a+72>>2]=de[0],W[a+76>>2]=de[1],L[a+80>>2]=_%1e3*1e3*1e3,de=[u.ino>>>0,(j=u.ino,+Math.abs(j)>=1?j>0?+Math.floor(j/4294967296)>>>0:~~+Math.ceil((j-+(~~j>>>0))/4294967296)>>>0:0)],W[a+88>>2]=de[0],W[a+92>>2]=de[1],0},doMsync(n,o,a,u,h){if(!c.isFile(o.node.mode))throw new c.ErrnoError(43);if(u&2)return 0;var g=be.slice(n,n+a);c.msync(o,g,h,a,u)},getStreamFromFD(n){var o=c.getStreamChecked(n);return o},varargs:void 0,getStr(n){var o=ht(n);return o}};function Do(n){try{var o=Ot.getStreamFromFD(n);return c.close(o),0}catch(a){if(typeof c>"u"||a.name!=="ErrnoError")throw a;return a.errno}}var $o=(n,o,a,u)=>{for(var h=0,g=0;g<a;g++){var _=L[o>>2],b=L[o+4>>2];o+=8;var M=c.read(n,Y,_,b,u);if(M<0)return-1;if(h+=M,M<b)break}return h};function Lo(n,o,a,u){try{var h=Ot.getStreamFromFD(n),g=$o(h,o,a);return L[u>>2]=g,0}catch(_){if(typeof c>"u"||_.name!=="ErrnoError")throw _;return _.errno}}var Io=(n,o)=>(C(n==n>>>0||n==(n|0)),C(o===(o|0)),o+2097152>>>0<4194305-!!n?(n>>>0)+o*4294967296:NaN);function Uo(n,o,a,u,h){var g=Io(o,a);try{if(isNaN(g))return 61;var _=Ot.getStreamFromFD(n);return c.llseek(_,g,u),de=[_.position>>>0,(j=_.position,+Math.abs(j)>=1?j>0?+Math.floor(j/4294967296)>>>0:~~+Math.ceil((j-+(~~j>>>0))/4294967296)>>>0:0)],W[h>>2]=de[0],W[h+4>>2]=de[1],_.getdents&&g===0&&u===0&&(_.getdents=null),0}catch(b){if(typeof c>"u"||b.name!=="ErrnoError")throw b;return b.errno}}var zo=(n,o,a,u)=>{for(var h=0,g=0;g<a;g++){var _=L[o>>2],b=L[o+4>>2];o+=8;var M=c.write(n,Y,_,b,u);if(M<0)return-1;if(h+=M,M<b)break}return h};function Bo(n,o,a,u){try{var h=Ot.getStreamFromFD(n),g=zo(h,o,a);return L[u>>2]=g,0}catch(_){if(typeof c>"u"||_.name!=="ErrnoError")throw _;return _.errno}}c.createPreloadedFile=Fo,c.staticInit();function jo(){ao("fetchSettings")}var En={__assert_fail:fo,__cxa_throw:po,_abort_js:mo,_emscripten_memcpy_js:go,_tzset_js:_o,emscripten_resize_heap:ko,environ_get:So,environ_sizes_get:Co,fd_close:Do,fd_read:Lo,fd_seek:Uo,fd_write:Bo},Qe=so();i._create_position=ee("create_position",1),i._delete_position=ee("delete_position",1),i._make_move=ee("make_move",2),i._unmake_move=ee("unmake_move",2),i._get_legal_moves=ee("get_legal_moves",2),i._malloc=ee("malloc",1),i._free_legal_moves=ee("free_legal_moves",1),i._free=ee("free",1),i._pos_attacks_to=ee("pos_attacks_to",4),i._pos_attacks=ee("pos_attacks",3),i._get_pieces_bb=ee("get_pieces_bb",4),i._get_pieces_color_bb=ee("get_pieces_color_bb",3),i._get_occupied=ee("get_occupied",2),i._get_attacks=ee("get_attacks",6),i._get_turn=ee("get_turn",1),i._get_at=ee("get_at",2),i._get_fen=ee("get_fen",1),i._is_checkmate=ee("is_checkmate",1),i._init=ee("init",0);var Wo=ee("fflush",1),Ho=ee("strerror",1),Sn=()=>(Sn=Qe.emscripten_stack_init)(),vr=()=>(vr=Qe.emscripten_stack_get_end)();i.dynCall_viijii=ee("dynCall_viijii",7),i.dynCall_jiji=ee("dynCall_jiji",5),i.dynCall_iiiiij=ee("dynCall_iiiiij",7),i.dynCall_iiiiijj=ee("dynCall_iiiiijj",9),i.dynCall_iiiiiijj=ee("dynCall_iiiiiijj",10);var Go=["writeI53ToI64","writeI53ToI64Clamped","writeI53ToI64Signaling","writeI53ToU64Clamped","writeI53ToU64Signaling","readI53FromI64","readI53FromU64","convertI32PairToI53","convertU32PairToI53","stackAlloc","getTempRet0","setTempRet0","exitJS","inetPton4","inetNtop4","inetPton6","inetNtop6","readSockaddr","writeSockaddr","emscriptenLog","readEmAsmArgs","jstoi_q","listenOnce","autoResumeAudioContext","dynCallLegacy","getDynCaller","dynCall","handleException","keepRuntimeAlive","runtimeKeepalivePush","runtimeKeepalivePop","callUserCallback","maybeExit","asmjsMangle","HandleAllocator","getNativeTypeSize","STACK_SIZE","STACK_ALIGN","POINTER_SIZE","ASSERTIONS","getCFunc","ccall","cwrap","uleb128Encode","sigToWasmTypes","generateFuncType","convertJsFunctionToWasm","getEmptyTableSlot","updateTableMap","getFunctionAddress","addFunction","removeFunction","reallyNegative","unSign","strLen","reSign","formatString","intArrayToString","AsciiToString","UTF16ToString","stringToUTF16","lengthBytesUTF16","UTF32ToString","stringToUTF32","lengthBytesUTF32","stringToNewUTF8","stringToUTF8OnStack","writeArrayToMemory","registerKeyEventCallback","maybeCStringToJsString","findEventTarget","getBoundingClientRect","fillMouseEventData","registerMouseEventCallback","registerWheelEventCallback","registerUiEventCallback","registerFocusEventCallback","fillDeviceOrientationEventData","registerDeviceOrientationEventCallback","fillDeviceMotionEventData","registerDeviceMotionEventCallback","screenOrientation","fillOrientationChangeEventData","registerOrientationChangeEventCallback","fillFullscreenChangeEventData","registerFullscreenChangeEventCallback","JSEvents_requestFullscreen","JSEvents_resizeCanvasForFullscreen","registerRestoreOldStyle","hideEverythingExceptGivenElement","restoreHiddenElements","setLetterbox","softFullscreenResizeWebGLRenderTarget","doRequestFullscreen","fillPointerlockChangeEventData","registerPointerlockChangeEventCallback","registerPointerlockErrorEventCallback","requestPointerLock","fillVisibilityChangeEventData","registerVisibilityChangeEventCallback","registerTouchEventCallback","fillGamepadEventData","registerGamepadEventCallback","registerBeforeUnloadEventCallback","fillBatteryEventData","battery","registerBatteryEventCallback","setCanvasElementSize","getCanvasElementSize","jsStackTrace","getCallstack","convertPCtoSourceLocation","checkWasiClock","wasiRightsToMuslOFlags","wasiOFlagsToMuslOFlags","safeSetTimeout","setImmediateWrapped","safeRequestAnimationFrame","clearImmediateWrapped","polyfillSetImmediate","registerPostMainLoop","registerPreMainLoop","getPromise","makePromise","idsToPromises","makePromiseCallback","findMatchingCatch","Browser_asyncPrepareDataCounter","isLeapYear","ydayFromDate","arraySum","addDays","getSocketFromFD","getSocketAddress","FS_unlink","FS_mkdirTree","_setNetworkCallback","heapObjectForWebGLType","toTypedArrayIndex","webgl_enable_ANGLE_instanced_arrays","webgl_enable_OES_vertex_array_object","webgl_enable_WEBGL_draw_buffers","webgl_enable_WEBGL_multi_draw","webgl_enable_EXT_polygon_offset_clamp","webgl_enable_EXT_clip_control","webgl_enable_WEBGL_polygon_mode","emscriptenWebGLGet","computeUnpackAlignedImageSize","colorChannelsInGlTextureFormat","emscriptenWebGLGetTexPixelData","emscriptenWebGLGetUniform","webglGetUniformLocation","webglPrepareUniformLocationsBeforeFirstUse","webglGetLeftBracePos","emscriptenWebGLGetVertexAttrib","__glGetActiveAttribOrUniform","writeGLArray","registerWebGlEventCallback","runAndAbortIfError","ALLOC_NORMAL","ALLOC_STACK","allocate","writeStringToMemory","writeAsciiToMemory","setErrNo","demangle","stackTrace"];Go.forEach(lo);var Ko=["run","addOnPreRun","addOnInit","addOnPreMain","addOnExit","addOnPostRun","addRunDependency","removeRunDependency","out","err","callMain","abort","wasmMemory","wasmExports","writeStackCookie","checkStackCookie","convertI32PairToI53Checked","stackSave","stackRestore","ptrToString","zeroMemory","getHeapMax","growMemory","ENV","ERRNO_CODES","strError","DNS","Protocols","Sockets","timers","warnOnce","readEmAsmArgsArray","jstoi_s","getExecutableName","asyncLoad","alignMemory","mmapAlloc","wasmTable","noExitRuntime","freeTableIndexes","functionsInTableMap","setValue","getValue","PATH","PATH_FS","UTF8Decoder","UTF8ArrayToString","UTF8ToString","stringToUTF8Array","stringToUTF8","lengthBytesUTF8","intArrayFromString","stringToAscii","UTF16Decoder","JSEvents","specialHTMLTargets","findCanvasEventTarget","currentFullscreenStrategy","restoreOldWindowedStyle","UNWIND_CACHE","ExitStatus","getEnvStrings","doReadv","doWritev","initRandomFill","randomFill","promiseMap","uncaughtExceptionCount","exceptionLast","exceptionCaught","ExceptionInfo","Browser","getPreloadedImageData__data","wget","MONTH_DAYS_REGULAR","MONTH_DAYS_LEAP","MONTH_DAYS_REGULAR_CUMULATIVE","MONTH_DAYS_LEAP_CUMULATIVE","SYSCALLS","preloadPlugins","FS_createPreloadedFile","FS_modeStringToFlags","FS_getMode","FS_stdin_getChar_buffer","FS_stdin_getChar","FS_createPath","FS_createDevice","FS_readFile","FS","FS_createDataFile","FS_createLazyFile","MEMFS","TTY","PIPEFS","SOCKFS","tempFixedLengthArray","miniTempWebGLFloatBuffers","miniTempWebGLIntBuffers","GL","AL","GLUT","EGL","GLEW","IDBStore","SDL","SDL_gfx","allocateUTF8","allocateUTF8OnStack","print","printErr"];Ko.forEach(_n);var Qt;St=function n(){Qt||Cn(),Qt||(St=n)};function Vo(){Sn(),ur()}function Cn(){if(Ke>0||(Vo(),Kt(),Ke>0))return;function n(){Qt||(Qt=!0,i.calledRun=!0,!se&&(Vt(),s(i),i.onRuntimeInitialized?.(),C(!i._main,'compiled without a main, but one is present. if you added it from JS, use Module["onRuntimeInitialized"]'),qt()))}i.setStatus?(i.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>i.setStatus(""),1),n()},1)):n(),lt()}if(i.preInit)for(typeof i.preInit=="function"&&(i.preInit=[i.preInit]);i.preInit.length>0;)i.preInit.pop()();Cn(),r=d;for(const n of Object.keys(i))n in t||Object.defineProperty(t,n,{configurable:!0,get(){ie(`Access to module property ('${n}') is no longer possible via the module constructor argument; Instead, use the result of the module constructor.`)}});return r}})();const Jn=0,bs=1,ei=2,ks=3,ys=4,Es=5,Ss=6,Cs=0,Ps=16384;function ti(e){return e>>3}function ri(e){return e&7}function Ts(e){let t=ti(e),r=ri(e);return{color:As(t),role:ni(r)}}function ni(e){switch(e){case bs:return"pawn";case ei:return"knight";case ks:return"bishop";case ys:return"rook";case Es:return"queen";case Ss:return"king"}throw"No Piece Type"}function As(e){return e===Jn?"white":"black"}function kt(e){let t=e&63,r=e>>6&63,s=(e&49152)===Ps?ni((e>>12&3)+ei):void 0;return{from:r,to:t,promotion:s}}class Hr{m;static async make(t){let r=await ws({locateFile:t});return r._init(),new Hr(r)}constructor(t){this.m=t}create_position(t){return this.m._create_position(this.stringToWasm(t))}delete_position(t){this.m._delete_position(t)}unmake_move(t,r){this.m._unmake_move(t,r)}make_move(t,r){this.m._make_move(t,r)}pos_turn(t){return this.m._get_turn(t)===Jn?"white":"black"}get_legal_moves(t){const r=this.m._malloc(4);let i=this.m._get_legal_moves(t,r);const s=this.m.getValue(r,"i32");let l=[];for(let d=0;d<s;d++){const f=this.m.getValue(i+d*4,"i32");l.push(f)}return this.m._free(r),this.m._free(i),l}pos_occupied(t){const r=this.m._malloc(8);this.m._get_occupied(t,r);const i=this.m.getValue(r,"i32"),s=this.m.getValue(r+4,"i32");return this.m._free(r),new De(i,s)}attacks(t,r,i){const s=this.m._malloc(8);this.m._get_attacks(ri(t),ti(t),r,i.lo,i.hi,s);const l=this.m.getValue(s,"i32"),d=this.m.getValue(s+4,"i32");return this.m._free(s),new De(l,d)}pos_attacks(t,r){const i=this.m._malloc(8);this.m._pos_attacks(t,r,i);const s=this.m.getValue(i,"i32"),l=this.m.getValue(i+4,"i32");return this.m._free(i),new De(s,l)}pos_attacks_of_color(t,r){const i=this.m._malloc(8);this.m._pos_attacks_to(t,r,0,i);const s=this.m.getValue(i,"i32"),l=this.m.getValue(i+4,"i32");return this.m._free(i),new De(s,l)}get_pieces_color_bb(t,r){const i=this.m._malloc(8);this.m._get_pieces_color_bb(t,r,i);const s=this.m.getValue(i,"i32"),l=this.m.getValue(i+4,"i32");return this.m._free(i),new De(s,l)}get_pieces_bb(t,r){const i=this.m._malloc(8),s=this.m._malloc(4*r.length);for(let f=0;f<r.length;f++)this.m.setValue(s+f*4,r[f],"i32");this.m._get_pieces_bb(t,s,r.length,i);const l=this.m.getValue(i,"i32"),d=this.m.getValue(i+4,"i32");return this.m._free(i),this.m._free(s),new De(l,d)}get_at(t,r){let i=this.m._get_at(t,r);if(i!==Cs)return i}is_checkmate(t){return this.m._is_checkmate(t)}get_pos_read_fen(t){let r=this.wasmToStringAndFree(this.m._get_fen(t));return rs.fromSetup(ns(r).unwrap()).unwrap()}make_san(t,r){let i=this.get_pos_read_fen(t);return Pr(i,kt(r))}stringToWasm(t){let r=this.m;const i=t.length+1,s=r._malloc(i);return r.stringToUTF8(t,s,i),s}wasmToStringAndFree(t){return this.m.UTF8ToString(t)}}function ii(e,t){let r=is(e);os(r);let i=oi(r),s=R.create_position(t),l=Ds(s);Tr(i,[{data:{path:[],move:void 0,before:l,after:l}}],s);let f=si(i,s);return R.delete_position(s),f}function oi(e){let t=e.sentence,r=e.children.map(oi);return{sentence:t,children:r,res:[],children_resolved:!1,line:e}}function Tr(e,t,r){let i=[],s=Rs(e.sentence,r);for(let f of t){for(let p of f.data.path)R.make_move(r,p);["E","A"].includes(e.sentence.precessor)&&f.data.move&&R.make_move(r,f.data.move);let m=Fs(e.sentence,f,r);m=m.filter(s);for(let p of m)i.push({parent:f,data:p});["E","A"].includes(e.sentence.precessor)&&f.data.move&&R.unmake_move(r,f.data.move);for(let p=f.data.path.length-1;p>=0;p--){let v=f.data.path[p];R.unmake_move(r,v)}}if(i.length===0)return e.children_resolved=!1,e.res=[],e.res;let l=i,d=new Map;for(let f of l){let m=f.data.path.join(" ");d.has(m)||d.set(m,[]),d.get(m).push(f)}if(e.sentence.precessor==="E"||e.sentence.precessor==="."||e.sentence.precessor==="G")for(let[f,m]of d){let p=m[0].data.path.map(kt);p[p.length-1]?.to===52&&console.log(p);let v=[],w=[];for(let S of e.children){let A=S.children_resolved,k=S.res;S.res=[];let E=Tr(S,m,r);if(S.children_resolved){for(let O of m)E.find(T=>T===O||T.parent===O)?v.push(O):w.push(O);m=w}S.res.push(...k),A&&(S.children_resolved=!0)}if(e.children.length===0){e.res.push(...i),e.children_resolved=!0;break}v.length>0&&(e.res.push(...v),e.children_resolved=!0)}else if(e.sentence.precessor==="A"){e.res=[];let f=[];for(let[m,p]of d){let v=p;for(let w of e.children){let S=w.children_resolved,A=w.res;w.res=[];let k=Tr(w,p,r);w.children_resolved&&(p=p.filter(E=>!k.find(O=>O===E||O.parent===E))),w.res.push(...A),S&&(w.children_resolved=!0)}e.children.length>0&&p.length!==0||f.push(v)}f.length>0&&(e.res=f.flat(),e.children_resolved=!0)}else e.children_resolved=!0;return e.res}function xn(e,t){re(e.piece),e.attack.map(re);let r=e.blocked.map(([s,l,d])=>[re(s),re(l),re(d)]);e.unblocked.map(([s,l])=>[re(s),re(l)]),e.attacked_by.map(re),e.double_blocked.map(([s,l,d])=>[re(s),re(l),re(d)]),e.undefended_by.map(re),e.zero_defend,e.zero_attack;let i=e.is_mate;return s=>{let l=s.after[e.piece],d=s.after;if(i&&!R.is_checkmate(t))return!1;if(e.zero_defend){for(let f of ai(d))if(R.pos_attacks(t,d[f]).has(l))return!1}if(e.attack.length>0)for(let f=0;f<e.attack.length;f++){let m=d[e.attack[f]];if(m===void 0||!R.pos_attacks(t,l).has(m))return!1}if(e.attacked_by.length>0){for(let f=0;f<e.attacked_by.length;f++){let m=d[e.attacked_by[f]];if(m===void 0||!R.pos_attacks(t,m).has(l))return!1}for(let f of Object.keys(d))if(!e.attacked_by.includes(f)){let m=d[f];if(R.pos_attacks(t,m).has(l))return!1}}if(e.undefended_by.length>0)for(let f=0;f<e.undefended_by.length;f++){let m=e.undefended_by[f];if(R.pos_attacks(t,d[m]).has(l))return!1}if(e.blocked.length>0){let f=R.pos_occupied(t);for(let m=0;m<e.blocked.length;m++){let p=r[m][0],[v,w,S]=e.blocked[m],A=d[v],k=d[w],E=d[S];if(A===void 0||k===void 0||E===void 0)return!1;if(!(Je(p,A,f.without(E)).has(k)&&!Je(p,A,f).has(k)))return!1}}if(e.double_blocked.length>0){let f=R.pos_occupied(t);for(let m=0;m<e.double_blocked.length;m++){let[p,v,w]=e.double_blocked[m],S=d[p],A=d[v],k=d[w];if(S===void 0||A===void 0||k===void 0)return!1;if(!(Je(re(p),S,f.without(A).without(k)).has(l)&&!Je(re(p),S,f.without(A)).has(l)&&!Je(re(p),S,f.without(k)).has(l)))return!1}}return!0}}function Ms(e,t){re(e.move),e.attack.map(re);let r=e.blocked.map(([s,l,d])=>[re(s),re(l),re(d)]);e.unblocked.map(([s,l])=>[re(s),re(l)]),e.captured&&re(e.captured),e.attacked_by.map(re),e.undefended_by.map(re),e.zero_defend,e.zero_attack;let i=e.is_mate;return s=>{if(!s.move)return!1;let l=s.move,d=kt(s.move),f=s.before,m=s.after;if(i){if(R.make_move(t,l),!R.is_checkmate(t))return R.unmake_move(t,l),!1;R.unmake_move(t,l)}if(f[e.move]!==d.from||e.captured&&f[e.captured]!==d.to)return!1;if(e.zero_defend){for(let p of ai(m))if(R.pos_attacks(t,m[p]).has(d.to))return!1}if(e.attack.length>0){R.make_move(t,l);for(let p=0;p<e.attack.length;p++){let v=f[e.attack[p]];if(v===void 0)return R.unmake_move(t,l),!1;if(!R.pos_attacks(t,d.to).has(v))return R.unmake_move(t,l),!1}R.unmake_move(t,l)}if(e.attacked_by.length>0){R.make_move(t,l);for(let p=0;p<e.attacked_by.length;p++){let v=f[e.attacked_by[p]];if(v===void 0)return R.unmake_move(t,l),!1;if(!R.pos_attacks(t,v).has(d.to))return R.unmake_move(t,l),!1}for(let p of Object.keys(f))if(!e.attacked_by.includes(p)){let v=f[p];if(R.pos_attacks(t,v).has(d.to))return R.unmake_move(t,l),!1}R.unmake_move(t,l)}if(e.unblocked.length>0){for(let p=0;p<e.unblocked.length;p++){let[v,w]=e.unblocked[p],S=m[v],A=m[w];if(R.pos_attacks(t,S).has(A))return!1}R.make_move(t,l);for(let p=0;p<e.unblocked.length;p++){let[v,w]=e.unblocked[p],S=f[v],A=f[w];if(!R.pos_attacks(t,S).has(A))return R.unmake_move(t,l),!1}R.unmake_move(t,l)}if(e.undefended_by.length>0)for(let p=0;p<e.undefended_by.length;p++){let v=e.undefended_by[p];if(R.pos_attacks(t,f[v]).has(d.to))return!1}if(e.blocked.length>0){let p=R.pos_occupied(t);R.make_move(t,l);for(let v=0;v<e.blocked.length;v++){let w=r[v][0],[S,A,k]=e.blocked[v],E=m[S],O=m[A],T=m[k];if(E===void 0||O===void 0||T===void 0)return R.unmake_move(t,l),!1;if(!(Je(w,E,p.without(T)).has(O)&&!Je(w,E,p).has(O)))return R.unmake_move(t,l),!1}R.unmake_move(t,l)}return!0}}const Os=()=>!0;function Rs(e,t){if(e.type==="move_attack")return Ms(e,t);if(e.type==="still_attack")return xn(e,t);if(e.type==="g_still_attack"){let r=e.attacks.map(i=>xn(i,t));return i=>r.every(s=>s(i))}return Os}function Fs(e,t,r){if(["E","A","*"].includes(e.precessor)){let i=t.data.path.slice(0);return t.data.move&&i.push(t.data.move),R.get_legal_moves(r).map(s=>({path:i,move:s,before:t.data.after,after:Ns(t.data.after,r,s)}))}else return[t.data]}function xs(e,t){if(!e.data.move)return"";if(!e.parent){let s=kt(e.data.move);R.make_move(t,e.data.move);let l=R.get_pos_read_fen(t);return R.unmake_move(t,e.data.move),`${Pr(l,s)}`}let r=e.data.path.slice(0);r.push(e.data.move);let i=[];for(let s of r){let l=R.get_pos_read_fen(t),d=Pr(l,kt(s));R.make_move(t,s),i.push(d)}r.reverse();for(let s of r)R.unmake_move(t,s);return`${i.join(" ")}`}function si(e,t){let r=e.line,i="",s=" ".repeat(r.depth+1),l=r.long?150:1,d=(r.no_c,e.res),f=d.slice(0,l).map(p=>xs(p,t)).join(", ");d.length>1&&(f+=" .."+d.length);let m=e.children_resolved;return i+=" "+r.rule+(m?" OK":" ?")+" <"+(f??"?")+`>
`,e.children.map((p,v)=>{v===e.children.length-1?i+=s+"":v===0?i+=s+"":i+=s+" ",i+=si(p,t)}).join(""),i}function Ns(e,t,r){let i={},s=kt(r);for(let l of Object.keys(e))e[l]===s.from?i[l]=s.to:e[l]===s.to||(i[l]=e[l]);return i}function Ds(e){let t={};for(let r of De.full()){let i=R.get_at(e,r);if(i!==void 0){let s=Ts(i),l=ss(s);if(t[l]!==void 0){for(let d=2;d<=8;d++)if(t[l+d]===void 0){t[l+d]=r;break}}else t[l]=r}}return t}function $s(e,t){let r=ii(e,t),s=(r.trim().split(`
`)[1]?.match(/E [^O]*OK <([^>]+)/)??r.trim().split(`
`)[2]?.match(/E [^O]*OK <([^>]+)/))?.[1];return s?.includes(".")?s.slice(0,s.indexOf(".")):s}function ai(e){return Object.keys(e).filter(t=>t[0].toLowerCase()!==t[0])}const li=e=>{let t=Object.keys(e.has_tags).length,r={...e.has_tags};return t>0&&(r.has_tag=!0,t===1?r.single_tag=!0:r.many_tags=!0),r[`id_${e.id}`]=!0,e.rating<1500?r.easy=!0:e.rating<2e3?r.medium=!0:e.rating<2300?r.advanced=!0:r.high=!0,r},Gr=e=>{let t={...e.tags,...li(e)};if(e.rules){[...new Set(e.rules.flatMap(Ls))].forEach(l=>t[l]=!0);let i=[],s=e.rules.filter(l=>l.solve===void 0||l.solve>=0);if(s.length>0){let l=s[0];l.solve===void 0?(i.push("matched"),i.push(`matched_${l.rule.name}`)):i.push("unmatched")}i.forEach(l=>t[l]=!0),s.length===1&&(t.single_attempt=!0)}return t},Ls=e=>e.solve===void 0?(e.rule.rule.includes("."),["solved",`solved_${e.rule.name}`]):e.solve>=0?["failed",`failed_${e.rule.name}`]:[""],Nn=e=>t=>{let r=Gr(t),[i,s]=e.split("_!_").map(d=>d.trim()),l=i===""?[]:i.split(" ");return s&&s.split(" ").find(f=>r[f])?!1:l.every(d=>r[d])},Is=""+new URL("hopefox-LFTqDWdf.wasm",import.meta.url).href,Us=["white","black"],er=["a","b","c","d","e","f","g","h"],tr=["1","2","3","4","5","6","7","8"],zs=[...tr].reverse(),Kr=Array.prototype.concat(...er.map(e=>tr.map(t=>e+t))),Ce=e=>Kr[8*e[0]+e[1]],ae=e=>[e.charCodeAt(0)-97,e.charCodeAt(1)-49],ci=Kr.map(ae);function Bs(e){let t;const r=()=>(t===void 0&&(t=e()),t);return r.clear=()=>{t=void 0},r}const js=()=>{let e;return{start(){e=performance.now()},cancel(){e=void 0},stop(){if(!e)return 0;const t=performance.now()-e;return e=void 0,t}}},Vr=e=>e==="white"?"black":"white",It=(e,t)=>{const r=e[0]-t[0],i=e[1]-t[1];return r*r+i*i},Ar=(e,t)=>e.role===t.role&&e.color===t.color,Ht=e=>(t,r)=>[(r?t[0]:7-t[0])*e.width/8,(r?7-t[1]:t[1])*e.height/8],Re=(e,t)=>{e.style.transform=`translate(${t[0]}px,${t[1]}px)`},ui=(e,t,r=1)=>{e.style.transform=`translate(${t[0]}px,${t[1]}px) scale(${r})`},qr=(e,t)=>{e.style.visibility=t?"visible":"hidden"},ot=e=>{var t;if(e.clientX||e.clientX===0)return[e.clientX,e.clientY];if(!((t=e.targetTouches)===null||t===void 0)&&t[0])return[e.targetTouches[0].clientX,e.targetTouches[0].clientY]},di=e=>e.button===2,Le=(e,t)=>{const r=document.createElement(e);return t&&(r.className=t),r};function fi(e,t,r){const i=ae(e);return t||(i[0]=7-i[0],i[1]=7-i[1]),[r.left+r.width*i[0]/8+r.width/16,r.top+r.height*(7-i[1])/8+r.height/16]}const rt=(e,t)=>Math.abs(e-t),Ws=e=>(t,r,i,s)=>rt(t,i)<2&&(e==="white"?s===r+1||r<=1&&s===r+2&&t===i:s===r-1||r>=6&&s===r-2&&t===i),hi=(e,t,r,i)=>{const s=rt(e,r),l=rt(t,i);return s===1&&l===2||s===2&&l===1},pi=(e,t,r,i)=>rt(e,r)===rt(t,i),mi=(e,t,r,i)=>e===r||t===i,gi=(e,t,r,i)=>pi(e,t,r,i)||mi(e,t,r,i),Hs=(e,t,r)=>(i,s,l,d)=>rt(i,l)<2&&rt(s,d)<2||r&&s===d&&s===(e==="white"?0:7)&&(i===4&&(l===2&&t.includes(0)||l===6&&t.includes(7))||t.includes(l));function Gs(e,t){const r=t==="white"?"1":"8",i=[];for(const[s,l]of e)s[1]===r&&l.color===t&&l.role==="rook"&&i.push(ae(s)[0]);return i}function _i(e,t,r){const i=e.get(t);if(!i)return[];const s=ae(t),l=i.role,d=l==="pawn"?Ws(i.color):l==="knight"?hi:l==="bishop"?pi:l==="rook"?mi:l==="queen"?gi:Hs(i.color,Gs(e,i.color),r);return ci.filter(f=>(s[0]!==f[0]||s[1]!==f[1])&&d(s[0],s[1],f[0],f[1])).map(Ce)}function ve(e,...t){e&&setTimeout(()=>e(...t),1)}function Ks(e){e.orientation=Vr(e.orientation),e.animation.current=e.draggable.current=e.selected=void 0}function Vs(e,t){for(const[r,i]of t)i?e.pieces.set(r,i):e.pieces.delete(r)}function qs(e,t){if(e.check=void 0,t===!0&&(t=e.turnColor),t)for(const[r,i]of e.pieces)i.role==="king"&&i.color===t&&(e.check=r)}function Ys(e,t,r,i){Ge(e),e.premovable.current=[t,r],ve(e.premovable.events.set,t,r,i)}function He(e){e.premovable.current&&(e.premovable.current=void 0,ve(e.premovable.events.unset))}function Xs(e,t,r){He(e),e.predroppable.current={role:t,key:r},ve(e.predroppable.events.set,t,r)}function Ge(e){const t=e.predroppable;t.current&&(t.current=void 0,ve(t.events.unset))}function Qs(e,t,r){if(!e.autoCastle)return!1;const i=e.pieces.get(t);if(!i||i.role!=="king")return!1;const s=ae(t),l=ae(r);if(s[1]!==0&&s[1]!==7||s[1]!==l[1])return!1;s[0]===4&&!e.pieces.has(r)&&(l[0]===6?r=Ce([7,l[1]]):l[0]===2&&(r=Ce([0,l[1]])));const d=e.pieces.get(r);return!d||d.color!==i.color||d.role!=="rook"?!1:(e.pieces.delete(t),e.pieces.delete(r),s[0]<l[0]?(e.pieces.set(Ce([6,l[1]]),i),e.pieces.set(Ce([5,l[1]]),d)):(e.pieces.set(Ce([2,l[1]]),i),e.pieces.set(Ce([3,l[1]]),d)),!0)}function vi(e,t,r){const i=e.pieces.get(t),s=e.pieces.get(r);if(t===r||!i)return!1;const l=s&&s.color!==i.color?s:void 0;return r===e.selected&&Pe(e),ve(e.events.move,t,r,l),Qs(e,t,r)||(e.pieces.set(r,i),e.pieces.delete(t)),e.lastMove=[t,r],e.check=void 0,ve(e.events.change),l||!0}function Yr(e,t,r,i){if(e.pieces.has(r))if(i)e.pieces.delete(r);else return!1;return ve(e.events.dropNewPiece,t,r),e.pieces.set(r,t),e.lastMove=[r],e.check=void 0,ve(e.events.change),e.movable.dests=void 0,e.turnColor=Vr(e.turnColor),!0}function wi(e,t,r){const i=vi(e,t,r);return i&&(e.movable.dests=void 0,e.turnColor=Vr(e.turnColor),e.animation.current=void 0),i}function bi(e,t,r){if(Xr(e,t,r)){const i=wi(e,t,r);if(i){const s=e.hold.stop();Pe(e);const l={premove:!1,ctrlKey:e.stats.ctrlKey,holdTime:s};return i!==!0&&(l.captured=i),ve(e.movable.events.after,t,r,l),!0}}else if(Js(e,t,r))return Ys(e,t,r,{ctrlKey:e.stats.ctrlKey}),Pe(e),!0;return Pe(e),!1}function ki(e,t,r,i){const s=e.pieces.get(t);s&&(Zs(e,t,r)||i)?(e.pieces.delete(t),Yr(e,s,r,i),ve(e.movable.events.afterNewPiece,s.role,r,{premove:!1,predrop:!1})):s&&ea(e,t,r)?Xs(e,s.role,r):(He(e),Ge(e)),e.pieces.delete(t),Pe(e)}function Mr(e,t,r){if(ve(e.events.select,t),e.selected){if(e.selected===t&&!e.draggable.enabled){Pe(e),e.hold.cancel();return}else if((e.selectable.enabled||r)&&e.selected!==t&&bi(e,e.selected,t)){e.stats.dragged=!1;return}}(e.selectable.enabled||e.draggable.enabled)&&(Ei(e,t)||Qr(e,t))&&(yi(e,t),e.hold.start())}function yi(e,t){e.selected=t,Qr(e,t)?e.premovable.customDests||(e.premovable.dests=_i(e.pieces,t,e.premovable.castle)):e.premovable.dests=void 0}function Pe(e){e.selected=void 0,e.premovable.dests=void 0,e.hold.cancel()}function Ei(e,t){const r=e.pieces.get(t);return!!r&&(e.movable.color==="both"||e.movable.color===r.color&&e.turnColor===r.color)}const Xr=(e,t,r)=>{var i,s;return t!==r&&Ei(e,t)&&(e.movable.free||!!(!((s=(i=e.movable.dests)===null||i===void 0?void 0:i.get(t))===null||s===void 0)&&s.includes(r)))};function Zs(e,t,r){const i=e.pieces.get(t);return!!i&&(t===r||!e.pieces.has(r))&&(e.movable.color==="both"||e.movable.color===i.color&&e.turnColor===i.color)}function Qr(e,t){const r=e.pieces.get(t);return!!r&&e.premovable.enabled&&e.movable.color===r.color&&e.turnColor!==r.color}function Js(e,t,r){var i,s;const l=(s=(i=e.premovable.customDests)===null||i===void 0?void 0:i.get(t))!==null&&s!==void 0?s:_i(e.pieces,t,e.premovable.castle);return t!==r&&Qr(e,t)&&l.includes(r)}function ea(e,t,r){const i=e.pieces.get(t),s=e.pieces.get(r);return!!i&&(!s||s.color!==e.movable.color)&&e.predroppable.enabled&&(i.role!=="pawn"||r[1]!=="1"&&r[1]!=="8")&&e.movable.color===i.color&&e.turnColor!==i.color}function ta(e,t){const r=e.pieces.get(t);return!!r&&e.draggable.enabled&&(e.movable.color==="both"||e.movable.color===r.color&&(e.turnColor===r.color||e.premovable.enabled))}function ra(e){const t=e.premovable.current;if(!t)return!1;const r=t[0],i=t[1];let s=!1;if(Xr(e,r,i)){const l=wi(e,r,i);if(l){const d={premove:!0};l!==!0&&(d.captured=l),ve(e.movable.events.after,r,i,d),s=!0}}return He(e),s}function na(e,t){const r=e.predroppable.current;let i=!1;if(!r)return!1;if(t(r)){const s={role:r.role,color:e.movable.color};Yr(e,s,r.key)&&(ve(e.movable.events.afterNewPiece,r.role,r.key,{premove:!1,predrop:!0}),i=!0)}return Ge(e),i}function Zr(e){He(e),Ge(e),Pe(e)}function Dn(e){e.movable.color=e.movable.dests=e.animation.current=void 0,Zr(e)}function st(e,t,r){let i=Math.floor(8*(e[0]-r.left)/r.width);t||(i=7-i);let s=7-Math.floor(8*(e[1]-r.top)/r.height);return t||(s=7-s),i>=0&&i<8&&s>=0&&s<8?Ce([i,s]):void 0}function ia(e,t,r,i){const s=ae(e),l=ci.filter(p=>gi(s[0],s[1],p[0],p[1])||hi(s[0],s[1],p[0],p[1])),f=l.map(p=>fi(Ce(p),r,i)).map(p=>It(t,p)),[,m]=f.reduce((p,v,w)=>p[0]<v?p:[v,w],[f[0],0]);return Ce(l[m])}const we=e=>e.orientation==="white",Si="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",oa={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},sa={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};function Ci(e){e==="start"&&(e=Si);const t=new Map;let r=7,i=0;for(const s of e)switch(s){case" ":case"[":return t;case"/":if(--r,r<0)return t;i=0;break;case"~":{const l=t.get(Ce([i-1,r]));l&&(l.promoted=!0);break}default:{const l=s.charCodeAt(0);if(l<57)i+=l-48;else{const d=s.toLowerCase();t.set(Ce([i,r]),{role:oa[d],color:s===d?"black":"white"}),++i}}}return t}function aa(e){return zs.map(t=>er.map(r=>{const i=e.get(r+t);if(i){let s=sa[i.role];return i.color==="white"&&(s=s.toUpperCase()),i.promoted&&(s+="~"),s}else return"1"}).join("")).join("/").replace(/1{2,}/g,t=>t.length.toString())}function Pi(e,t){t.animation&&(Jr(e.animation,t.animation),(e.animation.duration||0)<70&&(e.animation.enabled=!1))}function Ti(e,t){var r,i,s;if(!((r=t.movable)===null||r===void 0)&&r.dests&&(e.movable.dests=void 0),!((i=t.drawable)===null||i===void 0)&&i.autoShapes&&(e.drawable.autoShapes=[]),Jr(e,t),t.fen&&(e.pieces=Ci(t.fen),e.drawable.shapes=((s=t.drawable)===null||s===void 0?void 0:s.shapes)||[]),"check"in t&&qs(e,t.check||!1),"lastMove"in t&&!t.lastMove?e.lastMove=void 0:t.lastMove&&(e.lastMove=t.lastMove),e.selected&&yi(e,e.selected),Pi(e,t),!e.movable.rookCastle&&e.movable.dests){const l=e.movable.color==="white"?"1":"8",d="e"+l,f=e.movable.dests.get(d),m=e.pieces.get(d);if(!f||!m||m.role!=="king")return;e.movable.dests.set(d,f.filter(p=>!(p==="a"+l&&f.includes("c"+l))&&!(p==="h"+l&&f.includes("g"+l))))}}function Jr(e,t){for(const r in t)r==="__proto__"||r==="constructor"||!Object.prototype.hasOwnProperty.call(t,r)||(Object.prototype.hasOwnProperty.call(e,r)&&$n(e[r])&&$n(t[r])?Jr(e[r],t[r]):e[r]=t[r])}function $n(e){if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return t===Object.prototype||t===null}const Ze=(e,t)=>t.animation.enabled?ua(e,t):ze(e,t);function ze(e,t){const r=e(t);return t.dom.redraw(),r}const wr=(e,t)=>({key:e,pos:ae(e),piece:t}),la=(e,t)=>t.sort((r,i)=>It(e.pos,r.pos)-It(e.pos,i.pos))[0];function ca(e,t){const r=new Map,i=[],s=new Map,l=[],d=[],f=new Map;let m,p,v;for(const[w,S]of e)f.set(w,wr(w,S));for(const w of Kr)m=t.pieces.get(w),p=f.get(w),m?p?Ar(m,p.piece)||(l.push(p),d.push(wr(w,m))):d.push(wr(w,m)):p&&l.push(p);for(const w of d)p=la(w,l.filter(S=>Ar(w.piece,S.piece))),p&&(v=[p.pos[0]-w.pos[0],p.pos[1]-w.pos[1]],r.set(w.key,v.concat(v)),i.push(p.key));for(const w of l)i.includes(w.key)||s.set(w.key,w.piece);return{anims:r,fadings:s}}function Ai(e,t){const r=e.animation.current;if(r===void 0){e.dom.destroyed||e.dom.redrawNow();return}const i=1-(t-r.start)*r.frequency;if(i<=0)e.animation.current=void 0,e.dom.redrawNow();else{const s=da(i);for(const l of r.plan.anims.values())l[2]=l[0]*s,l[3]=l[1]*s;e.dom.redrawNow(!0),requestAnimationFrame((l=performance.now())=>Ai(e,l))}}function ua(e,t){const r=new Map(t.pieces),i=e(t),s=ca(r,t);if(s.anims.size||s.fadings.size){const l=t.animation.current&&t.animation.current.start;t.animation.current={start:performance.now(),frequency:1/t.animation.duration,plan:s},l||Ai(t,performance.now())}else t.dom.redraw();return i}const da=e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1,fa=["green","red","blue","yellow"];function ha(e,t){if(t.touches&&t.touches.length>1)return;t.stopPropagation(),t.preventDefault(),t.ctrlKey?Pe(e):Zr(e);const r=ot(t),i=st(r,we(e),e.dom.bounds());i&&(e.drawable.current={orig:i,pos:r,brush:_a(t),snapToValidMove:e.drawable.defaultSnapToValidMove},Mi(e))}function Mi(e){requestAnimationFrame(()=>{const t=e.drawable.current;if(t){const r=st(t.pos,we(e),e.dom.bounds());r||(t.snapToValidMove=!1);const i=t.snapToValidMove?ia(t.orig,t.pos,we(e),e.dom.bounds()):r;i!==t.mouseSq&&(t.mouseSq=i,t.dest=i!==t.orig?i:void 0,e.dom.redrawNow()),Mi(e)}})}function pa(e,t){e.drawable.current&&(e.drawable.current.pos=ot(t))}function ma(e){const t=e.drawable.current;t&&(t.mouseSq&&va(e.drawable,t),Oi(e))}function Oi(e){e.drawable.current&&(e.drawable.current=void 0,e.dom.redraw())}function ga(e){e.drawable.shapes.length&&(e.drawable.shapes=[],e.dom.redraw(),Ri(e.drawable))}function _a(e){var t;const r=(e.shiftKey||e.ctrlKey)&&di(e),i=e.altKey||e.metaKey||((t=e.getModifierState)===null||t===void 0?void 0:t.call(e,"AltGraph"));return fa[(r?1:0)+(i?2:0)]}function va(e,t){const r=s=>s.orig===t.orig&&s.dest===t.dest,i=e.shapes.find(r);i&&(e.shapes=e.shapes.filter(s=>!r(s))),(!i||i.brush!==t.brush)&&e.shapes.push({orig:t.orig,dest:t.dest,brush:t.brush}),Ri(e)}function Ri(e){e.onChange&&e.onChange(e.shapes)}function wa(e,t){if(!(e.trustAllEvents||t.isTrusted)||t.buttons!==void 0&&t.buttons>1||t.touches&&t.touches.length>1)return;const r=e.dom.bounds(),i=ot(t),s=st(i,we(e),r);if(!s)return;const l=e.pieces.get(s),d=e.selected;if(!d&&e.drawable.enabled&&(e.drawable.eraseOnClick||!l||l.color!==e.turnColor)&&ga(e),t.cancelable!==!1&&(!t.touches||e.blockTouchScroll||l||d||ba(e,i)))t.preventDefault();else if(t.touches)return;const f=!!e.premovable.current,m=!!e.predroppable.current;e.stats.ctrlKey=t.ctrlKey,e.selected&&Xr(e,e.selected,s)?Ze(w=>Mr(w,s),e):Mr(e,s);const p=e.selected===s,v=xi(e,s);if(l&&v&&p&&ta(e,s)){e.draggable.current={orig:s,piece:l,origPos:i,pos:i,started:e.draggable.autoDistance&&e.stats.dragged,element:v,previouslySelected:d,originTarget:t.target,keyHasChanged:!1},v.cgDragging=!0,v.classList.add("dragging");const w=e.dom.elements.ghost;w&&(w.className=`ghost ${l.color} ${l.role}`,Re(w,Ht(r)(ae(s),we(e))),qr(w,!0)),en(e)}else f&&He(e),m&&Ge(e);e.dom.redraw()}function ba(e,t){const r=we(e),i=e.dom.bounds(),s=Math.pow(i.width/8,2);for(const l of e.pieces.keys()){const d=fi(l,r,i);if(It(d,t)<=s)return!0}return!1}function ka(e,t,r,i){const s="a0";e.pieces.set(s,t),e.dom.redraw();const l=ot(r);e.draggable.current={orig:s,piece:t,origPos:l,pos:l,started:!0,element:()=>xi(e,s),originTarget:r.target,newPiece:!0,force:!!i,keyHasChanged:!1},en(e)}function en(e){requestAnimationFrame(()=>{var t;const r=e.draggable.current;if(!r)return;!((t=e.animation.current)===null||t===void 0)&&t.plan.anims.has(r.orig)&&(e.animation.current=void 0);const i=e.pieces.get(r.orig);if(!i||!Ar(i,r.piece))rr(e);else if(!r.started&&It(r.pos,r.origPos)>=Math.pow(e.draggable.distance,2)&&(r.started=!0),r.started){if(typeof r.element=="function"){const l=r.element();if(!l)return;l.cgDragging=!0,l.classList.add("dragging"),r.element=l}const s=e.dom.bounds();Re(r.element,[r.pos[0]-s.left-s.width/16,r.pos[1]-s.top-s.height/16]),r.keyHasChanged||(r.keyHasChanged=r.orig!==st(r.pos,we(e),s))}en(e)})}function ya(e,t){e.draggable.current&&(!t.touches||t.touches.length<2)&&(e.draggable.current.pos=ot(t))}function Ea(e,t){const r=e.draggable.current;if(!r)return;if(t.type==="touchend"&&t.cancelable!==!1&&t.preventDefault(),t.type==="touchend"&&r.originTarget!==t.target&&!r.newPiece){e.draggable.current=void 0;return}He(e),Ge(e);const i=ot(t)||r.pos,s=st(i,we(e),e.dom.bounds());s&&r.started&&r.orig!==s?r.newPiece?ki(e,r.orig,s,r.force):(e.stats.ctrlKey=t.ctrlKey,bi(e,r.orig,s)&&(e.stats.dragged=!0)):r.newPiece?e.pieces.delete(r.orig):e.draggable.deleteOnDropOff&&!s&&(e.pieces.delete(r.orig),ve(e.events.change)),(r.orig===r.previouslySelected||r.keyHasChanged)&&(r.orig===s||!s)?Pe(e):e.selectable.enabled||Pe(e),Fi(e),e.draggable.current=void 0,e.dom.redraw()}function rr(e){const t=e.draggable.current;t&&(t.newPiece&&e.pieces.delete(t.orig),e.draggable.current=void 0,Pe(e),Fi(e),e.dom.redraw())}function Fi(e){const t=e.dom.elements;t.ghost&&qr(t.ghost,!1)}function xi(e,t){let r=e.dom.elements.board.firstChild;for(;r;){if(r.cgKey===t&&r.tagName==="PIECE")return r;r=r.nextSibling}}function Sa(e,t){e.exploding={stage:1,keys:t},e.dom.redraw(),setTimeout(()=>{Ln(e,2),setTimeout(()=>Ln(e,void 0),120)},120)}function Ln(e,t){e.exploding&&(t?e.exploding.stage=t:e.exploding=void 0,e.dom.redraw())}function Ca(e,t){function r(){Ks(e),t()}return{set(i){i.orientation&&i.orientation!==e.orientation&&r(),Pi(e,i),(i.fen?Ze:ze)(s=>Ti(s,i),e)},state:e,getFen:()=>aa(e.pieces),toggleOrientation:r,setPieces(i){Ze(s=>Vs(s,i),e)},selectSquare(i,s){i?Ze(l=>Mr(l,i,s),e):e.selected&&(Pe(e),e.dom.redraw())},move(i,s){Ze(l=>vi(l,i,s),e)},newPiece(i,s){Ze(l=>Yr(l,i,s),e)},playPremove(){if(e.premovable.current){if(Ze(ra,e))return!0;e.dom.redraw()}return!1},playPredrop(i){if(e.predroppable.current){const s=na(e,i);return e.dom.redraw(),s}return!1},cancelPremove(){ze(He,e)},cancelPredrop(){ze(Ge,e)},cancelMove(){ze(i=>{Zr(i),rr(i)},e)},stop(){ze(i=>{Dn(i),rr(i)},e)},explode(i){Sa(e,i)},setAutoShapes(i){ze(s=>s.drawable.autoShapes=i,e)},setShapes(i){ze(s=>s.drawable.shapes=i,e)},getKeyAtDomPos(i){return st(i,we(e),e.dom.bounds())},redrawAll:t,dragNewPiece(i,s,l){ka(e,i,s,l)},destroy(){Dn(e),e.dom.unbind&&e.dom.unbind(),e.dom.destroyed=!0}}}function Pa(){return{pieces:Ci(Si),orientation:"white",turnColor:"white",coordinates:!0,coordinatesOnSquares:!1,ranksPosition:"right",autoCastle:!0,viewOnly:!1,disableContextMenu:!1,addPieceZIndex:!1,blockTouchScroll:!1,pieceKey:!1,trustAllEvents:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,defaultSnapToValidMove:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15},purple:{key:"purple",color:"#68217a",opacity:.65,lineWidth:10},pink:{key:"pink",color:"#ee2080",opacity:.5,lineWidth:10},white:{key:"white",color:"white",opacity:1,lineWidth:10}},prevSvgHash:""},hold:js()}}const In={hilitePrimary:{key:"hilitePrimary",color:"#3291ff",opacity:1,lineWidth:1},hiliteWhite:{key:"hiliteWhite",color:"#ffffff",opacity:1,lineWidth:1}};function Ta(){const e=ue("defs"),t=_e(ue("filter"),{id:"cg-filter-blur"});return t.appendChild(_e(ue("feGaussianBlur"),{stdDeviation:"0.019"})),e.appendChild(t),e}function Aa(e,t,r){var i;const s=e.drawable,l=s.current,d=l&&l.mouseSq?l:void 0,f=new Map,m=e.dom.bounds(),p=s.autoShapes.filter(A=>!A.piece);for(const A of s.shapes.concat(p).concat(d?[d]:[])){if(!A.dest)continue;const k=(i=f.get(A.dest))!==null&&i!==void 0?i:new Set,E=or(ir(ae(A.orig),e.orientation),m),O=or(ir(ae(A.dest),e.orientation),m);k.add(Rr(E,O)),f.set(A.dest,k)}const v=s.shapes.concat(p).map(A=>({shape:A,current:!1,hash:Un(A,Or(A.dest,f),!1,m)}));d&&v.push({shape:d,current:!0,hash:Un(d,Or(d.dest,f),!0,m)});const w=v.map(A=>A.hash).join(";");if(w===e.drawable.prevSvgHash)return;e.drawable.prevSvgHash=w;const S=t.querySelector("defs");Ma(s,v,S),Oa(v,t.querySelector("g"),r.querySelector("g"),A=>xa(e,A,s.brushes,f,m))}function Ma(e,t,r){var i;const s=new Map;let l;for(const m of t.filter(p=>p.shape.dest&&p.shape.brush))l=Ni(e.brushes[m.shape.brush],m.shape.modifiers),!((i=m.shape.modifiers)===null||i===void 0)&&i.hilite&&s.set(nr(l).key,nr(l)),s.set(l.key,l);const d=new Set;let f=r.firstElementChild;for(;f;)d.add(f.getAttribute("cgKey")),f=f.nextElementSibling;for(const[m,p]of s.entries())d.has(m)||r.appendChild($a(p))}function Oa(e,t,r,i){const s=new Map;for(const l of e)s.set(l.hash,!1);for(const l of[t,r]){const d=[];let f=l.firstElementChild,m;for(;f;)m=f.getAttribute("cgHash"),s.has(m)?s.set(m,!0):d.push(f),f=f.nextElementSibling;for(const p of d)l.removeChild(p)}for(const l of e.filter(d=>!s.get(d.hash)))for(const d of i(l))d.isCustom?r.appendChild(d.el):t.appendChild(d.el)}function Un({orig:e,dest:t,brush:r,piece:i,modifiers:s,customSvg:l,label:d},f,m,p){var v,w;return[p.width,p.height,m,e,t,r,f&&"-",i&&Ra(i),s&&Fa(s),l&&`custom-${zn(l.html)},${(w=(v=l.center)===null||v===void 0?void 0:v[0])!==null&&w!==void 0?w:"o"}`,d&&`label-${zn(d.text)}`].filter(S=>S).join(",")}function Ra(e){return[e.color,e.role,e.scale].filter(t=>t).join(",")}function Fa(e){return[e.lineWidth,e.hilite&&"*"].filter(t=>t).join(",")}function zn(e){let t=0;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r)>>>0;return t.toString()}function xa(e,{shape:t,current:r,hash:i},s,l,d){var f,m;const p=or(ir(ae(t.orig),e.orientation),d),v=t.dest?or(ir(ae(t.dest),e.orientation),d):p,w=t.brush&&Ni(s[t.brush],t.modifiers),S=l.get(t.dest),A=[];if(w){const k=_e(ue("g"),{cgHash:i});A.push({el:k}),p[0]!==v[0]||p[1]!==v[1]?k.appendChild(Da(t,w,p,v,r,Or(t.dest,l))):k.appendChild(Na(s[t.brush],p,r,d))}if(t.label){const k=t.label;(f=k.fill)!==null&&f!==void 0||(k.fill=t.brush&&s[t.brush].color);const E=t.brush?void 0:"tr";A.push({el:La(k,i,p,v,S,E),isCustom:!0})}if(t.customSvg){const k=(m=t.customSvg.center)!==null&&m!==void 0?m:"orig",[E,O]=k==="label"?$i(p,v,S).map(P=>P-.5):k==="dest"?v:p,T=_e(ue("g"),{transform:`translate(${E},${O})`,cgHash:i});T.innerHTML=`<svg width="1" height="1" viewBox="0 0 100 100">${t.customSvg.html}</svg>`,A.push({el:T,isCustom:!0})}return A}function Na(e,t,r,i){const s=Ia(),l=(i.width+i.height)/(4*Math.max(i.width,i.height));return _e(ue("circle"),{stroke:e.color,"stroke-width":s[r?0:1],fill:"none",opacity:Di(e,r),cx:t[0],cy:t[1],r:l-s[1]/2})}function nr(e){return["#ffffff","#fff","white"].includes(e.color)?In.hilitePrimary:In.hiliteWhite}function Da(e,t,r,i,s,l){var d;function f(v){var w;const S=za(l&&!s),A=i[0]-r[0],k=i[1]-r[1],E=Math.atan2(k,A),O=Math.cos(E)*S,T=Math.sin(E)*S;return _e(ue("line"),{stroke:v?nr(t).color:t.color,"stroke-width":Ua(t,s)+(v?.04:0),"stroke-linecap":"round","marker-end":`url(#arrowhead-${v?nr(t).key:t.key})`,opacity:!((w=e.modifiers)===null||w===void 0)&&w.hilite?1:Di(t,s),x1:r[0],y1:r[1],x2:i[0]-O,y2:i[1]-T})}if(!(!((d=e.modifiers)===null||d===void 0)&&d.hilite))return f(!1);const m=ue("g"),p=_e(ue("g"),{filter:"url(#cg-filter-blur)"});return p.appendChild(Ba(r,i)),p.appendChild(f(!0)),m.appendChild(p),m.appendChild(f(!1)),m}function $a(e){const t=_e(ue("marker"),{id:"arrowhead-"+e.key,orient:"auto",overflow:"visible",markerWidth:4,markerHeight:4,refX:e.key.startsWith("hilite")?1.86:2.05,refY:2});return t.appendChild(_e(ue("path"),{d:"M0,0 V4 L3,2 Z",fill:e.color})),t.setAttribute("cgKey",e.key),t}function La(e,t,r,i,s,l){var d;const m=.4*.75**e.text.length,p=$i(r,i,s),v=l==="tr"?.4:0,w=_e(ue("g"),{transform:`translate(${p[0]+v},${p[1]-v})`,cgHash:t});w.appendChild(_e(ue("circle"),{r:.4/2,"fill-opacity":l?1:.8,"stroke-opacity":l?1:.7,"stroke-width":.03,fill:(d=e.fill)!==null&&d!==void 0?d:"#666",stroke:"white"}));const S=_e(ue("text"),{"font-size":m,"font-family":"Noto Sans","text-anchor":"middle",fill:"white",y:.13*.75**e.text.length});return S.innerHTML=e.text,w.appendChild(S),w}function ir(e,t){return t==="white"?e:[7-e[0],7-e[1]]}function Or(e,t){return(e&&t.has(e)&&t.get(e).size>1)===!0}function ue(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function _e(e,t){for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.setAttribute(r,t[r]);return e}function Ni(e,t){return t?{color:e.color,opacity:Math.round(e.opacity*10)/10,lineWidth:Math.round(t.lineWidth||e.lineWidth),key:[e.key,t.lineWidth].filter(r=>r).join("")}:e}function Ia(){return[3/64,4/64]}function Ua(e,t){return(e.lineWidth||10)*(t?.85:1)/64}function Di(e,t){return(e.opacity||1)*(t?.9:1)}function za(e){return(e?20:10)/64}function or(e,t){const r=Math.min(1,t.width/t.height),i=Math.min(1,t.height/t.width);return[(e[0]-3.5)*r,(3.5-e[1])*i]}function Ba(e,t){const r={from:[Math.floor(Math.min(e[0],t[0])),Math.floor(Math.min(e[1],t[1]))],to:[Math.ceil(Math.max(e[0],t[0])),Math.ceil(Math.max(e[1],t[1]))]};return _e(ue("rect"),{x:r.from[0],y:r.from[1],width:r.to[0]-r.from[0],height:r.to[1]-r.from[1],fill:"none",stroke:"none"})}function Rr(e,t,r=!0){const i=Math.atan2(t[1]-e[1],t[0]-e[0])+Math.PI;return r?(Math.round(i*8/Math.PI)+16)%16:i}function ja(e,t){return Math.sqrt([e[0]-t[0],e[1]-t[1]].reduce((r,i)=>r+i*i,0))}function $i(e,t,r){let i=ja(e,t);const s=Rr(e,t,!1);if(r&&(i-=33/64,r.size>1)){i-=10/64;const l=Rr(e,t);(r.has((l+1)%16)||r.has((l+15)%16))&&l&1&&(i-=.4)}return[e[0]-Math.cos(s)*i,e[1]-Math.sin(s)*i].map(l=>l+.5)}function Wa(e,t){e.innerHTML="",e.classList.add("cg-wrap");for(const m of Us)e.classList.toggle("orientation-"+m,t.orientation===m);e.classList.toggle("manipulable",!t.viewOnly);const r=Le("cg-container");e.appendChild(r);const i=Le("cg-board");r.appendChild(i);let s,l,d;if(t.drawable.visible&&(s=_e(ue("svg"),{class:"cg-shapes",viewBox:"-4 -4 8 8",preserveAspectRatio:"xMidYMid slice"}),s.appendChild(Ta()),s.appendChild(ue("g")),l=_e(ue("svg"),{class:"cg-custom-svgs",viewBox:"-3.5 -3.5 8 8",preserveAspectRatio:"xMidYMid slice"}),l.appendChild(ue("g")),d=Le("cg-auto-pieces"),r.appendChild(s),r.appendChild(l),r.appendChild(d)),t.coordinates){const m=t.orientation==="black"?" black":"",p=t.ranksPosition==="left"?" left":"";if(t.coordinatesOnSquares){const v=t.orientation==="white"?w=>w+1:w=>8-w;er.forEach((w,S)=>r.appendChild(br(tr.map(A=>w+A),"squares rank"+v(S)+m+p)))}else r.appendChild(br(tr,"ranks"+m+p)),r.appendChild(br(er,"files"+m))}let f;return t.draggable.enabled&&t.draggable.showGhost&&(f=Le("piece","ghost"),qr(f,!1),r.appendChild(f)),{board:i,container:r,wrap:e,ghost:f,svg:s,customSvg:l,autoPieces:d}}function br(e,t){const r=Le("coords",t);let i;for(const s of e)i=Le("coord"),i.textContent=s,r.appendChild(i);return r}function Ha(e,t){if(!e.dropmode.active)return;He(e),Ge(e);const r=e.dropmode.piece;if(r){e.pieces.set("a0",r);const i=ot(t),s=i&&st(i,we(e),e.dom.bounds());s&&ki(e,"a0",s)}e.dom.redraw()}function Ga(e,t){const r=e.dom.elements.board;if("ResizeObserver"in window&&new ResizeObserver(t).observe(e.dom.elements.wrap),(e.disableContextMenu||e.drawable.enabled)&&r.addEventListener("contextmenu",s=>s.preventDefault()),e.viewOnly)return;const i=Va(e);r.addEventListener("touchstart",i,{passive:!1}),r.addEventListener("mousedown",i,{passive:!1})}function Ka(e,t){const r=[];if("ResizeObserver"in window||r.push(xt(document.body,"chessground.resize",t)),!e.viewOnly){const i=Bn(e,ya,pa),s=Bn(e,Ea,ma);for(const d of["touchmove","mousemove"])r.push(xt(document,d,i));for(const d of["touchend","mouseup"])r.push(xt(document,d,s));const l=()=>e.dom.bounds.clear();r.push(xt(document,"scroll",l,{capture:!0,passive:!0})),r.push(xt(window,"resize",l,{passive:!0}))}return()=>r.forEach(i=>i())}function xt(e,t,r,i){return e.addEventListener(t,r,i),()=>e.removeEventListener(t,r,i)}const Va=e=>t=>{e.draggable.current?rr(e):e.drawable.current?Oi(e):t.shiftKey||di(t)?e.drawable.enabled&&ha(e,t):e.viewOnly||(e.dropmode.active?Ha(e,t):wa(e,t))},Bn=(e,t,r)=>i=>{e.drawable.current?e.drawable.enabled&&r(e,i):e.viewOnly||t(e,i)};function qa(e){const t=we(e),r=Ht(e.dom.bounds()),i=e.dom.elements.board,s=e.pieces,l=e.animation.current,d=l?l.plan.anims:new Map,f=l?l.plan.fadings:new Map,m=e.draggable.current,p=Xa(e),v=new Set,w=new Set,S=new Map,A=new Map;let k,E,O,T,P,I,te,x,ne,U;for(E=i.firstChild;E;){if(k=E.cgKey,Li(E))if(O=s.get(k),P=d.get(k),I=f.get(k),T=E.cgPiece,E.cgDragging&&(!m||m.orig!==k)&&(E.classList.remove("dragging"),Re(E,r(ae(k),t)),E.cgDragging=!1),!I&&E.cgFading&&(E.cgFading=!1,E.classList.remove("fading")),O){if(P&&E.cgAnimating&&T===Nt(O)){const z=ae(k);z[0]+=P[2],z[1]+=P[3],E.classList.add("anim"),Re(E,r(z,t))}else E.cgAnimating&&(E.cgAnimating=!1,E.classList.remove("anim"),Re(E,r(ae(k),t)),e.addPieceZIndex&&(E.style.zIndex=kr(ae(k),t)));T===Nt(O)&&(!I||!E.cgFading)?v.add(k):I&&T===Nt(I)?(E.classList.add("fading"),E.cgFading=!0):yr(S,T,E)}else yr(S,T,E);else if(Ii(E)){const z=E.className;p.get(k)===z?w.add(k):yr(A,z,E)}E=E.nextSibling}for(const[z,oe]of p)if(!w.has(z)){ne=A.get(oe),U=ne&&ne.pop();const se=r(ae(z),t);if(U)U.cgKey=z,Re(U,se);else{const C=Le("square",oe);C.cgKey=z,Re(C,se),i.insertBefore(C,i.firstChild)}}for(const[z,oe]of s)if(P=d.get(z),!v.has(z))if(te=S.get(Nt(oe)),x=te&&te.pop(),x){x.cgKey=z,x.cgFading&&(x.classList.remove("fading"),x.cgFading=!1);const se=ae(z);e.addPieceZIndex&&(x.style.zIndex=kr(se,t)),P&&(x.cgAnimating=!0,x.classList.add("anim"),se[0]+=P[2],se[1]+=P[3]),Re(x,r(se,t))}else{const se=Nt(oe),C=Le("piece",se),Y=ae(z);C.cgPiece=se,C.cgKey=z,P&&(C.cgAnimating=!0,Y[0]+=P[2],Y[1]+=P[3]),Re(C,r(Y,t)),e.addPieceZIndex&&(C.style.zIndex=kr(Y,t)),i.appendChild(C)}for(const z of S.values())Wn(e,z);for(const z of A.values())Wn(e,z)}function Ya(e){const t=we(e),r=Ht(e.dom.bounds());let i=e.dom.elements.board.firstChild;for(;i;)(Li(i)&&!i.cgAnimating||Ii(i))&&Re(i,r(ae(i.cgKey),t)),i=i.nextSibling}function jn(e){var t,r;const i=e.dom.elements.wrap.getBoundingClientRect(),s=e.dom.elements.container,l=i.height/i.width,d=Math.floor(i.width*window.devicePixelRatio/8)*8/window.devicePixelRatio,f=d*l;s.style.width=d+"px",s.style.height=f+"px",e.dom.bounds.clear(),(t=e.addDimensionsCssVarsTo)===null||t===void 0||t.style.setProperty("---cg-width",d+"px"),(r=e.addDimensionsCssVarsTo)===null||r===void 0||r.style.setProperty("---cg-height",f+"px")}const Li=e=>e.tagName==="PIECE",Ii=e=>e.tagName==="SQUARE";function Wn(e,t){for(const r of t)e.dom.elements.board.removeChild(r)}function kr(e,t){const i=e[1];return`${t?10-i:3+i}`}const Nt=e=>`${e.color} ${e.role}`;function Xa(e){var t,r,i;const s=new Map;if(e.lastMove&&e.highlight.lastMove)for(const f of e.lastMove)Ne(s,f,"last-move");if(e.check&&e.highlight.check&&Ne(s,e.check,"check"),e.selected&&(Ne(s,e.selected,"selected"),e.movable.showDests)){const f=(t=e.movable.dests)===null||t===void 0?void 0:t.get(e.selected);if(f)for(const p of f)Ne(s,p,"move-dest"+(e.pieces.has(p)?" oc":""));const m=(i=(r=e.premovable.customDests)===null||r===void 0?void 0:r.get(e.selected))!==null&&i!==void 0?i:e.premovable.dests;if(m)for(const p of m)Ne(s,p,"premove-dest"+(e.pieces.has(p)?" oc":""))}const l=e.premovable.current;if(l)for(const f of l)Ne(s,f,"current-premove");else e.predroppable.current&&Ne(s,e.predroppable.current.key,"current-premove");const d=e.exploding;if(d)for(const f of d.keys)Ne(s,f,"exploding"+d.stage);return e.highlight.custom&&e.highlight.custom.forEach((f,m)=>{Ne(s,m,f)}),s}function Ne(e,t,r){const i=e.get(t);i?e.set(t,`${i} ${r}`):e.set(t,r)}function yr(e,t,r){const i=e.get(t);i?i.push(r):e.set(t,[r])}function Qa(e,t,r){const i=new Map,s=[];for(const f of e)i.set(f.hash,!1);let l=t.firstElementChild,d;for(;l;)d=l.getAttribute("cgHash"),i.has(d)?i.set(d,!0):s.push(l),l=l.nextElementSibling;for(const f of s)t.removeChild(f);for(const f of e)i.get(f.hash)||t.appendChild(r(f))}function Za(e,t){const i=e.drawable.autoShapes.filter(s=>s.piece).map(s=>({shape:s,hash:tl(s),current:!1}));Qa(i,t,s=>el(e,s,e.dom.bounds()))}function Ja(e){var t;const r=we(e),i=Ht(e.dom.bounds());let s=(t=e.dom.elements.autoPieces)===null||t===void 0?void 0:t.firstChild;for(;s;)ui(s,i(ae(s.cgKey),r),s.cgScale),s=s.nextSibling}function el(e,{shape:t,hash:r},i){var s,l,d;const f=t.orig,m=(s=t.piece)===null||s===void 0?void 0:s.role,p=(l=t.piece)===null||l===void 0?void 0:l.color,v=(d=t.piece)===null||d===void 0?void 0:d.scale,w=Le("piece",`${m} ${p}`);return w.setAttribute("cgHash",r),w.cgKey=f,w.cgScale=v,ui(w,Ht(i)(ae(f),we(e)),v),w}const tl=e=>{var t,r,i;return[e.orig,(t=e.piece)===null||t===void 0?void 0:t.role,(r=e.piece)===null||r===void 0?void 0:r.color,(i=e.piece)===null||i===void 0?void 0:i.scale].join(",")};function rl(e,t){const r=Pa();Ti(r,t||{});function i(){const s="dom"in r?r.dom.unbind:void 0,l=Wa(e,r),d=Bs(()=>l.board.getBoundingClientRect()),f=v=>{qa(p),l.autoPieces&&Za(p,l.autoPieces),!v&&l.svg&&Aa(p,l.svg,l.customSvg)},m=()=>{jn(p),Ya(p),l.autoPieces&&Ja(p)},p=r;return p.dom={elements:l,bounds:d,redraw:nl(f),redrawNow:f,unbind:s},p.drawable.prevSvgHash="",jn(p),f(!1),Ga(p,m),s||(p.dom.unbind=Ka(p,m)),p.events.insert&&p.events.insert(l),p}return Ca(i(),i)}function nl(e){let t=!1;return()=>{t||(t=!0,requestAnimationFrame(()=>{e(),t=!1}))}}const sr=["a","b","c","d","e","f","g","h"],Ui=["1","2","3","4","5","6","7","8"],nt=["white","black"],Me=["pawn","knight","bishop","rook","queen","king"],il=["a","h"],ar=e=>"role"in e,N=e=>e!==void 0,ge=e=>e==="white"?"black":"white",it=e=>e>>3,ye=e=>e&7,Fr=(e,t)=>0<=e&&e<8&&0<=t&&t<8?e+8*t:void 0,Dt=e=>{switch(e){case"pawn":return"p";case"knight":return"n";case"bishop":return"b";case"rook":return"r";case"queen":return"q";case"king":return"k"}};function xr(e){switch(e.toLowerCase()){case"p":return"pawn";case"n":return"knight";case"b":return"bishop";case"r":return"rook";case"q":return"queen";case"k":return"king";default:return}}function Zt(e){if(e.length===2)return Fr(e.charCodeAt(0)-97,e.charCodeAt(1)-49)}const Ut=e=>sr[ye(e)]+Ui[it(e)],ol=e=>{if(e[1]==="@"&&e.length===4){const t=xr(e[0]),r=Zt(e.slice(2));if(t&&N(r))return{role:t,to:r}}else if(e.length===4||e.length===5){const t=Zt(e.slice(0,2)),r=Zt(e.slice(2,4));let i;if(e.length===5&&(i=xr(e[4]),!i))return;if(N(t)&&N(r))return{from:t,to:r,promotion:i}}},tn=(e,t)=>e==="white"?t==="a"?2:6:t==="a"?58:62,rn=(e,t)=>e==="white"?t==="a"?3:5:t==="a"?59:61,Hn=e=>(e=e-(e>>>1&1431655765),e=(e&858993459)+(e>>>2&858993459),Math.imul(e+(e>>>4)&252645135,16843009)>>24),Nr=e=>(e=e>>>8&16711935|(e&16711935)<<8,e>>>16&65535|(e&65535)<<16),Gn=e=>(e=e>>>1&1431655765|(e&1431655765)<<1,e=e>>>2&858993459|(e&858993459)<<2,e=e>>>4&252645135|(e&252645135)<<4,Nr(e));class y{constructor(t,r){this.lo=t|0,this.hi=r|0}static fromSquare(t){return t>=32?new y(0,1<<t-32):new y(1<<t,0)}static fromRank(t){return new y(255,0).shl64(8*t)}static fromFile(t){return new y(16843009<<t,16843009<<t)}static empty(){return new y(0,0)}static full(){return new y(4294967295,4294967295)}static corners(){return new y(129,2164260864)}static center(){return new y(402653184,24)}static backranks(){return new y(255,4278190080)}static backrank(t){return t==="white"?new y(255,0):new y(0,4278190080)}static lightSquares(){return new y(1437226410,1437226410)}static darkSquares(){return new y(2857740885,2857740885)}complement(){return new y(~this.lo,~this.hi)}xor(t){return new y(this.lo^t.lo,this.hi^t.hi)}union(t){return new y(this.lo|t.lo,this.hi|t.hi)}intersect(t){return new y(this.lo&t.lo,this.hi&t.hi)}diff(t){return new y(this.lo&~t.lo,this.hi&~t.hi)}intersects(t){return this.intersect(t).nonEmpty()}isDisjoint(t){return this.intersect(t).isEmpty()}supersetOf(t){return t.diff(this).isEmpty()}subsetOf(t){return this.diff(t).isEmpty()}shr64(t){return t>=64?y.empty():t>=32?new y(this.hi>>>t-32,0):t>0?new y(this.lo>>>t^this.hi<<32-t,this.hi>>>t):this}shl64(t){return t>=64?y.empty():t>=32?new y(0,this.lo<<t-32):t>0?new y(this.lo<<t,this.hi<<t^this.lo>>>32-t):this}bswap64(){return new y(Nr(this.hi),Nr(this.lo))}rbit64(){return new y(Gn(this.hi),Gn(this.lo))}minus64(t){const r=this.lo-t.lo,i=(r&t.lo&1)+(t.lo>>>1)+(r>>>1)>>>31;return new y(r,this.hi-(t.hi+i))}equals(t){return this.lo===t.lo&&this.hi===t.hi}size(){return Hn(this.lo)+Hn(this.hi)}isEmpty(){return this.lo===0&&this.hi===0}nonEmpty(){return this.lo!==0||this.hi!==0}has(t){return(t>=32?this.hi&1<<t-32:this.lo&1<<t)!==0}set(t,r){return r?this.with(t):this.without(t)}with(t){return t>=32?new y(this.lo,this.hi|1<<t-32):new y(this.lo|1<<t,this.hi)}without(t){return t>=32?new y(this.lo,this.hi&~(1<<t-32)):new y(this.lo&~(1<<t),this.hi)}toggle(t){return t>=32?new y(this.lo,this.hi^1<<t-32):new y(this.lo^1<<t,this.hi)}last(){if(this.hi!==0)return 63-Math.clz32(this.hi);if(this.lo!==0)return 31-Math.clz32(this.lo)}first(){if(this.lo!==0)return 31-Math.clz32(this.lo&-this.lo);if(this.hi!==0)return 63-Math.clz32(this.hi&-this.hi)}withoutFirst(){return this.lo!==0?new y(this.lo&this.lo-1,this.hi):new y(0,this.hi&this.hi-1)}moreThanOne(){return this.hi!==0&&this.lo!==0||(this.lo&this.lo-1)!==0||(this.hi&this.hi-1)!==0}singleSquare(){return this.moreThanOne()?void 0:this.last()}*[Symbol.iterator](){let t=this.lo,r=this.hi;for(;t!==0;){const i=31-Math.clz32(t&-t);t^=1<<i,yield i}for(;r!==0;){const i=31-Math.clz32(r&-r);r^=1<<i,yield 32+i}}*reversed(){let t=this.lo,r=this.hi;for(;r!==0;){const i=31-Math.clz32(r);r^=1<<i,yield 32+i}for(;t!==0;){const i=31-Math.clz32(t);t^=1<<i,yield i}}}const lr=(e,t)=>{let r=y.empty();for(const i of t){const s=e+i;0<=s&&s<64&&Math.abs(ye(e)-ye(s))<=2&&(r=r.with(s))}return r},We=e=>{const t=[];for(let r=0;r<64;r++)t[r]=e(r);return t},sl=We(e=>lr(e,[-9,-8,-7,-1,1,7,8,9])),al=We(e=>lr(e,[-17,-15,-10,-6,6,10,15,17])),ll={white:We(e=>lr(e,[7,9])),black:We(e=>lr(e,[-7,-9]))},nn=e=>sl[e],on=e=>al[e],cr=(e,t)=>ll[e][t],Dr=We(e=>y.fromFile(ye(e)).without(e)),$r=We(e=>y.fromRank(it(e)).without(e)),Lr=We(e=>{const t=new y(134480385,2151686160),r=8*(it(e)-ye(e));return(r>=0?t.shl64(r):t.shr64(-r)).without(e)}),Ir=We(e=>{const t=new y(270549120,16909320),r=8*(it(e)+ye(e)-7);return(r>=0?t.shl64(r):t.shr64(-r)).without(e)}),Ur=(e,t,r)=>{let i=r.intersect(t),s=i.bswap64();return i=i.minus64(e),s=s.minus64(e.bswap64()),i.xor(s.bswap64()).intersect(t)},cl=(e,t)=>Ur(y.fromSquare(e),Dr[e],t),ul=(e,t)=>{const r=$r[e];let i=t.intersect(r),s=i.rbit64();return i=i.minus64(y.fromSquare(e)),s=s.minus64(y.fromSquare(63-e)),i.xor(s.rbit64()).intersect(r)},zt=(e,t)=>{const r=y.fromSquare(e);return Ur(r,Lr[e],t).xor(Ur(r,Ir[e],t))},Bt=(e,t)=>cl(e,t).xor(ul(e,t)),zi=(e,t)=>zt(e,t).xor(Bt(e,t)),Bi=(e,t)=>{const r=y.fromSquare(t);return $r[e].intersects(r)?$r[e].with(e):Ir[e].intersects(r)?Ir[e].with(e):Lr[e].intersects(r)?Lr[e].with(e):Dr[e].intersects(r)?Dr[e].with(e):y.empty()},jt=(e,t)=>Bi(e,t).intersect(y.full().shl64(e).xor(y.full().shl64(t))).withoutFirst();class bt{constructor(){}static default(){const t=new bt;return t.reset(),t}reset(){this.occupied=new y(65535,4294901760),this.promoted=y.empty(),this.white=new y(65535,0),this.black=new y(0,4294901760),this.pawn=new y(65280,16711680),this.knight=new y(66,1107296256),this.bishop=new y(36,603979776),this.rook=new y(129,2164260864),this.queen=new y(8,134217728),this.king=new y(16,268435456)}static empty(){const t=new bt;return t.clear(),t}clear(){this.occupied=y.empty(),this.promoted=y.empty();for(const t of nt)this[t]=y.empty();for(const t of Me)this[t]=y.empty()}clone(){const t=new bt;t.occupied=this.occupied,t.promoted=this.promoted;for(const r of nt)t[r]=this[r];for(const r of Me)t[r]=this[r];return t}getColor(t){if(this.white.has(t))return"white";if(this.black.has(t))return"black"}getRole(t){for(const r of Me)if(this[r].has(t))return r}get(t){const r=this.getColor(t);if(!r)return;const i=this.getRole(t),s=this.promoted.has(t);return{color:r,role:i,promoted:s}}take(t){const r=this.get(t);return r&&(this.occupied=this.occupied.without(t),this[r.color]=this[r.color].without(t),this[r.role]=this[r.role].without(t),r.promoted&&(this.promoted=this.promoted.without(t))),r}set(t,r){const i=this.take(t);return this.occupied=this.occupied.with(t),this[r.color]=this[r.color].with(t),this[r.role]=this[r.role].with(t),r.promoted&&(this.promoted=this.promoted.with(t)),i}has(t){return this.occupied.has(t)}*[Symbol.iterator](){for(const t of this.occupied)yield[t,this.get(t)]}pieces(t,r){return this[t].intersect(this[r])}rooksAndQueens(){return this.rook.union(this.queen)}bishopsAndQueens(){return this.bishop.union(this.queen)}kingOf(t){return this.pieces(t,"king").singleSquare()}}class Fe{constructor(){}static empty(){const t=new Fe;for(const r of Me)t[r]=0;return t}static fromBoard(t,r){const i=new Fe;for(const s of Me)i[s]=t.pieces(r,s).size();return i}clone(){const t=new Fe;for(const r of Me)t[r]=this[r];return t}equals(t){return Me.every(r=>this[r]===t[r])}add(t){const r=new Fe;for(const i of Me)r[i]=this[i]+t[i];return r}subtract(t){const r=new Fe;for(const i of Me)r[i]=this[i]-t[i];return r}nonEmpty(){return Me.some(t=>this[t]>0)}isEmpty(){return!this.nonEmpty()}hasPawns(){return this.pawn>0}hasNonPawns(){return this.knight>0||this.bishop>0||this.rook>0||this.queen>0||this.king>0}size(){return this.pawn+this.knight+this.bishop+this.rook+this.queen+this.king}}class et{constructor(t,r){this.white=t,this.black=r}static empty(){return new et(Fe.empty(),Fe.empty())}static fromBoard(t){return new et(Fe.fromBoard(t,"white"),Fe.fromBoard(t,"black"))}clone(){return new et(this.white.clone(),this.black.clone())}equals(t){return this.white.equals(t.white)&&this.black.equals(t.black)}add(t){return new et(this.white.add(t.white),this.black.add(t.black))}subtract(t){return new et(this.white.subtract(t.white),this.black.subtract(t.black))}count(t){return this.white[t]+this.black[t]}size(){return this.white.size()+this.black.size()}isEmpty(){return this.white.isEmpty()&&this.black.isEmpty()}nonEmpty(){return!this.isEmpty()}hasPawns(){return this.white.hasPawns()||this.black.hasPawns()}hasNonPawns(){return this.white.hasNonPawns()||this.black.hasNonPawns()}}class Wt{constructor(t,r){this.white=t,this.black=r}static default(){return new Wt(3,3)}clone(){return new Wt(this.white,this.black)}equals(t){return this.white===t.white&&this.black===t.black}}class ji{unwrap(t,r){const i=this._chain(s=>$.ok(t?t(s):s),s=>r?$.ok(r(s)):$.err(s));if(i.isErr)throw i.error;return i.value}map(t,r){return this._chain(i=>$.ok(t(i)),i=>$.err(r?r(i):i))}chain(t,r){return this._chain(t,r||(i=>$.err(i)))}}class dl extends ji{constructor(t){super(),this.value=void 0,this.isOk=!0,this.isErr=!1,this.value=t}_chain(t,r){return t(this.value)}}class fl extends ji{constructor(t){super(),this.error=void 0,this.isOk=!1,this.isErr=!0,this.error=t}_chain(t,r){return r(this.error)}}var $;(function(e){e.ok=function(t){return new dl(t)},e.err=function(t){return new fl(t||new Error)},e.all=function(t){if(Array.isArray(t)){const s=[];for(let l=0;l<t.length;l++){const d=t[l];if(d.isErr)return d;s.push(d.value)}return e.ok(s)}const r={},i=Object.keys(t);for(let s=0;s<i.length;s++){const l=t[i[s]];if(l.isErr)return l;r[i[s]]=l.value}return e.ok(r)}})($||($={}));var Be;(function(e){e.Empty="ERR_EMPTY",e.OppositeCheck="ERR_OPPOSITE_CHECK",e.PawnsOnBackrank="ERR_PAWNS_ON_BACKRANK",e.Kings="ERR_KINGS",e.Variant="ERR_VARIANT"})(Be||(Be={}));class mt extends Error{}const hl=(e,t,r,i)=>r[t].intersect(Bt(e,i).intersect(r.rooksAndQueens()).union(zt(e,i).intersect(r.bishopsAndQueens())).union(on(e).intersect(r.knight)).union(nn(e).intersect(r.king)).union(cr(ge(t),e).intersect(r.pawn)));class tt{constructor(){}static default(){const t=new tt;return t.castlingRights=y.corners(),t.rook={white:{a:0,h:7},black:{a:56,h:63}},t.path={white:{a:new y(14,0),h:new y(96,0)},black:{a:new y(0,234881024),h:new y(0,1610612736)}},t}static empty(){const t=new tt;return t.castlingRights=y.empty(),t.rook={white:{a:void 0,h:void 0},black:{a:void 0,h:void 0}},t.path={white:{a:y.empty(),h:y.empty()},black:{a:y.empty(),h:y.empty()}},t}clone(){const t=new tt;return t.castlingRights=this.castlingRights,t.rook={white:{a:this.rook.white.a,h:this.rook.white.h},black:{a:this.rook.black.a,h:this.rook.black.h}},t.path={white:{a:this.path.white.a,h:this.path.white.h},black:{a:this.path.black.a,h:this.path.black.h}},t}add(t,r,i,s){const l=tn(t,r),d=rn(t,r);this.castlingRights=this.castlingRights.with(s),this.rook[t][r]=s,this.path[t][r]=jt(s,d).with(d).union(jt(i,l).with(l)).without(i).without(s)}static fromSetup(t){const r=tt.empty(),i=t.castlingRights.intersect(t.board.rook);for(const s of nt){const l=y.backrank(s),d=t.board.kingOf(s);if(!N(d)||!l.has(d))continue;const f=i.intersect(t.board[s]).intersect(l),m=f.first();N(m)&&m<d&&r.add(s,"a",d,m);const p=f.last();N(p)&&d<p&&r.add(s,"h",d,p)}return r}discardRook(t){if(this.castlingRights.has(t)){this.castlingRights=this.castlingRights.without(t);for(const r of nt)for(const i of il)this.rook[r][i]===t&&(this.rook[r][i]=void 0)}}discardColor(t){this.castlingRights=this.castlingRights.diff(y.backrank(t)),this.rook[t].a=void 0,this.rook[t].h=void 0}}class pl{constructor(t){this.rules=t}reset(){this.board=bt.default(),this.pockets=void 0,this.turn="white",this.castles=tt.default(),this.epSquare=void 0,this.remainingChecks=void 0,this.halfmoves=0,this.fullmoves=1}setupUnchecked(t){this.board=t.board.clone(),this.board.promoted=y.empty(),this.pockets=void 0,this.turn=t.turn,this.castles=tt.fromSetup(t),this.epSquare=ml(this,t.epSquare),this.remainingChecks=void 0,this.halfmoves=t.halfmoves,this.fullmoves=t.fullmoves}kingAttackers(t,r,i){return hl(t,r,this.board,i)}playCaptureAt(t,r){this.halfmoves=0,r.role==="rook"&&this.castles.discardRook(t),this.pockets&&this.pockets[ge(r.color)][r.promoted?"pawn":r.role]++}ctx(){const t=this.isVariantEnd(),r=this.board.kingOf(this.turn);if(!N(r))return{king:r,blockers:y.empty(),checkers:y.empty(),variantEnd:t,mustCapture:!1};const i=Bt(r,y.empty()).intersect(this.board.rooksAndQueens()).union(zt(r,y.empty()).intersect(this.board.bishopsAndQueens())).intersect(this.board[ge(this.turn)]);let s=y.empty();for(const d of i){const f=jt(r,d).intersect(this.board.occupied);f.moreThanOne()||(s=s.union(f))}const l=this.kingAttackers(r,ge(this.turn),this.board.occupied);return{king:r,blockers:s,checkers:l,variantEnd:t,mustCapture:!1}}clone(){var t,r;const i=new this.constructor;return i.board=this.board.clone(),i.pockets=(t=this.pockets)===null||t===void 0?void 0:t.clone(),i.turn=this.turn,i.castles=this.castles.clone(),i.epSquare=this.epSquare,i.remainingChecks=(r=this.remainingChecks)===null||r===void 0?void 0:r.clone(),i.halfmoves=this.halfmoves,i.fullmoves=this.fullmoves,i}validate(){if(this.board.occupied.isEmpty())return $.err(new mt(Be.Empty));if(this.board.king.size()!==2)return $.err(new mt(Be.Kings));if(!N(this.board.kingOf(this.turn)))return $.err(new mt(Be.Kings));const t=this.board.kingOf(ge(this.turn));return N(t)?this.kingAttackers(t,this.turn,this.board.occupied).nonEmpty()?$.err(new mt(Be.OppositeCheck)):y.backranks().intersects(this.board.pawn)?$.err(new mt(Be.PawnsOnBackrank)):$.ok(void 0):$.err(new mt(Be.Kings))}dropDests(t){return y.empty()}dests(t,r){if(r=r||this.ctx(),r.variantEnd)return y.empty();const i=this.board.get(t);if(!i||i.color!==this.turn)return y.empty();let s,l;if(i.role==="pawn"){s=cr(this.turn,t).intersect(this.board[ge(this.turn)]);const d=this.turn==="white"?8:-8,f=t+d;if(0<=f&&f<64&&!this.board.occupied.has(f)){s=s.with(f);const m=this.turn==="white"?t<16:t>=48,p=f+d;m&&!this.board.occupied.has(p)&&(s=s.with(p))}N(this.epSquare)&&_l(this,t,r)&&(l=y.fromSquare(this.epSquare))}else i.role==="bishop"?s=zt(t,this.board.occupied):i.role==="knight"?s=on(t):i.role==="rook"?s=Bt(t,this.board.occupied):i.role==="queen"?s=zi(t,this.board.occupied):s=nn(t);if(s=s.diff(this.board[this.turn]),N(r.king)){if(i.role==="king"){const d=this.board.occupied.without(t);for(const f of s)this.kingAttackers(f,ge(this.turn),d).nonEmpty()&&(s=s.without(f));return s.union(Kn(this,"a",r)).union(Kn(this,"h",r))}if(r.checkers.nonEmpty()){const d=r.checkers.singleSquare();if(!N(d))return y.empty();s=s.intersect(jt(d,r.king).with(d))}r.blockers.has(t)&&(s=s.intersect(Bi(t,r.king)))}return l&&(s=s.union(l)),s}isVariantEnd(){return!1}variantOutcome(t){}hasInsufficientMaterial(t){return this.board[t].intersect(this.board.pawn.union(this.board.rooksAndQueens())).nonEmpty()?!1:this.board[t].intersects(this.board.knight)?this.board[t].size()<=2&&this.board[ge(t)].diff(this.board.king).diff(this.board.queen).isEmpty():this.board[t].intersects(this.board.bishop)?(!this.board.bishop.intersects(y.darkSquares())||!this.board.bishop.intersects(y.lightSquares()))&&this.board.pawn.isEmpty()&&this.board.knight.isEmpty():!0}toSetup(){var t,r;return{board:this.board.clone(),pockets:(t=this.pockets)===null||t===void 0?void 0:t.clone(),turn:this.turn,castlingRights:this.castles.castlingRights,epSquare:gl(this),remainingChecks:(r=this.remainingChecks)===null||r===void 0?void 0:r.clone(),halfmoves:Math.min(this.halfmoves,150),fullmoves:Math.min(Math.max(this.fullmoves,1),9999)}}isInsufficientMaterial(){return nt.every(t=>this.hasInsufficientMaterial(t))}hasDests(t){t=t||this.ctx();for(const r of this.board[this.turn])if(this.dests(r,t).nonEmpty())return!0;return this.dropDests(t).nonEmpty()}isLegal(t,r){if(ar(t))return!this.pockets||this.pockets[this.turn][t.role]<=0||t.role==="pawn"&&y.backranks().has(t.to)?!1:this.dropDests(r).has(t.to);{if(t.promotion==="pawn"||t.promotion==="king"&&this.rules!=="antichess"||!!t.promotion!==(this.board.pawn.has(t.from)&&y.backranks().has(t.to)))return!1;const i=this.dests(t.from,r);return i.has(t.to)||i.has(vl(this,t).to)}}isCheck(){const t=this.board.kingOf(this.turn);return N(t)&&this.kingAttackers(t,ge(this.turn),this.board.occupied).nonEmpty()}isEnd(t){return(t?t.variantEnd:this.isVariantEnd())?!0:this.isInsufficientMaterial()||!this.hasDests(t)}isCheckmate(t){return t=t||this.ctx(),!t.variantEnd&&t.checkers.nonEmpty()&&!this.hasDests(t)}isStalemate(t){return t=t||this.ctx(),!t.variantEnd&&t.checkers.isEmpty()&&!this.hasDests(t)}outcome(t){const r=this.variantOutcome(t);return r||(t=t||this.ctx(),this.isCheckmate(t)?{winner:ge(this.turn)}:this.isInsufficientMaterial()||this.isStalemate(t)?{winner:void 0}:void 0)}allDests(t){t=t||this.ctx();const r=new Map;if(t.variantEnd)return r;for(const i of this.board[this.turn])r.set(i,this.dests(i,t));return r}play(t){const r=this.turn,i=this.epSquare,s=Hi(this,t);if(this.epSquare=void 0,this.halfmoves+=1,r==="black"&&(this.fullmoves+=1),this.turn=ge(r),ar(t))this.board.set(t.to,{role:t.role,color:r}),this.pockets&&this.pockets[r][t.role]--,t.role==="pawn"&&(this.halfmoves=0);else{const l=this.board.take(t.from);if(!l)return;let d;if(l.role==="pawn"){this.halfmoves=0,t.to===i&&(d=this.board.take(t.to+(r==="white"?-8:8)));const f=t.from-t.to;Math.abs(f)===16&&8<=t.from&&t.from<=55&&(this.epSquare=t.from+t.to>>1),t.promotion&&(l.role=t.promotion,l.promoted=!!this.pockets)}else if(l.role==="rook")this.castles.discardRook(t.from);else if(l.role==="king"){if(s){const f=this.castles.rook[r][s];if(N(f)){const m=this.board.take(f);this.board.set(tn(r,s),l),m&&this.board.set(rn(r,s),m)}}this.castles.discardColor(r)}if(!s){const f=this.board.set(t.to,l)||d;f&&this.playCaptureAt(t.to,f)}}this.remainingChecks&&this.isCheck()&&(this.remainingChecks[r]=Math.max(this.remainingChecks[r]-1,0))}}class Wi extends pl{constructor(){super("chess")}static default(){const t=new this;return t.reset(),t}static fromSetup(t){const r=new this;return r.setupUnchecked(t),r.validate().map(i=>r)}clone(){return super.clone()}}const ml=(e,t)=>{if(!N(t))return;const r=e.turn==="white"?5:2,i=e.turn==="white"?8:-8;if(it(t)!==r||e.board.occupied.has(t+i))return;const s=t-i;if(!(!e.board.pawn.has(s)||!e.board[ge(e.turn)].has(s)))return t},gl=e=>{if(!N(e.epSquare))return;const t=e.ctx(),i=e.board.pieces(e.turn,"pawn").intersect(cr(ge(e.turn),e.epSquare));for(const s of i)if(e.dests(s,t).has(e.epSquare))return e.epSquare},_l=(e,t,r)=>{if(!N(e.epSquare)||!cr(e.turn,t).has(e.epSquare))return!1;if(!N(r.king))return!0;const i=e.turn==="white"?8:-8,s=e.epSquare-i;return e.kingAttackers(r.king,ge(e.turn),e.board.occupied.toggle(t).toggle(s).with(e.epSquare)).without(s).isEmpty()},Kn=(e,t,r)=>{if(!N(r.king)||r.checkers.nonEmpty())return y.empty();const i=e.castles.rook[e.turn][t];if(!N(i)||e.castles.path[e.turn][t].intersects(e.board.occupied))return y.empty();const s=tn(e.turn,t),l=jt(r.king,s),d=e.board.occupied.without(r.king);for(const p of l)if(e.kingAttackers(p,ge(e.turn),d).nonEmpty())return y.empty();const f=rn(e.turn,t),m=e.board.occupied.toggle(r.king).toggle(i).toggle(f);return e.kingAttackers(s,ge(e.turn),m).nonEmpty()?y.empty():y.fromSquare(i)},Hi=(e,t)=>{if(ar(t))return;const r=t.to-t.from;if(!(Math.abs(r)!==2&&!e.board[e.turn].has(t.to))&&e.board.king.has(t.from))return r>0?"h":"a"},vl=(e,t)=>{const r=Hi(e,t);if(!r)return t;const i=e.castles.rook[e.turn][r];return{from:t.from,to:N(i)?i:t.to}},wl=(e,t)=>{const r=new Map,i=e.ctx();for(const[s,l]of e.allDests(i))if(l.nonEmpty()){const d=Array.from(l,Ut);s===i.king&&ye(s)===4&&(l.has(0)?d.push("c1"):l.has(56)&&d.push("c8"),l.has(7)?d.push("g1"):l.has(63)&&d.push("g8")),r.set(Ut(s),d)}return r},bl="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",kl=bl+" w KQkq -",sn=kl+" 0 1";var ce;(function(e){e.Fen="ERR_FEN",e.Board="ERR_BOARD",e.Pockets="ERR_POCKETS",e.Turn="ERR_TURN",e.Castling="ERR_CASTLING",e.EpSquare="ERR_EP_SQUARE",e.RemainingChecks="ERR_REMAINING_CHECKS",e.Halfmoves="ERR_HALFMOVES",e.Fullmoves="ERR_FULLMOVES"})(ce||(ce={}));class me extends Error{}const yl=(e,t,r)=>{let i=e.indexOf(t);for(;r-- >0&&i!==-1;)i=e.indexOf(t,i+t.length);return i},wt=e=>/^\d{1,4}$/.test(e)?parseInt(e,10):void 0,Gi=e=>{const t=xr(e);return t&&{role:t,color:e.toLowerCase()===e?"black":"white"}},Er=e=>{const t=bt.empty();let r=7,i=0;for(let s=0;s<e.length;s++){const l=e[s];if(l==="/"&&i===8)i=0,r--;else{const d=parseInt(l,10);if(d>0)i+=d;else{if(i>=8||r<0)return $.err(new me(ce.Board));const f=i+r*8,m=Gi(l);if(!m)return $.err(new me(ce.Board));e[s+1]==="~"&&(m.promoted=!0,s++),t.set(f,m),i++}}}return r!==0||i!==8?$.err(new me(ce.Board)):$.ok(t)},Vn=e=>{if(e.length>64)return $.err(new me(ce.Pockets));const t=et.empty();for(const r of e){const i=Gi(r);if(!i)return $.err(new me(ce.Pockets));t[i.color][i.role]++}return $.ok(t)},El=(e,t)=>{let r=y.empty();if(t==="-")return $.ok(r);for(const i of t){const s=i.toLowerCase(),l=i===s?"black":"white",d=l==="white"?0:7;if("a"<=s&&s<="h")r=r.with(Fr(s.charCodeAt(0)-97,d));else if(s==="k"||s==="q"){const f=e[l].intersect(y.backrank(l)).intersect(e.rook.union(e.king)),m=s==="k"?f.last():f.first();r=r.with(N(m)&&e.rook.has(m)?m:Fr(s==="k"?7:0,d))}else return $.err(new me(ce.Castling))}return nt.some(i=>y.backrank(i).intersect(r).size()>2)?$.err(new me(ce.Castling)):$.ok(r)},qn=e=>{const t=e.split("+");if(t.length===3&&t[0]===""){const r=wt(t[1]),i=wt(t[2]);return!N(r)||r>3||!N(i)||i>3?$.err(new me(ce.RemainingChecks)):$.ok(new Wt(3-r,3-i))}else if(t.length===2){const r=wt(t[0]),i=wt(t[1]);return!N(r)||r>3||!N(i)||i>3?$.err(new me(ce.RemainingChecks)):$.ok(new Wt(r,i))}else return $.err(new me(ce.RemainingChecks))},Sl=e=>{const t=e.split(/[\s_]+/),r=t.shift();let i,s=$.ok(void 0);if(r.endsWith("]")){const f=r.indexOf("[");if(f===-1)return $.err(new me(ce.Fen));i=Er(r.slice(0,f)),s=Vn(r.slice(f+1,-1))}else{const f=yl(r,"/",7);f===-1?i=Er(r):(i=Er(r.slice(0,f)),s=Vn(r.slice(f+1)))}let l;const d=t.shift();if(!N(d)||d==="w")l="white";else if(d==="b")l="black";else return $.err(new me(ce.Turn));return i.chain(f=>{const m=t.shift(),p=N(m)?El(f,m):$.ok(y.empty()),v=t.shift();let w;if(N(v)&&v!=="-"&&(w=Zt(v),!N(w)))return $.err(new me(ce.EpSquare));let S=t.shift(),A;N(S)&&S.includes("+")&&(A=qn(S),S=t.shift());const k=N(S)?wt(S):0;if(!N(k))return $.err(new me(ce.Halfmoves));const E=t.shift(),O=N(E)?wt(E):1;if(!N(O))return $.err(new me(ce.Fullmoves));const T=t.shift();let P=$.ok(void 0);if(N(T)){if(N(A))return $.err(new me(ce.RemainingChecks));P=qn(T)}else N(A)&&(P=A);return t.length>0?$.err(new me(ce.Fen)):s.chain(I=>p.chain(te=>P.map(x=>({board:f,pockets:I,turn:l,castlingRights:te,remainingChecks:x,epSquare:w,halfmoves:k,fullmoves:Math.max(1,O)}))))})},Cl=e=>{let t=Dt(e.role);return e.color==="white"&&(t=t.toUpperCase()),e.promoted&&(t+="~"),t},Pl=e=>{let t="",r=0;for(let i=7;i>=0;i--)for(let s=0;s<8;s++){const l=s+i*8,d=e.get(l);d?(r>0&&(t+=r,r=0),t+=Cl(d)):r++,s===7&&(r>0&&(t+=r,r=0),i!==0&&(t+="/"))}return t},Yn=e=>Me.map(t=>Dt(t).repeat(e[t])).join(""),Tl=e=>Yn(e.white).toUpperCase()+Yn(e.black),Al=(e,t)=>{let r="";for(const i of nt){const s=y.backrank(i);let l=e.kingOf(i);N(l)&&!s.has(l)&&(l=void 0);const d=e.pieces(i,"rook").intersect(s);for(const f of t.intersect(s).reversed())if(f===d.first()&&N(l)&&f<l)r+=i==="white"?"Q":"q";else if(f===d.last()&&N(l)&&l<f)r+=i==="white"?"K":"k";else{const m=sr[ye(f)];r+=i==="white"?m.toUpperCase():m}}return r||"-"},Ml=e=>`${e.white}+${e.black}`,Ol=(e,t)=>[Pl(e.board)+(e.pockets?`[${Tl(e.pockets)}]`:""),e.turn[0],Al(e.board,e.castlingRights),N(e.epSquare)?Ut(e.epSquare):"-",...e.remainingChecks?[Ml(e.remainingChecks)]:[],Math.max(0,Math.min(e.halfmoves,9999)),Math.max(1,Math.min(e.fullmoves,9999))].join(" "),Rl=(e,t)=>{let r="";if(ar(t))t.role!=="pawn"&&(r=Dt(t.role).toUpperCase()),r+="@"+Ut(t.to);else{const i=e.board.getRole(t.from);if(!i)return"--";if(i==="king"&&(e.board[e.turn].has(t.to)||Math.abs(t.to-t.from)===2))r=t.to>t.from?"O-O":"O-O-O";else{const s=e.board.occupied.has(t.to)||i==="pawn"&&ye(t.from)!==ye(t.to);if(i!=="pawn"){r=Dt(i).toUpperCase();let l;if(i==="king"?l=nn(t.to).intersect(e.board.king):i==="queen"?l=zi(t.to,e.board.occupied).intersect(e.board.queen):i==="rook"?l=Bt(t.to,e.board.occupied).intersect(e.board.rook):i==="bishop"?l=zt(t.to,e.board.occupied).intersect(e.board.bishop):l=on(t.to).intersect(e.board.knight),l=l.intersect(e.board[e.turn]).without(t.from),l.nonEmpty()){const d=e.ctx();for(const f of l)e.dests(f,d).has(t.to)||(l=l.without(f));if(l.nonEmpty()){let f=!1,m=l.intersects(y.fromRank(it(t.from)));l.intersects(y.fromFile(ye(t.from)))?f=!0:m=!0,m&&(r+=sr[ye(t.from)]),f&&(r+=Ui[it(t.from)])}}}else s&&(r=sr[ye(t.from)]);s&&(r+="x"),r+=Ut(t.to),t.promotion&&(r+="="+Dt(t.promotion).toUpperCase())}}return r},Fl=(e,t)=>{var r;const i=Rl(e,t);return e.play(t),!((r=e.outcome())===null||r===void 0)&&r.winner?i+"#":e.isCheck()?i+"+":i},xl=(e,t)=>Fl(e.clone(),t),an=e=>e.split(" ").slice(0,-1).join(" "),ln=e=>Wi.fromSetup(Sl(e).unwrap()).unwrap(),Ki=e=>ln(e).turn;function Nl(e,t=sn){let r=[],i=ln(t),s;for(let l of e){let d=ol(l),f=xl(i,d);i.play(d);let m=Ol(i.toSetup()),p=s?`${s.path} ${l}`:`${l}`,v=s?s.ply+1:1,w=s?.fen??t,S=s?.uci;s={path:p,ply:v,before_fen:w,fen:m,before_uci:S,uci:l,san:f},r.push(s)}return r}function Dl(e){let t=0;return r=>{t+=r.deltaY*(r.deltaMode?40:1),Math.abs(t)>=4?(e(r,!0),t=0):e(r,!1)}}var $l=fe('<div class="is2d chessboard"> ');function Ll(e){let t,r,i=G(()=>{try{return ln(e.fen)}catch{return Wi.default()}}),s=G(()=>wl(i())),l=G(()=>i().isCheck());return Xn(()=>{let d=e.color,f=i().isCheck(),m={fen:e.fen,check:f,premovable:{enabled:!1},movable:{color:d,free:!1,dests:s(),events:{after:e.play_orig_key}}};r=rl(t,m)}),$t(()=>{let d;if(e.last_move){let[f]=e.last_move;d=[f.slice(0,2),f.slice(2,4)]}r.set({lastMove:d,fen:e.fen,turnColor:Ki(e.fen),orientation:e.orientation??"white",check:l(),movable:{color:e.movable?e.color:void 0,dests:s()}})}),$t(()=>{r.setAutoShapes(e.shapes??[])}),(()=>{var d=$l();return Qn(f=>t=f,d),d})()}const Il=e=>({handleEvent:Ul(e),passive:!1}),Ul=e=>Dl(t=>{const r=t.target;r.tagName!=="PIECE"&&r.tagName!=="SQUARE"&&r.tagName!=="CG-BOARD"||(t.preventDefault(),e(Math.sign(t.deltaY)))});function Vi(e,t={}){const r=t.storage||globalThis.localStorage,i=t.name||`storage-${as()}`;if(!r)return[e[0],e[1],null];const s=t.storageOptions,l=t.serialize||JSON.stringify.bind(JSON),d=t.deserialize||JSON.parse.bind(JSON),f=r.getItem(i,s),m=typeof e[0]=="function"?v=>{try{const w=d(v);e[1](()=>w)}catch{}}:v=>{try{const w=d(v);e[1](ls(w))}catch{}};let p=!0;if(f instanceof Promise?f.then(v=>p&&v&&m(v)):f&&m(f),typeof t.sync?.[0]=="function"){const v=typeof e[0]=="function"?e[0]:()=>e[0];t.sync[0](w=>{w.key!==i||(w.url||globalThis.location.href)!==globalThis.location.href||w.newValue===l(Mn(v))||m(w.newValue)})}return[e[0],typeof e[0]=="function"?v=>{const w=e[1](v),S=v!=null?l(w):v;return t.sync?.[1](i,S),S!=null?r.setItem(i,S,s):r.removeItem(i,s),p=!1,w}:(...v)=>{e[1](...v);const w=l(Mn(()=>e[0]));t.sync?.[1](i,w),r.setItem(i,w,s),p=!1},f]}var zl=fe('<div class=replay-tree><div class=moves-wrap><div class=moves></div></div><div class=replay-jump><button title=first class="fbt first"data-icon=></button><button title=previous class="fbt prev"data-icon=></button><button title=next class="fbt next"data-icon=></button><button title=last class="fbt last"data-icon=>'),Bl=fe('<div class=branch-sums><button title=up class="fbt up"data-icon=></button><button title=down class="fbt down"data-icon=>'),qi=fe("<span class=index>"),jl=fe("<div class=fbt>"),Wl=fe("<div class=lines>"),Hl=fe("<div class=line>"),Gl=fe("<span class=collapsed>..<!> "),Kl=fe("<div class=move>"),Vl=fe("<span class=nag>");function ql(e){return Yi(e.steps_tree,e.cursor_path)}function Yl(e,t){return le(e,an(t))}function Yi(e,t){let r=[],i=vt(e),s=i.length>1;if(t==="")return i;for(let l of t.split(" ")){let d=i.find(m=>m.step.uci===l);if(!d)return;s&&(r.push(d),s=!1);let f=le(e,d.step.path);f.length>1&&(s=!0),i=f}return r}function vt(e){return le(e,"")}function gt(e,t){let r=$e(e,t);return r?[$e(e,an(t)),r]:void 0}function $e(e,t){if(t==="")return;let r=an(t),i=e.flat_nodes[r];return i===void 0?void 0:i.find(l=>l.step.path===t)}function le(e,t){return e.flat_nodes[t]??[]}function Xl(e,t){let r=le(e,t.step.path);if(r.length>1)return 1;if(r.length===0)return 0;let i=1,s=r[0];for(;le(e,s.step.path).length===1;)i++,s=le(e,s.step.path)[0];return i}function Ql(e,t){return Zl(e,t)?.length??0}const Zl=(e,t)=>{let r=Xi(e,t);return r?le(e,r.step.path):void 0},Xi=(e,t)=>{let r=le(e,t.step.path);if(r.length!==0)return r.length===1?Xi(e,r[0]):t};function Qi(e){const t=G(()=>e.replay_tree.cursor_path),r=G(()=>e.replay_tree.steps_tree),i=G(()=>$e(r(),"")?.step.fen??r().initial_fen??sn),s=G(()=>$e(r(),t())?.step.fen??i()),l=G(()=>{let k=$e(r(),t())?.step;if(k)return[k.uci,k.san]});let d=[];$t(Br(t,k=>{Yi(r(),k)?.map(E=>{d.includes(E.step.path)||(Yl(r(),E.step.path)?.forEach(O=>{d=d.filter(T=>T!==O.step.path)}),d.push(E.step.path))})}));const f=G(()=>{let k=t();if(k!=="")return k.split(" ").slice(0,-1).join(" ")}),m=G(()=>{let k=t(),E=le(r(),k);return E.length===1?E[0].step.path:E.find(O=>d.includes(O.step.path))?.step.path??E[0]?.step.path}),p=G(()=>{let k=gt(r(),t());if(!k)return;let E=k;if(!E[0])return"";if(le(r(),E[0].step.path).length>1)return E[0].step.path;for(;!(!E[0]||le(r(),E[0].step.path).length>1);){let O=gt(r(),E[0].step.path);if(!O)break;E=O}return E[1].step.path}),v=G(()=>{let k=$e(r(),t());if(!k){let T=vt(r());return(T.find(P=>d.includes(P.step.path))??T[0])?.step.path}let E=k,O=le(r(),E.step.path);if(O.length>1)return O.find(T=>d.includes(T.step.path))?.step.path??O[0]?.step.path;for(;O.length===1;)E=O[0],O=le(r(),E.step.path);return E.step.path}),w=G(()=>{let k=gt(r(),t());if(!k)return;let E=k[0]?le(r(),k[0].step.path):[];if(!k[0])E=vt(r());else if(le(r(),k[0].step.path).length===1)for(;;){if(k=gt(r(),k[0].step.path),!k)return;if(!k[0]){E=vt(r());break}if(le(r(),k[0].step.path).length>1){E=le(r(),k[0].step.path);break}}let O=E.indexOf(k[1]),T=E[O-1];if(T)return T.step.path}),S=G(()=>{let k=gt(r(),t());if(!k)return;let E=k[0]?le(r(),k[0].step.path):[];if(!k[0])E=vt(r());else if(le(r(),k[0].step.path).length===1)for(;;){if(k=gt(r(),k[0].step.path),!k)return;if(!k[0]){E=vt(r());break}if(le(r(),k[0].step.path).length>1){E=le(r(),k[0].step.path);break}}let O=E.indexOf(k[1]),T=E[O+1];if(T)return T.step.path}),A=G(()=>$e(e.replay_tree.steps_tree,t()));return{get initial_fen(){return i()},get fen(){return s()},get turn(){return Ki(s())},get last_move(){return l()},get step_at_cursor_path(){return A()},get cursor_path(){return t()},get get_prev_path(){return f()},get get_next_path(){return m()},get get_first_path(){return p()},get get_last_path(){return v()},get get_down_path(){return S()},get get_up_path(){return w()}}}const Jl=e=>{let t=Qi(e);const r=v=>{e.handle_goto_path(v)},i=v=>{e.handle_goto_path(v)},s=v=>{r(v)},l=(v,w)=>{e.on_context_menu?.(v,w)};let d;$t(()=>{let v=e.replay_tree.cursor_path,w=d.parentElement;if(!w)return;const S=d.querySelector(".on-path-end");if(!S){w.scrollTop=v.length>0?99999:0;return}let A=S.offsetTop-w.offsetHeight/2+S.offsetHeight;w.scrollTo({behavior:"smooth",top:A})});const f=v=>{if(e.lose_focus)return;let w=!1;v.key==="ArrowLeft"&&(i(t.get_prev_path),w=!0),v.key==="ArrowRight"&&(i(t.get_next_path),w=!0),v.key==="ArrowUp"&&(i(t.get_up_path),w=!0),v.key==="ArrowDown"&&(i(t.get_down_path),w=!0),w&&v.preventDefault()};Xn(()=>{document.addEventListener("keydown",f),us(()=>{document.removeEventListener("keydown",f)})});const m=On(()=>e.features),p=On(()=>e.feature_content);return(()=>{var v=zl(),w=v.firstChild,S=w.firstChild,A=w.nextSibling,k=A.firstChild,E=k.nextSibling,O=E.nextSibling,T=O.nextSibling;return Qn(P=>d=P,S),K(S,Z(zr,_t({get replay_tree(){return e.replay_tree}},t,{on_set_cursor:s,on_context_menu:l,path:""}))),K(v,Z(xe,{get when(){return p()},get fallback(){return(()=>{var P=Bl(),I=P.firstChild,te=I.nextSibling;return I.$$click=()=>i(t.get_up_path),te.$$click=()=>i(t.get_down_path),K(P,Z(Lt,{get each(){return ql(e.replay_tree)},children:x=>(()=>{var ne=jl();return ne.$$click=()=>r(x.step.path),K(ne,Z(xe,{get when(){return x.step.ply&1},get children(){var U=qi();return K(U,()=>Ji(x.step.ply)),U}}),null),K(ne,()=>x.step.san,null),ne})()}),null),je(x=>{var ne=t.get_up_path===void 0,U=t.get_up_path===void 0,z=t.get_down_path===void 0,oe=t.get_down_path===void 0;return ne!==x.e&&(I.disabled=x.e=ne),U!==x.t&&I.classList.toggle("disabled",x.t=U),z!==x.a&&(te.disabled=x.a=z),oe!==x.o&&te.classList.toggle("disabled",x.o=oe),x},{e:void 0,t:void 0,a:void 0,o:void 0}),P})()},children:P=>P()}),A),K(A,Z(xe,{get when(){return m()},children:P=>P()}),k),k.$$click=()=>i(t.get_first_path),E.$$click=()=>i(t.get_prev_path),O.$$click=()=>i(t.get_next_path),T.$$click=()=>i(t.get_last_path),je(P=>{var I=t.get_first_path===void 0,te=t.get_first_path===void 0,x=t.get_prev_path===void 0,ne=t.get_prev_path===void 0,U=t.get_next_path===void 0,z=t.get_next_path===void 0,oe=t.get_last_path===void 0,se=t.get_last_path===void 0;return I!==P.e&&(k.disabled=P.e=I),te!==P.t&&k.classList.toggle("disabled",P.t=te),x!==P.a&&(E.disabled=P.a=x),ne!==P.o&&E.classList.toggle("disabled",P.o=ne),U!==P.i&&(O.disabled=P.i=U),z!==P.n&&O.classList.toggle("disabled",P.n=z),oe!==P.s&&(T.disabled=P.s=oe),se!==P.h&&T.classList.toggle("disabled",P.h=se),P},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),v})()};function zr(e){const t=G(()=>e.replay_tree.steps_tree.flat_nodes[e.path]??[]);return[Z(xe,{get when(){return t().length===1},get children(){return[Z(Sr,_t(e,{get cursor_path(){return e.replay_tree.cursor_path},get node(){return t()[0]}})),Z(zr,_t(e,{get path(){return t()[0].step.path}}))]}}),Z(xe,{get when(){return t().length>1},get children(){var r=Wl();return K(r,Z(Lt,{get each(){return t()},children:i=>(()=>{var s=Hl();return K(s,Z(xe,{get when(){return e.replay_tree.cursor_path.startsWith(i.step.path)},get fallback(){return[Z(Sr,_t(e,{get cursor_path(){return e.replay_tree.cursor_path},node:i,show_index:!0,collapsed:!0})),Z(ec,{node:i,get replay_tree(){return e.replay_tree}})]},get children(){return[Z(Sr,_t(e,{get cursor_path(){return e.replay_tree.cursor_path},node:i,show_index:!0})),Z(zr,_t(e,{get path(){return i.step.path}}))]}})),s})()})),r}})]}function ec(e){return(()=>{var t=Gl(),r=t.firstChild,i=r.nextSibling;return i.nextSibling,K(t,()=>Xl(e.replay_tree.steps_tree,e.node),i),K(t,()=>Ql(e.replay_tree.steps_tree,e.node),null),t})()}function Sr(e){const t=G(()=>e.node.step);let r=G(()=>t().ply%2===1||e.show_index);const i=G(()=>t().path),s=G(()=>e.cursor_path.startsWith(i())),l=G(()=>i()===e.cursor_path),d=G(()=>({collapsed:e.collapsed,"on-path":s(),"on-path-end":l(),[tc[e.node.nags?.[0]??0]]:e.node.nags!==void 0}));return(()=>{var f=Kl();return f.$$click=()=>{e.on_set_cursor(t().path)},f.$$contextmenu=m=>{m.preventDefault(),e.on_context_menu(m,t().path)},K(f,Z(xe,{get when(){return r()},get children(){var m=qi();return K(m,()=>Ji(t().ply)),m}}),null),K(f,()=>t().san,null),K(f,Z(xe,{get when(){return e.node.nags},children:m=>Z(rc,{get nags(){return m()}})}),null),je(m=>cs(f,d(),m)),f})()}let Zi=["","!","?","!!","??","!?","?!"];Zi[22]="";let tc=["","good","mistake","top","blunder","interesting","inaccuracy"];const rc=e=>[" ",(()=>{var t=Vl();return K(t,()=>Zi[e.nags[0]]),t})()," "],Ji=e=>`${Math.ceil(e/2)}.`+(e%2===0?"..":"");Zn(["click","contextmenu"]);const nc=(e,t,r)=>Vi(jr(e),{name:`.tactics-filter.v0.${t}`});class cn{static create=t=>new cn(t);get id(){return this.puzzle.id}get fen(){return this.puzzle.fen}get tags(){return this.puzzle.tags}_has_tags;get has_tags(){return this._has_tags||(this._has_tags=li(this.puzzle)),this._has_tags}_all_tags;get all_tags(){return this._all_tags||(this._all_tags=Gr(this.puzzle)),this._all_tags}constructor(t){this.puzzle=t}puzzle}var ic=fe('<main class=tactics-filter><div class=code-wrap></div><div class=list-wrap><div class=filter><input type=text placeholder="Filter1: y_filter _!_ n_filter"><input type=text placeholder="Filter2: y_filter _!_ n_filter"></div><div class=stats><span>/10000 Positions</span></div></div><div class=board-wrap></div><div class=replay-wrap><div class=tools><button>Copy FEN</button><button>Copy Puzzle ID</button><button>Skip ID</button><button>Copy All Rules'),oc=fe("<div class=progress> <!>/<!> "),sc=fe("<div class=codebox><div class=rule-list><div class=scroll-wrap></div><div class=tools><div class=rule>+ New rule</div><div class=rule>- Delete rule</div></div></div><div class=text-wrap><textarea class=editor-input title=rules rows=13 cols=21></textarea><div class=ascii><textarea>"),ac=fe("<div><span class=name></span><span class=stats>f <!> / s "),lc=fe("<span>"),cc=fe("<div class=tactics-list><div class=list>"),uc=fe("<div class=item><a class=id target=_blank></a><div class=tags></div><div class=tags2>"),dc=fe("<span class=tag>");function gc(){const e=Wr(),t=G(()=>e.puzzles??[]),[r,i]=Vi(Rn({filter1:"",filter2:"",puzzle_id:""})),s=G(()=>Nn(r.filter1)),l=G(()=>Nn(r.filter2)),d=G(()=>t().filter(s()).filter(l())),f=G(()=>d().find(B=>B.id===r.puzzle_id)??d()[0]),m=B=>{B!==void 0&&A("cursor_path",B)},p=G(()=>{let B=f();return B?Nl(B.moves.split(" "),B.fen):[]}),v=G(()=>{let B=p(),W={},L="";for(let Ee of B)W[L]||(W[L]=[]),W[L].push({step:Ee}),L=Ee.path;return W}),w=G(()=>({flat_nodes:v()})),[S,A]=Rn({get steps_tree(){return w()},cursor_path:""}),k=()=>"white",E=()=>$e(S.steps_tree,S.cursor_path)?.step.fen??f()?.fen??sn,O=()=>{let B=$e(S.steps_tree,S.cursor_path);if(B)return[B.step.uci,B.step.san]},T=B=>{B!==void 0&&A("cursor_path",B)};let P=Qi({replay_tree:S});const I=B=>{B>0?T(P.get_next_path):T(P.get_prev_path)},te=B=>{i("puzzle_id",B.id)};ds(Br(f,()=>{A("cursor_path",""),setTimeout(()=>{T(P.get_next_path)},200)}));const ne=()=>{navigator.clipboard.writeText(E())},U=()=>{let B=f()?.id;B&&navigator.clipboard.writeText(B)},z=B=>{Jt(()=>{i("filter1",B)})},oe=B=>{Jt(()=>{i("filter2",B)})},se=()=>{oe(r.filter2+" id_"+f().id)},[C,Y]=jr(void 0,{equals:!1}),be=()=>{Y()};return(()=>{var B=ic(),W=B.firstChild,L=W.nextSibling,Ee=L.firstChild,Ie=Ee.firstChild,at=Ie.nextSibling,ur=Ee.nextSibling,lt=ur.firstChild,Gt=lt.firstChild,ct=L.nextSibling,yt=ct.nextSibling,ut=yt.firstChild,Kt=ut.firstChild,Vt=Kt.nextSibling,qt=Vt.nextSibling,dr=qt.nextSibling;return K(W,Z(hc,{get fen(){return E()},on_reset_cursor_path:()=>{},set_copy_rules:C})),Ie.$$input=Et=>z(Et.target.value),Cr(Ie,"spellcheck",!1),at.$$input=Et=>oe(Et.target.value),Cr(at,"spellcheck",!1),K(lt,()=>d().length,Gt),K(L,Z(pc,{get tactics(){return d().slice(0,1e3)},get selected_id(){return f()?.id},on_selected:te}),null),fs(ct,"wheel",Il(I)),K(ct,Z(Ll,{get color(){return k()},get fen(){return E()},get last_move(){return O()}})),Kt.$$click=ne,Vt.$$click=U,qt.$$click=se,dr.$$click=be,K(yt,Z(Jl,{handle_goto_path:m,lose_focus:!0,replay_tree:S}),null),K(B,Z(fc,{}),null),je(()=>Ie.value=r.filter1),je(()=>at.value=r.filter2),B})()}const fc=()=>{const e=Wr();return Z(xe,{get when(){return e.progress},children:t=>(()=>{var r=oc(),i=r.firstChild,s=i.nextSibling,l=s.nextSibling,d=l.nextSibling;return d.nextSibling,K(r,()=>t()[0],s),K(r,()=>t()[1],d),r})()})};function hc(e){let t=Wr();const r=G(hs(()=>t.all,cn.create)),i=T=>r().filter(P=>P.all_tags[`failed_${T}`]).length,s=T=>r().filter(P=>P.all_tags[`solved_${T}`]).length;$t(Br(e.set_copy_rules,()=>{let T=d().map(P=>P.rule).join(`

`);navigator.clipboard.writeText(T)},{defer:!0}));function l(){let T=1,P=`rule${T}`,I=d();for(;I.find(te=>te.name===P);)P=`rule${T++}`;return{name:P,rule:"",z:I.length}}const[d,f]=nc([{name:"rule1",rule:"",z:0}],"rule-list"),[m,p]=jr(0);t.rules(d());const v=G(()=>d()[m()]),w=T=>{if(T.key==="Escape"){let P=T.target.value,I=v(),te={name:I.name,rule:P,z:I.z},x=d(),ne=x.findIndex(U=>U.name===I.name);x.splice(ne,1,te),f([...x]),e.on_reset_cursor_path(),t.rules([te])}},S=()=>{Jt(()=>{f([l(),...d()]),p(0)})},A=()=>{let T=d();if(T.length===1)return;let P=T.splice(m(),1);Jt(()=>{f([...T]),m()===T.length&&p(T.length-1)}),t.rules(P.map(I=>({name:I.name,rule:"",z:-1})))};let k=ps(()=>Hr.make(()=>Is)),E=G(()=>{const T=k();let P=v().rule;if(e.fen&&T){Fn(T);try{return $s(P,e.fen)}catch(I){return`${I}`}}});const O=G(()=>{let T=v();if(!T||!T.rule||!e.fen)return;let P=k();if(P){Fn(P);try{return ii(T.rule,e.fen)}catch(I){return`${I}`}}});return(()=>{var T=sc(),P=T.firstChild,I=P.firstChild,te=I.nextSibling,x=te.firstChild,ne=x.nextSibling,U=P.nextSibling,z=U.firstChild,oe=z.nextSibling,se=oe.firstChild;return K(I,Z(Lt,{get each(){return d()},children:(C,Y)=>(()=>{var be=ac(),B=be.firstChild,W=B.nextSibling,L=W.firstChild,Ee=L.nextSibling;return Ee.nextSibling,be.$$click=()=>p(Y()),K(B,()=>C.name),K(W,()=>i(C.name),Ee),K(W,()=>s(C.name),null),je(()=>ms(be,"rule"+(Y()===m()?" active":""))),be})()})),x.$$click=S,ne.$$click=A,z.$$keydown=w,se.disabled=!0,K(se,O),K(oe,Z(xe,{get when(){return E()},children:C=>(()=>{var Y=lc();return K(Y,C),Y})()}),null),je(()=>z.value=v()?.rule??"Select a rule"),T})()}function pc(e){const t=G(()=>e.tactics),r=gs(()=>e.selected_id);return(()=>{var i=cc(),s=i.firstChild;return K(s,Z(Lt,{get each(){return t()},children:l=>(()=>{var d=uc(),f=d.firstChild,m=f.nextSibling,p=m.nextSibling;return d.$$click=()=>e.on_selected(l),K(f,()=>l.id),K(p,Z(Lt,{get each(){return Object.keys(Gr(l))},children:v=>(()=>{var w=dc();return K(w,v),w})()})),je(v=>{var w=!!r(l.id),S=l.link;return w!==v.e&&d.classList.toggle("active",v.e=w),S!==v.t&&Cr(f,"href",v.t=S),v},{e:void 0,t:void 0}),d})()})),i})()}Zn(["input","click","keydown"]);export{gc as default};
