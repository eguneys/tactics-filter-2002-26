const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-Cxx8_2Ho.js","./index-ArAQ9-7r.css"])))=>i.map(i=>d[i]);
import{s as Tt,r as _n,k as Ho,q as Go,a as Ko,b as Vo,c as qo,S as Ne,d as wn,F as bn,R as Yo,m as Xo,_ as Qo,C as Jo,p as Zo,e as es,f as ts,g as z,h as rs,i as Fe,j as W,o as Bn,l as Vt,t as ue,u as jn,n as ns,v as kn,w as is,x as os,y as yn,z as H,A as Z,B as pt,D as Ft,E as Re,G as Be,H as ss,I as as,J as ls,K as Wn,L as Hn,M as Nr,N as En,O as _r,P as cs,Q as Ot,T as us,U as ds,V as fs,W as hs,X as Sn}from"./index-Cxx8_2Ho.js";const ps=(e,t)=>{let r="";{const i=e.board.getRole(t.from);if(!i)return"--";if(i==="king"&&(e.board[e.turn].has(t.to)||Math.abs(t.to-t.from)===2))r=t.to>t.from?"O-O":"O-O-O";else{const s=e.board.occupied.has(t.to)||i==="pawn"&&Tt(t.from)!==Tt(t.to);if(i!=="pawn"){r=_n(i).toUpperCase();let c;if(i==="king"?c=Ho(t.to).intersect(e.board.king):i==="queen"?c=Go(t.to,e.board.occupied).intersect(e.board.queen):i==="rook"?c=Ko(t.to,e.board.occupied).intersect(e.board.rook):i==="bishop"?c=Vo(t.to,e.board.occupied).intersect(e.board.bishop):c=qo(t.to).intersect(e.board.knight),c=c.intersect(e.board[e.turn]).without(t.from),c.nonEmpty()){const d=e.ctx();for(const h of c)e.dests(h,d).has(t.to)||(c=c.without(h));if(c.nonEmpty()){let h=!1,m=c.intersects(Ne.fromRank(wn(t.from)));c.intersects(Ne.fromFile(Tt(t.from)))?h=!0:m=!0,m&&(r+=bn[Tt(t.from)]),h&&(r+=Yo[wn(t.from)])}}}else s&&(r=bn[Tt(t.from)]);s&&(r+="x"),r+=Xo(t.to),t.promotion&&(r+="="+_n(t.promotion).toUpperCase())}}return r},ms=(e,t)=>{const r=ps(e,t);return e.play(t),e.outcome()?.winner?r+"#":e.isCheck()?r+"+":r},wr=(e,t)=>ms(e.clone(),t);var gs=(()=>{var e=import.meta.url;return async function(t={}){var r,i=t,s,c,d=new Promise((n,o)=>{s=n,c=o});["_get_attacks","_get_occupied","_get_pieces_color_bb","_get_fen","_get_pieces_bb","_get_turn","_is_checkmate","_pos_attacks_to","_pos_attacks","_get_at","_create_position","_delete_position","_make_move","_unmake_move","_get_legal_moves","_free_legal_moves","_init","_malloc","_free","setValue","getValue","stringToUTF8","UTF8ToString","_memory","___indirect_function_table","onRuntimeInitialized"].forEach(n=>{Object.getOwnPropertyDescriptor(d,n)||Object.defineProperty(d,n,{get:()=>ie("You are getting "+n+" on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js"),set:()=>ie("You are setting "+n+" on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")})});var h=typeof window=="object",m=typeof WorkerGlobalScope<"u",g=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string"&&process.type!="renderer",b=!h&&!g&&!m;if(g){const{createRequire:n}=await Qo(async()=>{const{createRequire:a}=await import("./index-Cxx8_2Ho.js").then(u=>u.Y);return{createRequire:a}},__vite__mapDeps([0,1]),import.meta.url);let o=import.meta.url;o.startsWith("data:")&&(o="/");var w=n(o)}var P=Object.assign({},i),M="./this.program",y="";function E(n){return i.locateFile?i.locateFile(n,y):y+n}var R,T;if(g){if(typeof process>"u"||!process.release||process.release.name!=="node")throw new Error("not compiled for this environment (did you build to HTML and try to run it not on the web, or set ENVIRONMENT to something - like node - and run it someplace else - like on the web?)");var C=process.versions.node,U=C.split(".").slice(0,3);if(U=U[0]*1e4+U[1]*100+U[2].split("-")[0]*1,U<16e4)throw new Error("This emscripten-generated code requires node v16.0.0 (detected v"+C+")");var re=w("fs"),x=w("path");import.meta.url.startsWith("data:")||(y=x.dirname(w("url").fileURLToPath(import.meta.url))+"/"),T=n=>{n=bt(n)?new URL(n):x.normalize(n);var o=re.readFileSync(n);return S(o.buffer),o},R=(n,o=!0)=>(n=bt(n)?new URL(n):x.normalize(n),new Promise((a,u)=>{re.readFile(n,o?void 0:"utf8",(f,p)=>{f?u(f):a(o?p.buffer:p)})})),!i.thisProgram&&process.argv.length>1&&(M=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2)}else if(b){if(typeof process=="object"&&typeof w=="function"||typeof window=="object"||typeof WorkerGlobalScope<"u")throw new Error("not compiled for this environment (did you build to HTML and try to run it not on the web, or set ENVIRONMENT to something - like node - and run it someplace else - like on the web?)")}else if(h||m){if(m?y=self.location.href:typeof document<"u"&&document.currentScript&&(y=document.currentScript.src),e&&(y=e),y.startsWith("blob:")?y="":y=y.substr(0,y.replace(/[?#].*/,"").lastIndexOf("/")+1),!(typeof window=="object"||typeof WorkerGlobalScope<"u"))throw new Error("not compiled for this environment (did you build to HTML and try to run it not on the web, or set ENVIRONMENT to something - like node - and run it someplace else - like on the web?)");m&&(T=n=>{var o=new XMLHttpRequest;return o.open("GET",n,!1),o.responseType="arraybuffer",o.send(null),new Uint8Array(o.response)}),R=n=>bt(n)?new Promise((o,a)=>{var u=new XMLHttpRequest;u.open("GET",n,!0),u.responseType="arraybuffer",u.onload=()=>{if(u.status==200||u.status==0&&u.response){o(u.response);return}a(u.status)},u.onerror=a,u.send(null)}):fetch(n,{credentials:"same-origin"}).then(o=>o.ok?o.arrayBuffer():Promise.reject(new Error(o.status+" : "+o.url)))}else throw new Error("environment detection error");var ne=i.print||console.log.bind(console),$=i.printErr||console.error.bind(console);Object.assign(i,P),P=null,Io(),i.arguments&&i.arguments,qe("arguments","arguments_"),i.thisProgram&&(M=i.thisProgram),qe("thisProgram","thisProgram"),S(typeof i.memoryInitializerPrefixURL>"u","Module.memoryInitializerPrefixURL option was removed, use Module.locateFile instead"),S(typeof i.pthreadMainPrefixURL>"u","Module.pthreadMainPrefixURL option was removed, use Module.locateFile instead"),S(typeof i.cdInitializerPrefixURL>"u","Module.cdInitializerPrefixURL option was removed, use Module.locateFile instead"),S(typeof i.filePackagePrefixURL>"u","Module.filePackagePrefixURL option was removed, use Module.locateFile instead"),S(typeof i.read>"u","Module.read option was removed"),S(typeof i.readAsync>"u","Module.readAsync option was removed (modify readAsync in JS)"),S(typeof i.readBinary>"u","Module.readBinary option was removed (modify readBinary in JS)"),S(typeof i.setWindowTitle>"u","Module.setWindowTitle option was removed (modify emscripten_set_window_title in JS)"),S(typeof i.TOTAL_MEMORY>"u","Module.TOTAL_MEMORY has been renamed Module.INITIAL_MEMORY"),qe("asm","wasmExports"),qe("readAsync","readAsync"),qe("readBinary","readBinary"),qe("setWindowTitle","setWindowTitle"),S(!b,"shell environment detected but not enabled at build time.  Add `shell` to `-sENVIRONMENT` to enable.");var I=i.wasmBinary;qe("wasmBinary","wasmBinary"),typeof WebAssembly!="object"&&$("no native wasm support detected");var O,Q=!1;function S(n,o){n||ie("Assertion failed"+(o?": "+o:""))}var G,pe,Te,J,K,$e,Ge;function _t(){var n=O.buffer;i.HEAP8=G=new Int8Array(n),i.HEAP16=Te=new Int16Array(n),i.HEAPU8=pe=new Uint8Array(n),i.HEAPU16=new Uint16Array(n),i.HEAP32=J=new Int32Array(n),i.HEAPU32=K=new Uint32Array(n),i.HEAPF32=$e=new Float32Array(n),i.HEAPF64=Ge=new Float64Array(n)}S(!i.STACK_SIZE,"STACK_SIZE can no longer be set at runtime.  Use -sSTACK_SIZE at link time"),S(typeof Int32Array<"u"&&typeof Float64Array<"u"&&Int32Array.prototype.subarray!=null&&Int32Array.prototype.set!=null,"JS engine does not provide full typed array support"),S(!i.wasmMemory,"Use of `wasmMemory` detected.  Use -sIMPORTED_MEMORY to define wasmMemory externally"),S(!i.INITIAL_MEMORY,"Detected runtime INITIAL_MEMORY setting.  Use -sIMPORTED_MEMORY to define wasmMemory dynamically");function ir(){var n=dr();S((n&3)==0),n==0&&(n+=4),K[n>>2]=34821223,K[n+4>>2]=2310721022,K[0]=1668509029}function st(){if(!Q){var n=dr();n==0&&(n+=4);var o=K[n>>2],a=K[n+4>>2];(o!=34821223||a!=2310721022)&&ie(`Stack overflow! Stack cookie has been overwritten at ${yt(n)}, expected hex dwords 0x89BACDFE and 0x2135467, but received ${yt(a)} ${yt(o)}`),K[0]!=1668509029&&ie("Runtime error: The application has corrupted its heap memory area (address zero)!")}}var Bt=[],at=[],en=[],jt=!1;function Gi(){if(i.preRun)for(typeof i.preRun=="function"&&(i.preRun=[i.preRun]);i.preRun.length;)qi(i.preRun.shift());sr(Bt)}function Ki(){S(!jt),jt=!0,st(),!i.noFSInit&&!l.initialized&&l.init(),l.ignorePermissions=!1,sr(at)}function Vi(){if(st(),i.postRun)for(typeof i.postRun=="function"&&(i.postRun=[i.postRun]);i.postRun.length;)Xi(i.postRun.shift());sr(en)}function qi(n){Bt.unshift(n)}function Yi(n){at.unshift(n)}function Xi(n){en.unshift(n)}S(Math.imul,"This browser does not support Math.imul(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),S(Math.fround,"This browser does not support Math.fround(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),S(Math.clz32,"This browser does not support Math.clz32(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),S(Math.trunc,"This browser does not support Math.trunc(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill");var Ke=0,Ve=null,wt=null,lt={};function tn(n){for(var o=n;;){if(!lt[n])return n;n=o+Math.random()}}function or(n){Ke++,i.monitorRunDependencies?.(Ke),n?(S(!lt[n]),lt[n]=1,Ve===null&&typeof setInterval<"u"&&(Ve=setInterval(()=>{if(Q){clearInterval(Ve),Ve=null;return}var o=!1;for(var a in lt)o||(o=!0,$("still waiting on run dependencies:")),$(`dependency: ${a}`);o&&$("(end of list)")},1e4))):$("warning: run dependency added without ID")}function Wt(n){if(Ke--,i.monitorRunDependencies?.(Ke),n?(S(lt[n]),delete lt[n]):$("warning: run dependency removed without ID"),Ke==0&&(Ve!==null&&(clearInterval(Ve),Ve=null),wt)){var o=wt;wt=null,o()}}function ie(n){i.onAbort?.(n),n="Aborted("+n+")",$(n),Q=!0;var o=new WebAssembly.RuntimeError(n);throw c(o),o}var Qi="data:application/octet-stream;base64,",rn=n=>n.startsWith(Qi),bt=n=>n.startsWith("file://");function te(n,o){return(...a)=>{S(jt,`native function \`${n}\` called before runtime initialization`);var u=Qe[n];return S(u,`exported native function \`${n}\` not found`),S(a.length<=o,`native function \`${n}\` called with ${a.length} args but expects ${o}`),u(...a)}}function Ji(){if(i.locateFile){var n="hopefox.wasm";return rn(n)?n:E(n)}return new URL("hopefox.wasm",import.meta.url).href}var kt;function nn(n){if(n==kt&&I)return new Uint8Array(I);if(T)return T(n);throw"both async and sync fetching of the wasm failed"}function Zi(n){return I?Promise.resolve().then(()=>nn(n)):R(n).then(o=>new Uint8Array(o),()=>nn(n))}function on(n,o,a){return Zi(n).then(u=>WebAssembly.instantiate(u,o)).then(a,u=>{$(`failed to asynchronously prepare wasm: ${u}`),bt(kt)&&$(`warning: Loading from a file URI (${kt}) is not supported in most browsers. See https://emscripten.org/docs/getting_started/FAQ.html#how-do-i-run-a-local-webserver-for-testing-why-does-my-program-stall-in-downloading-or-preparing`),ie(u)})}function eo(n,o,a,u){return!n&&typeof WebAssembly.instantiateStreaming=="function"&&!rn(o)&&!bt(o)&&!g&&typeof fetch=="function"?fetch(o,{credentials:"same-origin"}).then(f=>{var p=WebAssembly.instantiateStreaming(f,a);return p.then(u,function(v){return $(`wasm streaming compile failed: ${v}`),$("falling back to ArrayBuffer instantiation"),on(o,a,u)})}):on(o,a,u)}function to(){return{env:mn,wasi_snapshot_preview1:mn}}function ro(){function n(f,p){return Qe=f.exports,O=Qe.memory,S(O,"memory not found in wasm exports"),_t(),Yi(Qe.__wasm_call_ctors),Wt("wasm-instantiate"),Qe}or("wasm-instantiate");var o=i;function a(f){S(i===o,"the Module object should not be replaced during async compilation - perhaps the order of HTML elements is wrong?"),o=null,n(f.instance)}var u=to();if(i.instantiateWasm)try{return i.instantiateWasm(u,n)}catch(f){$(`Module.instantiateWasm callback failed with error: ${f}`),c(f)}return kt??=Ji(),eo(I,kt,u,a).catch(c),{}}var B,ce;if((()=>{var n=new Int16Array(1),o=new Int8Array(n.buffer);if(n[0]=25459,o[0]!==115||o[1]!==99)throw"Runtime error: expected the system to be little-endian! (Run with -sSUPPORT_BIG_ENDIAN to bypass)"})(),i.ENVIRONMENT)throw new Error("Module.ENVIRONMENT has been deprecated. To force the environment, use the ENVIRONMENT compile-time option (for example, -sENVIRONMENT=web or -sENVIRONMENT=node)");function qe(n,o,a=!0){Object.getOwnPropertyDescriptor(i,n)||Object.defineProperty(i,n,{configurable:!0,get(){let u=a?" (the initial value can be provided on Module, but after startup the value is only looked for on a local variable of that name)":"";ie(`\`Module.${n}\` has been replaced by \`${o}\``+u)}})}function no(n){Object.getOwnPropertyDescriptor(i,n)&&ie(`\`Module.${n}\` was supplied but \`${n}\` not included in INCOMING_MODULE_JS_API`)}function sn(n){return n==="FS_createPath"||n==="FS_createDataFile"||n==="FS_createPreloadedFile"||n==="FS_unlink"||n==="addRunDependency"||n==="FS_createLazyFile"||n==="FS_createDevice"||n==="removeRunDependency"}function an(n,o){typeof globalThis<"u"&&!Object.getOwnPropertyDescriptor(globalThis,n)&&Object.defineProperty(globalThis,n,{configurable:!0,get(){o()}})}function ln(n,o){an(n,()=>{Ye(`\`${n}\` is not longer defined by emscripten. ${o}`)})}ln("buffer","Please use HEAP8.buffer or wasmMemory.buffer"),ln("asm","Please use wasmExports instead");function io(n){an(n,()=>{var o=`\`${n}\` is a library symbol and not included by default; add it to your library.js __deps or to DEFAULT_LIBRARY_FUNCS_TO_INCLUDE on the command line`,a=n;a.startsWith("_")||(a="$"+n),o+=` (e.g. -sDEFAULT_LIBRARY_FUNCS_TO_INCLUDE='${a}')`,sn(n)&&(o+=". Alternatively, forcing filesystem support (-sFORCE_FILESYSTEM) can export this for you"),Ye(o)}),cn(n)}function cn(n){Object.getOwnPropertyDescriptor(i,n)||Object.defineProperty(i,n,{configurable:!0,get(){var o=`'${n}' was not exported. add it to EXPORTED_RUNTIME_METHODS (see the Emscripten FAQ)`;sn(n)&&(o+=". Alternatively, forcing filesystem support (-sFORCE_FILESYSTEM) can export this for you"),ie(o)}})}var sr=n=>{for(;n.length>0;)n.shift()(i)};function oo(n,o="i8"){switch(o.endsWith("*")&&(o="*"),o){case"i1":return G[n];case"i8":return G[n];case"i16":return Te[n>>1];case"i32":return J[n>>2];case"i64":ie("to do getValue(i64) use WASM_BIGINT");case"float":return $e[n>>2];case"double":return Ge[n>>3];case"*":return K[n>>2];default:ie(`invalid type for getValue: ${o}`)}}i.getValue=oo,i.noExitRuntime;var yt=n=>(S(typeof n=="number"),n>>>=0,"0x"+n.toString(16).padStart(8,"0"));function so(n,o,a="i8"){switch(a.endsWith("*")&&(a="*"),a){case"i1":G[n]=o;break;case"i8":G[n]=o;break;case"i16":Te[n>>1]=o;break;case"i32":J[n>>2]=o;break;case"i64":ie("to do setValue(i64) use WASM_BIGINT");case"float":$e[n>>2]=o;break;case"double":Ge[n>>3]=o;break;case"*":K[n>>2]=o;break;default:ie(`invalid type for setValue: ${a}`)}}i.setValue=so;var Ye=n=>{Ye.shown||={},Ye.shown[n]||(Ye.shown[n]=1,g&&(n="warning: "+n),$(n))},un=typeof TextDecoder<"u"?new TextDecoder:void 0,ct=(n,o=0,a=NaN)=>{for(var u=o+a,f=o;n[f]&&!(f>=u);)++f;if(f-o>16&&n.buffer&&un)return un.decode(n.subarray(o,f));for(var p="";o<f;){var v=n[o++];if(!(v&128)){p+=String.fromCharCode(v);continue}var _=n[o++]&63;if((v&224)==192){p+=String.fromCharCode((v&31)<<6|_);continue}var A=n[o++]&63;if((v&240)==224?v=(v&15)<<12|_<<6|A:((v&248)!=240&&Ye("Invalid UTF-8 leading byte "+yt(v)+" encountered when deserializing a UTF-8 string in wasm memory to a JS string!"),v=(v&7)<<18|_<<12|A<<6|n[o++]&63),v<65536)p+=String.fromCharCode(v);else{var V=v-65536;p+=String.fromCharCode(55296|V>>10,56320|V&1023)}}return p},ut=(n,o)=>(S(typeof n=="number",`UTF8ToString expects a number (got ${typeof n})`),n?ct(pe,n,o):"");i.UTF8ToString=ut;var ao=(n,o,a,u)=>ie(`Assertion failed: ${ut(n)}, at: `+[o?ut(o):"unknown filename",a,u?ut(u):"unknown function"]);class lo{constructor(o){this.excPtr=o,this.ptr=o-24}set_type(o){K[this.ptr+4>>2]=o}get_type(){return K[this.ptr+4>>2]}set_destructor(o){K[this.ptr+8>>2]=o}get_destructor(){return K[this.ptr+8>>2]}set_caught(o){o=o?1:0,G[this.ptr+12]=o}get_caught(){return G[this.ptr+12]!=0}set_rethrown(o){o=o?1:0,G[this.ptr+13]=o}get_rethrown(){return G[this.ptr+13]!=0}init(o,a){this.set_adjusted_ptr(0),this.set_type(o),this.set_destructor(a)}set_adjusted_ptr(o){K[this.ptr+16>>2]=o}get_adjusted_ptr(){return K[this.ptr+16>>2]}}var co=(n,o,a)=>{var u=new lo(n);u.init(o,a),S(!1,"Exception thrown, but exception catching is not enabled. Compile with -sNO_DISABLE_EXCEPTION_CATCHING or -sEXCEPTION_CATCHING_ALLOWED=[..] to catch.")},uo=()=>ie("native code called abort()"),fo=(n,o,a)=>pe.copyWithin(n,o,o+a),ar=(n,o,a,u)=>{if(S(typeof n=="string",`stringToUTF8Array expects a string (got ${typeof n})`),!(u>0))return 0;for(var f=a,p=a+u-1,v=0;v<n.length;++v){var _=n.charCodeAt(v);if(_>=55296&&_<=57343){var A=n.charCodeAt(++v);_=65536+((_&1023)<<10)|A&1023}if(_<=127){if(a>=p)break;o[a++]=_}else if(_<=2047){if(a+1>=p)break;o[a++]=192|_>>6,o[a++]=128|_&63}else if(_<=65535){if(a+2>=p)break;o[a++]=224|_>>12,o[a++]=128|_>>6&63,o[a++]=128|_&63}else{if(a+3>=p)break;_>1114111&&Ye("Invalid Unicode code point "+yt(_)+" encountered when serializing a JS string to a UTF-8 string in wasm memory! (Valid unicode code points should be in range 0-0x10FFFF)."),o[a++]=240|_>>18,o[a++]=128|_>>12&63,o[a++]=128|_>>6&63,o[a++]=128|_&63}}return o[a]=0,a-f},Et=(n,o,a)=>(S(typeof a=="number","stringToUTF8(str, outPtr, maxBytesToWrite) is missing the third parameter that specifies the length of the output buffer!"),ar(n,pe,o,a));i.stringToUTF8=Et;var Ht=n=>{for(var o=0,a=0;a<n.length;++a){var u=n.charCodeAt(a);u<=127?o++:u<=2047?o+=2:u>=55296&&u<=57343?(o+=4,++a):o+=3}return o},ho=(n,o,a,u)=>{var f=new Date().getFullYear(),p=new Date(f,0,1),v=new Date(f,6,1),_=p.getTimezoneOffset(),A=v.getTimezoneOffset(),V=Math.max(_,A);K[n>>2]=V*60,J[o>>2]=+(_!=A);var Y=F=>{var j=F>=0?"-":"+",de=Math.abs(F),Se=String(Math.floor(de/60)).padStart(2,"0"),we=String(de%60).padStart(2,"0");return`UTC${j}${Se}${we}`},X=Y(_),q=Y(A);S(X),S(q),S(Ht(X)<=16,`timezone name truncated to fit in TZNAME_MAX (${X})`),S(Ht(q)<=16,`timezone name truncated to fit in TZNAME_MAX (${q})`),A<_?(Et(X,a,17),Et(q,u,17)):(Et(X,u,17),Et(q,a,17))},po=()=>2147483648,mo=(n,o)=>(S(o,"alignment argument is required"),Math.ceil(n/o)*o),go=n=>{var o=O.buffer,a=(n-o.byteLength+65535)/65536|0;try{return O.grow(a),_t(),1}catch(u){$(`growMemory: Attempted to grow heap from ${o.byteLength} bytes to ${n} bytes, but got error: ${u}`)}},vo=n=>{var o=pe.length;n>>>=0,S(n>o);var a=po();if(n>a)return $(`Cannot enlarge memory, requested ${n} bytes, but the limit is ${a} bytes!`),!1;for(var u=1;u<=4;u*=2){var f=o*(1+.2/u);f=Math.min(f,n+100663296);var p=Math.min(a,mo(Math.max(n,f),65536)),v=go(p);if(v)return!0}return $(`Failed to grow the heap from ${o} bytes to ${p} bytes, not enough memory!`),!1},lr={},_o=()=>M||"./this.program",St=()=>{if(!St.strings){var n=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",o={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:n,_:_o()};for(var a in lr)lr[a]===void 0?delete o[a]:o[a]=lr[a];var u=[];for(var a in o)u.push(`${a}=${o[a]}`);St.strings=u}return St.strings},wo=(n,o)=>{for(var a=0;a<n.length;++a)S(n.charCodeAt(a)===(n.charCodeAt(a)&255)),G[o++]=n.charCodeAt(a);G[o]=0},bo=(n,o)=>{var a=0;return St().forEach((u,f)=>{var p=o+a;K[n+f*4>>2]=p,wo(u,p),a+=u.length+1}),0},ko=(n,o)=>{var a=St();K[n>>2]=a.length;var u=0;return a.forEach(f=>u+=f.length+1),K[o>>2]=u,0},ee={isAbs:n=>n.charAt(0)==="/",splitPath:n=>{var o=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;return o.exec(n).slice(1)},normalizeArray:(n,o)=>{for(var a=0,u=n.length-1;u>=0;u--){var f=n[u];f==="."?n.splice(u,1):f===".."?(n.splice(u,1),a++):a&&(n.splice(u,1),a--)}if(o)for(;a;a--)n.unshift("..");return n},normalize:n=>{var o=ee.isAbs(n),a=n.substr(-1)==="/";return n=ee.normalizeArray(n.split("/").filter(u=>!!u),!o).join("/"),!n&&!o&&(n="."),n&&a&&(n+="/"),(o?"/":"")+n},dirname:n=>{var o=ee.splitPath(n),a=o[0],u=o[1];return!a&&!u?".":(u&&(u=u.substr(0,u.length-1)),a+u)},basename:n=>{if(n==="/")return"/";n=ee.normalize(n),n=n.replace(/\/$/,"");var o=n.lastIndexOf("/");return o===-1?n:n.substr(o+1)},join:(...n)=>ee.normalize(n.join("/")),join2:(n,o)=>ee.normalize(n+"/"+o)},yo=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return u=>crypto.getRandomValues(u);if(g)try{var n=w("crypto"),o=n.randomFillSync;if(o)return u=>n.randomFillSync(u);var a=n.randomBytes;return u=>(u.set(a(u.byteLength)),u)}catch{}ie("no cryptographic support found for randomDevice. consider polyfilling it if you want to use something insecure like Math.random(), e.g. put this in a --pre-js: var crypto = { getRandomValues: (array) => { for (var i = 0; i < array.length; i++) array[i] = (Math.random()*256)|0 } };")},dn=n=>(dn=yo())(n),Ie={resolve:(...n)=>{for(var o="",a=!1,u=n.length-1;u>=-1&&!a;u--){var f=u>=0?n[u]:l.cwd();if(typeof f!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!f)return"";o=f+"/"+o,a=ee.isAbs(f)}return o=ee.normalizeArray(o.split("/").filter(p=>!!p),!a).join("/"),(a?"/":"")+o||"."},relative:(n,o)=>{n=Ie.resolve(n).substr(1),o=Ie.resolve(o).substr(1);function a(V){for(var Y=0;Y<V.length&&V[Y]==="";Y++);for(var X=V.length-1;X>=0&&V[X]==="";X--);return Y>X?[]:V.slice(Y,X-Y+1)}for(var u=a(n.split("/")),f=a(o.split("/")),p=Math.min(u.length,f.length),v=p,_=0;_<p;_++)if(u[_]!==f[_]){v=_;break}for(var A=[],_=v;_<u.length;_++)A.push("..");return A=A.concat(f.slice(v)),A.join("/")}},cr=[];function fn(n,o,a){var u=Ht(n)+1,f=new Array(u),p=ar(n,f,0,f.length);return f.length=p,f}var Eo=()=>{if(!cr.length){var n=null;if(g){var o=256,a=Buffer.alloc(o),u=0,f=process.stdin.fd;try{u=re.readSync(f,a,0,o)}catch(p){if(p.toString().includes("EOF"))u=0;else throw p}u>0&&(n=a.slice(0,u).toString("utf-8"))}else typeof window<"u"&&typeof window.prompt=="function"&&(n=window.prompt("Input: "),n!==null&&(n+=`
`));if(!n)return null;cr=fn(n)}return cr.shift()},Xe={ttys:[],init(){},shutdown(){},register(n,o){Xe.ttys[n]={input:[],output:[],ops:o},l.registerDevice(n,Xe.stream_ops)},stream_ops:{open(n){var o=Xe.ttys[n.node.rdev];if(!o)throw new l.ErrnoError(43);n.tty=o,n.seekable=!1},close(n){n.tty.ops.fsync(n.tty)},fsync(n){n.tty.ops.fsync(n.tty)},read(n,o,a,u,f){if(!n.tty||!n.tty.ops.get_char)throw new l.ErrnoError(60);for(var p=0,v=0;v<u;v++){var _;try{_=n.tty.ops.get_char(n.tty)}catch{throw new l.ErrnoError(29)}if(_===void 0&&p===0)throw new l.ErrnoError(6);if(_==null)break;p++,o[a+v]=_}return p&&(n.node.timestamp=Date.now()),p},write(n,o,a,u,f){if(!n.tty||!n.tty.ops.put_char)throw new l.ErrnoError(60);try{for(var p=0;p<u;p++)n.tty.ops.put_char(n.tty,o[a+p])}catch{throw new l.ErrnoError(29)}return u&&(n.node.timestamp=Date.now()),p}},default_tty_ops:{get_char(n){return Eo()},put_char(n,o){o===null||o===10?(ne(ct(n.output)),n.output=[]):o!=0&&n.output.push(o)},fsync(n){n.output&&n.output.length>0&&(ne(ct(n.output)),n.output=[])},ioctl_tcgets(n){return{c_iflag:25856,c_oflag:5,c_cflag:191,c_lflag:35387,c_cc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},ioctl_tcsets(n,o,a){return 0},ioctl_tiocgwinsz(n){return[24,80]}},default_tty1_ops:{put_char(n,o){o===null||o===10?($(ct(n.output)),n.output=[]):o!=0&&n.output.push(o)},fsync(n){n.output&&n.output.length>0&&($(ct(n.output)),n.output=[])}}},hn=n=>{ie("internal error: mmapAlloc called but `emscripten_builtin_memalign` native symbol not exported")},D={ops_table:null,mount(n){return D.createNode(null,"/",16895,0)},createNode(n,o,a,u){if(l.isBlkdev(a)||l.isFIFO(a))throw new l.ErrnoError(63);D.ops_table||={dir:{node:{getattr:D.node_ops.getattr,setattr:D.node_ops.setattr,lookup:D.node_ops.lookup,mknod:D.node_ops.mknod,rename:D.node_ops.rename,unlink:D.node_ops.unlink,rmdir:D.node_ops.rmdir,readdir:D.node_ops.readdir,symlink:D.node_ops.symlink},stream:{llseek:D.stream_ops.llseek}},file:{node:{getattr:D.node_ops.getattr,setattr:D.node_ops.setattr},stream:{llseek:D.stream_ops.llseek,read:D.stream_ops.read,write:D.stream_ops.write,allocate:D.stream_ops.allocate,mmap:D.stream_ops.mmap,msync:D.stream_ops.msync}},link:{node:{getattr:D.node_ops.getattr,setattr:D.node_ops.setattr,readlink:D.node_ops.readlink},stream:{}},chrdev:{node:{getattr:D.node_ops.getattr,setattr:D.node_ops.setattr},stream:l.chrdev_stream_ops}};var f=l.createNode(n,o,a,u);return l.isDir(f.mode)?(f.node_ops=D.ops_table.dir.node,f.stream_ops=D.ops_table.dir.stream,f.contents={}):l.isFile(f.mode)?(f.node_ops=D.ops_table.file.node,f.stream_ops=D.ops_table.file.stream,f.usedBytes=0,f.contents=null):l.isLink(f.mode)?(f.node_ops=D.ops_table.link.node,f.stream_ops=D.ops_table.link.stream):l.isChrdev(f.mode)&&(f.node_ops=D.ops_table.chrdev.node,f.stream_ops=D.ops_table.chrdev.stream),f.timestamp=Date.now(),n&&(n.contents[o]=f,n.timestamp=f.timestamp),f},getFileDataAsTypedArray(n){return n.contents?n.contents.subarray?n.contents.subarray(0,n.usedBytes):new Uint8Array(n.contents):new Uint8Array(0)},expandFileStorage(n,o){var a=n.contents?n.contents.length:0;if(!(a>=o)){var u=1024*1024;o=Math.max(o,a*(a<u?2:1.125)>>>0),a!=0&&(o=Math.max(o,256));var f=n.contents;n.contents=new Uint8Array(o),n.usedBytes>0&&n.contents.set(f.subarray(0,n.usedBytes),0)}},resizeFileStorage(n,o){if(n.usedBytes!=o)if(o==0)n.contents=null,n.usedBytes=0;else{var a=n.contents;n.contents=new Uint8Array(o),a&&n.contents.set(a.subarray(0,Math.min(o,n.usedBytes))),n.usedBytes=o}},node_ops:{getattr(n){var o={};return o.dev=l.isChrdev(n.mode)?n.id:1,o.ino=n.id,o.mode=n.mode,o.nlink=1,o.uid=0,o.gid=0,o.rdev=n.rdev,l.isDir(n.mode)?o.size=4096:l.isFile(n.mode)?o.size=n.usedBytes:l.isLink(n.mode)?o.size=n.link.length:o.size=0,o.atime=new Date(n.timestamp),o.mtime=new Date(n.timestamp),o.ctime=new Date(n.timestamp),o.blksize=4096,o.blocks=Math.ceil(o.size/o.blksize),o},setattr(n,o){o.mode!==void 0&&(n.mode=o.mode),o.timestamp!==void 0&&(n.timestamp=o.timestamp),o.size!==void 0&&D.resizeFileStorage(n,o.size)},lookup(n,o){throw new l.ErrnoError(44)},mknod(n,o,a,u){return D.createNode(n,o,a,u)},rename(n,o,a){if(l.isDir(n.mode)){var u;try{u=l.lookupNode(o,a)}catch{}if(u)for(var f in u.contents)throw new l.ErrnoError(55)}delete n.parent.contents[n.name],n.parent.timestamp=Date.now(),n.name=a,o.contents[a]=n,o.timestamp=n.parent.timestamp},unlink(n,o){delete n.contents[o],n.timestamp=Date.now()},rmdir(n,o){var a=l.lookupNode(n,o);for(var u in a.contents)throw new l.ErrnoError(55);delete n.contents[o],n.timestamp=Date.now()},readdir(n){var o=[".",".."];for(var a of Object.keys(n.contents))o.push(a);return o},symlink(n,o,a){var u=D.createNode(n,o,41471,0);return u.link=a,u},readlink(n){if(!l.isLink(n.mode))throw new l.ErrnoError(28);return n.link}},stream_ops:{read(n,o,a,u,f){var p=n.node.contents;if(f>=n.node.usedBytes)return 0;var v=Math.min(n.node.usedBytes-f,u);if(S(v>=0),v>8&&p.subarray)o.set(p.subarray(f,f+v),a);else for(var _=0;_<v;_++)o[a+_]=p[f+_];return v},write(n,o,a,u,f,p){if(S(!(o instanceof ArrayBuffer)),o.buffer===G.buffer&&(p=!1),!u)return 0;var v=n.node;if(v.timestamp=Date.now(),o.subarray&&(!v.contents||v.contents.subarray)){if(p)return S(f===0,"canOwn must imply no weird position inside the file"),v.contents=o.subarray(a,a+u),v.usedBytes=u,u;if(v.usedBytes===0&&f===0)return v.contents=o.slice(a,a+u),v.usedBytes=u,u;if(f+u<=v.usedBytes)return v.contents.set(o.subarray(a,a+u),f),u}if(D.expandFileStorage(v,f+u),v.contents.subarray&&o.subarray)v.contents.set(o.subarray(a,a+u),f);else for(var _=0;_<u;_++)v.contents[f+_]=o[a+_];return v.usedBytes=Math.max(v.usedBytes,f+u),u},llseek(n,o,a){var u=o;if(a===1?u+=n.position:a===2&&l.isFile(n.node.mode)&&(u+=n.node.usedBytes),u<0)throw new l.ErrnoError(28);return u},allocate(n,o,a){D.expandFileStorage(n.node,o+a),n.node.usedBytes=Math.max(n.node.usedBytes,o+a)},mmap(n,o,a,u,f){if(!l.isFile(n.node.mode))throw new l.ErrnoError(43);var p,v,_=n.node.contents;if(!(f&2)&&_&&_.buffer===G.buffer)v=!1,p=_.byteOffset;else{if(v=!0,p=hn(),!p)throw new l.ErrnoError(48);_&&((a>0||a+o<_.length)&&(_.subarray?_=_.subarray(a,a+o):_=Array.prototype.slice.call(_,a,a+o)),G.set(_,p))}return{ptr:p,allocated:v}},msync(n,o,a,u,f){return D.stream_ops.write(n,o,0,u,a,!1),0}}},So=(n,o,a,u)=>{var f=tn(`al ${n}`);R(n).then(p=>{S(p,`Loading data file "${n}" failed (no arrayBuffer).`),o(new Uint8Array(p)),f&&Wt(f)},p=>{if(a)a();else throw`Loading data file "${n}" failed.`}),f&&or(f)},Co=(n,o,a,u,f,p)=>{l.createDataFile(n,o,a,u,f,p)},Po=i.preloadPlugins||[],To=(n,o,a,u)=>{typeof Browser<"u"&&Browser.init();var f=!1;return Po.forEach(p=>{f||p.canHandle(o)&&(p.handle(n,o,a,u),f=!0)}),f},Ao=(n,o,a,u,f,p,v,_,A,V)=>{var Y=o?Ie.resolve(ee.join2(n,o)):n,X=tn(`cp ${Y}`);function q(F){function j(de){V?.(),_||Co(n,o,de,u,f,A),p?.(),Wt(X)}To(F,Y,j,()=>{v?.(),Wt(X)})||j(F)}or(X),typeof a=="string"?So(a,q,v):q(a)},Mo=n=>{var o={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},a=o[n];if(typeof a>"u")throw new Error(`Unknown file open mode: ${n}`);return a},ur=(n,o)=>{var a=0;return n&&(a|=365),o&&(a|=146),a},Oo=n=>ut(zo(n)),pn={EPERM:63,ENOENT:44,ESRCH:71,EINTR:27,EIO:29,ENXIO:60,E2BIG:1,ENOEXEC:45,EBADF:8,ECHILD:12,EAGAIN:6,EWOULDBLOCK:6,ENOMEM:48,EACCES:2,EFAULT:21,ENOTBLK:105,EBUSY:10,EEXIST:20,EXDEV:75,ENODEV:43,ENOTDIR:54,EISDIR:31,EINVAL:28,ENFILE:41,EMFILE:33,ENOTTY:59,ETXTBSY:74,EFBIG:22,ENOSPC:51,ESPIPE:70,EROFS:69,EMLINK:34,EPIPE:64,EDOM:18,ERANGE:68,ENOMSG:49,EIDRM:24,ECHRNG:106,EL2NSYNC:156,EL3HLT:107,EL3RST:108,ELNRNG:109,EUNATCH:110,ENOCSI:111,EL2HLT:112,EDEADLK:16,ENOLCK:46,EBADE:113,EBADR:114,EXFULL:115,ENOANO:104,EBADRQC:103,EBADSLT:102,EDEADLOCK:16,EBFONT:101,ENOSTR:100,ENODATA:116,ETIME:117,ENOSR:118,ENONET:119,ENOPKG:120,EREMOTE:121,ENOLINK:47,EADV:122,ESRMNT:123,ECOMM:124,EPROTO:65,EMULTIHOP:36,EDOTDOT:125,EBADMSG:9,ENOTUNIQ:126,EBADFD:127,EREMCHG:128,ELIBACC:129,ELIBBAD:130,ELIBSCN:131,ELIBMAX:132,ELIBEXEC:133,ENOSYS:52,ENOTEMPTY:55,ENAMETOOLONG:37,ELOOP:32,EOPNOTSUPP:138,EPFNOSUPPORT:139,ECONNRESET:15,ENOBUFS:42,EAFNOSUPPORT:5,EPROTOTYPE:67,ENOTSOCK:57,ENOPROTOOPT:50,ESHUTDOWN:140,ECONNREFUSED:14,EADDRINUSE:3,ECONNABORTED:13,ENETUNREACH:40,ENETDOWN:38,ETIMEDOUT:73,EHOSTDOWN:142,EHOSTUNREACH:23,EINPROGRESS:26,EALREADY:7,EDESTADDRREQ:17,EMSGSIZE:35,EPROTONOSUPPORT:66,ESOCKTNOSUPPORT:137,EADDRNOTAVAIL:4,ENETRESET:39,EISCONN:30,ENOTCONN:53,ETOOMANYREFS:141,EUSERS:136,EDQUOT:19,ESTALE:72,ENOTSUP:138,ENOMEDIUM:148,EILSEQ:25,EOVERFLOW:61,ECANCELED:11,ENOTRECOVERABLE:56,EOWNERDEAD:62,ESTRPIPE:135},l={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,ErrnoError:class extends Error{name="ErrnoError";constructor(n){super(jt?Oo(n):""),this.errno=n;for(var o in pn)if(pn[o]===n){this.code=o;break}}},filesystems:null,syncFSRequests:0,readFiles:{},FSStream:class{shared={};get object(){return this.node}set object(n){this.node=n}get isRead(){return(this.flags&2097155)!==1}get isWrite(){return(this.flags&2097155)!==0}get isAppend(){return this.flags&1024}get flags(){return this.shared.flags}set flags(n){this.shared.flags=n}get position(){return this.shared.position}set position(n){this.shared.position=n}},FSNode:class{node_ops={};stream_ops={};readMode=365;writeMode=146;mounted=null;constructor(n,o,a,u){n||(n=this),this.parent=n,this.mount=n.mount,this.id=l.nextInode++,this.name=o,this.mode=a,this.rdev=u}get read(){return(this.mode&this.readMode)===this.readMode}set read(n){n?this.mode|=this.readMode:this.mode&=~this.readMode}get write(){return(this.mode&this.writeMode)===this.writeMode}set write(n){n?this.mode|=this.writeMode:this.mode&=~this.writeMode}get isFolder(){return l.isDir(this.mode)}get isDevice(){return l.isChrdev(this.mode)}},lookupPath(n,o={}){if(n=Ie.resolve(n),!n)return{path:"",node:null};var a={follow_mount:!0,recurse_count:0};if(o=Object.assign(a,o),o.recurse_count>8)throw new l.ErrnoError(32);for(var u=n.split("/").filter(X=>!!X),f=l.root,p="/",v=0;v<u.length;v++){var _=v===u.length-1;if(_&&o.parent)break;if(f=l.lookupNode(f,u[v]),p=ee.join2(p,u[v]),l.isMountpoint(f)&&(!_||_&&o.follow_mount)&&(f=f.mounted.root),!_||o.follow)for(var A=0;l.isLink(f.mode);){var V=l.readlink(p);p=Ie.resolve(ee.dirname(p),V);var Y=l.lookupPath(p,{recurse_count:o.recurse_count+1});if(f=Y.node,A++>40)throw new l.ErrnoError(32)}}return{path:p,node:f}},getPath(n){for(var o;;){if(l.isRoot(n)){var a=n.mount.mountpoint;return o?a[a.length-1]!=="/"?`${a}/${o}`:a+o:a}o=o?`${n.name}/${o}`:n.name,n=n.parent}},hashName(n,o){for(var a=0,u=0;u<o.length;u++)a=(a<<5)-a+o.charCodeAt(u)|0;return(n+a>>>0)%l.nameTable.length},hashAddNode(n){var o=l.hashName(n.parent.id,n.name);n.name_next=l.nameTable[o],l.nameTable[o]=n},hashRemoveNode(n){var o=l.hashName(n.parent.id,n.name);if(l.nameTable[o]===n)l.nameTable[o]=n.name_next;else for(var a=l.nameTable[o];a;){if(a.name_next===n){a.name_next=n.name_next;break}a=a.name_next}},lookupNode(n,o){var a=l.mayLookup(n);if(a)throw new l.ErrnoError(a);for(var u=l.hashName(n.id,o),f=l.nameTable[u];f;f=f.name_next){var p=f.name;if(f.parent.id===n.id&&p===o)return f}return l.lookup(n,o)},createNode(n,o,a,u){S(typeof n=="object");var f=new l.FSNode(n,o,a,u);return l.hashAddNode(f),f},destroyNode(n){l.hashRemoveNode(n)},isRoot(n){return n===n.parent},isMountpoint(n){return!!n.mounted},isFile(n){return(n&61440)===32768},isDir(n){return(n&61440)===16384},isLink(n){return(n&61440)===40960},isChrdev(n){return(n&61440)===8192},isBlkdev(n){return(n&61440)===24576},isFIFO(n){return(n&61440)===4096},isSocket(n){return(n&49152)===49152},flagsToPermissionString(n){var o=["r","w","rw"][n&3];return n&512&&(o+="w"),o},nodePermissions(n,o){return l.ignorePermissions?0:o.includes("r")&&!(n.mode&292)||o.includes("w")&&!(n.mode&146)||o.includes("x")&&!(n.mode&73)?2:0},mayLookup(n){if(!l.isDir(n.mode))return 54;var o=l.nodePermissions(n,"x");return o||(n.node_ops.lookup?0:2)},mayCreate(n,o){try{var a=l.lookupNode(n,o);return 20}catch{}return l.nodePermissions(n,"wx")},mayDelete(n,o,a){var u;try{u=l.lookupNode(n,o)}catch(p){return p.errno}var f=l.nodePermissions(n,"wx");if(f)return f;if(a){if(!l.isDir(u.mode))return 54;if(l.isRoot(u)||l.getPath(u)===l.cwd())return 10}else if(l.isDir(u.mode))return 31;return 0},mayOpen(n,o){return n?l.isLink(n.mode)?32:l.isDir(n.mode)&&(l.flagsToPermissionString(o)!=="r"||o&512)?31:l.nodePermissions(n,l.flagsToPermissionString(o)):44},MAX_OPEN_FDS:4096,nextfd(){for(var n=0;n<=l.MAX_OPEN_FDS;n++)if(!l.streams[n])return n;throw new l.ErrnoError(33)},getStreamChecked(n){var o=l.getStream(n);if(!o)throw new l.ErrnoError(8);return o},getStream:n=>l.streams[n],createStream(n,o=-1){return S(o>=-1),n=Object.assign(new l.FSStream,n),o==-1&&(o=l.nextfd()),n.fd=o,l.streams[o]=n,n},closeStream(n){l.streams[n]=null},dupStream(n,o=-1){var a=l.createStream(n,o);return a.stream_ops?.dup?.(a),a},chrdev_stream_ops:{open(n){var o=l.getDevice(n.node.rdev);n.stream_ops=o.stream_ops,n.stream_ops.open?.(n)},llseek(){throw new l.ErrnoError(70)}},major:n=>n>>8,minor:n=>n&255,makedev:(n,o)=>n<<8|o,registerDevice(n,o){l.devices[n]={stream_ops:o}},getDevice:n=>l.devices[n],getMounts(n){for(var o=[],a=[n];a.length;){var u=a.pop();o.push(u),a.push(...u.mounts)}return o},syncfs(n,o){typeof n=="function"&&(o=n,n=!1),l.syncFSRequests++,l.syncFSRequests>1&&$(`warning: ${l.syncFSRequests} FS.syncfs operations in flight at once, probably just doing extra work`);var a=l.getMounts(l.root.mount),u=0;function f(v){return S(l.syncFSRequests>0),l.syncFSRequests--,o(v)}function p(v){if(v)return p.errored?void 0:(p.errored=!0,f(v));++u>=a.length&&f(null)}a.forEach(v=>{if(!v.type.syncfs)return p(null);v.type.syncfs(v,n,p)})},mount(n,o,a){if(typeof n=="string")throw n;var u=a==="/",f=!a,p;if(u&&l.root)throw new l.ErrnoError(10);if(!u&&!f){var v=l.lookupPath(a,{follow_mount:!1});if(a=v.path,p=v.node,l.isMountpoint(p))throw new l.ErrnoError(10);if(!l.isDir(p.mode))throw new l.ErrnoError(54)}var _={type:n,opts:o,mountpoint:a,mounts:[]},A=n.mount(_);return A.mount=_,_.root=A,u?l.root=A:p&&(p.mounted=_,p.mount&&p.mount.mounts.push(_)),A},unmount(n){var o=l.lookupPath(n,{follow_mount:!1});if(!l.isMountpoint(o.node))throw new l.ErrnoError(28);var a=o.node,u=a.mounted,f=l.getMounts(u);Object.keys(l.nameTable).forEach(v=>{for(var _=l.nameTable[v];_;){var A=_.name_next;f.includes(_.mount)&&l.destroyNode(_),_=A}}),a.mounted=null;var p=a.mount.mounts.indexOf(u);S(p!==-1),a.mount.mounts.splice(p,1)},lookup(n,o){return n.node_ops.lookup(n,o)},mknod(n,o,a){var u=l.lookupPath(n,{parent:!0}),f=u.node,p=ee.basename(n);if(!p||p==="."||p==="..")throw new l.ErrnoError(28);var v=l.mayCreate(f,p);if(v)throw new l.ErrnoError(v);if(!f.node_ops.mknod)throw new l.ErrnoError(63);return f.node_ops.mknod(f,p,o,a)},statfs(n){var o={bsize:4096,frsize:4096,blocks:1e6,bfree:5e5,bavail:5e5,files:l.nextInode,ffree:l.nextInode-1,fsid:42,flags:2,namelen:255},a=l.lookupPath(n,{follow:!0}).node;return a?.node_ops.statfs&&Object.assign(o,a.node_ops.statfs(a.mount.opts.root)),o},create(n,o=438){return o&=4095,o|=32768,l.mknod(n,o,0)},mkdir(n,o=511){return o&=1023,o|=16384,l.mknod(n,o,0)},mkdirTree(n,o){for(var a=n.split("/"),u="",f=0;f<a.length;++f)if(a[f]){u+="/"+a[f];try{l.mkdir(u,o)}catch(p){if(p.errno!=20)throw p}}},mkdev(n,o,a){return typeof a>"u"&&(a=o,o=438),o|=8192,l.mknod(n,o,a)},symlink(n,o){if(!Ie.resolve(n))throw new l.ErrnoError(44);var a=l.lookupPath(o,{parent:!0}),u=a.node;if(!u)throw new l.ErrnoError(44);var f=ee.basename(o),p=l.mayCreate(u,f);if(p)throw new l.ErrnoError(p);if(!u.node_ops.symlink)throw new l.ErrnoError(63);return u.node_ops.symlink(u,f,n)},rename(n,o){var a=ee.dirname(n),u=ee.dirname(o),f=ee.basename(n),p=ee.basename(o),v,_,A;if(v=l.lookupPath(n,{parent:!0}),_=v.node,v=l.lookupPath(o,{parent:!0}),A=v.node,!_||!A)throw new l.ErrnoError(44);if(_.mount!==A.mount)throw new l.ErrnoError(75);var V=l.lookupNode(_,f),Y=Ie.relative(n,u);if(Y.charAt(0)!==".")throw new l.ErrnoError(28);if(Y=Ie.relative(o,a),Y.charAt(0)!==".")throw new l.ErrnoError(55);var X;try{X=l.lookupNode(A,p)}catch{}if(V!==X){var q=l.isDir(V.mode),F=l.mayDelete(_,f,q);if(F)throw new l.ErrnoError(F);if(F=X?l.mayDelete(A,p,q):l.mayCreate(A,p),F)throw new l.ErrnoError(F);if(!_.node_ops.rename)throw new l.ErrnoError(63);if(l.isMountpoint(V)||X&&l.isMountpoint(X))throw new l.ErrnoError(10);if(A!==_&&(F=l.nodePermissions(_,"w"),F))throw new l.ErrnoError(F);l.hashRemoveNode(V);try{_.node_ops.rename(V,A,p),V.parent=A}catch(j){throw j}finally{l.hashAddNode(V)}}},rmdir(n){var o=l.lookupPath(n,{parent:!0}),a=o.node,u=ee.basename(n),f=l.lookupNode(a,u),p=l.mayDelete(a,u,!0);if(p)throw new l.ErrnoError(p);if(!a.node_ops.rmdir)throw new l.ErrnoError(63);if(l.isMountpoint(f))throw new l.ErrnoError(10);a.node_ops.rmdir(a,u),l.destroyNode(f)},readdir(n){var o=l.lookupPath(n,{follow:!0}),a=o.node;if(!a.node_ops.readdir)throw new l.ErrnoError(54);return a.node_ops.readdir(a)},unlink(n){var o=l.lookupPath(n,{parent:!0}),a=o.node;if(!a)throw new l.ErrnoError(44);var u=ee.basename(n),f=l.lookupNode(a,u),p=l.mayDelete(a,u,!1);if(p)throw new l.ErrnoError(p);if(!a.node_ops.unlink)throw new l.ErrnoError(63);if(l.isMountpoint(f))throw new l.ErrnoError(10);a.node_ops.unlink(a,u),l.destroyNode(f)},readlink(n){var o=l.lookupPath(n),a=o.node;if(!a)throw new l.ErrnoError(44);if(!a.node_ops.readlink)throw new l.ErrnoError(28);return a.node_ops.readlink(a)},stat(n,o){var a=l.lookupPath(n,{follow:!o}),u=a.node;if(!u)throw new l.ErrnoError(44);if(!u.node_ops.getattr)throw new l.ErrnoError(63);return u.node_ops.getattr(u)},lstat(n){return l.stat(n,!0)},chmod(n,o,a){var u;if(typeof n=="string"){var f=l.lookupPath(n,{follow:!a});u=f.node}else u=n;if(!u.node_ops.setattr)throw new l.ErrnoError(63);u.node_ops.setattr(u,{mode:o&4095|u.mode&-4096,timestamp:Date.now()})},lchmod(n,o){l.chmod(n,o,!0)},fchmod(n,o){var a=l.getStreamChecked(n);l.chmod(a.node,o)},chown(n,o,a,u){var f;if(typeof n=="string"){var p=l.lookupPath(n,{follow:!u});f=p.node}else f=n;if(!f.node_ops.setattr)throw new l.ErrnoError(63);f.node_ops.setattr(f,{timestamp:Date.now()})},lchown(n,o,a){l.chown(n,o,a,!0)},fchown(n,o,a){var u=l.getStreamChecked(n);l.chown(u.node,o,a)},truncate(n,o){if(o<0)throw new l.ErrnoError(28);var a;if(typeof n=="string"){var u=l.lookupPath(n,{follow:!0});a=u.node}else a=n;if(!a.node_ops.setattr)throw new l.ErrnoError(63);if(l.isDir(a.mode))throw new l.ErrnoError(31);if(!l.isFile(a.mode))throw new l.ErrnoError(28);var f=l.nodePermissions(a,"w");if(f)throw new l.ErrnoError(f);a.node_ops.setattr(a,{size:o,timestamp:Date.now()})},ftruncate(n,o){var a=l.getStreamChecked(n);if((a.flags&2097155)===0)throw new l.ErrnoError(28);l.truncate(a.node,o)},utime(n,o,a){var u=l.lookupPath(n,{follow:!0}),f=u.node;f.node_ops.setattr(f,{timestamp:Math.max(o,a)})},open(n,o,a=438){if(n==="")throw new l.ErrnoError(44);o=typeof o=="string"?Mo(o):o,o&64?a=a&4095|32768:a=0;var u;if(typeof n=="object")u=n;else{n=ee.normalize(n);try{var f=l.lookupPath(n,{follow:!(o&131072)});u=f.node}catch{}}var p=!1;if(o&64)if(u){if(o&128)throw new l.ErrnoError(20)}else u=l.mknod(n,a,0),p=!0;if(!u)throw new l.ErrnoError(44);if(l.isChrdev(u.mode)&&(o&=-513),o&65536&&!l.isDir(u.mode))throw new l.ErrnoError(54);if(!p){var v=l.mayOpen(u,o);if(v)throw new l.ErrnoError(v)}o&512&&!p&&l.truncate(u,0),o&=-131713;var _=l.createStream({node:u,path:l.getPath(u),flags:o,seekable:!0,position:0,stream_ops:u.stream_ops,ungotten:[],error:!1});return _.stream_ops.open&&_.stream_ops.open(_),i.logReadFiles&&!(o&1)&&(n in l.readFiles||(l.readFiles[n]=1)),_},close(n){if(l.isClosed(n))throw new l.ErrnoError(8);n.getdents&&(n.getdents=null);try{n.stream_ops.close&&n.stream_ops.close(n)}catch(o){throw o}finally{l.closeStream(n.fd)}n.fd=null},isClosed(n){return n.fd===null},llseek(n,o,a){if(l.isClosed(n))throw new l.ErrnoError(8);if(!n.seekable||!n.stream_ops.llseek)throw new l.ErrnoError(70);if(a!=0&&a!=1&&a!=2)throw new l.ErrnoError(28);return n.position=n.stream_ops.llseek(n,o,a),n.ungotten=[],n.position},read(n,o,a,u,f){if(S(a>=0),u<0||f<0)throw new l.ErrnoError(28);if(l.isClosed(n))throw new l.ErrnoError(8);if((n.flags&2097155)===1)throw new l.ErrnoError(8);if(l.isDir(n.node.mode))throw new l.ErrnoError(31);if(!n.stream_ops.read)throw new l.ErrnoError(28);var p=typeof f<"u";if(!p)f=n.position;else if(!n.seekable)throw new l.ErrnoError(70);var v=n.stream_ops.read(n,o,a,u,f);return p||(n.position+=v),v},write(n,o,a,u,f,p){if(S(a>=0),u<0||f<0)throw new l.ErrnoError(28);if(l.isClosed(n))throw new l.ErrnoError(8);if((n.flags&2097155)===0)throw new l.ErrnoError(8);if(l.isDir(n.node.mode))throw new l.ErrnoError(31);if(!n.stream_ops.write)throw new l.ErrnoError(28);n.seekable&&n.flags&1024&&l.llseek(n,0,2);var v=typeof f<"u";if(!v)f=n.position;else if(!n.seekable)throw new l.ErrnoError(70);var _=n.stream_ops.write(n,o,a,u,f,p);return v||(n.position+=_),_},allocate(n,o,a){if(l.isClosed(n))throw new l.ErrnoError(8);if(o<0||a<=0)throw new l.ErrnoError(28);if((n.flags&2097155)===0)throw new l.ErrnoError(8);if(!l.isFile(n.node.mode)&&!l.isDir(n.node.mode))throw new l.ErrnoError(43);if(!n.stream_ops.allocate)throw new l.ErrnoError(138);n.stream_ops.allocate(n,o,a)},mmap(n,o,a,u,f){if((u&2)!==0&&(f&2)===0&&(n.flags&2097155)!==2)throw new l.ErrnoError(2);if((n.flags&2097155)===1)throw new l.ErrnoError(2);if(!n.stream_ops.mmap)throw new l.ErrnoError(43);if(!o)throw new l.ErrnoError(28);return n.stream_ops.mmap(n,o,a,u,f)},msync(n,o,a,u,f){return S(a>=0),n.stream_ops.msync?n.stream_ops.msync(n,o,a,u,f):0},ioctl(n,o,a){if(!n.stream_ops.ioctl)throw new l.ErrnoError(59);return n.stream_ops.ioctl(n,o,a)},readFile(n,o={}){if(o.flags=o.flags||0,o.encoding=o.encoding||"binary",o.encoding!=="utf8"&&o.encoding!=="binary")throw new Error(`Invalid encoding type "${o.encoding}"`);var a,u=l.open(n,o.flags),f=l.stat(n),p=f.size,v=new Uint8Array(p);return l.read(u,v,0,p,0),o.encoding==="utf8"?a=ct(v):o.encoding==="binary"&&(a=v),l.close(u),a},writeFile(n,o,a={}){a.flags=a.flags||577;var u=l.open(n,a.flags,a.mode);if(typeof o=="string"){var f=new Uint8Array(Ht(o)+1),p=ar(o,f,0,f.length);l.write(u,f,0,p,void 0,a.canOwn)}else if(ArrayBuffer.isView(o))l.write(u,o,0,o.byteLength,void 0,a.canOwn);else throw new Error("Unsupported data type");l.close(u)},cwd:()=>l.currentPath,chdir(n){var o=l.lookupPath(n,{follow:!0});if(o.node===null)throw new l.ErrnoError(44);if(!l.isDir(o.node.mode))throw new l.ErrnoError(54);var a=l.nodePermissions(o.node,"x");if(a)throw new l.ErrnoError(a);l.currentPath=o.path},createDefaultDirectories(){l.mkdir("/tmp"),l.mkdir("/home"),l.mkdir("/home/web_user")},createDefaultDevices(){l.mkdir("/dev"),l.registerDevice(l.makedev(1,3),{read:()=>0,write:(u,f,p,v,_)=>v,llseek:()=>0}),l.mkdev("/dev/null",l.makedev(1,3)),Xe.register(l.makedev(5,0),Xe.default_tty_ops),Xe.register(l.makedev(6,0),Xe.default_tty1_ops),l.mkdev("/dev/tty",l.makedev(5,0)),l.mkdev("/dev/tty1",l.makedev(6,0));var n=new Uint8Array(1024),o=0,a=()=>(o===0&&(o=dn(n).byteLength),n[--o]);l.createDevice("/dev","random",a),l.createDevice("/dev","urandom",a),l.mkdir("/dev/shm"),l.mkdir("/dev/shm/tmp")},createSpecialDirectories(){l.mkdir("/proc");var n=l.mkdir("/proc/self");l.mkdir("/proc/self/fd"),l.mount({mount(){var o=l.createNode(n,"fd",16895,73);return o.node_ops={lookup(a,u){var f=+u,p=l.getStreamChecked(f),v={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>p.path}};return v.parent=v,v}},o}},{},"/proc/self/fd")},createStandardStreams(n,o,a){n?l.createDevice("/dev","stdin",n):l.symlink("/dev/tty","/dev/stdin"),o?l.createDevice("/dev","stdout",null,o):l.symlink("/dev/tty","/dev/stdout"),a?l.createDevice("/dev","stderr",null,a):l.symlink("/dev/tty1","/dev/stderr");var u=l.open("/dev/stdin",0),f=l.open("/dev/stdout",1),p=l.open("/dev/stderr",1);S(u.fd===0,`invalid handle for stdin (${u.fd})`),S(f.fd===1,`invalid handle for stdout (${f.fd})`),S(p.fd===2,`invalid handle for stderr (${p.fd})`)},staticInit(){l.nameTable=new Array(4096),l.mount(D,{},"/"),l.createDefaultDirectories(),l.createDefaultDevices(),l.createSpecialDirectories(),l.filesystems={MEMFS:D}},init(n,o,a){S(!l.initialized,"FS.init was previously called. If you want to initialize later with custom parameters, remove any earlier calls (note that one is automatically added to the generated code)"),l.initialized=!0,n??=i.stdin,o??=i.stdout,a??=i.stderr,l.createStandardStreams(n,o,a)},quit(){l.initialized=!1,Uo(0);for(var n=0;n<l.streams.length;n++){var o=l.streams[n];o&&l.close(o)}},findObject(n,o){var a=l.analyzePath(n,o);return a.exists?a.object:null},analyzePath(n,o){try{var a=l.lookupPath(n,{follow:!o});n=a.path}catch{}var u={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var a=l.lookupPath(n,{parent:!0});u.parentExists=!0,u.parentPath=a.path,u.parentObject=a.node,u.name=ee.basename(n),a=l.lookupPath(n,{follow:!o}),u.exists=!0,u.path=a.path,u.object=a.node,u.name=a.node.name,u.isRoot=a.path==="/"}catch(f){u.error=f.errno}return u},createPath(n,o,a,u){n=typeof n=="string"?n:l.getPath(n);for(var f=o.split("/").reverse();f.length;){var p=f.pop();if(p){var v=ee.join2(n,p);try{l.mkdir(v)}catch{}n=v}}return v},createFile(n,o,a,u,f){var p=ee.join2(typeof n=="string"?n:l.getPath(n),o),v=ur(u,f);return l.create(p,v)},createDataFile(n,o,a,u,f,p){var v=o;n&&(n=typeof n=="string"?n:l.getPath(n),v=o?ee.join2(n,o):n);var _=ur(u,f),A=l.create(v,_);if(a){if(typeof a=="string"){for(var V=new Array(a.length),Y=0,X=a.length;Y<X;++Y)V[Y]=a.charCodeAt(Y);a=V}l.chmod(A,_|146);var q=l.open(A,577);l.write(q,a,0,a.length,0,p),l.close(q),l.chmod(A,_)}},createDevice(n,o,a,u){var f=ee.join2(typeof n=="string"?n:l.getPath(n),o),p=ur(!!a,!!u);l.createDevice.major??=64;var v=l.makedev(l.createDevice.major++,0);return l.registerDevice(v,{open(_){_.seekable=!1},close(_){u?.buffer?.length&&u(10)},read(_,A,V,Y,X){for(var q=0,F=0;F<Y;F++){var j;try{j=a()}catch{throw new l.ErrnoError(29)}if(j===void 0&&q===0)throw new l.ErrnoError(6);if(j==null)break;q++,A[V+F]=j}return q&&(_.node.timestamp=Date.now()),q},write(_,A,V,Y,X){for(var q=0;q<Y;q++)try{u(A[V+q])}catch{throw new l.ErrnoError(29)}return Y&&(_.node.timestamp=Date.now()),q}}),l.mkdev(f,p,v)},forceLoadFile(n){if(n.isDevice||n.isFolder||n.link||n.contents)return!0;if(typeof XMLHttpRequest<"u")throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");try{n.contents=T(n.url),n.usedBytes=n.contents.length}catch{throw new l.ErrnoError(29)}},createLazyFile(n,o,a,u,f){class p{lengthKnown=!1;chunks=[];get(F){if(!(F>this.length-1||F<0)){var j=F%this.chunkSize,de=F/this.chunkSize|0;return this.getter(de)[j]}}setDataGetter(F){this.getter=F}cacheLength(){var F=new XMLHttpRequest;if(F.open("HEAD",a,!1),F.send(null),!(F.status>=200&&F.status<300||F.status===304))throw new Error("Couldn't load "+a+". Status: "+F.status);var j=Number(F.getResponseHeader("Content-length")),de,Se=(de=F.getResponseHeader("Accept-Ranges"))&&de==="bytes",we=(de=F.getResponseHeader("Content-Encoding"))&&de==="gzip",ke=1024*1024;Se||(ke=j);var Ce=(Ae,dt)=>{if(Ae>dt)throw new Error("invalid range ("+Ae+", "+dt+") or no bytes requested!");if(dt>j-1)throw new Error("only "+j+" bytes available! programmer error!");var fe=new XMLHttpRequest;if(fe.open("GET",a,!1),j!==ke&&fe.setRequestHeader("Range","bytes="+Ae+"-"+dt),fe.responseType="arraybuffer",fe.overrideMimeType&&fe.overrideMimeType("text/plain; charset=x-user-defined"),fe.send(null),!(fe.status>=200&&fe.status<300||fe.status===304))throw new Error("Couldn't load "+a+". Status: "+fe.status);return fe.response!==void 0?new Uint8Array(fe.response||[]):fn(fe.responseText||"")},Pt=this;Pt.setDataGetter(Ae=>{var dt=Ae*ke,fe=(Ae+1)*ke-1;if(fe=Math.min(fe,j-1),typeof Pt.chunks[Ae]>"u"&&(Pt.chunks[Ae]=Ce(dt,fe)),typeof Pt.chunks[Ae]>"u")throw new Error("doXHR failed!");return Pt.chunks[Ae]}),(we||!j)&&(ke=j=1,j=this.getter(0).length,ke=j,ne("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=j,this._chunkSize=ke,this.lengthKnown=!0}get length(){return this.lengthKnown||this.cacheLength(),this._length}get chunkSize(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}if(typeof XMLHttpRequest<"u"){if(!m)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var v=new p,_={isDevice:!1,contents:v}}else var _={isDevice:!1,url:a};var A=l.createFile(n,o,_,u,f);_.contents?A.contents=_.contents:_.url&&(A.contents=null,A.url=_.url),Object.defineProperties(A,{usedBytes:{get:function(){return this.contents.length}}});var V={},Y=Object.keys(A.stream_ops);Y.forEach(q=>{var F=A.stream_ops[q];V[q]=(...j)=>(l.forceLoadFile(A),F(...j))});function X(q,F,j,de,Se){var we=q.node.contents;if(Se>=we.length)return 0;var ke=Math.min(we.length-Se,de);if(S(ke>=0),we.slice)for(var Ce=0;Ce<ke;Ce++)F[j+Ce]=we[Se+Ce];else for(var Ce=0;Ce<ke;Ce++)F[j+Ce]=we.get(Se+Ce);return ke}return V.read=(q,F,j,de,Se)=>(l.forceLoadFile(A),X(q,F,j,de,Se)),V.mmap=(q,F,j,de,Se)=>{l.forceLoadFile(A);var we=hn();if(!we)throw new l.ErrnoError(48);return X(q,G,we,F,j),{ptr:we,allocated:!0}},A.stream_ops=V,A},absolutePath(){ie("FS.absolutePath has been removed; use PATH_FS.resolve instead")},createFolder(){ie("FS.createFolder has been removed; use FS.mkdir instead")},createLink(){ie("FS.createLink has been removed; use FS.symlink instead")},joinPath(){ie("FS.joinPath has been removed; use PATH.join instead")},mmapAlloc(){ie("FS.mmapAlloc has been replaced by the top level function mmapAlloc")},standardizePath(){ie("FS.standardizePath has been removed; use PATH.normalize instead")}},Ct={DEFAULT_POLLMASK:5,calculateAt(n,o,a){if(ee.isAbs(o))return o;var u;if(n===-100)u=l.cwd();else{var f=Ct.getStreamFromFD(n);u=f.path}if(o.length==0){if(!a)throw new l.ErrnoError(44);return u}return ee.join2(u,o)},doStat(n,o,a){var u=n(o);J[a>>2]=u.dev,J[a+4>>2]=u.mode,K[a+8>>2]=u.nlink,J[a+12>>2]=u.uid,J[a+16>>2]=u.gid,J[a+20>>2]=u.rdev,ce=[u.size>>>0,(B=u.size,+Math.abs(B)>=1?B>0?+Math.floor(B/4294967296)>>>0:~~+Math.ceil((B-+(~~B>>>0))/4294967296)>>>0:0)],J[a+24>>2]=ce[0],J[a+28>>2]=ce[1],J[a+32>>2]=4096,J[a+36>>2]=u.blocks;var f=u.atime.getTime(),p=u.mtime.getTime(),v=u.ctime.getTime();return ce=[Math.floor(f/1e3)>>>0,(B=Math.floor(f/1e3),+Math.abs(B)>=1?B>0?+Math.floor(B/4294967296)>>>0:~~+Math.ceil((B-+(~~B>>>0))/4294967296)>>>0:0)],J[a+40>>2]=ce[0],J[a+44>>2]=ce[1],K[a+48>>2]=f%1e3*1e3*1e3,ce=[Math.floor(p/1e3)>>>0,(B=Math.floor(p/1e3),+Math.abs(B)>=1?B>0?+Math.floor(B/4294967296)>>>0:~~+Math.ceil((B-+(~~B>>>0))/4294967296)>>>0:0)],J[a+56>>2]=ce[0],J[a+60>>2]=ce[1],K[a+64>>2]=p%1e3*1e3*1e3,ce=[Math.floor(v/1e3)>>>0,(B=Math.floor(v/1e3),+Math.abs(B)>=1?B>0?+Math.floor(B/4294967296)>>>0:~~+Math.ceil((B-+(~~B>>>0))/4294967296)>>>0:0)],J[a+72>>2]=ce[0],J[a+76>>2]=ce[1],K[a+80>>2]=v%1e3*1e3*1e3,ce=[u.ino>>>0,(B=u.ino,+Math.abs(B)>=1?B>0?+Math.floor(B/4294967296)>>>0:~~+Math.ceil((B-+(~~B>>>0))/4294967296)>>>0:0)],J[a+88>>2]=ce[0],J[a+92>>2]=ce[1],0},doMsync(n,o,a,u,f){if(!l.isFile(o.node.mode))throw new l.ErrnoError(43);if(u&2)return 0;var p=pe.slice(n,n+a);l.msync(o,p,f,a,u)},getStreamFromFD(n){var o=l.getStreamChecked(n);return o},varargs:void 0,getStr(n){var o=ut(n);return o}};function Ro(n){try{var o=Ct.getStreamFromFD(n);return l.close(o),0}catch(a){if(typeof l>"u"||a.name!=="ErrnoError")throw a;return a.errno}}var Fo=(n,o,a,u)=>{for(var f=0,p=0;p<a;p++){var v=K[o>>2],_=K[o+4>>2];o+=8;var A=l.read(n,G,v,_,u);if(A<0)return-1;if(f+=A,A<_)break}return f};function xo(n,o,a,u){try{var f=Ct.getStreamFromFD(n),p=Fo(f,o,a);return K[u>>2]=p,0}catch(v){if(typeof l>"u"||v.name!=="ErrnoError")throw v;return v.errno}}var No=(n,o)=>(S(n==n>>>0||n==(n|0)),S(o===(o|0)),o+2097152>>>0<4194305-!!n?(n>>>0)+o*4294967296:NaN);function Do(n,o,a,u,f){var p=No(o,a);try{if(isNaN(p))return 61;var v=Ct.getStreamFromFD(n);return l.llseek(v,p,u),ce=[v.position>>>0,(B=v.position,+Math.abs(B)>=1?B>0?+Math.floor(B/4294967296)>>>0:~~+Math.ceil((B-+(~~B>>>0))/4294967296)>>>0:0)],J[f>>2]=ce[0],J[f+4>>2]=ce[1],v.getdents&&p===0&&u===0&&(v.getdents=null),0}catch(_){if(typeof l>"u"||_.name!=="ErrnoError")throw _;return _.errno}}var Lo=(n,o,a,u)=>{for(var f=0,p=0;p<a;p++){var v=K[o>>2],_=K[o+4>>2];o+=8;var A=l.write(n,G,v,_,u);if(A<0)return-1;if(f+=A,A<_)break}return f};function $o(n,o,a,u){try{var f=Ct.getStreamFromFD(n),p=Lo(f,o,a);return K[u>>2]=p,0}catch(v){if(typeof l>"u"||v.name!=="ErrnoError")throw v;return v.errno}}l.createPreloadedFile=Ao,l.staticInit();function Io(){no("fetchSettings")}var mn={__assert_fail:ao,__cxa_throw:co,_abort_js:uo,_emscripten_memcpy_js:fo,_tzset_js:ho,emscripten_resize_heap:vo,environ_get:bo,environ_sizes_get:ko,fd_close:Ro,fd_read:xo,fd_seek:Do,fd_write:$o},Qe=ro();i._create_position=te("create_position",1),i._delete_position=te("delete_position",1),i._make_move=te("make_move",2),i._unmake_move=te("unmake_move",2),i._get_legal_moves=te("get_legal_moves",2),i._malloc=te("malloc",1),i._free_legal_moves=te("free_legal_moves",1),i._free=te("free",1),i._pos_attacks_to=te("pos_attacks_to",4),i._pos_attacks=te("pos_attacks",3),i._get_pieces_bb=te("get_pieces_bb",4),i._get_pieces_color_bb=te("get_pieces_color_bb",3),i._get_occupied=te("get_occupied",2),i._get_attacks=te("get_attacks",6),i._get_turn=te("get_turn",1),i._get_at=te("get_at",2),i._get_fen=te("get_fen",1),i._is_checkmate=te("is_checkmate",1),i._init=te("init",0);var Uo=te("fflush",1),zo=te("strerror",1),gn=()=>(gn=Qe.emscripten_stack_init)(),dr=()=>(dr=Qe.emscripten_stack_get_end)();i.dynCall_viijii=te("dynCall_viijii",7),i.dynCall_jiji=te("dynCall_jiji",5),i.dynCall_iiiiij=te("dynCall_iiiiij",7),i.dynCall_iiiiijj=te("dynCall_iiiiijj",9),i.dynCall_iiiiiijj=te("dynCall_iiiiiijj",10);var Bo=["writeI53ToI64","writeI53ToI64Clamped","writeI53ToI64Signaling","writeI53ToU64Clamped","writeI53ToU64Signaling","readI53FromI64","readI53FromU64","convertI32PairToI53","convertU32PairToI53","stackAlloc","getTempRet0","setTempRet0","exitJS","inetPton4","inetNtop4","inetPton6","inetNtop6","readSockaddr","writeSockaddr","emscriptenLog","readEmAsmArgs","jstoi_q","listenOnce","autoResumeAudioContext","dynCallLegacy","getDynCaller","dynCall","handleException","keepRuntimeAlive","runtimeKeepalivePush","runtimeKeepalivePop","callUserCallback","maybeExit","asmjsMangle","HandleAllocator","getNativeTypeSize","STACK_SIZE","STACK_ALIGN","POINTER_SIZE","ASSERTIONS","getCFunc","ccall","cwrap","uleb128Encode","sigToWasmTypes","generateFuncType","convertJsFunctionToWasm","getEmptyTableSlot","updateTableMap","getFunctionAddress","addFunction","removeFunction","reallyNegative","unSign","strLen","reSign","formatString","intArrayToString","AsciiToString","UTF16ToString","stringToUTF16","lengthBytesUTF16","UTF32ToString","stringToUTF32","lengthBytesUTF32","stringToNewUTF8","stringToUTF8OnStack","writeArrayToMemory","registerKeyEventCallback","maybeCStringToJsString","findEventTarget","getBoundingClientRect","fillMouseEventData","registerMouseEventCallback","registerWheelEventCallback","registerUiEventCallback","registerFocusEventCallback","fillDeviceOrientationEventData","registerDeviceOrientationEventCallback","fillDeviceMotionEventData","registerDeviceMotionEventCallback","screenOrientation","fillOrientationChangeEventData","registerOrientationChangeEventCallback","fillFullscreenChangeEventData","registerFullscreenChangeEventCallback","JSEvents_requestFullscreen","JSEvents_resizeCanvasForFullscreen","registerRestoreOldStyle","hideEverythingExceptGivenElement","restoreHiddenElements","setLetterbox","softFullscreenResizeWebGLRenderTarget","doRequestFullscreen","fillPointerlockChangeEventData","registerPointerlockChangeEventCallback","registerPointerlockErrorEventCallback","requestPointerLock","fillVisibilityChangeEventData","registerVisibilityChangeEventCallback","registerTouchEventCallback","fillGamepadEventData","registerGamepadEventCallback","registerBeforeUnloadEventCallback","fillBatteryEventData","battery","registerBatteryEventCallback","setCanvasElementSize","getCanvasElementSize","jsStackTrace","getCallstack","convertPCtoSourceLocation","checkWasiClock","wasiRightsToMuslOFlags","wasiOFlagsToMuslOFlags","safeSetTimeout","setImmediateWrapped","safeRequestAnimationFrame","clearImmediateWrapped","polyfillSetImmediate","registerPostMainLoop","registerPreMainLoop","getPromise","makePromise","idsToPromises","makePromiseCallback","findMatchingCatch","Browser_asyncPrepareDataCounter","isLeapYear","ydayFromDate","arraySum","addDays","getSocketFromFD","getSocketAddress","FS_unlink","FS_mkdirTree","_setNetworkCallback","heapObjectForWebGLType","toTypedArrayIndex","webgl_enable_ANGLE_instanced_arrays","webgl_enable_OES_vertex_array_object","webgl_enable_WEBGL_draw_buffers","webgl_enable_WEBGL_multi_draw","webgl_enable_EXT_polygon_offset_clamp","webgl_enable_EXT_clip_control","webgl_enable_WEBGL_polygon_mode","emscriptenWebGLGet","computeUnpackAlignedImageSize","colorChannelsInGlTextureFormat","emscriptenWebGLGetTexPixelData","emscriptenWebGLGetUniform","webglGetUniformLocation","webglPrepareUniformLocationsBeforeFirstUse","webglGetLeftBracePos","emscriptenWebGLGetVertexAttrib","__glGetActiveAttribOrUniform","writeGLArray","registerWebGlEventCallback","runAndAbortIfError","ALLOC_NORMAL","ALLOC_STACK","allocate","writeStringToMemory","writeAsciiToMemory","setErrNo","demangle","stackTrace"];Bo.forEach(io);var jo=["run","addOnPreRun","addOnInit","addOnPreMain","addOnExit","addOnPostRun","addRunDependency","removeRunDependency","out","err","callMain","abort","wasmMemory","wasmExports","writeStackCookie","checkStackCookie","convertI32PairToI53Checked","stackSave","stackRestore","ptrToString","zeroMemory","getHeapMax","growMemory","ENV","ERRNO_CODES","strError","DNS","Protocols","Sockets","timers","warnOnce","readEmAsmArgsArray","jstoi_s","getExecutableName","asyncLoad","alignMemory","mmapAlloc","wasmTable","noExitRuntime","freeTableIndexes","functionsInTableMap","setValue","getValue","PATH","PATH_FS","UTF8Decoder","UTF8ArrayToString","UTF8ToString","stringToUTF8Array","stringToUTF8","lengthBytesUTF8","intArrayFromString","stringToAscii","UTF16Decoder","JSEvents","specialHTMLTargets","findCanvasEventTarget","currentFullscreenStrategy","restoreOldWindowedStyle","UNWIND_CACHE","ExitStatus","getEnvStrings","doReadv","doWritev","initRandomFill","randomFill","promiseMap","uncaughtExceptionCount","exceptionLast","exceptionCaught","ExceptionInfo","Browser","getPreloadedImageData__data","wget","MONTH_DAYS_REGULAR","MONTH_DAYS_LEAP","MONTH_DAYS_REGULAR_CUMULATIVE","MONTH_DAYS_LEAP_CUMULATIVE","SYSCALLS","preloadPlugins","FS_createPreloadedFile","FS_modeStringToFlags","FS_getMode","FS_stdin_getChar_buffer","FS_stdin_getChar","FS_createPath","FS_createDevice","FS_readFile","FS","FS_createDataFile","FS_createLazyFile","MEMFS","TTY","PIPEFS","SOCKFS","tempFixedLengthArray","miniTempWebGLFloatBuffers","miniTempWebGLIntBuffers","GL","AL","GLUT","EGL","GLEW","IDBStore","SDL","SDL_gfx","allocateUTF8","allocateUTF8OnStack","print","printErr"];jo.forEach(cn);var Gt;wt=function n(){Gt||vn(),Gt||(wt=n)};function Wo(){gn(),ir()}function vn(){if(Ke>0||(Wo(),Gi(),Ke>0))return;function n(){Gt||(Gt=!0,i.calledRun=!0,!Q&&(Ki(),s(i),i.onRuntimeInitialized?.(),S(!i._main,'compiled without a main, but one is present. if you added it from JS, use Module["onRuntimeInitialized"]'),Vi()))}i.setStatus?(i.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>i.setStatus(""),1),n()},1)):n(),st()}if(i.preInit)for(typeof i.preInit=="function"&&(i.preInit=[i.preInit]);i.preInit.length>0;)i.preInit.pop()();vn(),r=d;for(const n of Object.keys(i))n in t||Object.defineProperty(t,n,{configurable:!0,get(){ie(`Access to module property ('${n}') is no longer possible via the module constructor argument; Instead, use the result of the module constructor.`)}});return r}})();const Gn=0,vs=1,Kn=2,_s=3,ws=4,bs=5,ks=6,ys=0,Es=16384;function Vn(e){return e>>3}function qn(e){return e&7}function Ss(e){let t=Vn(e),r=qn(e);return{color:Cs(t),role:Yn(r)}}function Yn(e){switch(e){case vs:return"pawn";case Kn:return"knight";case _s:return"bishop";case ws:return"rook";case bs:return"queen";case ks:return"king"}throw"No Piece Type"}function Cs(e){return e===Gn?"white":"black"}function xt(e){let t=e&63,r=e>>6&63,s=(e&49152)===Es?Yn((e>>12&3)+Kn):void 0;return{from:r,to:t,promotion:s}}class Dr{m;static async make(t){let r=await gs({locateFile:t});return r._init(),new Dr(r)}constructor(t){this.m=t}create_position(t){return this.m._create_position(this.stringToWasm(t))}delete_position(t){this.m._delete_position(t)}unmake_move(t,r){this.m._unmake_move(t,r)}make_move(t,r){this.m._make_move(t,r)}pos_turn(t){return this.m._get_turn(t)===Gn?"white":"black"}get_legal_moves(t){const r=this.m._malloc(4);let i=this.m._get_legal_moves(t,r);const s=this.m.getValue(r,"i32");let c=[];for(let d=0;d<s;d++){const h=this.m.getValue(i+d*4,"i32");c.push(h)}return this.m._free(r),this.m._free(i),c}pos_occupied(t){const r=this.m._malloc(8);this.m._get_occupied(t,r);const i=this.m.getValue(r,"i32"),s=this.m.getValue(r+4,"i32");return this.m._free(r),new Ne(i,s)}attacks(t,r,i){const s=this.m._malloc(8);this.m._get_attacks(qn(t),Vn(t),r,i.lo,i.hi,s);const c=this.m.getValue(s,"i32"),d=this.m.getValue(s+4,"i32");return this.m._free(s),new Ne(c,d)}pos_attacks(t,r){const i=this.m._malloc(8);this.m._pos_attacks(t,r,i);const s=this.m.getValue(i,"i32"),c=this.m.getValue(i+4,"i32");return this.m._free(i),new Ne(s,c)}pos_attacks_of_color(t,r){const i=this.m._malloc(8);this.m._pos_attacks_to(t,r,0,i);const s=this.m.getValue(i,"i32"),c=this.m.getValue(i+4,"i32");return this.m._free(i),new Ne(s,c)}get_pieces_color_bb(t,r){const i=this.m._malloc(8);this.m._get_pieces_color_bb(t,r,i);const s=this.m.getValue(i,"i32"),c=this.m.getValue(i+4,"i32");return this.m._free(i),new Ne(s,c)}get_pieces_bb(t,r){const i=this.m._malloc(8),s=this.m._malloc(4*r.length);for(let h=0;h<r.length;h++)this.m.setValue(s+h*4,r[h],"i32");this.m._get_pieces_bb(t,s,r.length,i);const c=this.m.getValue(i,"i32"),d=this.m.getValue(i+4,"i32");return this.m._free(i),this.m._free(s),new Ne(c,d)}get_at(t,r){let i=this.m._get_at(t,r);if(i!==ys)return i}is_checkmate(t){return this.m._is_checkmate(t)}get_pos_read_fen(t){let r=this.wasmToStringAndFree(this.m._get_fen(t));return Jo.fromSetup(Zo(r).unwrap()).unwrap()}make_san(t,r){let i=this.get_pos_read_fen(t);return wr(i,xt(r))}stringToWasm(t){let r=this.m;const i=t.length+1,s=r._malloc(i);return r.stringToUTF8(t,s,i),s}wasmToStringAndFree(t){return this.m.UTF8ToString(t)}}function Xn(e,t){let r=es(e);ts(r);let i=Qn(r),s=z.create_position(t),c=Fs(s);br(i,[{data:{move:void 0,before:c,after:c}}],s);let h=Jn(i,s);return z.delete_position(s),h}function Qn(e){let t=e.sentence,r=e.children.map(Qn);return{sentence:t,children:r,res:[],children_resolved:!1,line:e}}function br(e,t,r){let i=e.res,s=As(e.sentence,r);for(let h of t){let m=Ms(e.sentence,h,r);m=m.filter(s);for(let g of m)i.push({parent:h,data:g})}let c=i,d=new Map;for(let h of c)h.data.move?(d.has(h.data.move)||d.set(h.data.move,[]),d.get(h.data.move).push(h)):(d.has(0)||d.set(0,[]),d.get(0).push(h));if(e.sentence.precessor==="E"||e.sentence.precessor==="."||e.sentence.precessor==="G")for(let[h,m]of d){let g=[],b=[];h!==0&&z.make_move(r,h);for(let w of e.children){let P=br(w,m,r);if(w.children_resolved){for(let M of m)P.find(y=>y===M||y.parent===M)?g.push(M):b.push(M);m=b}}if(h!==0&&z.unmake_move(r,h),e.children.length===0){e.children_resolved=!0;break}if(g.length>0){e.res=g,e.children_resolved=!0;break}}else if(e.sentence.precessor==="A"){e.res=[];for(let[h,m]of d){let g=m;h!==0&&z.make_move(r,h);for(let b of e.children){let w=br(b,m,r);b.children_resolved&&(m=m.filter(P=>!w.find(M=>M===P||M.parent===P)))}if(h!==0&&z.unmake_move(r,h),e.children.length===0||m.length===0){e.res=g,e.children_resolved=!0;break}}}else e.children_resolved=!0;return e.res}function Ps(e,t){Fe(e.move),e.attack.map(Fe),e.blocked.map(([i,s])=>[Fe(i),Fe(s)]),e.unblocked.map(([i,s])=>[Fe(i),Fe(s)]),e.captured&&Fe(e.captured),e.attacked_by.map(Fe),e.undefended_by.map(Fe),e.zero_defend,e.zero_attack;let r=e.is_mate;return i=>{if(!i.move)return!1;let s=i.move,c=xt(i.move),d=i.before,h=i.after;if(r){if(z.make_move(t,s),!z.is_checkmate(t))return z.unmake_move(t,s),!1;z.unmake_move(t,s)}if(d[e.move]!==c.from||e.captured&&d[e.captured]!==c.to)return!1;if(e.zero_defend){for(let m of Ns(h))if(z.pos_attacks(t,h[m]).has(c.to))return!1}if(e.attack.length>0){z.make_move(t,s);for(let m=0;m<e.attack.length;m++){let g=d[e.attack[m]];if(g===void 0)return z.unmake_move(t,s),!1;if(!z.pos_attacks(t,c.to).has(g))return z.unmake_move(t,s),!1}z.unmake_move(t,s)}if(e.attacked_by.length>0){z.make_move(t,s);for(let m=0;m<e.attacked_by.length;m++){let g=d[e.attacked_by[m]];if(g===void 0)return z.unmake_move(t,s),!1;if(!z.pos_attacks(t,g).has(c.to))return z.unmake_move(t,s),!1}for(let m of Object.keys(d))if(!e.attacked_by.includes(m)){let g=d[m];if(z.pos_attacks(t,g).has(c.to))return z.unmake_move(t,s),!1}z.unmake_move(t,s)}if(e.unblocked.length>0){for(let m=0;m<e.unblocked.length;m++){let[g,b]=e.unblocked[m],w=h[g],P=h[b];if(z.pos_attacks(t,w).has(P))return!1}z.make_move(t,s);for(let m=0;m<e.unblocked.length;m++){let[g,b]=e.unblocked[m],w=d[g],P=d[b];if(!z.pos_attacks(t,w).has(P))return z.unmake_move(t,s),!1}z.unmake_move(t,s)}if(e.undefended_by.length>0)for(let m=0;m<e.undefended_by.length;m++){let g=e.undefended_by[m];if(z.pos_attacks(t,d[g]).has(c.to))return!1}return!0}}const Ts=()=>!0;function As(e,t){return e.type==="move_attack"?Ps(e,t):Ts}function Ms(e,t,r){return["E","A","*"].includes(e.precessor)?z.get_legal_moves(r).map(i=>({move:i,before:t.data.after,after:Rs(t.data.after,r,i)})):[t.data]}function Os(e,t){if(!e.data.move)return"";if(!e.parent){let c=xt(e.data.move);z.make_move(t,e.data.move);let d=z.get_pos_read_fen(t);return z.unmake_move(t,e.data.move),`${wr(d,c)}`}let r=[],i=[],s=e;for(;s.parent!==void 0;){if(!s.data.move){s=s.parent;continue}r.push(s.data.move),s=s.parent}r.reverse();for(let c of r){let d=z.get_pos_read_fen(t),h=wr(d,xt(c));z.make_move(t,c),i.push(h)}r.reverse();for(let c of r)z.unmake_move(t,c);return`${i.join(" ")}`}function Jn(e,t){let r=e.line,i="",s=" ".repeat(r.depth+1),c=r.long?150:1,d=(r.no_c,e.res),h=d.slice(0,c).map(g=>Os(g,t)).join(", ");d.length>1&&(h+=" .."+d.length);let m=e.children_resolved;return i+=" "+r.rule+(m?" OK":" ?")+" <"+(h??"?")+`>
`,e.children.map((g,b)=>{b===e.children.length-1?i+=s+"└─":b===0?i+=s+"├─":i+=s+"│ ",i+=Jn(g,t)}).join(""),i}function Rs(e,t,r){let i={},s=xt(r);for(let c of Object.keys(e))e[c]===s.from?i[c]=s.to:e[c]===s.to||(i[c]=e[c]);return i}function Fs(e){let t={};for(let r of Ne.full()){let i=z.get_at(e,r);if(i!==void 0){let s=Ss(i),c=rs(s);t[c]!==void 0?t[c+"2"]=r:t[c]=r}}return t}function xs(e,t){let r=Xn(e,t),s=(r.trim().split(`
`)[1].match(/OK <([^>]+)/)??r.trim().split(`
`)[2].match(/OK <([^>]+)/))?.[1];return s?.includes(".")?s.slice(0,s.indexOf(".")):s}function Ns(e){return Object.keys(e).filter(t=>t[0].toLowerCase()!==t[0])}const Zn=e=>{let t=Object.keys(e.has_tags).length,r={...e.has_tags};return t>0&&(r.has_tag=!0,t===1?r.single_tag=!0:r.many_tags=!0),r[`id_${e.id}`]=!0,r},Lr=e=>{let t={...e.tags,...Zn(e)};if(e.rules){[...new Set(e.rules.flatMap(Ds))].forEach(c=>t[c]=!0);let i=[],s=e.rules.filter(c=>c.solve===void 0||c.solve>=0);if(s.length>0){let c=s[0];c.solve===void 0?(i.push("matched"),i.push(`matched_${c.rule.name}`)):i.push("unmatched")}i.forEach(c=>t[c]=!0),s.length===1&&(t.single_attempt=!0)}return t},Ds=e=>e.solve===void 0?(e.rule.rule.includes("."),["solved",`solved_${e.rule.name}`]):e.solve>=0?["failed",`failed_${e.rule.name}`]:[""],Cn=e=>t=>{let r=Lr(t),[i,s]=e.split("_!_").map(d=>d.trim()),c=i===""?[]:i.split(" ");return s&&s.split(" ").find(h=>r[h])?!1:c.every(d=>r[d])},Ls=""+new URL("hopefox-LFTqDWdf.wasm",import.meta.url).href,$s=["white","black"],qt=["a","b","c","d","e","f","g","h"],Yt=["1","2","3","4","5","6","7","8"],Is=[...Yt].reverse(),$r=Array.prototype.concat(...qt.map(e=>Yt.map(t=>e+t))),ye=e=>$r[8*e[0]+e[1]],oe=e=>[e.charCodeAt(0)-97,e.charCodeAt(1)-49],ei=$r.map(oe);function Us(e){let t;const r=()=>(t===void 0&&(t=e()),t);return r.clear=()=>{t=void 0},r}const zs=()=>{let e;return{start(){e=performance.now()},cancel(){e=void 0},stop(){if(!e)return 0;const t=performance.now()-e;return e=void 0,t}}},Ir=e=>e==="white"?"black":"white",Nt=(e,t)=>{const r=e[0]-t[0],i=e[1]-t[1];return r*r+i*i},kr=(e,t)=>e.role===t.role&&e.color===t.color,zt=e=>(t,r)=>[(r?t[0]:7-t[0])*e.width/8,(r?7-t[1]:t[1])*e.height/8],Me=(e,t)=>{e.style.transform=`translate(${t[0]}px,${t[1]}px)`},ti=(e,t,r=1)=>{e.style.transform=`translate(${t[0]}px,${t[1]}px) scale(${r})`},Ur=(e,t)=>{e.style.visibility=t?"visible":"hidden"},it=e=>{var t;if(e.clientX||e.clientX===0)return[e.clientX,e.clientY];if(!((t=e.targetTouches)===null||t===void 0)&&t[0])return[e.targetTouches[0].clientX,e.targetTouches[0].clientY]},ri=e=>e.button===2,Le=(e,t)=>{const r=document.createElement(e);return t&&(r.className=t),r};function ni(e,t,r){const i=oe(e);return t||(i[0]=7-i[0],i[1]=7-i[1]),[r.left+r.width*i[0]/8+r.width/16,r.top+r.height*(7-i[1])/8+r.height/16]}const tt=(e,t)=>Math.abs(e-t),Bs=e=>(t,r,i,s)=>tt(t,i)<2&&(e==="white"?s===r+1||r<=1&&s===r+2&&t===i:s===r-1||r>=6&&s===r-2&&t===i),ii=(e,t,r,i)=>{const s=tt(e,r),c=tt(t,i);return s===1&&c===2||s===2&&c===1},oi=(e,t,r,i)=>tt(e,r)===tt(t,i),si=(e,t,r,i)=>e===r||t===i,ai=(e,t,r,i)=>oi(e,t,r,i)||si(e,t,r,i),js=(e,t,r)=>(i,s,c,d)=>tt(i,c)<2&&tt(s,d)<2||r&&s===d&&s===(e==="white"?0:7)&&(i===4&&(c===2&&t.includes(0)||c===6&&t.includes(7))||t.includes(c));function Ws(e,t){const r=t==="white"?"1":"8",i=[];for(const[s,c]of e)s[1]===r&&c.color===t&&c.role==="rook"&&i.push(oe(s)[0]);return i}function li(e,t,r){const i=e.get(t);if(!i)return[];const s=oe(t),c=i.role,d=c==="pawn"?Bs(i.color):c==="knight"?ii:c==="bishop"?oi:c==="rook"?si:c==="queen"?ai:js(i.color,Ws(e,i.color),r);return ei.filter(h=>(s[0]!==h[0]||s[1]!==h[1])&&d(s[0],s[1],h[0],h[1])).map(ye)}function ve(e,...t){e&&setTimeout(()=>e(...t),1)}function Hs(e){e.orientation=Ir(e.orientation),e.animation.current=e.draggable.current=e.selected=void 0}function Gs(e,t){for(const[r,i]of t)i?e.pieces.set(r,i):e.pieces.delete(r)}function Ks(e,t){if(e.check=void 0,t===!0&&(t=e.turnColor),t)for(const[r,i]of e.pieces)i.role==="king"&&i.color===t&&(e.check=r)}function Vs(e,t,r,i){He(e),e.premovable.current=[t,r],ve(e.premovable.events.set,t,r,i)}function We(e){e.premovable.current&&(e.premovable.current=void 0,ve(e.premovable.events.unset))}function qs(e,t,r){We(e),e.predroppable.current={role:t,key:r},ve(e.predroppable.events.set,t,r)}function He(e){const t=e.predroppable;t.current&&(t.current=void 0,ve(t.events.unset))}function Ys(e,t,r){if(!e.autoCastle)return!1;const i=e.pieces.get(t);if(!i||i.role!=="king")return!1;const s=oe(t),c=oe(r);if(s[1]!==0&&s[1]!==7||s[1]!==c[1])return!1;s[0]===4&&!e.pieces.has(r)&&(c[0]===6?r=ye([7,c[1]]):c[0]===2&&(r=ye([0,c[1]])));const d=e.pieces.get(r);return!d||d.color!==i.color||d.role!=="rook"?!1:(e.pieces.delete(t),e.pieces.delete(r),s[0]<c[0]?(e.pieces.set(ye([6,c[1]]),i),e.pieces.set(ye([5,c[1]]),d)):(e.pieces.set(ye([2,c[1]]),i),e.pieces.set(ye([3,c[1]]),d)),!0)}function ci(e,t,r){const i=e.pieces.get(t),s=e.pieces.get(r);if(t===r||!i)return!1;const c=s&&s.color!==i.color?s:void 0;return r===e.selected&&Ee(e),ve(e.events.move,t,r,c),Ys(e,t,r)||(e.pieces.set(r,i),e.pieces.delete(t)),e.lastMove=[t,r],e.check=void 0,ve(e.events.change),c||!0}function zr(e,t,r,i){if(e.pieces.has(r))if(i)e.pieces.delete(r);else return!1;return ve(e.events.dropNewPiece,t,r),e.pieces.set(r,t),e.lastMove=[r],e.check=void 0,ve(e.events.change),e.movable.dests=void 0,e.turnColor=Ir(e.turnColor),!0}function ui(e,t,r){const i=ci(e,t,r);return i&&(e.movable.dests=void 0,e.turnColor=Ir(e.turnColor),e.animation.current=void 0),i}function di(e,t,r){if(Br(e,t,r)){const i=ui(e,t,r);if(i){const s=e.hold.stop();Ee(e);const c={premove:!1,ctrlKey:e.stats.ctrlKey,holdTime:s};return i!==!0&&(c.captured=i),ve(e.movable.events.after,t,r,c),!0}}else if(Qs(e,t,r))return Vs(e,t,r,{ctrlKey:e.stats.ctrlKey}),Ee(e),!0;return Ee(e),!1}function fi(e,t,r,i){const s=e.pieces.get(t);s&&(Xs(e,t,r)||i)?(e.pieces.delete(t),zr(e,s,r,i),ve(e.movable.events.afterNewPiece,s.role,r,{premove:!1,predrop:!1})):s&&Js(e,t,r)?qs(e,s.role,r):(We(e),He(e)),e.pieces.delete(t),Ee(e)}function yr(e,t,r){if(ve(e.events.select,t),e.selected){if(e.selected===t&&!e.draggable.enabled){Ee(e),e.hold.cancel();return}else if((e.selectable.enabled||r)&&e.selected!==t&&di(e,e.selected,t)){e.stats.dragged=!1;return}}(e.selectable.enabled||e.draggable.enabled)&&(pi(e,t)||jr(e,t))&&(hi(e,t),e.hold.start())}function hi(e,t){e.selected=t,jr(e,t)?e.premovable.customDests||(e.premovable.dests=li(e.pieces,t,e.premovable.castle)):e.premovable.dests=void 0}function Ee(e){e.selected=void 0,e.premovable.dests=void 0,e.hold.cancel()}function pi(e,t){const r=e.pieces.get(t);return!!r&&(e.movable.color==="both"||e.movable.color===r.color&&e.turnColor===r.color)}const Br=(e,t,r)=>{var i,s;return t!==r&&pi(e,t)&&(e.movable.free||!!(!((s=(i=e.movable.dests)===null||i===void 0?void 0:i.get(t))===null||s===void 0)&&s.includes(r)))};function Xs(e,t,r){const i=e.pieces.get(t);return!!i&&(t===r||!e.pieces.has(r))&&(e.movable.color==="both"||e.movable.color===i.color&&e.turnColor===i.color)}function jr(e,t){const r=e.pieces.get(t);return!!r&&e.premovable.enabled&&e.movable.color===r.color&&e.turnColor!==r.color}function Qs(e,t,r){var i,s;const c=(s=(i=e.premovable.customDests)===null||i===void 0?void 0:i.get(t))!==null&&s!==void 0?s:li(e.pieces,t,e.premovable.castle);return t!==r&&jr(e,t)&&c.includes(r)}function Js(e,t,r){const i=e.pieces.get(t),s=e.pieces.get(r);return!!i&&(!s||s.color!==e.movable.color)&&e.predroppable.enabled&&(i.role!=="pawn"||r[1]!=="1"&&r[1]!=="8")&&e.movable.color===i.color&&e.turnColor!==i.color}function Zs(e,t){const r=e.pieces.get(t);return!!r&&e.draggable.enabled&&(e.movable.color==="both"||e.movable.color===r.color&&(e.turnColor===r.color||e.premovable.enabled))}function ea(e){const t=e.premovable.current;if(!t)return!1;const r=t[0],i=t[1];let s=!1;if(Br(e,r,i)){const c=ui(e,r,i);if(c){const d={premove:!0};c!==!0&&(d.captured=c),ve(e.movable.events.after,r,i,d),s=!0}}return We(e),s}function ta(e,t){const r=e.predroppable.current;let i=!1;if(!r)return!1;if(t(r)){const s={role:r.role,color:e.movable.color};zr(e,s,r.key)&&(ve(e.movable.events.afterNewPiece,r.role,r.key,{premove:!1,predrop:!0}),i=!0)}return He(e),i}function Wr(e){We(e),He(e),Ee(e)}function Pn(e){e.movable.color=e.movable.dests=e.animation.current=void 0,Wr(e)}function ot(e,t,r){let i=Math.floor(8*(e[0]-r.left)/r.width);t||(i=7-i);let s=7-Math.floor(8*(e[1]-r.top)/r.height);return t||(s=7-s),i>=0&&i<8&&s>=0&&s<8?ye([i,s]):void 0}function ra(e,t,r,i){const s=oe(e),c=ei.filter(g=>ai(s[0],s[1],g[0],g[1])||ii(s[0],s[1],g[0],g[1])),h=c.map(g=>ni(ye(g),r,i)).map(g=>Nt(t,g)),[,m]=h.reduce((g,b,w)=>g[0]<b?g:[b,w],[h[0],0]);return ye(c[m])}const _e=e=>e.orientation==="white",mi="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",na={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},ia={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};function gi(e){e==="start"&&(e=mi);const t=new Map;let r=7,i=0;for(const s of e)switch(s){case" ":case"[":return t;case"/":if(--r,r<0)return t;i=0;break;case"~":{const c=t.get(ye([i-1,r]));c&&(c.promoted=!0);break}default:{const c=s.charCodeAt(0);if(c<57)i+=c-48;else{const d=s.toLowerCase();t.set(ye([i,r]),{role:na[d],color:s===d?"black":"white"}),++i}}}return t}function oa(e){return Is.map(t=>qt.map(r=>{const i=e.get(r+t);if(i){let s=ia[i.role];return i.color==="white"&&(s=s.toUpperCase()),i.promoted&&(s+="~"),s}else return"1"}).join("")).join("/").replace(/1{2,}/g,t=>t.length.toString())}function vi(e,t){t.animation&&(Hr(e.animation,t.animation),(e.animation.duration||0)<70&&(e.animation.enabled=!1))}function _i(e,t){var r,i,s;if(!((r=t.movable)===null||r===void 0)&&r.dests&&(e.movable.dests=void 0),!((i=t.drawable)===null||i===void 0)&&i.autoShapes&&(e.drawable.autoShapes=[]),Hr(e,t),t.fen&&(e.pieces=gi(t.fen),e.drawable.shapes=((s=t.drawable)===null||s===void 0?void 0:s.shapes)||[]),"check"in t&&Ks(e,t.check||!1),"lastMove"in t&&!t.lastMove?e.lastMove=void 0:t.lastMove&&(e.lastMove=t.lastMove),e.selected&&hi(e,e.selected),vi(e,t),!e.movable.rookCastle&&e.movable.dests){const c=e.movable.color==="white"?"1":"8",d="e"+c,h=e.movable.dests.get(d),m=e.pieces.get(d);if(!h||!m||m.role!=="king")return;e.movable.dests.set(d,h.filter(g=>!(g==="a"+c&&h.includes("c"+c))&&!(g==="h"+c&&h.includes("g"+c))))}}function Hr(e,t){for(const r in t)r==="__proto__"||r==="constructor"||!Object.prototype.hasOwnProperty.call(t,r)||(Object.prototype.hasOwnProperty.call(e,r)&&Tn(e[r])&&Tn(t[r])?Hr(e[r],t[r]):e[r]=t[r])}function Tn(e){if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return t===Object.prototype||t===null}const Je=(e,t)=>t.animation.enabled?la(e,t):Ue(e,t);function Ue(e,t){const r=e(t);return t.dom.redraw(),r}const fr=(e,t)=>({key:e,pos:oe(e),piece:t}),sa=(e,t)=>t.sort((r,i)=>Nt(e.pos,r.pos)-Nt(e.pos,i.pos))[0];function aa(e,t){const r=new Map,i=[],s=new Map,c=[],d=[],h=new Map;let m,g,b;for(const[w,P]of e)h.set(w,fr(w,P));for(const w of $r)m=t.pieces.get(w),g=h.get(w),m?g?kr(m,g.piece)||(c.push(g),d.push(fr(w,m))):d.push(fr(w,m)):g&&c.push(g);for(const w of d)g=sa(w,c.filter(P=>kr(w.piece,P.piece))),g&&(b=[g.pos[0]-w.pos[0],g.pos[1]-w.pos[1]],r.set(w.key,b.concat(b)),i.push(g.key));for(const w of c)i.includes(w.key)||s.set(w.key,w.piece);return{anims:r,fadings:s}}function wi(e,t){const r=e.animation.current;if(r===void 0){e.dom.destroyed||e.dom.redrawNow();return}const i=1-(t-r.start)*r.frequency;if(i<=0)e.animation.current=void 0,e.dom.redrawNow();else{const s=ca(i);for(const c of r.plan.anims.values())c[2]=c[0]*s,c[3]=c[1]*s;e.dom.redrawNow(!0),requestAnimationFrame((c=performance.now())=>wi(e,c))}}function la(e,t){const r=new Map(t.pieces),i=e(t),s=aa(r,t);if(s.anims.size||s.fadings.size){const c=t.animation.current&&t.animation.current.start;t.animation.current={start:performance.now(),frequency:1/t.animation.duration,plan:s},c||wi(t,performance.now())}else t.dom.redraw();return i}const ca=e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1,ua=["green","red","blue","yellow"];function da(e,t){if(t.touches&&t.touches.length>1)return;t.stopPropagation(),t.preventDefault(),t.ctrlKey?Ee(e):Wr(e);const r=it(t),i=ot(r,_e(e),e.dom.bounds());i&&(e.drawable.current={orig:i,pos:r,brush:ma(t),snapToValidMove:e.drawable.defaultSnapToValidMove},bi(e))}function bi(e){requestAnimationFrame(()=>{const t=e.drawable.current;if(t){const r=ot(t.pos,_e(e),e.dom.bounds());r||(t.snapToValidMove=!1);const i=t.snapToValidMove?ra(t.orig,t.pos,_e(e),e.dom.bounds()):r;i!==t.mouseSq&&(t.mouseSq=i,t.dest=i!==t.orig?i:void 0,e.dom.redrawNow()),bi(e)}})}function fa(e,t){e.drawable.current&&(e.drawable.current.pos=it(t))}function ha(e){const t=e.drawable.current;t&&(t.mouseSq&&ga(e.drawable,t),ki(e))}function ki(e){e.drawable.current&&(e.drawable.current=void 0,e.dom.redraw())}function pa(e){e.drawable.shapes.length&&(e.drawable.shapes=[],e.dom.redraw(),yi(e.drawable))}function ma(e){var t;const r=(e.shiftKey||e.ctrlKey)&&ri(e),i=e.altKey||e.metaKey||((t=e.getModifierState)===null||t===void 0?void 0:t.call(e,"AltGraph"));return ua[(r?1:0)+(i?2:0)]}function ga(e,t){const r=s=>s.orig===t.orig&&s.dest===t.dest,i=e.shapes.find(r);i&&(e.shapes=e.shapes.filter(s=>!r(s))),(!i||i.brush!==t.brush)&&e.shapes.push({orig:t.orig,dest:t.dest,brush:t.brush}),yi(e)}function yi(e){e.onChange&&e.onChange(e.shapes)}function va(e,t){if(!(e.trustAllEvents||t.isTrusted)||t.buttons!==void 0&&t.buttons>1||t.touches&&t.touches.length>1)return;const r=e.dom.bounds(),i=it(t),s=ot(i,_e(e),r);if(!s)return;const c=e.pieces.get(s),d=e.selected;if(!d&&e.drawable.enabled&&(e.drawable.eraseOnClick||!c||c.color!==e.turnColor)&&pa(e),t.cancelable!==!1&&(!t.touches||e.blockTouchScroll||c||d||_a(e,i)))t.preventDefault();else if(t.touches)return;const h=!!e.premovable.current,m=!!e.predroppable.current;e.stats.ctrlKey=t.ctrlKey,e.selected&&Br(e,e.selected,s)?Je(w=>yr(w,s),e):yr(e,s);const g=e.selected===s,b=Si(e,s);if(c&&b&&g&&Zs(e,s)){e.draggable.current={orig:s,piece:c,origPos:i,pos:i,started:e.draggable.autoDistance&&e.stats.dragged,element:b,previouslySelected:d,originTarget:t.target,keyHasChanged:!1},b.cgDragging=!0,b.classList.add("dragging");const w=e.dom.elements.ghost;w&&(w.className=`ghost ${c.color} ${c.role}`,Me(w,zt(r)(oe(s),_e(e))),Ur(w,!0)),Gr(e)}else h&&We(e),m&&He(e);e.dom.redraw()}function _a(e,t){const r=_e(e),i=e.dom.bounds(),s=Math.pow(i.width/8,2);for(const c of e.pieces.keys()){const d=ni(c,r,i);if(Nt(d,t)<=s)return!0}return!1}function wa(e,t,r,i){const s="a0";e.pieces.set(s,t),e.dom.redraw();const c=it(r);e.draggable.current={orig:s,piece:t,origPos:c,pos:c,started:!0,element:()=>Si(e,s),originTarget:r.target,newPiece:!0,force:!!i,keyHasChanged:!1},Gr(e)}function Gr(e){requestAnimationFrame(()=>{var t;const r=e.draggable.current;if(!r)return;!((t=e.animation.current)===null||t===void 0)&&t.plan.anims.has(r.orig)&&(e.animation.current=void 0);const i=e.pieces.get(r.orig);if(!i||!kr(i,r.piece))Xt(e);else if(!r.started&&Nt(r.pos,r.origPos)>=Math.pow(e.draggable.distance,2)&&(r.started=!0),r.started){if(typeof r.element=="function"){const c=r.element();if(!c)return;c.cgDragging=!0,c.classList.add("dragging"),r.element=c}const s=e.dom.bounds();Me(r.element,[r.pos[0]-s.left-s.width/16,r.pos[1]-s.top-s.height/16]),r.keyHasChanged||(r.keyHasChanged=r.orig!==ot(r.pos,_e(e),s))}Gr(e)})}function ba(e,t){e.draggable.current&&(!t.touches||t.touches.length<2)&&(e.draggable.current.pos=it(t))}function ka(e,t){const r=e.draggable.current;if(!r)return;if(t.type==="touchend"&&t.cancelable!==!1&&t.preventDefault(),t.type==="touchend"&&r.originTarget!==t.target&&!r.newPiece){e.draggable.current=void 0;return}We(e),He(e);const i=it(t)||r.pos,s=ot(i,_e(e),e.dom.bounds());s&&r.started&&r.orig!==s?r.newPiece?fi(e,r.orig,s,r.force):(e.stats.ctrlKey=t.ctrlKey,di(e,r.orig,s)&&(e.stats.dragged=!0)):r.newPiece?e.pieces.delete(r.orig):e.draggable.deleteOnDropOff&&!s&&(e.pieces.delete(r.orig),ve(e.events.change)),(r.orig===r.previouslySelected||r.keyHasChanged)&&(r.orig===s||!s)?Ee(e):e.selectable.enabled||Ee(e),Ei(e),e.draggable.current=void 0,e.dom.redraw()}function Xt(e){const t=e.draggable.current;t&&(t.newPiece&&e.pieces.delete(t.orig),e.draggable.current=void 0,Ee(e),Ei(e),e.dom.redraw())}function Ei(e){const t=e.dom.elements;t.ghost&&Ur(t.ghost,!1)}function Si(e,t){let r=e.dom.elements.board.firstChild;for(;r;){if(r.cgKey===t&&r.tagName==="PIECE")return r;r=r.nextSibling}}function ya(e,t){e.exploding={stage:1,keys:t},e.dom.redraw(),setTimeout(()=>{An(e,2),setTimeout(()=>An(e,void 0),120)},120)}function An(e,t){e.exploding&&(t?e.exploding.stage=t:e.exploding=void 0,e.dom.redraw())}function Ea(e,t){function r(){Hs(e),t()}return{set(i){i.orientation&&i.orientation!==e.orientation&&r(),vi(e,i),(i.fen?Je:Ue)(s=>_i(s,i),e)},state:e,getFen:()=>oa(e.pieces),toggleOrientation:r,setPieces(i){Je(s=>Gs(s,i),e)},selectSquare(i,s){i?Je(c=>yr(c,i,s),e):e.selected&&(Ee(e),e.dom.redraw())},move(i,s){Je(c=>ci(c,i,s),e)},newPiece(i,s){Je(c=>zr(c,i,s),e)},playPremove(){if(e.premovable.current){if(Je(ea,e))return!0;e.dom.redraw()}return!1},playPredrop(i){if(e.predroppable.current){const s=ta(e,i);return e.dom.redraw(),s}return!1},cancelPremove(){Ue(We,e)},cancelPredrop(){Ue(He,e)},cancelMove(){Ue(i=>{Wr(i),Xt(i)},e)},stop(){Ue(i=>{Pn(i),Xt(i)},e)},explode(i){ya(e,i)},setAutoShapes(i){Ue(s=>s.drawable.autoShapes=i,e)},setShapes(i){Ue(s=>s.drawable.shapes=i,e)},getKeyAtDomPos(i){return ot(i,_e(e),e.dom.bounds())},redrawAll:t,dragNewPiece(i,s,c){wa(e,i,s,c)},destroy(){Pn(e),e.dom.unbind&&e.dom.unbind(),e.dom.destroyed=!0}}}function Sa(){return{pieces:gi(mi),orientation:"white",turnColor:"white",coordinates:!0,coordinatesOnSquares:!1,ranksPosition:"right",autoCastle:!0,viewOnly:!1,disableContextMenu:!1,addPieceZIndex:!1,blockTouchScroll:!1,pieceKey:!1,trustAllEvents:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,defaultSnapToValidMove:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15},purple:{key:"purple",color:"#68217a",opacity:.65,lineWidth:10},pink:{key:"pink",color:"#ee2080",opacity:.5,lineWidth:10},white:{key:"white",color:"white",opacity:1,lineWidth:10}},prevSvgHash:""},hold:zs()}}const Mn={hilitePrimary:{key:"hilitePrimary",color:"#3291ff",opacity:1,lineWidth:1},hiliteWhite:{key:"hiliteWhite",color:"#ffffff",opacity:1,lineWidth:1}};function Ca(){const e=le("defs"),t=ge(le("filter"),{id:"cg-filter-blur"});return t.appendChild(ge(le("feGaussianBlur"),{stdDeviation:"0.019"})),e.appendChild(t),e}function Pa(e,t,r){var i;const s=e.drawable,c=s.current,d=c&&c.mouseSq?c:void 0,h=new Map,m=e.dom.bounds(),g=s.autoShapes.filter(M=>!M.piece);for(const M of s.shapes.concat(g).concat(d?[d]:[])){if(!M.dest)continue;const y=(i=h.get(M.dest))!==null&&i!==void 0?i:new Set,E=Zt(Jt(oe(M.orig),e.orientation),m),R=Zt(Jt(oe(M.dest),e.orientation),m);y.add(Sr(E,R)),h.set(M.dest,y)}const b=s.shapes.concat(g).map(M=>({shape:M,current:!1,hash:On(M,Er(M.dest,h),!1,m)}));d&&b.push({shape:d,current:!0,hash:On(d,Er(d.dest,h),!0,m)});const w=b.map(M=>M.hash).join(";");if(w===e.drawable.prevSvgHash)return;e.drawable.prevSvgHash=w;const P=t.querySelector("defs");Ta(s,b,P),Aa(b,t.querySelector("g"),r.querySelector("g"),M=>Ra(e,M,s.brushes,h,m))}function Ta(e,t,r){var i;const s=new Map;let c;for(const m of t.filter(g=>g.shape.dest&&g.shape.brush))c=Ci(e.brushes[m.shape.brush],m.shape.modifiers),!((i=m.shape.modifiers)===null||i===void 0)&&i.hilite&&s.set(Qt(c).key,Qt(c)),s.set(c.key,c);const d=new Set;let h=r.firstElementChild;for(;h;)d.add(h.getAttribute("cgKey")),h=h.nextElementSibling;for(const[m,g]of s.entries())d.has(m)||r.appendChild(Na(g))}function Aa(e,t,r,i){const s=new Map;for(const c of e)s.set(c.hash,!1);for(const c of[t,r]){const d=[];let h=c.firstElementChild,m;for(;h;)m=h.getAttribute("cgHash"),s.has(m)?s.set(m,!0):d.push(h),h=h.nextElementSibling;for(const g of d)c.removeChild(g)}for(const c of e.filter(d=>!s.get(d.hash)))for(const d of i(c))d.isCustom?r.appendChild(d.el):t.appendChild(d.el)}function On({orig:e,dest:t,brush:r,piece:i,modifiers:s,customSvg:c,label:d},h,m,g){var b,w;return[g.width,g.height,m,e,t,r,h&&"-",i&&Ma(i),s&&Oa(s),c&&`custom-${Rn(c.html)},${(w=(b=c.center)===null||b===void 0?void 0:b[0])!==null&&w!==void 0?w:"o"}`,d&&`label-${Rn(d.text)}`].filter(P=>P).join(",")}function Ma(e){return[e.color,e.role,e.scale].filter(t=>t).join(",")}function Oa(e){return[e.lineWidth,e.hilite&&"*"].filter(t=>t).join(",")}function Rn(e){let t=0;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r)>>>0;return t.toString()}function Ra(e,{shape:t,current:r,hash:i},s,c,d){var h,m;const g=Zt(Jt(oe(t.orig),e.orientation),d),b=t.dest?Zt(Jt(oe(t.dest),e.orientation),d):g,w=t.brush&&Ci(s[t.brush],t.modifiers),P=c.get(t.dest),M=[];if(w){const y=ge(le("g"),{cgHash:i});M.push({el:y}),g[0]!==b[0]||g[1]!==b[1]?y.appendChild(xa(t,w,g,b,r,Er(t.dest,c))):y.appendChild(Fa(s[t.brush],g,r,d))}if(t.label){const y=t.label;(h=y.fill)!==null&&h!==void 0||(y.fill=t.brush&&s[t.brush].color);const E=t.brush?void 0:"tr";M.push({el:Da(y,i,g,b,P,E),isCustom:!0})}if(t.customSvg){const y=(m=t.customSvg.center)!==null&&m!==void 0?m:"orig",[E,R]=y==="label"?Ti(g,b,P).map(C=>C-.5):y==="dest"?b:g,T=ge(le("g"),{transform:`translate(${E},${R})`,cgHash:i});T.innerHTML=`<svg width="1" height="1" viewBox="0 0 100 100">${t.customSvg.html}</svg>`,M.push({el:T,isCustom:!0})}return M}function Fa(e,t,r,i){const s=La(),c=(i.width+i.height)/(4*Math.max(i.width,i.height));return ge(le("circle"),{stroke:e.color,"stroke-width":s[r?0:1],fill:"none",opacity:Pi(e,r),cx:t[0],cy:t[1],r:c-s[1]/2})}function Qt(e){return["#ffffff","#fff","white"].includes(e.color)?Mn.hilitePrimary:Mn.hiliteWhite}function xa(e,t,r,i,s,c){var d;function h(b){var w;const P=Ia(c&&!s),M=i[0]-r[0],y=i[1]-r[1],E=Math.atan2(y,M),R=Math.cos(E)*P,T=Math.sin(E)*P;return ge(le("line"),{stroke:b?Qt(t).color:t.color,"stroke-width":$a(t,s)+(b?.04:0),"stroke-linecap":"round","marker-end":`url(#arrowhead-${b?Qt(t).key:t.key})`,opacity:!((w=e.modifiers)===null||w===void 0)&&w.hilite?1:Pi(t,s),x1:r[0],y1:r[1],x2:i[0]-R,y2:i[1]-T})}if(!(!((d=e.modifiers)===null||d===void 0)&&d.hilite))return h(!1);const m=le("g"),g=ge(le("g"),{filter:"url(#cg-filter-blur)"});return g.appendChild(Ua(r,i)),g.appendChild(h(!0)),m.appendChild(g),m.appendChild(h(!1)),m}function Na(e){const t=ge(le("marker"),{id:"arrowhead-"+e.key,orient:"auto",overflow:"visible",markerWidth:4,markerHeight:4,refX:e.key.startsWith("hilite")?1.86:2.05,refY:2});return t.appendChild(ge(le("path"),{d:"M0,0 V4 L3,2 Z",fill:e.color})),t.setAttribute("cgKey",e.key),t}function Da(e,t,r,i,s,c){var d;const m=.4*.75**e.text.length,g=Ti(r,i,s),b=c==="tr"?.4:0,w=ge(le("g"),{transform:`translate(${g[0]+b},${g[1]-b})`,cgHash:t});w.appendChild(ge(le("circle"),{r:.4/2,"fill-opacity":c?1:.8,"stroke-opacity":c?1:.7,"stroke-width":.03,fill:(d=e.fill)!==null&&d!==void 0?d:"#666",stroke:"white"}));const P=ge(le("text"),{"font-size":m,"font-family":"Noto Sans","text-anchor":"middle",fill:"white",y:.13*.75**e.text.length});return P.innerHTML=e.text,w.appendChild(P),w}function Jt(e,t){return t==="white"?e:[7-e[0],7-e[1]]}function Er(e,t){return(e&&t.has(e)&&t.get(e).size>1)===!0}function le(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function ge(e,t){for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.setAttribute(r,t[r]);return e}function Ci(e,t){return t?{color:e.color,opacity:Math.round(e.opacity*10)/10,lineWidth:Math.round(t.lineWidth||e.lineWidth),key:[e.key,t.lineWidth].filter(r=>r).join("")}:e}function La(){return[3/64,4/64]}function $a(e,t){return(e.lineWidth||10)*(t?.85:1)/64}function Pi(e,t){return(e.opacity||1)*(t?.9:1)}function Ia(e){return(e?20:10)/64}function Zt(e,t){const r=Math.min(1,t.width/t.height),i=Math.min(1,t.height/t.width);return[(e[0]-3.5)*r,(3.5-e[1])*i]}function Ua(e,t){const r={from:[Math.floor(Math.min(e[0],t[0])),Math.floor(Math.min(e[1],t[1]))],to:[Math.ceil(Math.max(e[0],t[0])),Math.ceil(Math.max(e[1],t[1]))]};return ge(le("rect"),{x:r.from[0],y:r.from[1],width:r.to[0]-r.from[0],height:r.to[1]-r.from[1],fill:"none",stroke:"none"})}function Sr(e,t,r=!0){const i=Math.atan2(t[1]-e[1],t[0]-e[0])+Math.PI;return r?(Math.round(i*8/Math.PI)+16)%16:i}function za(e,t){return Math.sqrt([e[0]-t[0],e[1]-t[1]].reduce((r,i)=>r+i*i,0))}function Ti(e,t,r){let i=za(e,t);const s=Sr(e,t,!1);if(r&&(i-=33/64,r.size>1)){i-=10/64;const c=Sr(e,t);(r.has((c+1)%16)||r.has((c+15)%16))&&c&1&&(i-=.4)}return[e[0]-Math.cos(s)*i,e[1]-Math.sin(s)*i].map(c=>c+.5)}function Ba(e,t){e.innerHTML="",e.classList.add("cg-wrap");for(const m of $s)e.classList.toggle("orientation-"+m,t.orientation===m);e.classList.toggle("manipulable",!t.viewOnly);const r=Le("cg-container");e.appendChild(r);const i=Le("cg-board");r.appendChild(i);let s,c,d;if(t.drawable.visible&&(s=ge(le("svg"),{class:"cg-shapes",viewBox:"-4 -4 8 8",preserveAspectRatio:"xMidYMid slice"}),s.appendChild(Ca()),s.appendChild(le("g")),c=ge(le("svg"),{class:"cg-custom-svgs",viewBox:"-3.5 -3.5 8 8",preserveAspectRatio:"xMidYMid slice"}),c.appendChild(le("g")),d=Le("cg-auto-pieces"),r.appendChild(s),r.appendChild(c),r.appendChild(d)),t.coordinates){const m=t.orientation==="black"?" black":"",g=t.ranksPosition==="left"?" left":"";if(t.coordinatesOnSquares){const b=t.orientation==="white"?w=>w+1:w=>8-w;qt.forEach((w,P)=>r.appendChild(hr(Yt.map(M=>w+M),"squares rank"+b(P)+m+g)))}else r.appendChild(hr(Yt,"ranks"+m+g)),r.appendChild(hr(qt,"files"+m))}let h;return t.draggable.enabled&&t.draggable.showGhost&&(h=Le("piece","ghost"),Ur(h,!1),r.appendChild(h)),{board:i,container:r,wrap:e,ghost:h,svg:s,customSvg:c,autoPieces:d}}function hr(e,t){const r=Le("coords",t);let i;for(const s of e)i=Le("coord"),i.textContent=s,r.appendChild(i);return r}function ja(e,t){if(!e.dropmode.active)return;We(e),He(e);const r=e.dropmode.piece;if(r){e.pieces.set("a0",r);const i=it(t),s=i&&ot(i,_e(e),e.dom.bounds());s&&fi(e,"a0",s)}e.dom.redraw()}function Wa(e,t){const r=e.dom.elements.board;if("ResizeObserver"in window&&new ResizeObserver(t).observe(e.dom.elements.wrap),(e.disableContextMenu||e.drawable.enabled)&&r.addEventListener("contextmenu",s=>s.preventDefault()),e.viewOnly)return;const i=Ga(e);r.addEventListener("touchstart",i,{passive:!1}),r.addEventListener("mousedown",i,{passive:!1})}function Ha(e,t){const r=[];if("ResizeObserver"in window||r.push(At(document.body,"chessground.resize",t)),!e.viewOnly){const i=Fn(e,ba,fa),s=Fn(e,ka,ha);for(const d of["touchmove","mousemove"])r.push(At(document,d,i));for(const d of["touchend","mouseup"])r.push(At(document,d,s));const c=()=>e.dom.bounds.clear();r.push(At(document,"scroll",c,{capture:!0,passive:!0})),r.push(At(window,"resize",c,{passive:!0}))}return()=>r.forEach(i=>i())}function At(e,t,r,i){return e.addEventListener(t,r,i),()=>e.removeEventListener(t,r,i)}const Ga=e=>t=>{e.draggable.current?Xt(e):e.drawable.current?ki(e):t.shiftKey||ri(t)?e.drawable.enabled&&da(e,t):e.viewOnly||(e.dropmode.active?ja(e,t):va(e,t))},Fn=(e,t,r)=>i=>{e.drawable.current?e.drawable.enabled&&r(e,i):e.viewOnly||t(e,i)};function Ka(e){const t=_e(e),r=zt(e.dom.bounds()),i=e.dom.elements.board,s=e.pieces,c=e.animation.current,d=c?c.plan.anims:new Map,h=c?c.plan.fadings:new Map,m=e.draggable.current,g=qa(e),b=new Set,w=new Set,P=new Map,M=new Map;let y,E,R,T,C,U,re,x,ne,$;for(E=i.firstChild;E;){if(y=E.cgKey,Ai(E))if(R=s.get(y),C=d.get(y),U=h.get(y),T=E.cgPiece,E.cgDragging&&(!m||m.orig!==y)&&(E.classList.remove("dragging"),Me(E,r(oe(y),t)),E.cgDragging=!1),!U&&E.cgFading&&(E.cgFading=!1,E.classList.remove("fading")),R){if(C&&E.cgAnimating&&T===Mt(R)){const I=oe(y);I[0]+=C[2],I[1]+=C[3],E.classList.add("anim"),Me(E,r(I,t))}else E.cgAnimating&&(E.cgAnimating=!1,E.classList.remove("anim"),Me(E,r(oe(y),t)),e.addPieceZIndex&&(E.style.zIndex=pr(oe(y),t)));T===Mt(R)&&(!U||!E.cgFading)?b.add(y):U&&T===Mt(U)?(E.classList.add("fading"),E.cgFading=!0):mr(P,T,E)}else mr(P,T,E);else if(Mi(E)){const I=E.className;g.get(y)===I?w.add(y):mr(M,I,E)}E=E.nextSibling}for(const[I,O]of g)if(!w.has(I)){ne=M.get(O),$=ne&&ne.pop();const Q=r(oe(I),t);if($)$.cgKey=I,Me($,Q);else{const S=Le("square",O);S.cgKey=I,Me(S,Q),i.insertBefore(S,i.firstChild)}}for(const[I,O]of s)if(C=d.get(I),!b.has(I))if(re=P.get(Mt(O)),x=re&&re.pop(),x){x.cgKey=I,x.cgFading&&(x.classList.remove("fading"),x.cgFading=!1);const Q=oe(I);e.addPieceZIndex&&(x.style.zIndex=pr(Q,t)),C&&(x.cgAnimating=!0,x.classList.add("anim"),Q[0]+=C[2],Q[1]+=C[3]),Me(x,r(Q,t))}else{const Q=Mt(O),S=Le("piece",Q),G=oe(I);S.cgPiece=Q,S.cgKey=I,C&&(S.cgAnimating=!0,G[0]+=C[2],G[1]+=C[3]),Me(S,r(G,t)),e.addPieceZIndex&&(S.style.zIndex=pr(G,t)),i.appendChild(S)}for(const I of P.values())Nn(e,I);for(const I of M.values())Nn(e,I)}function Va(e){const t=_e(e),r=zt(e.dom.bounds());let i=e.dom.elements.board.firstChild;for(;i;)(Ai(i)&&!i.cgAnimating||Mi(i))&&Me(i,r(oe(i.cgKey),t)),i=i.nextSibling}function xn(e){var t,r;const i=e.dom.elements.wrap.getBoundingClientRect(),s=e.dom.elements.container,c=i.height/i.width,d=Math.floor(i.width*window.devicePixelRatio/8)*8/window.devicePixelRatio,h=d*c;s.style.width=d+"px",s.style.height=h+"px",e.dom.bounds.clear(),(t=e.addDimensionsCssVarsTo)===null||t===void 0||t.style.setProperty("---cg-width",d+"px"),(r=e.addDimensionsCssVarsTo)===null||r===void 0||r.style.setProperty("---cg-height",h+"px")}const Ai=e=>e.tagName==="PIECE",Mi=e=>e.tagName==="SQUARE";function Nn(e,t){for(const r of t)e.dom.elements.board.removeChild(r)}function pr(e,t){const i=e[1];return`${t?10-i:3+i}`}const Mt=e=>`${e.color} ${e.role}`;function qa(e){var t,r,i;const s=new Map;if(e.lastMove&&e.highlight.lastMove)for(const h of e.lastMove)xe(s,h,"last-move");if(e.check&&e.highlight.check&&xe(s,e.check,"check"),e.selected&&(xe(s,e.selected,"selected"),e.movable.showDests)){const h=(t=e.movable.dests)===null||t===void 0?void 0:t.get(e.selected);if(h)for(const g of h)xe(s,g,"move-dest"+(e.pieces.has(g)?" oc":""));const m=(i=(r=e.premovable.customDests)===null||r===void 0?void 0:r.get(e.selected))!==null&&i!==void 0?i:e.premovable.dests;if(m)for(const g of m)xe(s,g,"premove-dest"+(e.pieces.has(g)?" oc":""))}const c=e.premovable.current;if(c)for(const h of c)xe(s,h,"current-premove");else e.predroppable.current&&xe(s,e.predroppable.current.key,"current-premove");const d=e.exploding;if(d)for(const h of d.keys)xe(s,h,"exploding"+d.stage);return e.highlight.custom&&e.highlight.custom.forEach((h,m)=>{xe(s,m,h)}),s}function xe(e,t,r){const i=e.get(t);i?e.set(t,`${i} ${r}`):e.set(t,r)}function mr(e,t,r){const i=e.get(t);i?i.push(r):e.set(t,[r])}function Ya(e,t,r){const i=new Map,s=[];for(const h of e)i.set(h.hash,!1);let c=t.firstElementChild,d;for(;c;)d=c.getAttribute("cgHash"),i.has(d)?i.set(d,!0):s.push(c),c=c.nextElementSibling;for(const h of s)t.removeChild(h);for(const h of e)i.get(h.hash)||t.appendChild(r(h))}function Xa(e,t){const i=e.drawable.autoShapes.filter(s=>s.piece).map(s=>({shape:s,hash:Za(s),current:!1}));Ya(i,t,s=>Ja(e,s,e.dom.bounds()))}function Qa(e){var t;const r=_e(e),i=zt(e.dom.bounds());let s=(t=e.dom.elements.autoPieces)===null||t===void 0?void 0:t.firstChild;for(;s;)ti(s,i(oe(s.cgKey),r),s.cgScale),s=s.nextSibling}function Ja(e,{shape:t,hash:r},i){var s,c,d;const h=t.orig,m=(s=t.piece)===null||s===void 0?void 0:s.role,g=(c=t.piece)===null||c===void 0?void 0:c.color,b=(d=t.piece)===null||d===void 0?void 0:d.scale,w=Le("piece",`${m} ${g}`);return w.setAttribute("cgHash",r),w.cgKey=h,w.cgScale=b,ti(w,zt(i)(oe(h),_e(e)),b),w}const Za=e=>{var t,r,i;return[e.orig,(t=e.piece)===null||t===void 0?void 0:t.role,(r=e.piece)===null||r===void 0?void 0:r.color,(i=e.piece)===null||i===void 0?void 0:i.scale].join(",")};function el(e,t){const r=Sa();_i(r,t||{});function i(){const s="dom"in r?r.dom.unbind:void 0,c=Ba(e,r),d=Us(()=>c.board.getBoundingClientRect()),h=b=>{Ka(g),c.autoPieces&&Xa(g,c.autoPieces),!b&&c.svg&&Pa(g,c.svg,c.customSvg)},m=()=>{xn(g),Va(g),c.autoPieces&&Qa(g)},g=r;return g.dom={elements:c,bounds:d,redraw:tl(h),redrawNow:h,unbind:s},g.drawable.prevSvgHash="",xn(g),h(!1),Wa(g,m),s||(g.dom.unbind=Ha(g,m)),g.events.insert&&g.events.insert(c),g}return Ea(i(),i)}function tl(e){let t=!1;return()=>{t||(t=!0,requestAnimationFrame(()=>{e(),t=!1}))}}const er=["a","b","c","d","e","f","g","h"],Oi=["1","2","3","4","5","6","7","8"],rt=["white","black"],Pe=["pawn","knight","bishop","rook","queen","king"],rl=["a","h"],tr=e=>"role"in e,N=e=>e!==void 0,me=e=>e==="white"?"black":"white",nt=e=>e>>3,be=e=>e&7,Cr=(e,t)=>0<=e&&e<8&&0<=t&&t<8?e+8*t:void 0,Rt=e=>{switch(e){case"pawn":return"p";case"knight":return"n";case"bishop":return"b";case"rook":return"r";case"queen":return"q";case"king":return"k"}};function Pr(e){switch(e.toLowerCase()){case"p":return"pawn";case"n":return"knight";case"b":return"bishop";case"r":return"rook";case"q":return"queen";case"k":return"king";default:return}}function Kt(e){if(e.length===2)return Cr(e.charCodeAt(0)-97,e.charCodeAt(1)-49)}const Dt=e=>er[be(e)]+Oi[nt(e)],nl=e=>{if(e[1]==="@"&&e.length===4){const t=Pr(e[0]),r=Kt(e.slice(2));if(t&&N(r))return{role:t,to:r}}else if(e.length===4||e.length===5){const t=Kt(e.slice(0,2)),r=Kt(e.slice(2,4));let i;if(e.length===5&&(i=Pr(e[4]),!i))return;if(N(t)&&N(r))return{from:t,to:r,promotion:i}}},Kr=(e,t)=>e==="white"?t==="a"?2:6:t==="a"?58:62,Vr=(e,t)=>e==="white"?t==="a"?3:5:t==="a"?59:61,Dn=e=>(e=e-(e>>>1&1431655765),e=(e&858993459)+(e>>>2&858993459),Math.imul(e+(e>>>4)&252645135,16843009)>>24),Tr=e=>(e=e>>>8&16711935|(e&16711935)<<8,e>>>16&65535|(e&65535)<<16),Ln=e=>(e=e>>>1&1431655765|(e&1431655765)<<1,e=e>>>2&858993459|(e&858993459)<<2,e=e>>>4&252645135|(e&252645135)<<4,Tr(e));class k{constructor(t,r){this.lo=t|0,this.hi=r|0}static fromSquare(t){return t>=32?new k(0,1<<t-32):new k(1<<t,0)}static fromRank(t){return new k(255,0).shl64(8*t)}static fromFile(t){return new k(16843009<<t,16843009<<t)}static empty(){return new k(0,0)}static full(){return new k(4294967295,4294967295)}static corners(){return new k(129,2164260864)}static center(){return new k(402653184,24)}static backranks(){return new k(255,4278190080)}static backrank(t){return t==="white"?new k(255,0):new k(0,4278190080)}static lightSquares(){return new k(1437226410,1437226410)}static darkSquares(){return new k(2857740885,2857740885)}complement(){return new k(~this.lo,~this.hi)}xor(t){return new k(this.lo^t.lo,this.hi^t.hi)}union(t){return new k(this.lo|t.lo,this.hi|t.hi)}intersect(t){return new k(this.lo&t.lo,this.hi&t.hi)}diff(t){return new k(this.lo&~t.lo,this.hi&~t.hi)}intersects(t){return this.intersect(t).nonEmpty()}isDisjoint(t){return this.intersect(t).isEmpty()}supersetOf(t){return t.diff(this).isEmpty()}subsetOf(t){return this.diff(t).isEmpty()}shr64(t){return t>=64?k.empty():t>=32?new k(this.hi>>>t-32,0):t>0?new k(this.lo>>>t^this.hi<<32-t,this.hi>>>t):this}shl64(t){return t>=64?k.empty():t>=32?new k(0,this.lo<<t-32):t>0?new k(this.lo<<t,this.hi<<t^this.lo>>>32-t):this}bswap64(){return new k(Tr(this.hi),Tr(this.lo))}rbit64(){return new k(Ln(this.hi),Ln(this.lo))}minus64(t){const r=this.lo-t.lo,i=(r&t.lo&1)+(t.lo>>>1)+(r>>>1)>>>31;return new k(r,this.hi-(t.hi+i))}equals(t){return this.lo===t.lo&&this.hi===t.hi}size(){return Dn(this.lo)+Dn(this.hi)}isEmpty(){return this.lo===0&&this.hi===0}nonEmpty(){return this.lo!==0||this.hi!==0}has(t){return(t>=32?this.hi&1<<t-32:this.lo&1<<t)!==0}set(t,r){return r?this.with(t):this.without(t)}with(t){return t>=32?new k(this.lo,this.hi|1<<t-32):new k(this.lo|1<<t,this.hi)}without(t){return t>=32?new k(this.lo,this.hi&~(1<<t-32)):new k(this.lo&~(1<<t),this.hi)}toggle(t){return t>=32?new k(this.lo,this.hi^1<<t-32):new k(this.lo^1<<t,this.hi)}last(){if(this.hi!==0)return 63-Math.clz32(this.hi);if(this.lo!==0)return 31-Math.clz32(this.lo)}first(){if(this.lo!==0)return 31-Math.clz32(this.lo&-this.lo);if(this.hi!==0)return 63-Math.clz32(this.hi&-this.hi)}withoutFirst(){return this.lo!==0?new k(this.lo&this.lo-1,this.hi):new k(0,this.hi&this.hi-1)}moreThanOne(){return this.hi!==0&&this.lo!==0||(this.lo&this.lo-1)!==0||(this.hi&this.hi-1)!==0}singleSquare(){return this.moreThanOne()?void 0:this.last()}*[Symbol.iterator](){let t=this.lo,r=this.hi;for(;t!==0;){const i=31-Math.clz32(t&-t);t^=1<<i,yield i}for(;r!==0;){const i=31-Math.clz32(r&-r);r^=1<<i,yield 32+i}}*reversed(){let t=this.lo,r=this.hi;for(;r!==0;){const i=31-Math.clz32(r);r^=1<<i,yield 32+i}for(;t!==0;){const i=31-Math.clz32(t);t^=1<<i,yield i}}}const rr=(e,t)=>{let r=k.empty();for(const i of t){const s=e+i;0<=s&&s<64&&Math.abs(be(e)-be(s))<=2&&(r=r.with(s))}return r},je=e=>{const t=[];for(let r=0;r<64;r++)t[r]=e(r);return t},il=je(e=>rr(e,[-9,-8,-7,-1,1,7,8,9])),ol=je(e=>rr(e,[-17,-15,-10,-6,6,10,15,17])),sl={white:je(e=>rr(e,[7,9])),black:je(e=>rr(e,[-7,-9]))},qr=e=>il[e],Yr=e=>ol[e],nr=(e,t)=>sl[e][t],Ar=je(e=>k.fromFile(be(e)).without(e)),Mr=je(e=>k.fromRank(nt(e)).without(e)),Or=je(e=>{const t=new k(134480385,2151686160),r=8*(nt(e)-be(e));return(r>=0?t.shl64(r):t.shr64(-r)).without(e)}),Rr=je(e=>{const t=new k(270549120,16909320),r=8*(nt(e)+be(e)-7);return(r>=0?t.shl64(r):t.shr64(-r)).without(e)}),Fr=(e,t,r)=>{let i=r.intersect(t),s=i.bswap64();return i=i.minus64(e),s=s.minus64(e.bswap64()),i.xor(s.bswap64()).intersect(t)},al=(e,t)=>Fr(k.fromSquare(e),Ar[e],t),ll=(e,t)=>{const r=Mr[e];let i=t.intersect(r),s=i.rbit64();return i=i.minus64(k.fromSquare(e)),s=s.minus64(k.fromSquare(63-e)),i.xor(s.rbit64()).intersect(r)},Lt=(e,t)=>{const r=k.fromSquare(e);return Fr(r,Or[e],t).xor(Fr(r,Rr[e],t))},$t=(e,t)=>al(e,t).xor(ll(e,t)),Ri=(e,t)=>Lt(e,t).xor($t(e,t)),Fi=(e,t)=>{const r=k.fromSquare(t);return Mr[e].intersects(r)?Mr[e].with(e):Rr[e].intersects(r)?Rr[e].with(e):Or[e].intersects(r)?Or[e].with(e):Ar[e].intersects(r)?Ar[e].with(e):k.empty()},It=(e,t)=>Fi(e,t).intersect(k.full().shl64(e).xor(k.full().shl64(t))).withoutFirst();class vt{constructor(){}static default(){const t=new vt;return t.reset(),t}reset(){this.occupied=new k(65535,4294901760),this.promoted=k.empty(),this.white=new k(65535,0),this.black=new k(0,4294901760),this.pawn=new k(65280,16711680),this.knight=new k(66,1107296256),this.bishop=new k(36,603979776),this.rook=new k(129,2164260864),this.queen=new k(8,134217728),this.king=new k(16,268435456)}static empty(){const t=new vt;return t.clear(),t}clear(){this.occupied=k.empty(),this.promoted=k.empty();for(const t of rt)this[t]=k.empty();for(const t of Pe)this[t]=k.empty()}clone(){const t=new vt;t.occupied=this.occupied,t.promoted=this.promoted;for(const r of rt)t[r]=this[r];for(const r of Pe)t[r]=this[r];return t}getColor(t){if(this.white.has(t))return"white";if(this.black.has(t))return"black"}getRole(t){for(const r of Pe)if(this[r].has(t))return r}get(t){const r=this.getColor(t);if(!r)return;const i=this.getRole(t),s=this.promoted.has(t);return{color:r,role:i,promoted:s}}take(t){const r=this.get(t);return r&&(this.occupied=this.occupied.without(t),this[r.color]=this[r.color].without(t),this[r.role]=this[r.role].without(t),r.promoted&&(this.promoted=this.promoted.without(t))),r}set(t,r){const i=this.take(t);return this.occupied=this.occupied.with(t),this[r.color]=this[r.color].with(t),this[r.role]=this[r.role].with(t),r.promoted&&(this.promoted=this.promoted.with(t)),i}has(t){return this.occupied.has(t)}*[Symbol.iterator](){for(const t of this.occupied)yield[t,this.get(t)]}pieces(t,r){return this[t].intersect(this[r])}rooksAndQueens(){return this.rook.union(this.queen)}bishopsAndQueens(){return this.bishop.union(this.queen)}kingOf(t){return this.pieces(t,"king").singleSquare()}}class Oe{constructor(){}static empty(){const t=new Oe;for(const r of Pe)t[r]=0;return t}static fromBoard(t,r){const i=new Oe;for(const s of Pe)i[s]=t.pieces(r,s).size();return i}clone(){const t=new Oe;for(const r of Pe)t[r]=this[r];return t}equals(t){return Pe.every(r=>this[r]===t[r])}add(t){const r=new Oe;for(const i of Pe)r[i]=this[i]+t[i];return r}subtract(t){const r=new Oe;for(const i of Pe)r[i]=this[i]-t[i];return r}nonEmpty(){return Pe.some(t=>this[t]>0)}isEmpty(){return!this.nonEmpty()}hasPawns(){return this.pawn>0}hasNonPawns(){return this.knight>0||this.bishop>0||this.rook>0||this.queen>0||this.king>0}size(){return this.pawn+this.knight+this.bishop+this.rook+this.queen+this.king}}class Ze{constructor(t,r){this.white=t,this.black=r}static empty(){return new Ze(Oe.empty(),Oe.empty())}static fromBoard(t){return new Ze(Oe.fromBoard(t,"white"),Oe.fromBoard(t,"black"))}clone(){return new Ze(this.white.clone(),this.black.clone())}equals(t){return this.white.equals(t.white)&&this.black.equals(t.black)}add(t){return new Ze(this.white.add(t.white),this.black.add(t.black))}subtract(t){return new Ze(this.white.subtract(t.white),this.black.subtract(t.black))}count(t){return this.white[t]+this.black[t]}size(){return this.white.size()+this.black.size()}isEmpty(){return this.white.isEmpty()&&this.black.isEmpty()}nonEmpty(){return!this.isEmpty()}hasPawns(){return this.white.hasPawns()||this.black.hasPawns()}hasNonPawns(){return this.white.hasNonPawns()||this.black.hasNonPawns()}}class Ut{constructor(t,r){this.white=t,this.black=r}static default(){return new Ut(3,3)}clone(){return new Ut(this.white,this.black)}equals(t){return this.white===t.white&&this.black===t.black}}class xi{unwrap(t,r){const i=this._chain(s=>L.ok(t?t(s):s),s=>r?L.ok(r(s)):L.err(s));if(i.isErr)throw i.error;return i.value}map(t,r){return this._chain(i=>L.ok(t(i)),i=>L.err(r?r(i):i))}chain(t,r){return this._chain(t,r||(i=>L.err(i)))}}class cl extends xi{constructor(t){super(),this.value=void 0,this.isOk=!0,this.isErr=!1,this.value=t}_chain(t,r){return t(this.value)}}class ul extends xi{constructor(t){super(),this.error=void 0,this.isOk=!1,this.isErr=!0,this.error=t}_chain(t,r){return r(this.error)}}var L;(function(e){e.ok=function(t){return new cl(t)},e.err=function(t){return new ul(t||new Error)},e.all=function(t){if(Array.isArray(t)){const s=[];for(let c=0;c<t.length;c++){const d=t[c];if(d.isErr)return d;s.push(d.value)}return e.ok(s)}const r={},i=Object.keys(t);for(let s=0;s<i.length;s++){const c=t[i[s]];if(c.isErr)return c;r[i[s]]=c.value}return e.ok(r)}})(L||(L={}));var ze;(function(e){e.Empty="ERR_EMPTY",e.OppositeCheck="ERR_OPPOSITE_CHECK",e.PawnsOnBackrank="ERR_PAWNS_ON_BACKRANK",e.Kings="ERR_KINGS",e.Variant="ERR_VARIANT"})(ze||(ze={}));class ft extends Error{}const dl=(e,t,r,i)=>r[t].intersect($t(e,i).intersect(r.rooksAndQueens()).union(Lt(e,i).intersect(r.bishopsAndQueens())).union(Yr(e).intersect(r.knight)).union(qr(e).intersect(r.king)).union(nr(me(t),e).intersect(r.pawn)));class et{constructor(){}static default(){const t=new et;return t.castlingRights=k.corners(),t.rook={white:{a:0,h:7},black:{a:56,h:63}},t.path={white:{a:new k(14,0),h:new k(96,0)},black:{a:new k(0,234881024),h:new k(0,1610612736)}},t}static empty(){const t=new et;return t.castlingRights=k.empty(),t.rook={white:{a:void 0,h:void 0},black:{a:void 0,h:void 0}},t.path={white:{a:k.empty(),h:k.empty()},black:{a:k.empty(),h:k.empty()}},t}clone(){const t=new et;return t.castlingRights=this.castlingRights,t.rook={white:{a:this.rook.white.a,h:this.rook.white.h},black:{a:this.rook.black.a,h:this.rook.black.h}},t.path={white:{a:this.path.white.a,h:this.path.white.h},black:{a:this.path.black.a,h:this.path.black.h}},t}add(t,r,i,s){const c=Kr(t,r),d=Vr(t,r);this.castlingRights=this.castlingRights.with(s),this.rook[t][r]=s,this.path[t][r]=It(s,d).with(d).union(It(i,c).with(c)).without(i).without(s)}static fromSetup(t){const r=et.empty(),i=t.castlingRights.intersect(t.board.rook);for(const s of rt){const c=k.backrank(s),d=t.board.kingOf(s);if(!N(d)||!c.has(d))continue;const h=i.intersect(t.board[s]).intersect(c),m=h.first();N(m)&&m<d&&r.add(s,"a",d,m);const g=h.last();N(g)&&d<g&&r.add(s,"h",d,g)}return r}discardRook(t){if(this.castlingRights.has(t)){this.castlingRights=this.castlingRights.without(t);for(const r of rt)for(const i of rl)this.rook[r][i]===t&&(this.rook[r][i]=void 0)}}discardColor(t){this.castlingRights=this.castlingRights.diff(k.backrank(t)),this.rook[t].a=void 0,this.rook[t].h=void 0}}class fl{constructor(t){this.rules=t}reset(){this.board=vt.default(),this.pockets=void 0,this.turn="white",this.castles=et.default(),this.epSquare=void 0,this.remainingChecks=void 0,this.halfmoves=0,this.fullmoves=1}setupUnchecked(t){this.board=t.board.clone(),this.board.promoted=k.empty(),this.pockets=void 0,this.turn=t.turn,this.castles=et.fromSetup(t),this.epSquare=hl(this,t.epSquare),this.remainingChecks=void 0,this.halfmoves=t.halfmoves,this.fullmoves=t.fullmoves}kingAttackers(t,r,i){return dl(t,r,this.board,i)}playCaptureAt(t,r){this.halfmoves=0,r.role==="rook"&&this.castles.discardRook(t),this.pockets&&this.pockets[me(r.color)][r.promoted?"pawn":r.role]++}ctx(){const t=this.isVariantEnd(),r=this.board.kingOf(this.turn);if(!N(r))return{king:r,blockers:k.empty(),checkers:k.empty(),variantEnd:t,mustCapture:!1};const i=$t(r,k.empty()).intersect(this.board.rooksAndQueens()).union(Lt(r,k.empty()).intersect(this.board.bishopsAndQueens())).intersect(this.board[me(this.turn)]);let s=k.empty();for(const d of i){const h=It(r,d).intersect(this.board.occupied);h.moreThanOne()||(s=s.union(h))}const c=this.kingAttackers(r,me(this.turn),this.board.occupied);return{king:r,blockers:s,checkers:c,variantEnd:t,mustCapture:!1}}clone(){var t,r;const i=new this.constructor;return i.board=this.board.clone(),i.pockets=(t=this.pockets)===null||t===void 0?void 0:t.clone(),i.turn=this.turn,i.castles=this.castles.clone(),i.epSquare=this.epSquare,i.remainingChecks=(r=this.remainingChecks)===null||r===void 0?void 0:r.clone(),i.halfmoves=this.halfmoves,i.fullmoves=this.fullmoves,i}validate(){if(this.board.occupied.isEmpty())return L.err(new ft(ze.Empty));if(this.board.king.size()!==2)return L.err(new ft(ze.Kings));if(!N(this.board.kingOf(this.turn)))return L.err(new ft(ze.Kings));const t=this.board.kingOf(me(this.turn));return N(t)?this.kingAttackers(t,this.turn,this.board.occupied).nonEmpty()?L.err(new ft(ze.OppositeCheck)):k.backranks().intersects(this.board.pawn)?L.err(new ft(ze.PawnsOnBackrank)):L.ok(void 0):L.err(new ft(ze.Kings))}dropDests(t){return k.empty()}dests(t,r){if(r=r||this.ctx(),r.variantEnd)return k.empty();const i=this.board.get(t);if(!i||i.color!==this.turn)return k.empty();let s,c;if(i.role==="pawn"){s=nr(this.turn,t).intersect(this.board[me(this.turn)]);const d=this.turn==="white"?8:-8,h=t+d;if(0<=h&&h<64&&!this.board.occupied.has(h)){s=s.with(h);const m=this.turn==="white"?t<16:t>=48,g=h+d;m&&!this.board.occupied.has(g)&&(s=s.with(g))}N(this.epSquare)&&ml(this,t,r)&&(c=k.fromSquare(this.epSquare))}else i.role==="bishop"?s=Lt(t,this.board.occupied):i.role==="knight"?s=Yr(t):i.role==="rook"?s=$t(t,this.board.occupied):i.role==="queen"?s=Ri(t,this.board.occupied):s=qr(t);if(s=s.diff(this.board[this.turn]),N(r.king)){if(i.role==="king"){const d=this.board.occupied.without(t);for(const h of s)this.kingAttackers(h,me(this.turn),d).nonEmpty()&&(s=s.without(h));return s.union($n(this,"a",r)).union($n(this,"h",r))}if(r.checkers.nonEmpty()){const d=r.checkers.singleSquare();if(!N(d))return k.empty();s=s.intersect(It(d,r.king).with(d))}r.blockers.has(t)&&(s=s.intersect(Fi(t,r.king)))}return c&&(s=s.union(c)),s}isVariantEnd(){return!1}variantOutcome(t){}hasInsufficientMaterial(t){return this.board[t].intersect(this.board.pawn.union(this.board.rooksAndQueens())).nonEmpty()?!1:this.board[t].intersects(this.board.knight)?this.board[t].size()<=2&&this.board[me(t)].diff(this.board.king).diff(this.board.queen).isEmpty():this.board[t].intersects(this.board.bishop)?(!this.board.bishop.intersects(k.darkSquares())||!this.board.bishop.intersects(k.lightSquares()))&&this.board.pawn.isEmpty()&&this.board.knight.isEmpty():!0}toSetup(){var t,r;return{board:this.board.clone(),pockets:(t=this.pockets)===null||t===void 0?void 0:t.clone(),turn:this.turn,castlingRights:this.castles.castlingRights,epSquare:pl(this),remainingChecks:(r=this.remainingChecks)===null||r===void 0?void 0:r.clone(),halfmoves:Math.min(this.halfmoves,150),fullmoves:Math.min(Math.max(this.fullmoves,1),9999)}}isInsufficientMaterial(){return rt.every(t=>this.hasInsufficientMaterial(t))}hasDests(t){t=t||this.ctx();for(const r of this.board[this.turn])if(this.dests(r,t).nonEmpty())return!0;return this.dropDests(t).nonEmpty()}isLegal(t,r){if(tr(t))return!this.pockets||this.pockets[this.turn][t.role]<=0||t.role==="pawn"&&k.backranks().has(t.to)?!1:this.dropDests(r).has(t.to);{if(t.promotion==="pawn"||t.promotion==="king"&&this.rules!=="antichess"||!!t.promotion!==(this.board.pawn.has(t.from)&&k.backranks().has(t.to)))return!1;const i=this.dests(t.from,r);return i.has(t.to)||i.has(gl(this,t).to)}}isCheck(){const t=this.board.kingOf(this.turn);return N(t)&&this.kingAttackers(t,me(this.turn),this.board.occupied).nonEmpty()}isEnd(t){return(t?t.variantEnd:this.isVariantEnd())?!0:this.isInsufficientMaterial()||!this.hasDests(t)}isCheckmate(t){return t=t||this.ctx(),!t.variantEnd&&t.checkers.nonEmpty()&&!this.hasDests(t)}isStalemate(t){return t=t||this.ctx(),!t.variantEnd&&t.checkers.isEmpty()&&!this.hasDests(t)}outcome(t){const r=this.variantOutcome(t);return r||(t=t||this.ctx(),this.isCheckmate(t)?{winner:me(this.turn)}:this.isInsufficientMaterial()||this.isStalemate(t)?{winner:void 0}:void 0)}allDests(t){t=t||this.ctx();const r=new Map;if(t.variantEnd)return r;for(const i of this.board[this.turn])r.set(i,this.dests(i,t));return r}play(t){const r=this.turn,i=this.epSquare,s=Di(this,t);if(this.epSquare=void 0,this.halfmoves+=1,r==="black"&&(this.fullmoves+=1),this.turn=me(r),tr(t))this.board.set(t.to,{role:t.role,color:r}),this.pockets&&this.pockets[r][t.role]--,t.role==="pawn"&&(this.halfmoves=0);else{const c=this.board.take(t.from);if(!c)return;let d;if(c.role==="pawn"){this.halfmoves=0,t.to===i&&(d=this.board.take(t.to+(r==="white"?-8:8)));const h=t.from-t.to;Math.abs(h)===16&&8<=t.from&&t.from<=55&&(this.epSquare=t.from+t.to>>1),t.promotion&&(c.role=t.promotion,c.promoted=!!this.pockets)}else if(c.role==="rook")this.castles.discardRook(t.from);else if(c.role==="king"){if(s){const h=this.castles.rook[r][s];if(N(h)){const m=this.board.take(h);this.board.set(Kr(r,s),c),m&&this.board.set(Vr(r,s),m)}}this.castles.discardColor(r)}if(!s){const h=this.board.set(t.to,c)||d;h&&this.playCaptureAt(t.to,h)}}this.remainingChecks&&this.isCheck()&&(this.remainingChecks[r]=Math.max(this.remainingChecks[r]-1,0))}}class Ni extends fl{constructor(){super("chess")}static default(){const t=new this;return t.reset(),t}static fromSetup(t){const r=new this;return r.setupUnchecked(t),r.validate().map(i=>r)}clone(){return super.clone()}}const hl=(e,t)=>{if(!N(t))return;const r=e.turn==="white"?5:2,i=e.turn==="white"?8:-8;if(nt(t)!==r||e.board.occupied.has(t+i))return;const s=t-i;if(!(!e.board.pawn.has(s)||!e.board[me(e.turn)].has(s)))return t},pl=e=>{if(!N(e.epSquare))return;const t=e.ctx(),i=e.board.pieces(e.turn,"pawn").intersect(nr(me(e.turn),e.epSquare));for(const s of i)if(e.dests(s,t).has(e.epSquare))return e.epSquare},ml=(e,t,r)=>{if(!N(e.epSquare)||!nr(e.turn,t).has(e.epSquare))return!1;if(!N(r.king))return!0;const i=e.turn==="white"?8:-8,s=e.epSquare-i;return e.kingAttackers(r.king,me(e.turn),e.board.occupied.toggle(t).toggle(s).with(e.epSquare)).without(s).isEmpty()},$n=(e,t,r)=>{if(!N(r.king)||r.checkers.nonEmpty())return k.empty();const i=e.castles.rook[e.turn][t];if(!N(i)||e.castles.path[e.turn][t].intersects(e.board.occupied))return k.empty();const s=Kr(e.turn,t),c=It(r.king,s),d=e.board.occupied.without(r.king);for(const g of c)if(e.kingAttackers(g,me(e.turn),d).nonEmpty())return k.empty();const h=Vr(e.turn,t),m=e.board.occupied.toggle(r.king).toggle(i).toggle(h);return e.kingAttackers(s,me(e.turn),m).nonEmpty()?k.empty():k.fromSquare(i)},Di=(e,t)=>{if(tr(t))return;const r=t.to-t.from;if(!(Math.abs(r)!==2&&!e.board[e.turn].has(t.to))&&e.board.king.has(t.from))return r>0?"h":"a"},gl=(e,t)=>{const r=Di(e,t);if(!r)return t;const i=e.castles.rook[e.turn][r];return{from:t.from,to:N(i)?i:t.to}},vl=(e,t)=>{const r=new Map,i=e.ctx();for(const[s,c]of e.allDests(i))if(c.nonEmpty()){const d=Array.from(c,Dt);s===i.king&&be(s)===4&&(c.has(0)?d.push("c1"):c.has(56)&&d.push("c8"),c.has(7)?d.push("g1"):c.has(63)&&d.push("g8")),r.set(Dt(s),d)}return r},_l="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",wl=_l+" w KQkq -",Xr=wl+" 0 1";var ae;(function(e){e.Fen="ERR_FEN",e.Board="ERR_BOARD",e.Pockets="ERR_POCKETS",e.Turn="ERR_TURN",e.Castling="ERR_CASTLING",e.EpSquare="ERR_EP_SQUARE",e.RemainingChecks="ERR_REMAINING_CHECKS",e.Halfmoves="ERR_HALFMOVES",e.Fullmoves="ERR_FULLMOVES"})(ae||(ae={}));class he extends Error{}const bl=(e,t,r)=>{let i=e.indexOf(t);for(;r-- >0&&i!==-1;)i=e.indexOf(t,i+t.length);return i},gt=e=>/^\d{1,4}$/.test(e)?parseInt(e,10):void 0,Li=e=>{const t=Pr(e);return t&&{role:t,color:e.toLowerCase()===e?"black":"white"}},gr=e=>{const t=vt.empty();let r=7,i=0;for(let s=0;s<e.length;s++){const c=e[s];if(c==="/"&&i===8)i=0,r--;else{const d=parseInt(c,10);if(d>0)i+=d;else{if(i>=8||r<0)return L.err(new he(ae.Board));const h=i+r*8,m=Li(c);if(!m)return L.err(new he(ae.Board));e[s+1]==="~"&&(m.promoted=!0,s++),t.set(h,m),i++}}}return r!==0||i!==8?L.err(new he(ae.Board)):L.ok(t)},In=e=>{if(e.length>64)return L.err(new he(ae.Pockets));const t=Ze.empty();for(const r of e){const i=Li(r);if(!i)return L.err(new he(ae.Pockets));t[i.color][i.role]++}return L.ok(t)},kl=(e,t)=>{let r=k.empty();if(t==="-")return L.ok(r);for(const i of t){const s=i.toLowerCase(),c=i===s?"black":"white",d=c==="white"?0:7;if("a"<=s&&s<="h")r=r.with(Cr(s.charCodeAt(0)-97,d));else if(s==="k"||s==="q"){const h=e[c].intersect(k.backrank(c)).intersect(e.rook.union(e.king)),m=s==="k"?h.last():h.first();r=r.with(N(m)&&e.rook.has(m)?m:Cr(s==="k"?7:0,d))}else return L.err(new he(ae.Castling))}return rt.some(i=>k.backrank(i).intersect(r).size()>2)?L.err(new he(ae.Castling)):L.ok(r)},Un=e=>{const t=e.split("+");if(t.length===3&&t[0]===""){const r=gt(t[1]),i=gt(t[2]);return!N(r)||r>3||!N(i)||i>3?L.err(new he(ae.RemainingChecks)):L.ok(new Ut(3-r,3-i))}else if(t.length===2){const r=gt(t[0]),i=gt(t[1]);return!N(r)||r>3||!N(i)||i>3?L.err(new he(ae.RemainingChecks)):L.ok(new Ut(r,i))}else return L.err(new he(ae.RemainingChecks))},yl=e=>{const t=e.split(/[\s_]+/),r=t.shift();let i,s=L.ok(void 0);if(r.endsWith("]")){const h=r.indexOf("[");if(h===-1)return L.err(new he(ae.Fen));i=gr(r.slice(0,h)),s=In(r.slice(h+1,-1))}else{const h=bl(r,"/",7);h===-1?i=gr(r):(i=gr(r.slice(0,h)),s=In(r.slice(h+1)))}let c;const d=t.shift();if(!N(d)||d==="w")c="white";else if(d==="b")c="black";else return L.err(new he(ae.Turn));return i.chain(h=>{const m=t.shift(),g=N(m)?kl(h,m):L.ok(k.empty()),b=t.shift();let w;if(N(b)&&b!=="-"&&(w=Kt(b),!N(w)))return L.err(new he(ae.EpSquare));let P=t.shift(),M;N(P)&&P.includes("+")&&(M=Un(P),P=t.shift());const y=N(P)?gt(P):0;if(!N(y))return L.err(new he(ae.Halfmoves));const E=t.shift(),R=N(E)?gt(E):1;if(!N(R))return L.err(new he(ae.Fullmoves));const T=t.shift();let C=L.ok(void 0);if(N(T)){if(N(M))return L.err(new he(ae.RemainingChecks));C=Un(T)}else N(M)&&(C=M);return t.length>0?L.err(new he(ae.Fen)):s.chain(U=>g.chain(re=>C.map(x=>({board:h,pockets:U,turn:c,castlingRights:re,remainingChecks:x,epSquare:w,halfmoves:y,fullmoves:Math.max(1,R)}))))})},El=e=>{let t=Rt(e.role);return e.color==="white"&&(t=t.toUpperCase()),e.promoted&&(t+="~"),t},Sl=e=>{let t="",r=0;for(let i=7;i>=0;i--)for(let s=0;s<8;s++){const c=s+i*8,d=e.get(c);d?(r>0&&(t+=r,r=0),t+=El(d)):r++,s===7&&(r>0&&(t+=r,r=0),i!==0&&(t+="/"))}return t},zn=e=>Pe.map(t=>Rt(t).repeat(e[t])).join(""),Cl=e=>zn(e.white).toUpperCase()+zn(e.black),Pl=(e,t)=>{let r="";for(const i of rt){const s=k.backrank(i);let c=e.kingOf(i);N(c)&&!s.has(c)&&(c=void 0);const d=e.pieces(i,"rook").intersect(s);for(const h of t.intersect(s).reversed())if(h===d.first()&&N(c)&&h<c)r+=i==="white"?"Q":"q";else if(h===d.last()&&N(c)&&c<h)r+=i==="white"?"K":"k";else{const m=er[be(h)];r+=i==="white"?m.toUpperCase():m}}return r||"-"},Tl=e=>`${e.white}+${e.black}`,Al=(e,t)=>[Sl(e.board)+(e.pockets?`[${Cl(e.pockets)}]`:""),e.turn[0],Pl(e.board,e.castlingRights),N(e.epSquare)?Dt(e.epSquare):"-",...e.remainingChecks?[Tl(e.remainingChecks)]:[],Math.max(0,Math.min(e.halfmoves,9999)),Math.max(1,Math.min(e.fullmoves,9999))].join(" "),Ml=(e,t)=>{let r="";if(tr(t))t.role!=="pawn"&&(r=Rt(t.role).toUpperCase()),r+="@"+Dt(t.to);else{const i=e.board.getRole(t.from);if(!i)return"--";if(i==="king"&&(e.board[e.turn].has(t.to)||Math.abs(t.to-t.from)===2))r=t.to>t.from?"O-O":"O-O-O";else{const s=e.board.occupied.has(t.to)||i==="pawn"&&be(t.from)!==be(t.to);if(i!=="pawn"){r=Rt(i).toUpperCase();let c;if(i==="king"?c=qr(t.to).intersect(e.board.king):i==="queen"?c=Ri(t.to,e.board.occupied).intersect(e.board.queen):i==="rook"?c=$t(t.to,e.board.occupied).intersect(e.board.rook):i==="bishop"?c=Lt(t.to,e.board.occupied).intersect(e.board.bishop):c=Yr(t.to).intersect(e.board.knight),c=c.intersect(e.board[e.turn]).without(t.from),c.nonEmpty()){const d=e.ctx();for(const h of c)e.dests(h,d).has(t.to)||(c=c.without(h));if(c.nonEmpty()){let h=!1,m=c.intersects(k.fromRank(nt(t.from)));c.intersects(k.fromFile(be(t.from)))?h=!0:m=!0,m&&(r+=er[be(t.from)]),h&&(r+=Oi[nt(t.from)])}}}else s&&(r=er[be(t.from)]);s&&(r+="x"),r+=Dt(t.to),t.promotion&&(r+="="+Rt(t.promotion).toUpperCase())}}return r},Ol=(e,t)=>{var r;const i=Ml(e,t);return e.play(t),!((r=e.outcome())===null||r===void 0)&&r.winner?i+"#":e.isCheck()?i+"+":i},Rl=(e,t)=>Ol(e.clone(),t),Qr=e=>e.split(" ").slice(0,-1).join(" "),Jr=e=>Ni.fromSetup(yl(e).unwrap()).unwrap(),$i=e=>Jr(e).turn;function Fl(e,t=Xr){let r=[],i=Jr(t),s;for(let c of e){let d=nl(c),h=Rl(i,d);i.play(d);let m=Al(i.toSetup()),g=s?`${s.path} ${c}`:`${c}`,b=s?s.ply+1:1,w=s?.fen??t,P=s?.uci;s={path:g,ply:b,before_fen:w,fen:m,before_uci:P,uci:c,san:h},r.push(s)}return r}function xl(e){let t=0;return r=>{t+=r.deltaY*(r.deltaMode?40:1),Math.abs(t)>=4?(e(r,!0),t=0):e(r,!1)}}var Nl=ue('<div class="is2d chessboard"> ');function Dl(e){let t,r,i=W(()=>{try{return Jr(e.fen)}catch{return Ni.default()}}),s=W(()=>vl(i())),c=W(()=>i().isCheck());return Bn(()=>{let d=e.color,h=i().isCheck(),m={fen:e.fen,check:h,premovable:{enabled:!1},movable:{color:d,free:!1,dests:s(),events:{after:e.play_orig_key}}};r=el(t,m)}),Vt(()=>{let d;if(e.last_move){let[h]=e.last_move;d=[h.slice(0,2),h.slice(2,4)]}r.set({lastMove:d,fen:e.fen,turnColor:$i(e.fen),orientation:e.orientation??"white",check:c(),movable:{color:e.movable?e.color:void 0,dests:s()}})}),Vt(()=>{r.setAutoShapes(e.shapes??[])}),(()=>{var d=Nl();return jn(h=>t=h,d),d})()}const Ll=e=>({handleEvent:$l(e),passive:!1}),$l=e=>xl(t=>{const r=t.target;r.tagName!=="PIECE"&&r.tagName!=="SQUARE"&&r.tagName!=="CG-BOARD"||(t.preventDefault(),e(Math.sign(t.deltaY)))});function Ii(e,t={}){const r=t.storage||globalThis.localStorage,i=t.name||`storage-${ns()}`;if(!r)return[e[0],e[1],null];const s=t.storageOptions,c=t.serialize||JSON.stringify.bind(JSON),d=t.deserialize||JSON.parse.bind(JSON),h=r.getItem(i,s),m=typeof e[0]=="function"?b=>{try{const w=d(b);e[1](()=>w)}catch{}}:b=>{try{const w=d(b);e[1](is(w))}catch{}};let g=!0;if(h instanceof Promise?h.then(b=>g&&b&&m(b)):h&&m(h),typeof t.sync?.[0]=="function"){const b=typeof e[0]=="function"?e[0]:()=>e[0];t.sync[0](w=>{w.key!==i||(w.url||globalThis.location.href)!==globalThis.location.href||w.newValue===c(kn(b))||m(w.newValue)})}return[e[0],typeof e[0]=="function"?b=>{const w=e[1](b),P=b!=null?c(w):b;return t.sync?.[1](i,P),P!=null?r.setItem(i,P,s):r.removeItem(i,s),g=!1,w}:(...b)=>{e[1](...b);const w=c(kn(()=>e[0]));t.sync?.[1](i,w),r.setItem(i,w,s),g=!1},h]}var Il=ue('<div class=replay-tree><div class=moves-wrap><div class=moves></div></div><div class=replay-jump><button title=first class="fbt first"data-icon=></button><button title=previous class="fbt prev"data-icon=></button><button title=next class="fbt next"data-icon=></button><button title=last class="fbt last"data-icon=>'),Ul=ue('<div class=branch-sums><button title=up class="fbt up"data-icon=></button><button title=down class="fbt down"data-icon=>'),Ui=ue("<span class=index>"),zl=ue("<div class=fbt>"),Bl=ue("<div class=lines>"),jl=ue("<div class=line>"),Wl=ue("<span class=collapsed>..<!> "),Hl=ue("<div class=move>"),Gl=ue("<span class=nag>");function Kl(e){return zi(e.steps_tree,e.cursor_path)}function Vl(e,t){return se(e,Qr(t))}function zi(e,t){let r=[],i=mt(e),s=i.length>1;if(t==="")return i;for(let c of t.split(" ")){let d=i.find(m=>m.step.uci===c);if(!d)return;s&&(r.push(d),s=!1);let h=se(e,d.step.path);h.length>1&&(s=!0),i=h}return r}function mt(e){return se(e,"")}function ht(e,t){let r=De(e,t);return r?[De(e,Qr(t)),r]:void 0}function De(e,t){if(t==="")return;let r=Qr(t),i=e.flat_nodes[r];if(i===void 0){console.log(t,r,os(e.flat_nodes));debugger}return i.find(c=>c.step.path===t)}function se(e,t){return e.flat_nodes[t]??[]}function ql(e,t){let r=se(e,t.step.path);if(r.length>1)return 1;if(r.length===0)return 0;let i=1,s=r[0];for(;se(e,s.step.path).length===1;)i++,s=se(e,s.step.path)[0];return i}function Yl(e,t){return Xl(e,t)?.length??0}const Xl=(e,t)=>{let r=Bi(e,t);return r?se(e,r.step.path):void 0},Bi=(e,t)=>{let r=se(e,t.step.path);if(r.length!==0)return r.length===1?Bi(e,r[0]):t};function ji(e){const t=W(()=>e.replay_tree.cursor_path),r=W(()=>e.replay_tree.steps_tree),i=W(()=>De(r(),"")?.step.fen??r().initial_fen??Xr),s=W(()=>De(r(),t())?.step.fen??i()),c=W(()=>{let y=De(r(),t())?.step;if(y)return[y.uci,y.san]});let d=[];Vt(as(t,y=>{zi(r(),y)?.map(E=>{d.includes(E.step.path)||(Vl(r(),E.step.path)?.forEach(R=>{d=d.filter(T=>T!==R.step.path)}),d.push(E.step.path))})}));const h=W(()=>{let y=t();if(y!=="")return y.split(" ").slice(0,-1).join(" ")}),m=W(()=>{let y=t(),E=se(r(),y);return E.length===1?E[0].step.path:E.find(R=>d.includes(R.step.path))?.step.path??E[0]?.step.path}),g=W(()=>{let y=ht(r(),t());if(!y)return;let E=y;if(!E[0])return"";if(se(r(),E[0].step.path).length>1)return E[0].step.path;for(;!(!E[0]||se(r(),E[0].step.path).length>1);){let R=ht(r(),E[0].step.path);if(!R)break;E=R}return E[1].step.path}),b=W(()=>{let y=De(r(),t());if(!y){let T=mt(r());return(T.find(C=>d.includes(C.step.path))??T[0])?.step.path}let E=y,R=se(r(),E.step.path);if(R.length>1)return R.find(T=>d.includes(T.step.path))?.step.path??R[0]?.step.path;for(;R.length===1;)E=R[0],R=se(r(),E.step.path);return E.step.path}),w=W(()=>{let y=ht(r(),t());if(!y)return;let E=y[0]?se(r(),y[0].step.path):[];if(!y[0])E=mt(r());else if(se(r(),y[0].step.path).length===1)for(;;){if(y=ht(r(),y[0].step.path),!y)return;if(!y[0]){E=mt(r());break}if(se(r(),y[0].step.path).length>1){E=se(r(),y[0].step.path);break}}let R=E.indexOf(y[1]),T=E[R-1];if(T)return T.step.path}),P=W(()=>{let y=ht(r(),t());if(!y)return;let E=y[0]?se(r(),y[0].step.path):[];if(!y[0])E=mt(r());else if(se(r(),y[0].step.path).length===1)for(;;){if(y=ht(r(),y[0].step.path),!y)return;if(!y[0]){E=mt(r());break}if(se(r(),y[0].step.path).length>1){E=se(r(),y[0].step.path);break}}let R=E.indexOf(y[1]),T=E[R+1];if(T)return T.step.path}),M=W(()=>De(e.replay_tree.steps_tree,t()));return{get initial_fen(){return i()},get fen(){return s()},get turn(){return $i(s())},get last_move(){return c()},get step_at_cursor_path(){return M()},get cursor_path(){return t()},get get_prev_path(){return h()},get get_next_path(){return m()},get get_first_path(){return g()},get get_last_path(){return b()},get get_down_path(){return P()},get get_up_path(){return w()}}}const Ql=e=>{let t=ji(e);const r=b=>{e.handle_goto_path(b)},i=b=>{e.handle_goto_path(b)},s=b=>{r(b)},c=(b,w)=>{e.on_context_menu?.(b,w)};let d;Vt(()=>{let b=e.replay_tree.cursor_path,w=d.parentElement;if(!w)return;const P=d.querySelector(".on-path-end");if(!P){w.scrollTop=b.length>0?99999:0;return}let M=P.offsetTop-w.offsetHeight/2+P.offsetHeight;w.scrollTo({behavior:"smooth",top:M})});const h=b=>{if(e.lose_focus)return;let w=!1;b.key==="ArrowLeft"&&(i(t.get_prev_path),w=!0),b.key==="ArrowRight"&&(i(t.get_next_path),w=!0),b.key==="ArrowUp"&&(i(t.get_up_path),w=!0),b.key==="ArrowDown"&&(i(t.get_down_path),w=!0),w&&b.preventDefault()};Bn(()=>{document.addEventListener("keydown",h),ls(()=>{document.removeEventListener("keydown",h)})});const m=yn(()=>e.features),g=yn(()=>e.feature_content);return(()=>{var b=Il(),w=b.firstChild,P=w.firstChild,M=w.nextSibling,y=M.firstChild,E=y.nextSibling,R=E.nextSibling,T=R.nextSibling;return jn(C=>d=C,P),H(P,Z(xr,pt({get replay_tree(){return e.replay_tree}},t,{on_set_cursor:s,on_context_menu:c,path:""}))),H(b,Z(Re,{get when(){return g()},get fallback(){return(()=>{var C=Ul(),U=C.firstChild,re=U.nextSibling;return U.$$click=()=>i(t.get_up_path),re.$$click=()=>i(t.get_down_path),H(C,Z(Ft,{get each(){return Kl(e.replay_tree)},children:x=>(()=>{var ne=zl();return ne.$$click=()=>r(x.step.path),H(ne,Z(Re,{get when(){return x.step.ply&1},get children(){var $=Ui();return H($,()=>Hi(x.step.ply)),$}}),null),H(ne,()=>x.step.san,null),ne})()}),null),Be(x=>{var ne=t.get_up_path===void 0,$=t.get_up_path===void 0,I=t.get_down_path===void 0,O=t.get_down_path===void 0;return ne!==x.e&&(U.disabled=x.e=ne),$!==x.t&&U.classList.toggle("disabled",x.t=$),I!==x.a&&(re.disabled=x.a=I),O!==x.o&&re.classList.toggle("disabled",x.o=O),x},{e:void 0,t:void 0,a:void 0,o:void 0}),C})()},children:C=>C()}),M),H(M,Z(Re,{get when(){return m()},children:C=>C()}),y),y.$$click=()=>i(t.get_first_path),E.$$click=()=>i(t.get_prev_path),R.$$click=()=>i(t.get_next_path),T.$$click=()=>i(t.get_last_path),Be(C=>{var U=t.get_first_path===void 0,re=t.get_first_path===void 0,x=t.get_prev_path===void 0,ne=t.get_prev_path===void 0,$=t.get_next_path===void 0,I=t.get_next_path===void 0,O=t.get_last_path===void 0,Q=t.get_last_path===void 0;return U!==C.e&&(y.disabled=C.e=U),re!==C.t&&y.classList.toggle("disabled",C.t=re),x!==C.a&&(E.disabled=C.a=x),ne!==C.o&&E.classList.toggle("disabled",C.o=ne),$!==C.i&&(R.disabled=C.i=$),I!==C.n&&R.classList.toggle("disabled",C.n=I),O!==C.s&&(T.disabled=C.s=O),Q!==C.h&&T.classList.toggle("disabled",C.h=Q),C},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),b})()};function xr(e){const t=W(()=>e.replay_tree.steps_tree.flat_nodes[e.path]??[]);return[Z(Re,{get when(){return t().length===1},get children(){return[Z(vr,pt(e,{get cursor_path(){return e.replay_tree.cursor_path},get node(){return t()[0]}})),Z(xr,pt(e,{get path(){return t()[0].step.path}}))]}}),Z(Re,{get when(){return t().length>1},get children(){var r=Bl();return H(r,Z(Ft,{get each(){return t()},children:i=>(()=>{var s=jl();return H(s,Z(Re,{get when(){return e.replay_tree.cursor_path.startsWith(i.step.path)},get fallback(){return[Z(vr,pt(e,{get cursor_path(){return e.replay_tree.cursor_path},node:i,show_index:!0,collapsed:!0})),Z(Jl,{node:i,get replay_tree(){return e.replay_tree}})]},get children(){return[Z(vr,pt(e,{get cursor_path(){return e.replay_tree.cursor_path},node:i,show_index:!0})),Z(xr,pt(e,{get path(){return i.step.path}}))]}})),s})()})),r}})]}function Jl(e){return(()=>{var t=Wl(),r=t.firstChild,i=r.nextSibling;return i.nextSibling,H(t,()=>ql(e.replay_tree.steps_tree,e.node),i),H(t,()=>Yl(e.replay_tree.steps_tree,e.node),null),t})()}function vr(e){const t=W(()=>e.node.step);let r=W(()=>t().ply%2===1||e.show_index);const i=W(()=>t().path),s=W(()=>e.cursor_path.startsWith(i())),c=W(()=>i()===e.cursor_path),d=W(()=>({collapsed:e.collapsed,"on-path":s(),"on-path-end":c(),[Zl[e.node.nags?.[0]??0]]:e.node.nags!==void 0}));return(()=>{var h=Hl();return h.$$click=()=>{e.on_set_cursor(t().path)},h.$$contextmenu=m=>{m.preventDefault(),e.on_context_menu(m,t().path)},H(h,Z(Re,{get when(){return r()},get children(){var m=Ui();return H(m,()=>Hi(t().ply)),m}}),null),H(h,()=>t().san,null),H(h,Z(Re,{get when(){return e.node.nags},children:m=>Z(ec,{get nags(){return m()}})}),null),Be(m=>ss(h,d(),m)),h})()}let Wi=["","!","?","!!","??","!?","?!"];Wi[22]="⨀";let Zl=["","good","mistake","top","blunder","interesting","inaccuracy"];const ec=e=>[" ",(()=>{var t=Gl();return H(t,()=>Wi[e.nags[0]]),t})()," "],Hi=e=>`${Math.ceil(e/2)}.`+(e%2===0?"..":"");Wn(["click","contextmenu"]);const tc=(e,t,r)=>Ii(Hn(e),{name:`.tactics-filter.v0.${t}`});class Zr{static create=t=>new Zr(t);get id(){return this.puzzle.id}get fen(){return this.puzzle.fen}get tags(){return this.puzzle.tags}_has_tags;get has_tags(){return this._has_tags||(this._has_tags=Zn(this.puzzle)),this._has_tags}_all_tags;get all_tags(){return this._all_tags||(this._all_tags=Lr(this.puzzle)),this._all_tags}constructor(t){this.puzzle=t}puzzle}var rc=ue('<main class=tactics-filter><div class=code-wrap></div><div class=list-wrap><div class=filter><input type=text placeholder="Filter1: y_filter _!_ n_filter"><input type=text placeholder="Filter2: y_filter _!_ n_filter"></div><div class=stats><span>/10000 Positions</span></div></div><div class=board-wrap></div><div class=replay-wrap><div class=tools><button>Copy FEN</button><button>Copy Puzzle ID'),nc=ue("<div class=progress> <!>/<!> "),ic=ue("<div class=codebox><div class=rule-list><div class=scroll-wrap></div><div class=tools><div class=rule>+ New rule</div><div class=rule>- Delete rule</div></div></div><div class=text-wrap><textarea class=editor-input title=rules rows=13 cols=21></textarea><div class=ascii><textarea>"),oc=ue("<div><span class=name></span><span class=stats>f <!> / s "),sc=ue("<span>"),ac=ue("<div class=tactics-list><div class=list>"),lc=ue("<div class=item><a class=id target=_blank></a><div class=tags></div><div class=tags2>"),cc=ue("<span class=tag>");function pc(){const e=Nr(),t=W(()=>e.puzzles??[]),[r,i]=Ii(En({filter1:"",filter2:"",puzzle_id:""})),s=W(()=>Cn(r.filter1)),c=W(()=>Cn(r.filter2)),d=W(()=>t().filter(s()).filter(c())),h=W(()=>d().find(O=>O.id===r.puzzle_id)),m=O=>{O!==void 0&&M("cursor_path",O)},g=W(()=>{let O=h();return O?Fl(O.moves.split(" "),O.fen):[]}),b=W(()=>{let O=g(),Q={},S="";for(let G of O)Q[S]||(Q[S]=[]),Q[S].push({step:G}),S=G.path;return Q}),w=W(()=>({flat_nodes:b()})),[P,M]=En({get steps_tree(){return w()},cursor_path:""}),y=()=>"white",E=()=>De(P.steps_tree,P.cursor_path)?.step.fen??h()?.fen??Xr,R=()=>{let O=De(P.steps_tree,P.cursor_path);if(O)return[O.step.uci,O.step.san]},T=O=>{O!==void 0&&M("cursor_path",O)};let C=ji({replay_tree:P});const U=O=>{O>0?T(C.get_next_path):T(C.get_prev_path)},re=O=>{Ot(()=>{M("cursor_path",""),i("puzzle_id",O.id)}),setTimeout(()=>{console.log("going path",C.get_next_path),T(C.get_next_path)},200)},x=()=>{navigator.clipboard.writeText(E())},ne=()=>{let O=h()?.id;O&&navigator.clipboard.writeText(O)},$=O=>{Ot(()=>{M("cursor_path",""),i("filter1",O)})},I=O=>{Ot(()=>{M("cursor_path",""),i("filter2",O)})};return(()=>{var O=rc(),Q=O.firstChild,S=Q.nextSibling,G=S.firstChild,pe=G.firstChild,Te=pe.nextSibling,J=G.nextSibling,K=J.firstChild,$e=K.firstChild,Ge=S.nextSibling,_t=Ge.nextSibling,ir=_t.firstChild,st=ir.firstChild,Bt=st.nextSibling;return H(Q,Z(dc,{get fen(){return E()}})),pe.$$input=at=>$(at.target.value),_r(pe,"spellcheck",!1),Te.$$input=at=>I(at.target.value),_r(Te,"spellcheck",!1),H(K,()=>d().length,$e),H(S,Z(fc,{get tactics(){return d().slice(0,1e3)},get selected_id(){return h()?.id},on_selected:re}),null),cs(Ge,"wheel",Ll(U)),H(Ge,Z(Dl,{get color(){return y()},get fen(){return E()},get last_move(){return R()}})),st.$$click=x,Bt.$$click=ne,H(_t,Z(Ql,{handle_goto_path:m,lose_focus:!0,replay_tree:P}),null),H(O,Z(uc,{}),null),Be(()=>pe.value=r.filter1),Be(()=>Te.value=r.filter2),O})()}const uc=()=>{const e=Nr();return Z(Re,{get when(){return e.progress},children:t=>(()=>{var r=nc(),i=r.firstChild,s=i.nextSibling,c=s.nextSibling,d=c.nextSibling;return d.nextSibling,H(r,()=>t()[0],s),H(r,()=>t()[1],d),r})()})};function dc(e){let t=Nr();const r=W(us(()=>t.all,Zr.create)),i=T=>r().filter(C=>C.all_tags[`failed_${T}`]).length,s=T=>r().filter(C=>C.all_tags[`solved_${T}`]).length;function c(){let T=1,C=`rule${T}`,U=d();for(;U.find(re=>re.name===C);)C=`rule${T++}`;return{name:C,rule:"",z:U.length}}const[d,h]=tc([{name:"rule1",rule:"",z:0}],"rule-list"),[m,g]=Hn(0);t.rules(d());const b=W(()=>d()[m()]),w=T=>{if(T.key==="Escape"){let C=T.target.value,U=b(),re={name:U.name,rule:C,z:U.z},x=d(),ne=x.findIndex($=>$.name===U.name);x.splice(ne,1,re),h([...x]),t.rules([re])}},P=()=>{Ot(()=>{h([c(),...d()]),g(0)})},M=()=>{let T=d();if(T.length===1)return;let C=T.splice(m(),1);Ot(()=>{h([...T]),m()===T.length&&g(T.length-1)}),t.rules(C.map(U=>({name:U.name,rule:"",z:-1})))};let y=ds(()=>Dr.make(()=>Ls)),E=W(()=>{const T=y();let C=b().rule;if(e.fen&&T){Sn(T);try{return xs(C,e.fen)}catch(U){return`${U}`}}});const R=W(()=>{let T=b();if(!T||!T.rule||!e.fen)return;let C=y();if(C)return Sn(C),Xn(T.rule,e.fen)});return(()=>{var T=ic(),C=T.firstChild,U=C.firstChild,re=U.nextSibling,x=re.firstChild,ne=x.nextSibling,$=C.nextSibling,I=$.firstChild,O=I.nextSibling,Q=O.firstChild;return H(U,Z(Ft,{get each(){return d()},children:(S,G)=>(()=>{var pe=oc(),Te=pe.firstChild,J=Te.nextSibling,K=J.firstChild,$e=K.nextSibling;return $e.nextSibling,pe.$$click=()=>g(G()),H(Te,()=>S.name),H(J,()=>i(S.name),$e),H(J,()=>s(S.name),null),Be(()=>fs(pe,"rule"+(G()===m()?" active":""))),pe})()})),x.$$click=P,ne.$$click=M,I.$$keydown=w,Q.disabled=!0,H(Q,R),H(O,Z(Re,{get when(){return E()},children:S=>(()=>{var G=sc();return H(G,S),G})()}),null),Be(()=>I.value=b()?.rule??"Select a rule"),T})()}function fc(e){const t=W(()=>e.tactics),r=hs(()=>e.selected_id);return(()=>{var i=ac(),s=i.firstChild;return H(s,Z(Ft,{get each(){return t()},children:c=>(()=>{var d=lc(),h=d.firstChild,m=h.nextSibling,g=m.nextSibling;return d.$$click=()=>e.on_selected(c),H(h,()=>c.id),H(g,Z(Ft,{get each(){return Object.keys(Lr(c))},children:b=>(()=>{var w=cc();return H(w,b),w})()})),Be(b=>{var w=!!r(c.id),P=c.link;return w!==b.e&&d.classList.toggle("active",b.e=w),P!==b.t&&_r(h,"href",b.t=P),b},{e:void 0,t:void 0}),d})()})),i})()}Wn(["input","click","keydown"]);export{pc as default};
