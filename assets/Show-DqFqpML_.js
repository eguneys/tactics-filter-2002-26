const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-Bd10sASY.js","./index-ArAQ9-7r.css"])))=>i.map(i=>d[i]);
import{s as Mt,r as wn,k as Vo,q as qo,a as Yo,b as Xo,c as Qo,S as De,d as bn,F as kn,R as Jo,m as Zo,_ as es,C as ts,p as rs,e as ns,f as is,g as R,h as os,i as re,j as Je,l as H,o as Wn,n as Yt,t as de,u as Hn,v as ss,w as yn,x as as,y as En,z as G,A as J,B as pt,D as xt,E as Fe,G as Be,H as ls,I as cs,J as us,K as Gn,L as Kn,M as Lr,N as Sn,O as br,P as ds,Q as Xt,T as fs,U as hs,V as ps,W as ms,X as Cn}from"./index-Bd10sASY.js";const gs=(e,t)=>{let r="";{const i=e.board.getRole(t.from);if(!i)return"--";if(i==="king"&&(e.board[e.turn].has(t.to)||Math.abs(t.to-t.from)===2))r=t.to>t.from?"O-O":"O-O-O";else{const s=e.board.occupied.has(t.to)||i==="pawn"&&Mt(t.from)!==Mt(t.to);if(i!=="pawn"){r=wn(i).toUpperCase();let l;if(i==="king"?l=Vo(t.to).intersect(e.board.king):i==="queen"?l=qo(t.to,e.board.occupied).intersect(e.board.queen):i==="rook"?l=Yo(t.to,e.board.occupied).intersect(e.board.rook):i==="bishop"?l=Xo(t.to,e.board.occupied).intersect(e.board.bishop):l=Qo(t.to).intersect(e.board.knight),l=l.intersect(e.board[e.turn]).without(t.from),l.nonEmpty()){const d=e.ctx();for(const f of l)e.dests(f,d).has(t.to)||(l=l.without(f));if(l.nonEmpty()){let f=!1,g=l.intersects(De.fromRank(bn(t.from)));l.intersects(De.fromFile(Mt(t.from)))?f=!0:g=!0,g&&(r+=kn[Mt(t.from)]),f&&(r+=Jo[bn(t.from)])}}}else s&&(r=kn[Mt(t.from)]);s&&(r+="x"),r+=Zo(t.to),t.promotion&&(r+="="+wn(t.promotion).toUpperCase())}}return r},vs=(e,t)=>{const r=gs(e,t);return e.play(t),e.outcome()?.winner?r+"#":e.isCheck()?r+"+":r},kr=(e,t)=>vs(e.clone(),t);var _s=(()=>{var e=import.meta.url;return async function(t={}){var r,i=t,s,l,d=new Promise((n,o)=>{s=n,l=o});["_get_attacks","_get_occupied","_get_pieces_color_bb","_get_fen","_get_pieces_bb","_get_turn","_is_checkmate","_pos_attacks_to","_pos_attacks","_get_at","_create_position","_delete_position","_make_move","_unmake_move","_get_legal_moves","_free_legal_moves","_init","_malloc","_free","setValue","getValue","stringToUTF8","UTF8ToString","_memory","___indirect_function_table","onRuntimeInitialized"].forEach(n=>{Object.getOwnPropertyDescriptor(d,n)||Object.defineProperty(d,n,{get:()=>ie("You are getting "+n+" on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js"),set:()=>ie("You are setting "+n+" on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")})});var f=typeof window=="object",g=typeof WorkerGlobalScope<"u",p=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string"&&process.type!="renderer",_=!f&&!p&&!g;if(p){const{createRequire:n}=await es(async()=>{const{createRequire:a}=await import("./index-Bd10sASY.js").then(u=>u.Y);return{createRequire:a}},__vite__mapDeps([0,1]),import.meta.url);let o=import.meta.url;o.startsWith("data:")&&(o="/");var w=n(o)}var C=Object.assign({},i),P="./this.program",k="";function E(n){return i.locateFile?i.locateFile(n,k):k+n}var F,A;if(p){if(typeof process>"u"||!process.release||process.release.name!=="node")throw new Error("not compiled for this environment (did you build to HTML and try to run it not on the web, or set ENVIRONMENT to something - like node - and run it someplace else - like on the web?)");var T=process.versions.node,I=T.split(".").slice(0,3);if(I=I[0]*1e4+I[1]*100+I[2].split("-")[0]*1,I<16e4)throw new Error("This emscripten-generated code requires node v16.0.0 (detected v"+T+")");var te=w("fs"),N=w("path");import.meta.url.startsWith("data:")||(k=N.dirname(w("url").fileURLToPath(import.meta.url))+"/"),A=n=>{n=yt(n)?new URL(n):N.normalize(n);var o=te.readFileSync(n);return S(o.buffer),o},F=(n,o=!0)=>(n=yt(n)?new URL(n):N.normalize(n),new Promise((a,u)=>{te.readFile(n,o?void 0:"utf8",(h,m)=>{h?u(h):a(o?m.buffer:m)})})),!i.thisProgram&&process.argv.length>1&&(P=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2)}else if(_){if(typeof process=="object"&&typeof w=="function"||typeof window=="object"||typeof WorkerGlobalScope<"u")throw new Error("not compiled for this environment (did you build to HTML and try to run it not on the web, or set ENVIRONMENT to something - like node - and run it someplace else - like on the web?)")}else if(f||g){if(g?k=self.location.href:typeof document<"u"&&document.currentScript&&(k=document.currentScript.src),e&&(k=e),k.startsWith("blob:")?k="":k=k.substr(0,k.replace(/[?#].*/,"").lastIndexOf("/")+1),!(typeof window=="object"||typeof WorkerGlobalScope<"u"))throw new Error("not compiled for this environment (did you build to HTML and try to run it not on the web, or set ENVIRONMENT to something - like node - and run it someplace else - like on the web?)");g&&(A=n=>{var o=new XMLHttpRequest;return o.open("GET",n,!1),o.responseType="arraybuffer",o.send(null),new Uint8Array(o.response)}),F=n=>yt(n)?new Promise((o,a)=>{var u=new XMLHttpRequest;u.open("GET",n,!0),u.responseType="arraybuffer",u.onload=()=>{if(u.status==200||u.status==0&&u.response){o(u.response);return}a(u.status)},u.onerror=a,u.send(null)}):fetch(n,{credentials:"same-origin"}).then(o=>o.ok?o.arrayBuffer():Promise.reject(new Error(o.status+" : "+o.url)))}else throw new Error("environment detection error");var ne=i.print||console.log.bind(console),U=i.printErr||console.error.bind(console);Object.assign(i,C),C=null,Bo(),i.arguments&&i.arguments,Ve("arguments","arguments_"),i.thisProgram&&(P=i.thisProgram),Ve("thisProgram","thisProgram"),S(typeof i.memoryInitializerPrefixURL>"u","Module.memoryInitializerPrefixURL option was removed, use Module.locateFile instead"),S(typeof i.pthreadMainPrefixURL>"u","Module.pthreadMainPrefixURL option was removed, use Module.locateFile instead"),S(typeof i.cdInitializerPrefixURL>"u","Module.cdInitializerPrefixURL option was removed, use Module.locateFile instead"),S(typeof i.filePackagePrefixURL>"u","Module.filePackagePrefixURL option was removed, use Module.locateFile instead"),S(typeof i.read>"u","Module.read option was removed"),S(typeof i.readAsync>"u","Module.readAsync option was removed (modify readAsync in JS)"),S(typeof i.readBinary>"u","Module.readBinary option was removed (modify readBinary in JS)"),S(typeof i.setWindowTitle>"u","Module.setWindowTitle option was removed (modify emscripten_set_window_title in JS)"),S(typeof i.TOTAL_MEMORY>"u","Module.TOTAL_MEMORY has been renamed Module.INITIAL_MEMORY"),Ve("asm","wasmExports"),Ve("readAsync","readAsync"),Ve("readBinary","readBinary"),Ve("setWindowTitle","setWindowTitle"),S(!_,"shell environment detected but not enabled at build time.  Add `shell` to `-sENVIRONMENT` to enable.");var z=i.wasmBinary;Ve("wasmBinary","wasmBinary"),typeof WebAssembly!="object"&&U("no native wasm support detected");var se,O=!1;function S(n,o){n||ie("Assertion failed"+(o?": "+o:""))}var B,fe,Ce,Y,q,xe,_t;function st(){var n=se.buffer;i.HEAP8=B=new Int8Array(n),i.HEAP16=Ce=new Int16Array(n),i.HEAPU8=fe=new Uint8Array(n),i.HEAPU16=new Uint16Array(n),i.HEAP32=Y=new Int32Array(n),i.HEAPU32=q=new Uint32Array(n),i.HEAPF32=xe=new Float32Array(n),i.HEAPF64=_t=new Float64Array(n)}S(!i.STACK_SIZE,"STACK_SIZE can no longer be set at runtime.  Use -sSTACK_SIZE at link time"),S(typeof Int32Array<"u"&&typeof Float64Array<"u"&&Int32Array.prototype.subarray!=null&&Int32Array.prototype.set!=null,"JS engine does not provide full typed array support"),S(!i.wasmMemory,"Use of `wasmMemory` detected.  Use -sIMPORTED_MEMORY to define wasmMemory externally"),S(!i.INITIAL_MEMORY,"Detected runtime INITIAL_MEMORY setting.  Use -sIMPORTED_MEMORY to define wasmMemory dynamically");function jt(){var n=hr();S((n&3)==0),n==0&&(n+=4),q[n>>2]=34821223,q[n+4>>2]=2310721022,q[0]=1668509029}function wt(){if(!O){var n=hr();n==0&&(n+=4);var o=q[n>>2],a=q[n+4>>2];(o!=34821223||a!=2310721022)&&ie(`Stack overflow! Stack cookie has been overwritten at ${St(n)}, expected hex dwords 0x89BACDFE and 0x2135467, but received ${St(a)} ${St(o)}`),q[0]!=1668509029&&ie("Runtime error: The application has corrupted its heap memory area (address zero)!")}}var bt=[],Wt=[],at=[],Ht=!1;function qi(){if(i.preRun)for(typeof i.preRun=="function"&&(i.preRun=[i.preRun]);i.preRun.length;)Qi(i.preRun.shift());lr(bt)}function Yi(){S(!Ht),Ht=!0,wt(),!i.noFSInit&&!c.initialized&&c.init(),c.ignorePermissions=!1,lr(Wt)}function Xi(){if(wt(),i.postRun)for(typeof i.postRun=="function"&&(i.postRun=[i.postRun]);i.postRun.length;)Zi(i.postRun.shift());lr(at)}function Qi(n){bt.unshift(n)}function Ji(n){Wt.unshift(n)}function Zi(n){at.unshift(n)}S(Math.imul,"This browser does not support Math.imul(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),S(Math.fround,"This browser does not support Math.fround(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),S(Math.clz32,"This browser does not support Math.clz32(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),S(Math.trunc,"This browser does not support Math.trunc(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill");var Ge=0,Ke=null,kt=null,lt={};function rn(n){for(var o=n;;){if(!lt[n])return n;n=o+Math.random()}}function ar(n){Ge++,i.monitorRunDependencies?.(Ge),n?(S(!lt[n]),lt[n]=1,Ke===null&&typeof setInterval<"u"&&(Ke=setInterval(()=>{if(O){clearInterval(Ke),Ke=null;return}var o=!1;for(var a in lt)o||(o=!0,U("still waiting on run dependencies:")),U(`dependency: ${a}`);o&&U("(end of list)")},1e4))):U("warning: run dependency added without ID")}function Gt(n){if(Ge--,i.monitorRunDependencies?.(Ge),n?(S(lt[n]),delete lt[n]):U("warning: run dependency removed without ID"),Ge==0&&(Ke!==null&&(clearInterval(Ke),Ke=null),kt)){var o=kt;kt=null,o()}}function ie(n){i.onAbort?.(n),n="Aborted("+n+")",U(n),O=!0;var o=new WebAssembly.RuntimeError(n);throw l(o),o}var eo="data:application/octet-stream;base64,",nn=n=>n.startsWith(eo),yt=n=>n.startsWith("file://");function ee(n,o){return(...a)=>{S(Ht,`native function \`${n}\` called before runtime initialization`);var u=Xe[n];return S(u,`exported native function \`${n}\` not found`),S(a.length<=o,`native function \`${n}\` called with ${a.length} args but expects ${o}`),u(...a)}}function to(){if(i.locateFile){var n="hopefox.wasm";return nn(n)?n:E(n)}return new URL("hopefox.wasm",import.meta.url).href}var Et;function on(n){if(n==Et&&z)return new Uint8Array(z);if(A)return A(n);throw"both async and sync fetching of the wasm failed"}function ro(n){return z?Promise.resolve().then(()=>on(n)):F(n).then(o=>new Uint8Array(o),()=>on(n))}function sn(n,o,a){return ro(n).then(u=>WebAssembly.instantiate(u,o)).then(a,u=>{U(`failed to asynchronously prepare wasm: ${u}`),yt(Et)&&U(`warning: Loading from a file URI (${Et}) is not supported in most browsers. See https://emscripten.org/docs/getting_started/FAQ.html#how-do-i-run-a-local-webserver-for-testing-why-does-my-program-stall-in-downloading-or-preparing`),ie(u)})}function no(n,o,a,u){return!n&&typeof WebAssembly.instantiateStreaming=="function"&&!nn(o)&&!yt(o)&&!p&&typeof fetch=="function"?fetch(o,{credentials:"same-origin"}).then(h=>{var m=WebAssembly.instantiateStreaming(h,a);return m.then(u,function(v){return U(`wasm streaming compile failed: ${v}`),U("falling back to ArrayBuffer instantiation"),sn(o,a,u)})}):sn(o,a,u)}function io(){return{env:gn,wasi_snapshot_preview1:gn}}function oo(){function n(h,m){return Xe=h.exports,se=Xe.memory,S(se,"memory not found in wasm exports"),st(),Ji(Xe.__wasm_call_ctors),Gt("wasm-instantiate"),Xe}ar("wasm-instantiate");var o=i;function a(h){S(i===o,"the Module object should not be replaced during async compilation - perhaps the order of HTML elements is wrong?"),o=null,n(h.instance)}var u=io();if(i.instantiateWasm)try{return i.instantiateWasm(u,n)}catch(h){U(`Module.instantiateWasm callback failed with error: ${h}`),l(h)}return Et??=to(),no(z,Et,u,a).catch(l),{}}var j,ue;if((()=>{var n=new Int16Array(1),o=new Int8Array(n.buffer);if(n[0]=25459,o[0]!==115||o[1]!==99)throw"Runtime error: expected the system to be little-endian! (Run with -sSUPPORT_BIG_ENDIAN to bypass)"})(),i.ENVIRONMENT)throw new Error("Module.ENVIRONMENT has been deprecated. To force the environment, use the ENVIRONMENT compile-time option (for example, -sENVIRONMENT=web or -sENVIRONMENT=node)");function Ve(n,o,a=!0){Object.getOwnPropertyDescriptor(i,n)||Object.defineProperty(i,n,{configurable:!0,get(){let u=a?" (the initial value can be provided on Module, but after startup the value is only looked for on a local variable of that name)":"";ie(`\`Module.${n}\` has been replaced by \`${o}\``+u)}})}function so(n){Object.getOwnPropertyDescriptor(i,n)&&ie(`\`Module.${n}\` was supplied but \`${n}\` not included in INCOMING_MODULE_JS_API`)}function an(n){return n==="FS_createPath"||n==="FS_createDataFile"||n==="FS_createPreloadedFile"||n==="FS_unlink"||n==="addRunDependency"||n==="FS_createLazyFile"||n==="FS_createDevice"||n==="removeRunDependency"}function ln(n,o){typeof globalThis<"u"&&!Object.getOwnPropertyDescriptor(globalThis,n)&&Object.defineProperty(globalThis,n,{configurable:!0,get(){o()}})}function cn(n,o){ln(n,()=>{qe(`\`${n}\` is not longer defined by emscripten. ${o}`)})}cn("buffer","Please use HEAP8.buffer or wasmMemory.buffer"),cn("asm","Please use wasmExports instead");function ao(n){ln(n,()=>{var o=`\`${n}\` is a library symbol and not included by default; add it to your library.js __deps or to DEFAULT_LIBRARY_FUNCS_TO_INCLUDE on the command line`,a=n;a.startsWith("_")||(a="$"+n),o+=` (e.g. -sDEFAULT_LIBRARY_FUNCS_TO_INCLUDE='${a}')`,an(n)&&(o+=". Alternatively, forcing filesystem support (-sFORCE_FILESYSTEM) can export this for you"),qe(o)}),un(n)}function un(n){Object.getOwnPropertyDescriptor(i,n)||Object.defineProperty(i,n,{configurable:!0,get(){var o=`'${n}' was not exported. add it to EXPORTED_RUNTIME_METHODS (see the Emscripten FAQ)`;an(n)&&(o+=". Alternatively, forcing filesystem support (-sFORCE_FILESYSTEM) can export this for you"),ie(o)}})}var lr=n=>{for(;n.length>0;)n.shift()(i)};function lo(n,o="i8"){switch(o.endsWith("*")&&(o="*"),o){case"i1":return B[n];case"i8":return B[n];case"i16":return Ce[n>>1];case"i32":return Y[n>>2];case"i64":ie("to do getValue(i64) use WASM_BIGINT");case"float":return xe[n>>2];case"double":return _t[n>>3];case"*":return q[n>>2];default:ie(`invalid type for getValue: ${o}`)}}i.getValue=lo,i.noExitRuntime;var St=n=>(S(typeof n=="number"),n>>>=0,"0x"+n.toString(16).padStart(8,"0"));function co(n,o,a="i8"){switch(a.endsWith("*")&&(a="*"),a){case"i1":B[n]=o;break;case"i8":B[n]=o;break;case"i16":Ce[n>>1]=o;break;case"i32":Y[n>>2]=o;break;case"i64":ie("to do setValue(i64) use WASM_BIGINT");case"float":xe[n>>2]=o;break;case"double":_t[n>>3]=o;break;case"*":q[n>>2]=o;break;default:ie(`invalid type for setValue: ${a}`)}}i.setValue=co;var qe=n=>{qe.shown||={},qe.shown[n]||(qe.shown[n]=1,p&&(n="warning: "+n),U(n))},dn=typeof TextDecoder<"u"?new TextDecoder:void 0,ct=(n,o=0,a=NaN)=>{for(var u=o+a,h=o;n[h]&&!(h>=u);)++h;if(h-o>16&&n.buffer&&dn)return dn.decode(n.subarray(o,h));for(var m="";o<h;){var v=n[o++];if(!(v&128)){m+=String.fromCharCode(v);continue}var b=n[o++]&63;if((v&224)==192){m+=String.fromCharCode((v&31)<<6|b);continue}var M=n[o++]&63;if((v&240)==224?v=(v&15)<<12|b<<6|M:((v&248)!=240&&qe("Invalid UTF-8 leading byte "+St(v)+" encountered when deserializing a UTF-8 string in wasm memory to a JS string!"),v=(v&7)<<18|b<<12|M<<6|n[o++]&63),v<65536)m+=String.fromCharCode(v);else{var K=v-65536;m+=String.fromCharCode(55296|K>>10,56320|K&1023)}}return m},ut=(n,o)=>(S(typeof n=="number",`UTF8ToString expects a number (got ${typeof n})`),n?ct(fe,n,o):"");i.UTF8ToString=ut;var uo=(n,o,a,u)=>ie(`Assertion failed: ${ut(n)}, at: `+[o?ut(o):"unknown filename",a,u?ut(u):"unknown function"]);class fo{constructor(o){this.excPtr=o,this.ptr=o-24}set_type(o){q[this.ptr+4>>2]=o}get_type(){return q[this.ptr+4>>2]}set_destructor(o){q[this.ptr+8>>2]=o}get_destructor(){return q[this.ptr+8>>2]}set_caught(o){o=o?1:0,B[this.ptr+12]=o}get_caught(){return B[this.ptr+12]!=0}set_rethrown(o){o=o?1:0,B[this.ptr+13]=o}get_rethrown(){return B[this.ptr+13]!=0}init(o,a){this.set_adjusted_ptr(0),this.set_type(o),this.set_destructor(a)}set_adjusted_ptr(o){q[this.ptr+16>>2]=o}get_adjusted_ptr(){return q[this.ptr+16>>2]}}var ho=(n,o,a)=>{var u=new fo(n);u.init(o,a),S(!1,"Exception thrown, but exception catching is not enabled. Compile with -sNO_DISABLE_EXCEPTION_CATCHING or -sEXCEPTION_CATCHING_ALLOWED=[..] to catch.")},po=()=>ie("native code called abort()"),mo=(n,o,a)=>fe.copyWithin(n,o,o+a),cr=(n,o,a,u)=>{if(S(typeof n=="string",`stringToUTF8Array expects a string (got ${typeof n})`),!(u>0))return 0;for(var h=a,m=a+u-1,v=0;v<n.length;++v){var b=n.charCodeAt(v);if(b>=55296&&b<=57343){var M=n.charCodeAt(++v);b=65536+((b&1023)<<10)|M&1023}if(b<=127){if(a>=m)break;o[a++]=b}else if(b<=2047){if(a+1>=m)break;o[a++]=192|b>>6,o[a++]=128|b&63}else if(b<=65535){if(a+2>=m)break;o[a++]=224|b>>12,o[a++]=128|b>>6&63,o[a++]=128|b&63}else{if(a+3>=m)break;b>1114111&&qe("Invalid Unicode code point "+St(b)+" encountered when serializing a JS string to a UTF-8 string in wasm memory! (Valid unicode code points should be in range 0-0x10FFFF)."),o[a++]=240|b>>18,o[a++]=128|b>>12&63,o[a++]=128|b>>6&63,o[a++]=128|b&63}}return o[a]=0,a-h},Ct=(n,o,a)=>(S(typeof a=="number","stringToUTF8(str, outPtr, maxBytesToWrite) is missing the third parameter that specifies the length of the output buffer!"),cr(n,fe,o,a));i.stringToUTF8=Ct;var Kt=n=>{for(var o=0,a=0;a<n.length;++a){var u=n.charCodeAt(a);u<=127?o++:u<=2047?o+=2:u>=55296&&u<=57343?(o+=4,++a):o+=3}return o},go=(n,o,a,u)=>{var h=new Date().getFullYear(),m=new Date(h,0,1),v=new Date(h,6,1),b=m.getTimezoneOffset(),M=v.getTimezoneOffset(),K=Math.max(b,M);q[n>>2]=K*60,Y[o>>2]=+(b!=M);var X=x=>{var W=x>=0?"-":"+",he=Math.abs(x),Pe=String(Math.floor(he/60)).padStart(2,"0"),be=String(he%60).padStart(2,"0");return`UTC${W}${Pe}${be}`},Q=X(b),V=X(M);S(Q),S(V),S(Kt(Q)<=16,`timezone name truncated to fit in TZNAME_MAX (${Q})`),S(Kt(V)<=16,`timezone name truncated to fit in TZNAME_MAX (${V})`),M<b?(Ct(Q,a,17),Ct(V,u,17)):(Ct(Q,u,17),Ct(V,a,17))},vo=()=>2147483648,_o=(n,o)=>(S(o,"alignment argument is required"),Math.ceil(n/o)*o),wo=n=>{var o=se.buffer,a=(n-o.byteLength+65535)/65536|0;try{return se.grow(a),st(),1}catch(u){U(`growMemory: Attempted to grow heap from ${o.byteLength} bytes to ${n} bytes, but got error: ${u}`)}},bo=n=>{var o=fe.length;n>>>=0,S(n>o);var a=vo();if(n>a)return U(`Cannot enlarge memory, requested ${n} bytes, but the limit is ${a} bytes!`),!1;for(var u=1;u<=4;u*=2){var h=o*(1+.2/u);h=Math.min(h,n+100663296);var m=Math.min(a,_o(Math.max(n,h),65536)),v=wo(m);if(v)return!0}return U(`Failed to grow the heap from ${o} bytes to ${m} bytes, not enough memory!`),!1},ur={},ko=()=>P||"./this.program",Pt=()=>{if(!Pt.strings){var n=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",o={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:n,_:ko()};for(var a in ur)ur[a]===void 0?delete o[a]:o[a]=ur[a];var u=[];for(var a in o)u.push(`${a}=${o[a]}`);Pt.strings=u}return Pt.strings},yo=(n,o)=>{for(var a=0;a<n.length;++a)S(n.charCodeAt(a)===(n.charCodeAt(a)&255)),B[o++]=n.charCodeAt(a);B[o]=0},Eo=(n,o)=>{var a=0;return Pt().forEach((u,h)=>{var m=o+a;q[n+h*4>>2]=m,yo(u,m),a+=u.length+1}),0},So=(n,o)=>{var a=Pt();q[n>>2]=a.length;var u=0;return a.forEach(h=>u+=h.length+1),q[o>>2]=u,0},Z={isAbs:n=>n.charAt(0)==="/",splitPath:n=>{var o=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;return o.exec(n).slice(1)},normalizeArray:(n,o)=>{for(var a=0,u=n.length-1;u>=0;u--){var h=n[u];h==="."?n.splice(u,1):h===".."?(n.splice(u,1),a++):a&&(n.splice(u,1),a--)}if(o)for(;a;a--)n.unshift("..");return n},normalize:n=>{var o=Z.isAbs(n),a=n.substr(-1)==="/";return n=Z.normalizeArray(n.split("/").filter(u=>!!u),!o).join("/"),!n&&!o&&(n="."),n&&a&&(n+="/"),(o?"/":"")+n},dirname:n=>{var o=Z.splitPath(n),a=o[0],u=o[1];return!a&&!u?".":(u&&(u=u.substr(0,u.length-1)),a+u)},basename:n=>{if(n==="/")return"/";n=Z.normalize(n),n=n.replace(/\/$/,"");var o=n.lastIndexOf("/");return o===-1?n:n.substr(o+1)},join:(...n)=>Z.normalize(n.join("/")),join2:(n,o)=>Z.normalize(n+"/"+o)},Co=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return u=>crypto.getRandomValues(u);if(p)try{var n=w("crypto"),o=n.randomFillSync;if(o)return u=>n.randomFillSync(u);var a=n.randomBytes;return u=>(u.set(a(u.byteLength)),u)}catch{}ie("no cryptographic support found for randomDevice. consider polyfilling it if you want to use something insecure like Math.random(), e.g. put this in a --pre-js: var crypto = { getRandomValues: (array) => { for (var i = 0; i < array.length; i++) array[i] = (Math.random()*256)|0 } };")},fn=n=>(fn=Co())(n),Ie={resolve:(...n)=>{for(var o="",a=!1,u=n.length-1;u>=-1&&!a;u--){var h=u>=0?n[u]:c.cwd();if(typeof h!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!h)return"";o=h+"/"+o,a=Z.isAbs(h)}return o=Z.normalizeArray(o.split("/").filter(m=>!!m),!a).join("/"),(a?"/":"")+o||"."},relative:(n,o)=>{n=Ie.resolve(n).substr(1),o=Ie.resolve(o).substr(1);function a(K){for(var X=0;X<K.length&&K[X]==="";X++);for(var Q=K.length-1;Q>=0&&K[Q]==="";Q--);return X>Q?[]:K.slice(X,Q-X+1)}for(var u=a(n.split("/")),h=a(o.split("/")),m=Math.min(u.length,h.length),v=m,b=0;b<m;b++)if(u[b]!==h[b]){v=b;break}for(var M=[],b=v;b<u.length;b++)M.push("..");return M=M.concat(h.slice(v)),M.join("/")}},dr=[];function hn(n,o,a){var u=Kt(n)+1,h=new Array(u),m=cr(n,h,0,h.length);return h.length=m,h}var Po=()=>{if(!dr.length){var n=null;if(p){var o=256,a=Buffer.alloc(o),u=0,h=process.stdin.fd;try{u=te.readSync(h,a,0,o)}catch(m){if(m.toString().includes("EOF"))u=0;else throw m}u>0&&(n=a.slice(0,u).toString("utf-8"))}else typeof window<"u"&&typeof window.prompt=="function"&&(n=window.prompt("Input: "),n!==null&&(n+=`
`));if(!n)return null;dr=hn(n)}return dr.shift()},Ye={ttys:[],init(){},shutdown(){},register(n,o){Ye.ttys[n]={input:[],output:[],ops:o},c.registerDevice(n,Ye.stream_ops)},stream_ops:{open(n){var o=Ye.ttys[n.node.rdev];if(!o)throw new c.ErrnoError(43);n.tty=o,n.seekable=!1},close(n){n.tty.ops.fsync(n.tty)},fsync(n){n.tty.ops.fsync(n.tty)},read(n,o,a,u,h){if(!n.tty||!n.tty.ops.get_char)throw new c.ErrnoError(60);for(var m=0,v=0;v<u;v++){var b;try{b=n.tty.ops.get_char(n.tty)}catch{throw new c.ErrnoError(29)}if(b===void 0&&m===0)throw new c.ErrnoError(6);if(b==null)break;m++,o[a+v]=b}return m&&(n.node.timestamp=Date.now()),m},write(n,o,a,u,h){if(!n.tty||!n.tty.ops.put_char)throw new c.ErrnoError(60);try{for(var m=0;m<u;m++)n.tty.ops.put_char(n.tty,o[a+m])}catch{throw new c.ErrnoError(29)}return u&&(n.node.timestamp=Date.now()),m}},default_tty_ops:{get_char(n){return Po()},put_char(n,o){o===null||o===10?(ne(ct(n.output)),n.output=[]):o!=0&&n.output.push(o)},fsync(n){n.output&&n.output.length>0&&(ne(ct(n.output)),n.output=[])},ioctl_tcgets(n){return{c_iflag:25856,c_oflag:5,c_cflag:191,c_lflag:35387,c_cc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},ioctl_tcsets(n,o,a){return 0},ioctl_tiocgwinsz(n){return[24,80]}},default_tty1_ops:{put_char(n,o){o===null||o===10?(U(ct(n.output)),n.output=[]):o!=0&&n.output.push(o)},fsync(n){n.output&&n.output.length>0&&(U(ct(n.output)),n.output=[])}}},pn=n=>{ie("internal error: mmapAlloc called but `emscripten_builtin_memalign` native symbol not exported")},L={ops_table:null,mount(n){return L.createNode(null,"/",16895,0)},createNode(n,o,a,u){if(c.isBlkdev(a)||c.isFIFO(a))throw new c.ErrnoError(63);L.ops_table||={dir:{node:{getattr:L.node_ops.getattr,setattr:L.node_ops.setattr,lookup:L.node_ops.lookup,mknod:L.node_ops.mknod,rename:L.node_ops.rename,unlink:L.node_ops.unlink,rmdir:L.node_ops.rmdir,readdir:L.node_ops.readdir,symlink:L.node_ops.symlink},stream:{llseek:L.stream_ops.llseek}},file:{node:{getattr:L.node_ops.getattr,setattr:L.node_ops.setattr},stream:{llseek:L.stream_ops.llseek,read:L.stream_ops.read,write:L.stream_ops.write,allocate:L.stream_ops.allocate,mmap:L.stream_ops.mmap,msync:L.stream_ops.msync}},link:{node:{getattr:L.node_ops.getattr,setattr:L.node_ops.setattr,readlink:L.node_ops.readlink},stream:{}},chrdev:{node:{getattr:L.node_ops.getattr,setattr:L.node_ops.setattr},stream:c.chrdev_stream_ops}};var h=c.createNode(n,o,a,u);return c.isDir(h.mode)?(h.node_ops=L.ops_table.dir.node,h.stream_ops=L.ops_table.dir.stream,h.contents={}):c.isFile(h.mode)?(h.node_ops=L.ops_table.file.node,h.stream_ops=L.ops_table.file.stream,h.usedBytes=0,h.contents=null):c.isLink(h.mode)?(h.node_ops=L.ops_table.link.node,h.stream_ops=L.ops_table.link.stream):c.isChrdev(h.mode)&&(h.node_ops=L.ops_table.chrdev.node,h.stream_ops=L.ops_table.chrdev.stream),h.timestamp=Date.now(),n&&(n.contents[o]=h,n.timestamp=h.timestamp),h},getFileDataAsTypedArray(n){return n.contents?n.contents.subarray?n.contents.subarray(0,n.usedBytes):new Uint8Array(n.contents):new Uint8Array(0)},expandFileStorage(n,o){var a=n.contents?n.contents.length:0;if(!(a>=o)){var u=1024*1024;o=Math.max(o,a*(a<u?2:1.125)>>>0),a!=0&&(o=Math.max(o,256));var h=n.contents;n.contents=new Uint8Array(o),n.usedBytes>0&&n.contents.set(h.subarray(0,n.usedBytes),0)}},resizeFileStorage(n,o){if(n.usedBytes!=o)if(o==0)n.contents=null,n.usedBytes=0;else{var a=n.contents;n.contents=new Uint8Array(o),a&&n.contents.set(a.subarray(0,Math.min(o,n.usedBytes))),n.usedBytes=o}},node_ops:{getattr(n){var o={};return o.dev=c.isChrdev(n.mode)?n.id:1,o.ino=n.id,o.mode=n.mode,o.nlink=1,o.uid=0,o.gid=0,o.rdev=n.rdev,c.isDir(n.mode)?o.size=4096:c.isFile(n.mode)?o.size=n.usedBytes:c.isLink(n.mode)?o.size=n.link.length:o.size=0,o.atime=new Date(n.timestamp),o.mtime=new Date(n.timestamp),o.ctime=new Date(n.timestamp),o.blksize=4096,o.blocks=Math.ceil(o.size/o.blksize),o},setattr(n,o){o.mode!==void 0&&(n.mode=o.mode),o.timestamp!==void 0&&(n.timestamp=o.timestamp),o.size!==void 0&&L.resizeFileStorage(n,o.size)},lookup(n,o){throw new c.ErrnoError(44)},mknod(n,o,a,u){return L.createNode(n,o,a,u)},rename(n,o,a){if(c.isDir(n.mode)){var u;try{u=c.lookupNode(o,a)}catch{}if(u)for(var h in u.contents)throw new c.ErrnoError(55)}delete n.parent.contents[n.name],n.parent.timestamp=Date.now(),n.name=a,o.contents[a]=n,o.timestamp=n.parent.timestamp},unlink(n,o){delete n.contents[o],n.timestamp=Date.now()},rmdir(n,o){var a=c.lookupNode(n,o);for(var u in a.contents)throw new c.ErrnoError(55);delete n.contents[o],n.timestamp=Date.now()},readdir(n){var o=[".",".."];for(var a of Object.keys(n.contents))o.push(a);return o},symlink(n,o,a){var u=L.createNode(n,o,41471,0);return u.link=a,u},readlink(n){if(!c.isLink(n.mode))throw new c.ErrnoError(28);return n.link}},stream_ops:{read(n,o,a,u,h){var m=n.node.contents;if(h>=n.node.usedBytes)return 0;var v=Math.min(n.node.usedBytes-h,u);if(S(v>=0),v>8&&m.subarray)o.set(m.subarray(h,h+v),a);else for(var b=0;b<v;b++)o[a+b]=m[h+b];return v},write(n,o,a,u,h,m){if(S(!(o instanceof ArrayBuffer)),o.buffer===B.buffer&&(m=!1),!u)return 0;var v=n.node;if(v.timestamp=Date.now(),o.subarray&&(!v.contents||v.contents.subarray)){if(m)return S(h===0,"canOwn must imply no weird position inside the file"),v.contents=o.subarray(a,a+u),v.usedBytes=u,u;if(v.usedBytes===0&&h===0)return v.contents=o.slice(a,a+u),v.usedBytes=u,u;if(h+u<=v.usedBytes)return v.contents.set(o.subarray(a,a+u),h),u}if(L.expandFileStorage(v,h+u),v.contents.subarray&&o.subarray)v.contents.set(o.subarray(a,a+u),h);else for(var b=0;b<u;b++)v.contents[h+b]=o[a+b];return v.usedBytes=Math.max(v.usedBytes,h+u),u},llseek(n,o,a){var u=o;if(a===1?u+=n.position:a===2&&c.isFile(n.node.mode)&&(u+=n.node.usedBytes),u<0)throw new c.ErrnoError(28);return u},allocate(n,o,a){L.expandFileStorage(n.node,o+a),n.node.usedBytes=Math.max(n.node.usedBytes,o+a)},mmap(n,o,a,u,h){if(!c.isFile(n.node.mode))throw new c.ErrnoError(43);var m,v,b=n.node.contents;if(!(h&2)&&b&&b.buffer===B.buffer)v=!1,m=b.byteOffset;else{if(v=!0,m=pn(),!m)throw new c.ErrnoError(48);b&&((a>0||a+o<b.length)&&(b.subarray?b=b.subarray(a,a+o):b=Array.prototype.slice.call(b,a,a+o)),B.set(b,m))}return{ptr:m,allocated:v}},msync(n,o,a,u,h){return L.stream_ops.write(n,o,0,u,a,!1),0}}},To=(n,o,a,u)=>{var h=rn(`al ${n}`);F(n).then(m=>{S(m,`Loading data file "${n}" failed (no arrayBuffer).`),o(new Uint8Array(m)),h&&Gt(h)},m=>{if(a)a();else throw`Loading data file "${n}" failed.`}),h&&ar(h)},Ao=(n,o,a,u,h,m)=>{c.createDataFile(n,o,a,u,h,m)},Mo=i.preloadPlugins||[],Oo=(n,o,a,u)=>{typeof Browser<"u"&&Browser.init();var h=!1;return Mo.forEach(m=>{h||m.canHandle(o)&&(m.handle(n,o,a,u),h=!0)}),h},Ro=(n,o,a,u,h,m,v,b,M,K)=>{var X=o?Ie.resolve(Z.join2(n,o)):n,Q=rn(`cp ${X}`);function V(x){function W(he){K?.(),b||Ao(n,o,he,u,h,M),m?.(),Gt(Q)}Oo(x,X,W,()=>{v?.(),Gt(Q)})||W(x)}ar(Q),typeof a=="string"?To(a,V,v):V(a)},Fo=n=>{var o={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},a=o[n];if(typeof a>"u")throw new Error(`Unknown file open mode: ${n}`);return a},fr=(n,o)=>{var a=0;return n&&(a|=365),o&&(a|=146),a},xo=n=>ut(Wo(n)),mn={EPERM:63,ENOENT:44,ESRCH:71,EINTR:27,EIO:29,ENXIO:60,E2BIG:1,ENOEXEC:45,EBADF:8,ECHILD:12,EAGAIN:6,EWOULDBLOCK:6,ENOMEM:48,EACCES:2,EFAULT:21,ENOTBLK:105,EBUSY:10,EEXIST:20,EXDEV:75,ENODEV:43,ENOTDIR:54,EISDIR:31,EINVAL:28,ENFILE:41,EMFILE:33,ENOTTY:59,ETXTBSY:74,EFBIG:22,ENOSPC:51,ESPIPE:70,EROFS:69,EMLINK:34,EPIPE:64,EDOM:18,ERANGE:68,ENOMSG:49,EIDRM:24,ECHRNG:106,EL2NSYNC:156,EL3HLT:107,EL3RST:108,ELNRNG:109,EUNATCH:110,ENOCSI:111,EL2HLT:112,EDEADLK:16,ENOLCK:46,EBADE:113,EBADR:114,EXFULL:115,ENOANO:104,EBADRQC:103,EBADSLT:102,EDEADLOCK:16,EBFONT:101,ENOSTR:100,ENODATA:116,ETIME:117,ENOSR:118,ENONET:119,ENOPKG:120,EREMOTE:121,ENOLINK:47,EADV:122,ESRMNT:123,ECOMM:124,EPROTO:65,EMULTIHOP:36,EDOTDOT:125,EBADMSG:9,ENOTUNIQ:126,EBADFD:127,EREMCHG:128,ELIBACC:129,ELIBBAD:130,ELIBSCN:131,ELIBMAX:132,ELIBEXEC:133,ENOSYS:52,ENOTEMPTY:55,ENAMETOOLONG:37,ELOOP:32,EOPNOTSUPP:138,EPFNOSUPPORT:139,ECONNRESET:15,ENOBUFS:42,EAFNOSUPPORT:5,EPROTOTYPE:67,ENOTSOCK:57,ENOPROTOOPT:50,ESHUTDOWN:140,ECONNREFUSED:14,EADDRINUSE:3,ECONNABORTED:13,ENETUNREACH:40,ENETDOWN:38,ETIMEDOUT:73,EHOSTDOWN:142,EHOSTUNREACH:23,EINPROGRESS:26,EALREADY:7,EDESTADDRREQ:17,EMSGSIZE:35,EPROTONOSUPPORT:66,ESOCKTNOSUPPORT:137,EADDRNOTAVAIL:4,ENETRESET:39,EISCONN:30,ENOTCONN:53,ETOOMANYREFS:141,EUSERS:136,EDQUOT:19,ESTALE:72,ENOTSUP:138,ENOMEDIUM:148,EILSEQ:25,EOVERFLOW:61,ECANCELED:11,ENOTRECOVERABLE:56,EOWNERDEAD:62,ESTRPIPE:135},c={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,ErrnoError:class extends Error{name="ErrnoError";constructor(n){super(Ht?xo(n):""),this.errno=n;for(var o in mn)if(mn[o]===n){this.code=o;break}}},filesystems:null,syncFSRequests:0,readFiles:{},FSStream:class{shared={};get object(){return this.node}set object(n){this.node=n}get isRead(){return(this.flags&2097155)!==1}get isWrite(){return(this.flags&2097155)!==0}get isAppend(){return this.flags&1024}get flags(){return this.shared.flags}set flags(n){this.shared.flags=n}get position(){return this.shared.position}set position(n){this.shared.position=n}},FSNode:class{node_ops={};stream_ops={};readMode=365;writeMode=146;mounted=null;constructor(n,o,a,u){n||(n=this),this.parent=n,this.mount=n.mount,this.id=c.nextInode++,this.name=o,this.mode=a,this.rdev=u}get read(){return(this.mode&this.readMode)===this.readMode}set read(n){n?this.mode|=this.readMode:this.mode&=~this.readMode}get write(){return(this.mode&this.writeMode)===this.writeMode}set write(n){n?this.mode|=this.writeMode:this.mode&=~this.writeMode}get isFolder(){return c.isDir(this.mode)}get isDevice(){return c.isChrdev(this.mode)}},lookupPath(n,o={}){if(n=Ie.resolve(n),!n)return{path:"",node:null};var a={follow_mount:!0,recurse_count:0};if(o=Object.assign(a,o),o.recurse_count>8)throw new c.ErrnoError(32);for(var u=n.split("/").filter(Q=>!!Q),h=c.root,m="/",v=0;v<u.length;v++){var b=v===u.length-1;if(b&&o.parent)break;if(h=c.lookupNode(h,u[v]),m=Z.join2(m,u[v]),c.isMountpoint(h)&&(!b||b&&o.follow_mount)&&(h=h.mounted.root),!b||o.follow)for(var M=0;c.isLink(h.mode);){var K=c.readlink(m);m=Ie.resolve(Z.dirname(m),K);var X=c.lookupPath(m,{recurse_count:o.recurse_count+1});if(h=X.node,M++>40)throw new c.ErrnoError(32)}}return{path:m,node:h}},getPath(n){for(var o;;){if(c.isRoot(n)){var a=n.mount.mountpoint;return o?a[a.length-1]!=="/"?`${a}/${o}`:a+o:a}o=o?`${n.name}/${o}`:n.name,n=n.parent}},hashName(n,o){for(var a=0,u=0;u<o.length;u++)a=(a<<5)-a+o.charCodeAt(u)|0;return(n+a>>>0)%c.nameTable.length},hashAddNode(n){var o=c.hashName(n.parent.id,n.name);n.name_next=c.nameTable[o],c.nameTable[o]=n},hashRemoveNode(n){var o=c.hashName(n.parent.id,n.name);if(c.nameTable[o]===n)c.nameTable[o]=n.name_next;else for(var a=c.nameTable[o];a;){if(a.name_next===n){a.name_next=n.name_next;break}a=a.name_next}},lookupNode(n,o){var a=c.mayLookup(n);if(a)throw new c.ErrnoError(a);for(var u=c.hashName(n.id,o),h=c.nameTable[u];h;h=h.name_next){var m=h.name;if(h.parent.id===n.id&&m===o)return h}return c.lookup(n,o)},createNode(n,o,a,u){S(typeof n=="object");var h=new c.FSNode(n,o,a,u);return c.hashAddNode(h),h},destroyNode(n){c.hashRemoveNode(n)},isRoot(n){return n===n.parent},isMountpoint(n){return!!n.mounted},isFile(n){return(n&61440)===32768},isDir(n){return(n&61440)===16384},isLink(n){return(n&61440)===40960},isChrdev(n){return(n&61440)===8192},isBlkdev(n){return(n&61440)===24576},isFIFO(n){return(n&61440)===4096},isSocket(n){return(n&49152)===49152},flagsToPermissionString(n){var o=["r","w","rw"][n&3];return n&512&&(o+="w"),o},nodePermissions(n,o){return c.ignorePermissions?0:o.includes("r")&&!(n.mode&292)||o.includes("w")&&!(n.mode&146)||o.includes("x")&&!(n.mode&73)?2:0},mayLookup(n){if(!c.isDir(n.mode))return 54;var o=c.nodePermissions(n,"x");return o||(n.node_ops.lookup?0:2)},mayCreate(n,o){try{var a=c.lookupNode(n,o);return 20}catch{}return c.nodePermissions(n,"wx")},mayDelete(n,o,a){var u;try{u=c.lookupNode(n,o)}catch(m){return m.errno}var h=c.nodePermissions(n,"wx");if(h)return h;if(a){if(!c.isDir(u.mode))return 54;if(c.isRoot(u)||c.getPath(u)===c.cwd())return 10}else if(c.isDir(u.mode))return 31;return 0},mayOpen(n,o){return n?c.isLink(n.mode)?32:c.isDir(n.mode)&&(c.flagsToPermissionString(o)!=="r"||o&512)?31:c.nodePermissions(n,c.flagsToPermissionString(o)):44},MAX_OPEN_FDS:4096,nextfd(){for(var n=0;n<=c.MAX_OPEN_FDS;n++)if(!c.streams[n])return n;throw new c.ErrnoError(33)},getStreamChecked(n){var o=c.getStream(n);if(!o)throw new c.ErrnoError(8);return o},getStream:n=>c.streams[n],createStream(n,o=-1){return S(o>=-1),n=Object.assign(new c.FSStream,n),o==-1&&(o=c.nextfd()),n.fd=o,c.streams[o]=n,n},closeStream(n){c.streams[n]=null},dupStream(n,o=-1){var a=c.createStream(n,o);return a.stream_ops?.dup?.(a),a},chrdev_stream_ops:{open(n){var o=c.getDevice(n.node.rdev);n.stream_ops=o.stream_ops,n.stream_ops.open?.(n)},llseek(){throw new c.ErrnoError(70)}},major:n=>n>>8,minor:n=>n&255,makedev:(n,o)=>n<<8|o,registerDevice(n,o){c.devices[n]={stream_ops:o}},getDevice:n=>c.devices[n],getMounts(n){for(var o=[],a=[n];a.length;){var u=a.pop();o.push(u),a.push(...u.mounts)}return o},syncfs(n,o){typeof n=="function"&&(o=n,n=!1),c.syncFSRequests++,c.syncFSRequests>1&&U(`warning: ${c.syncFSRequests} FS.syncfs operations in flight at once, probably just doing extra work`);var a=c.getMounts(c.root.mount),u=0;function h(v){return S(c.syncFSRequests>0),c.syncFSRequests--,o(v)}function m(v){if(v)return m.errored?void 0:(m.errored=!0,h(v));++u>=a.length&&h(null)}a.forEach(v=>{if(!v.type.syncfs)return m(null);v.type.syncfs(v,n,m)})},mount(n,o,a){if(typeof n=="string")throw n;var u=a==="/",h=!a,m;if(u&&c.root)throw new c.ErrnoError(10);if(!u&&!h){var v=c.lookupPath(a,{follow_mount:!1});if(a=v.path,m=v.node,c.isMountpoint(m))throw new c.ErrnoError(10);if(!c.isDir(m.mode))throw new c.ErrnoError(54)}var b={type:n,opts:o,mountpoint:a,mounts:[]},M=n.mount(b);return M.mount=b,b.root=M,u?c.root=M:m&&(m.mounted=b,m.mount&&m.mount.mounts.push(b)),M},unmount(n){var o=c.lookupPath(n,{follow_mount:!1});if(!c.isMountpoint(o.node))throw new c.ErrnoError(28);var a=o.node,u=a.mounted,h=c.getMounts(u);Object.keys(c.nameTable).forEach(v=>{for(var b=c.nameTable[v];b;){var M=b.name_next;h.includes(b.mount)&&c.destroyNode(b),b=M}}),a.mounted=null;var m=a.mount.mounts.indexOf(u);S(m!==-1),a.mount.mounts.splice(m,1)},lookup(n,o){return n.node_ops.lookup(n,o)},mknod(n,o,a){var u=c.lookupPath(n,{parent:!0}),h=u.node,m=Z.basename(n);if(!m||m==="."||m==="..")throw new c.ErrnoError(28);var v=c.mayCreate(h,m);if(v)throw new c.ErrnoError(v);if(!h.node_ops.mknod)throw new c.ErrnoError(63);return h.node_ops.mknod(h,m,o,a)},statfs(n){var o={bsize:4096,frsize:4096,blocks:1e6,bfree:5e5,bavail:5e5,files:c.nextInode,ffree:c.nextInode-1,fsid:42,flags:2,namelen:255},a=c.lookupPath(n,{follow:!0}).node;return a?.node_ops.statfs&&Object.assign(o,a.node_ops.statfs(a.mount.opts.root)),o},create(n,o=438){return o&=4095,o|=32768,c.mknod(n,o,0)},mkdir(n,o=511){return o&=1023,o|=16384,c.mknod(n,o,0)},mkdirTree(n,o){for(var a=n.split("/"),u="",h=0;h<a.length;++h)if(a[h]){u+="/"+a[h];try{c.mkdir(u,o)}catch(m){if(m.errno!=20)throw m}}},mkdev(n,o,a){return typeof a>"u"&&(a=o,o=438),o|=8192,c.mknod(n,o,a)},symlink(n,o){if(!Ie.resolve(n))throw new c.ErrnoError(44);var a=c.lookupPath(o,{parent:!0}),u=a.node;if(!u)throw new c.ErrnoError(44);var h=Z.basename(o),m=c.mayCreate(u,h);if(m)throw new c.ErrnoError(m);if(!u.node_ops.symlink)throw new c.ErrnoError(63);return u.node_ops.symlink(u,h,n)},rename(n,o){var a=Z.dirname(n),u=Z.dirname(o),h=Z.basename(n),m=Z.basename(o),v,b,M;if(v=c.lookupPath(n,{parent:!0}),b=v.node,v=c.lookupPath(o,{parent:!0}),M=v.node,!b||!M)throw new c.ErrnoError(44);if(b.mount!==M.mount)throw new c.ErrnoError(75);var K=c.lookupNode(b,h),X=Ie.relative(n,u);if(X.charAt(0)!==".")throw new c.ErrnoError(28);if(X=Ie.relative(o,a),X.charAt(0)!==".")throw new c.ErrnoError(55);var Q;try{Q=c.lookupNode(M,m)}catch{}if(K!==Q){var V=c.isDir(K.mode),x=c.mayDelete(b,h,V);if(x)throw new c.ErrnoError(x);if(x=Q?c.mayDelete(M,m,V):c.mayCreate(M,m),x)throw new c.ErrnoError(x);if(!b.node_ops.rename)throw new c.ErrnoError(63);if(c.isMountpoint(K)||Q&&c.isMountpoint(Q))throw new c.ErrnoError(10);if(M!==b&&(x=c.nodePermissions(b,"w"),x))throw new c.ErrnoError(x);c.hashRemoveNode(K);try{b.node_ops.rename(K,M,m),K.parent=M}catch(W){throw W}finally{c.hashAddNode(K)}}},rmdir(n){var o=c.lookupPath(n,{parent:!0}),a=o.node,u=Z.basename(n),h=c.lookupNode(a,u),m=c.mayDelete(a,u,!0);if(m)throw new c.ErrnoError(m);if(!a.node_ops.rmdir)throw new c.ErrnoError(63);if(c.isMountpoint(h))throw new c.ErrnoError(10);a.node_ops.rmdir(a,u),c.destroyNode(h)},readdir(n){var o=c.lookupPath(n,{follow:!0}),a=o.node;if(!a.node_ops.readdir)throw new c.ErrnoError(54);return a.node_ops.readdir(a)},unlink(n){var o=c.lookupPath(n,{parent:!0}),a=o.node;if(!a)throw new c.ErrnoError(44);var u=Z.basename(n),h=c.lookupNode(a,u),m=c.mayDelete(a,u,!1);if(m)throw new c.ErrnoError(m);if(!a.node_ops.unlink)throw new c.ErrnoError(63);if(c.isMountpoint(h))throw new c.ErrnoError(10);a.node_ops.unlink(a,u),c.destroyNode(h)},readlink(n){var o=c.lookupPath(n),a=o.node;if(!a)throw new c.ErrnoError(44);if(!a.node_ops.readlink)throw new c.ErrnoError(28);return a.node_ops.readlink(a)},stat(n,o){var a=c.lookupPath(n,{follow:!o}),u=a.node;if(!u)throw new c.ErrnoError(44);if(!u.node_ops.getattr)throw new c.ErrnoError(63);return u.node_ops.getattr(u)},lstat(n){return c.stat(n,!0)},chmod(n,o,a){var u;if(typeof n=="string"){var h=c.lookupPath(n,{follow:!a});u=h.node}else u=n;if(!u.node_ops.setattr)throw new c.ErrnoError(63);u.node_ops.setattr(u,{mode:o&4095|u.mode&-4096,timestamp:Date.now()})},lchmod(n,o){c.chmod(n,o,!0)},fchmod(n,o){var a=c.getStreamChecked(n);c.chmod(a.node,o)},chown(n,o,a,u){var h;if(typeof n=="string"){var m=c.lookupPath(n,{follow:!u});h=m.node}else h=n;if(!h.node_ops.setattr)throw new c.ErrnoError(63);h.node_ops.setattr(h,{timestamp:Date.now()})},lchown(n,o,a){c.chown(n,o,a,!0)},fchown(n,o,a){var u=c.getStreamChecked(n);c.chown(u.node,o,a)},truncate(n,o){if(o<0)throw new c.ErrnoError(28);var a;if(typeof n=="string"){var u=c.lookupPath(n,{follow:!0});a=u.node}else a=n;if(!a.node_ops.setattr)throw new c.ErrnoError(63);if(c.isDir(a.mode))throw new c.ErrnoError(31);if(!c.isFile(a.mode))throw new c.ErrnoError(28);var h=c.nodePermissions(a,"w");if(h)throw new c.ErrnoError(h);a.node_ops.setattr(a,{size:o,timestamp:Date.now()})},ftruncate(n,o){var a=c.getStreamChecked(n);if((a.flags&2097155)===0)throw new c.ErrnoError(28);c.truncate(a.node,o)},utime(n,o,a){var u=c.lookupPath(n,{follow:!0}),h=u.node;h.node_ops.setattr(h,{timestamp:Math.max(o,a)})},open(n,o,a=438){if(n==="")throw new c.ErrnoError(44);o=typeof o=="string"?Fo(o):o,o&64?a=a&4095|32768:a=0;var u;if(typeof n=="object")u=n;else{n=Z.normalize(n);try{var h=c.lookupPath(n,{follow:!(o&131072)});u=h.node}catch{}}var m=!1;if(o&64)if(u){if(o&128)throw new c.ErrnoError(20)}else u=c.mknod(n,a,0),m=!0;if(!u)throw new c.ErrnoError(44);if(c.isChrdev(u.mode)&&(o&=-513),o&65536&&!c.isDir(u.mode))throw new c.ErrnoError(54);if(!m){var v=c.mayOpen(u,o);if(v)throw new c.ErrnoError(v)}o&512&&!m&&c.truncate(u,0),o&=-131713;var b=c.createStream({node:u,path:c.getPath(u),flags:o,seekable:!0,position:0,stream_ops:u.stream_ops,ungotten:[],error:!1});return b.stream_ops.open&&b.stream_ops.open(b),i.logReadFiles&&!(o&1)&&(n in c.readFiles||(c.readFiles[n]=1)),b},close(n){if(c.isClosed(n))throw new c.ErrnoError(8);n.getdents&&(n.getdents=null);try{n.stream_ops.close&&n.stream_ops.close(n)}catch(o){throw o}finally{c.closeStream(n.fd)}n.fd=null},isClosed(n){return n.fd===null},llseek(n,o,a){if(c.isClosed(n))throw new c.ErrnoError(8);if(!n.seekable||!n.stream_ops.llseek)throw new c.ErrnoError(70);if(a!=0&&a!=1&&a!=2)throw new c.ErrnoError(28);return n.position=n.stream_ops.llseek(n,o,a),n.ungotten=[],n.position},read(n,o,a,u,h){if(S(a>=0),u<0||h<0)throw new c.ErrnoError(28);if(c.isClosed(n))throw new c.ErrnoError(8);if((n.flags&2097155)===1)throw new c.ErrnoError(8);if(c.isDir(n.node.mode))throw new c.ErrnoError(31);if(!n.stream_ops.read)throw new c.ErrnoError(28);var m=typeof h<"u";if(!m)h=n.position;else if(!n.seekable)throw new c.ErrnoError(70);var v=n.stream_ops.read(n,o,a,u,h);return m||(n.position+=v),v},write(n,o,a,u,h,m){if(S(a>=0),u<0||h<0)throw new c.ErrnoError(28);if(c.isClosed(n))throw new c.ErrnoError(8);if((n.flags&2097155)===0)throw new c.ErrnoError(8);if(c.isDir(n.node.mode))throw new c.ErrnoError(31);if(!n.stream_ops.write)throw new c.ErrnoError(28);n.seekable&&n.flags&1024&&c.llseek(n,0,2);var v=typeof h<"u";if(!v)h=n.position;else if(!n.seekable)throw new c.ErrnoError(70);var b=n.stream_ops.write(n,o,a,u,h,m);return v||(n.position+=b),b},allocate(n,o,a){if(c.isClosed(n))throw new c.ErrnoError(8);if(o<0||a<=0)throw new c.ErrnoError(28);if((n.flags&2097155)===0)throw new c.ErrnoError(8);if(!c.isFile(n.node.mode)&&!c.isDir(n.node.mode))throw new c.ErrnoError(43);if(!n.stream_ops.allocate)throw new c.ErrnoError(138);n.stream_ops.allocate(n,o,a)},mmap(n,o,a,u,h){if((u&2)!==0&&(h&2)===0&&(n.flags&2097155)!==2)throw new c.ErrnoError(2);if((n.flags&2097155)===1)throw new c.ErrnoError(2);if(!n.stream_ops.mmap)throw new c.ErrnoError(43);if(!o)throw new c.ErrnoError(28);return n.stream_ops.mmap(n,o,a,u,h)},msync(n,o,a,u,h){return S(a>=0),n.stream_ops.msync?n.stream_ops.msync(n,o,a,u,h):0},ioctl(n,o,a){if(!n.stream_ops.ioctl)throw new c.ErrnoError(59);return n.stream_ops.ioctl(n,o,a)},readFile(n,o={}){if(o.flags=o.flags||0,o.encoding=o.encoding||"binary",o.encoding!=="utf8"&&o.encoding!=="binary")throw new Error(`Invalid encoding type "${o.encoding}"`);var a,u=c.open(n,o.flags),h=c.stat(n),m=h.size,v=new Uint8Array(m);return c.read(u,v,0,m,0),o.encoding==="utf8"?a=ct(v):o.encoding==="binary"&&(a=v),c.close(u),a},writeFile(n,o,a={}){a.flags=a.flags||577;var u=c.open(n,a.flags,a.mode);if(typeof o=="string"){var h=new Uint8Array(Kt(o)+1),m=cr(o,h,0,h.length);c.write(u,h,0,m,void 0,a.canOwn)}else if(ArrayBuffer.isView(o))c.write(u,o,0,o.byteLength,void 0,a.canOwn);else throw new Error("Unsupported data type");c.close(u)},cwd:()=>c.currentPath,chdir(n){var o=c.lookupPath(n,{follow:!0});if(o.node===null)throw new c.ErrnoError(44);if(!c.isDir(o.node.mode))throw new c.ErrnoError(54);var a=c.nodePermissions(o.node,"x");if(a)throw new c.ErrnoError(a);c.currentPath=o.path},createDefaultDirectories(){c.mkdir("/tmp"),c.mkdir("/home"),c.mkdir("/home/web_user")},createDefaultDevices(){c.mkdir("/dev"),c.registerDevice(c.makedev(1,3),{read:()=>0,write:(u,h,m,v,b)=>v,llseek:()=>0}),c.mkdev("/dev/null",c.makedev(1,3)),Ye.register(c.makedev(5,0),Ye.default_tty_ops),Ye.register(c.makedev(6,0),Ye.default_tty1_ops),c.mkdev("/dev/tty",c.makedev(5,0)),c.mkdev("/dev/tty1",c.makedev(6,0));var n=new Uint8Array(1024),o=0,a=()=>(o===0&&(o=fn(n).byteLength),n[--o]);c.createDevice("/dev","random",a),c.createDevice("/dev","urandom",a),c.mkdir("/dev/shm"),c.mkdir("/dev/shm/tmp")},createSpecialDirectories(){c.mkdir("/proc");var n=c.mkdir("/proc/self");c.mkdir("/proc/self/fd"),c.mount({mount(){var o=c.createNode(n,"fd",16895,73);return o.node_ops={lookup(a,u){var h=+u,m=c.getStreamChecked(h),v={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>m.path}};return v.parent=v,v}},o}},{},"/proc/self/fd")},createStandardStreams(n,o,a){n?c.createDevice("/dev","stdin",n):c.symlink("/dev/tty","/dev/stdin"),o?c.createDevice("/dev","stdout",null,o):c.symlink("/dev/tty","/dev/stdout"),a?c.createDevice("/dev","stderr",null,a):c.symlink("/dev/tty1","/dev/stderr");var u=c.open("/dev/stdin",0),h=c.open("/dev/stdout",1),m=c.open("/dev/stderr",1);S(u.fd===0,`invalid handle for stdin (${u.fd})`),S(h.fd===1,`invalid handle for stdout (${h.fd})`),S(m.fd===2,`invalid handle for stderr (${m.fd})`)},staticInit(){c.nameTable=new Array(4096),c.mount(L,{},"/"),c.createDefaultDirectories(),c.createDefaultDevices(),c.createSpecialDirectories(),c.filesystems={MEMFS:L}},init(n,o,a){S(!c.initialized,"FS.init was previously called. If you want to initialize later with custom parameters, remove any earlier calls (note that one is automatically added to the generated code)"),c.initialized=!0,n??=i.stdin,o??=i.stdout,a??=i.stderr,c.createStandardStreams(n,o,a)},quit(){c.initialized=!1,jo(0);for(var n=0;n<c.streams.length;n++){var o=c.streams[n];o&&c.close(o)}},findObject(n,o){var a=c.analyzePath(n,o);return a.exists?a.object:null},analyzePath(n,o){try{var a=c.lookupPath(n,{follow:!o});n=a.path}catch{}var u={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var a=c.lookupPath(n,{parent:!0});u.parentExists=!0,u.parentPath=a.path,u.parentObject=a.node,u.name=Z.basename(n),a=c.lookupPath(n,{follow:!o}),u.exists=!0,u.path=a.path,u.object=a.node,u.name=a.node.name,u.isRoot=a.path==="/"}catch(h){u.error=h.errno}return u},createPath(n,o,a,u){n=typeof n=="string"?n:c.getPath(n);for(var h=o.split("/").reverse();h.length;){var m=h.pop();if(m){var v=Z.join2(n,m);try{c.mkdir(v)}catch{}n=v}}return v},createFile(n,o,a,u,h){var m=Z.join2(typeof n=="string"?n:c.getPath(n),o),v=fr(u,h);return c.create(m,v)},createDataFile(n,o,a,u,h,m){var v=o;n&&(n=typeof n=="string"?n:c.getPath(n),v=o?Z.join2(n,o):n);var b=fr(u,h),M=c.create(v,b);if(a){if(typeof a=="string"){for(var K=new Array(a.length),X=0,Q=a.length;X<Q;++X)K[X]=a.charCodeAt(X);a=K}c.chmod(M,b|146);var V=c.open(M,577);c.write(V,a,0,a.length,0,m),c.close(V),c.chmod(M,b)}},createDevice(n,o,a,u){var h=Z.join2(typeof n=="string"?n:c.getPath(n),o),m=fr(!!a,!!u);c.createDevice.major??=64;var v=c.makedev(c.createDevice.major++,0);return c.registerDevice(v,{open(b){b.seekable=!1},close(b){u?.buffer?.length&&u(10)},read(b,M,K,X,Q){for(var V=0,x=0;x<X;x++){var W;try{W=a()}catch{throw new c.ErrnoError(29)}if(W===void 0&&V===0)throw new c.ErrnoError(6);if(W==null)break;V++,M[K+x]=W}return V&&(b.node.timestamp=Date.now()),V},write(b,M,K,X,Q){for(var V=0;V<X;V++)try{u(M[K+V])}catch{throw new c.ErrnoError(29)}return X&&(b.node.timestamp=Date.now()),V}}),c.mkdev(h,m,v)},forceLoadFile(n){if(n.isDevice||n.isFolder||n.link||n.contents)return!0;if(typeof XMLHttpRequest<"u")throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");try{n.contents=A(n.url),n.usedBytes=n.contents.length}catch{throw new c.ErrnoError(29)}},createLazyFile(n,o,a,u,h){class m{lengthKnown=!1;chunks=[];get(x){if(!(x>this.length-1||x<0)){var W=x%this.chunkSize,he=x/this.chunkSize|0;return this.getter(he)[W]}}setDataGetter(x){this.getter=x}cacheLength(){var x=new XMLHttpRequest;if(x.open("HEAD",a,!1),x.send(null),!(x.status>=200&&x.status<300||x.status===304))throw new Error("Couldn't load "+a+". Status: "+x.status);var W=Number(x.getResponseHeader("Content-length")),he,Pe=(he=x.getResponseHeader("Accept-Ranges"))&&he==="bytes",be=(he=x.getResponseHeader("Content-Encoding"))&&he==="gzip",ye=1024*1024;Pe||(ye=W);var Te=(Me,dt)=>{if(Me>dt)throw new Error("invalid range ("+Me+", "+dt+") or no bytes requested!");if(dt>W-1)throw new Error("only "+W+" bytes available! programmer error!");var pe=new XMLHttpRequest;if(pe.open("GET",a,!1),W!==ye&&pe.setRequestHeader("Range","bytes="+Me+"-"+dt),pe.responseType="arraybuffer",pe.overrideMimeType&&pe.overrideMimeType("text/plain; charset=x-user-defined"),pe.send(null),!(pe.status>=200&&pe.status<300||pe.status===304))throw new Error("Couldn't load "+a+". Status: "+pe.status);return pe.response!==void 0?new Uint8Array(pe.response||[]):hn(pe.responseText||"")},At=this;At.setDataGetter(Me=>{var dt=Me*ye,pe=(Me+1)*ye-1;if(pe=Math.min(pe,W-1),typeof At.chunks[Me]>"u"&&(At.chunks[Me]=Te(dt,pe)),typeof At.chunks[Me]>"u")throw new Error("doXHR failed!");return At.chunks[Me]}),(be||!W)&&(ye=W=1,W=this.getter(0).length,ye=W,ne("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=W,this._chunkSize=ye,this.lengthKnown=!0}get length(){return this.lengthKnown||this.cacheLength(),this._length}get chunkSize(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}if(typeof XMLHttpRequest<"u"){if(!g)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var v=new m,b={isDevice:!1,contents:v}}else var b={isDevice:!1,url:a};var M=c.createFile(n,o,b,u,h);b.contents?M.contents=b.contents:b.url&&(M.contents=null,M.url=b.url),Object.defineProperties(M,{usedBytes:{get:function(){return this.contents.length}}});var K={},X=Object.keys(M.stream_ops);X.forEach(V=>{var x=M.stream_ops[V];K[V]=(...W)=>(c.forceLoadFile(M),x(...W))});function Q(V,x,W,he,Pe){var be=V.node.contents;if(Pe>=be.length)return 0;var ye=Math.min(be.length-Pe,he);if(S(ye>=0),be.slice)for(var Te=0;Te<ye;Te++)x[W+Te]=be[Pe+Te];else for(var Te=0;Te<ye;Te++)x[W+Te]=be.get(Pe+Te);return ye}return K.read=(V,x,W,he,Pe)=>(c.forceLoadFile(M),Q(V,x,W,he,Pe)),K.mmap=(V,x,W,he,Pe)=>{c.forceLoadFile(M);var be=pn();if(!be)throw new c.ErrnoError(48);return Q(V,B,be,x,W),{ptr:be,allocated:!0}},M.stream_ops=K,M},absolutePath(){ie("FS.absolutePath has been removed; use PATH_FS.resolve instead")},createFolder(){ie("FS.createFolder has been removed; use FS.mkdir instead")},createLink(){ie("FS.createLink has been removed; use FS.symlink instead")},joinPath(){ie("FS.joinPath has been removed; use PATH.join instead")},mmapAlloc(){ie("FS.mmapAlloc has been replaced by the top level function mmapAlloc")},standardizePath(){ie("FS.standardizePath has been removed; use PATH.normalize instead")}},Tt={DEFAULT_POLLMASK:5,calculateAt(n,o,a){if(Z.isAbs(o))return o;var u;if(n===-100)u=c.cwd();else{var h=Tt.getStreamFromFD(n);u=h.path}if(o.length==0){if(!a)throw new c.ErrnoError(44);return u}return Z.join2(u,o)},doStat(n,o,a){var u=n(o);Y[a>>2]=u.dev,Y[a+4>>2]=u.mode,q[a+8>>2]=u.nlink,Y[a+12>>2]=u.uid,Y[a+16>>2]=u.gid,Y[a+20>>2]=u.rdev,ue=[u.size>>>0,(j=u.size,+Math.abs(j)>=1?j>0?+Math.floor(j/4294967296)>>>0:~~+Math.ceil((j-+(~~j>>>0))/4294967296)>>>0:0)],Y[a+24>>2]=ue[0],Y[a+28>>2]=ue[1],Y[a+32>>2]=4096,Y[a+36>>2]=u.blocks;var h=u.atime.getTime(),m=u.mtime.getTime(),v=u.ctime.getTime();return ue=[Math.floor(h/1e3)>>>0,(j=Math.floor(h/1e3),+Math.abs(j)>=1?j>0?+Math.floor(j/4294967296)>>>0:~~+Math.ceil((j-+(~~j>>>0))/4294967296)>>>0:0)],Y[a+40>>2]=ue[0],Y[a+44>>2]=ue[1],q[a+48>>2]=h%1e3*1e3*1e3,ue=[Math.floor(m/1e3)>>>0,(j=Math.floor(m/1e3),+Math.abs(j)>=1?j>0?+Math.floor(j/4294967296)>>>0:~~+Math.ceil((j-+(~~j>>>0))/4294967296)>>>0:0)],Y[a+56>>2]=ue[0],Y[a+60>>2]=ue[1],q[a+64>>2]=m%1e3*1e3*1e3,ue=[Math.floor(v/1e3)>>>0,(j=Math.floor(v/1e3),+Math.abs(j)>=1?j>0?+Math.floor(j/4294967296)>>>0:~~+Math.ceil((j-+(~~j>>>0))/4294967296)>>>0:0)],Y[a+72>>2]=ue[0],Y[a+76>>2]=ue[1],q[a+80>>2]=v%1e3*1e3*1e3,ue=[u.ino>>>0,(j=u.ino,+Math.abs(j)>=1?j>0?+Math.floor(j/4294967296)>>>0:~~+Math.ceil((j-+(~~j>>>0))/4294967296)>>>0:0)],Y[a+88>>2]=ue[0],Y[a+92>>2]=ue[1],0},doMsync(n,o,a,u,h){if(!c.isFile(o.node.mode))throw new c.ErrnoError(43);if(u&2)return 0;var m=fe.slice(n,n+a);c.msync(o,m,h,a,u)},getStreamFromFD(n){var o=c.getStreamChecked(n);return o},varargs:void 0,getStr(n){var o=ut(n);return o}};function No(n){try{var o=Tt.getStreamFromFD(n);return c.close(o),0}catch(a){if(typeof c>"u"||a.name!=="ErrnoError")throw a;return a.errno}}var Do=(n,o,a,u)=>{for(var h=0,m=0;m<a;m++){var v=q[o>>2],b=q[o+4>>2];o+=8;var M=c.read(n,B,v,b,u);if(M<0)return-1;if(h+=M,M<b)break}return h};function Lo(n,o,a,u){try{var h=Tt.getStreamFromFD(n),m=Do(h,o,a);return q[u>>2]=m,0}catch(v){if(typeof c>"u"||v.name!=="ErrnoError")throw v;return v.errno}}var $o=(n,o)=>(S(n==n>>>0||n==(n|0)),S(o===(o|0)),o+2097152>>>0<4194305-!!n?(n>>>0)+o*4294967296:NaN);function Io(n,o,a,u,h){var m=$o(o,a);try{if(isNaN(m))return 61;var v=Tt.getStreamFromFD(n);return c.llseek(v,m,u),ue=[v.position>>>0,(j=v.position,+Math.abs(j)>=1?j>0?+Math.floor(j/4294967296)>>>0:~~+Math.ceil((j-+(~~j>>>0))/4294967296)>>>0:0)],Y[h>>2]=ue[0],Y[h+4>>2]=ue[1],v.getdents&&m===0&&u===0&&(v.getdents=null),0}catch(b){if(typeof c>"u"||b.name!=="ErrnoError")throw b;return b.errno}}var Uo=(n,o,a,u)=>{for(var h=0,m=0;m<a;m++){var v=q[o>>2],b=q[o+4>>2];o+=8;var M=c.write(n,B,v,b,u);if(M<0)return-1;if(h+=M,M<b)break}return h};function zo(n,o,a,u){try{var h=Tt.getStreamFromFD(n),m=Uo(h,o,a);return q[u>>2]=m,0}catch(v){if(typeof c>"u"||v.name!=="ErrnoError")throw v;return v.errno}}c.createPreloadedFile=Ro,c.staticInit();function Bo(){so("fetchSettings")}var gn={__assert_fail:uo,__cxa_throw:ho,_abort_js:po,_emscripten_memcpy_js:mo,_tzset_js:go,emscripten_resize_heap:bo,environ_get:Eo,environ_sizes_get:So,fd_close:No,fd_read:Lo,fd_seek:Io,fd_write:zo},Xe=oo();i._create_position=ee("create_position",1),i._delete_position=ee("delete_position",1),i._make_move=ee("make_move",2),i._unmake_move=ee("unmake_move",2),i._get_legal_moves=ee("get_legal_moves",2),i._malloc=ee("malloc",1),i._free_legal_moves=ee("free_legal_moves",1),i._free=ee("free",1),i._pos_attacks_to=ee("pos_attacks_to",4),i._pos_attacks=ee("pos_attacks",3),i._get_pieces_bb=ee("get_pieces_bb",4),i._get_pieces_color_bb=ee("get_pieces_color_bb",3),i._get_occupied=ee("get_occupied",2),i._get_attacks=ee("get_attacks",6),i._get_turn=ee("get_turn",1),i._get_at=ee("get_at",2),i._get_fen=ee("get_fen",1),i._is_checkmate=ee("is_checkmate",1),i._init=ee("init",0);var jo=ee("fflush",1),Wo=ee("strerror",1),vn=()=>(vn=Xe.emscripten_stack_init)(),hr=()=>(hr=Xe.emscripten_stack_get_end)();i.dynCall_viijii=ee("dynCall_viijii",7),i.dynCall_jiji=ee("dynCall_jiji",5),i.dynCall_iiiiij=ee("dynCall_iiiiij",7),i.dynCall_iiiiijj=ee("dynCall_iiiiijj",9),i.dynCall_iiiiiijj=ee("dynCall_iiiiiijj",10);var Ho=["writeI53ToI64","writeI53ToI64Clamped","writeI53ToI64Signaling","writeI53ToU64Clamped","writeI53ToU64Signaling","readI53FromI64","readI53FromU64","convertI32PairToI53","convertU32PairToI53","stackAlloc","getTempRet0","setTempRet0","exitJS","inetPton4","inetNtop4","inetPton6","inetNtop6","readSockaddr","writeSockaddr","emscriptenLog","readEmAsmArgs","jstoi_q","listenOnce","autoResumeAudioContext","dynCallLegacy","getDynCaller","dynCall","handleException","keepRuntimeAlive","runtimeKeepalivePush","runtimeKeepalivePop","callUserCallback","maybeExit","asmjsMangle","HandleAllocator","getNativeTypeSize","STACK_SIZE","STACK_ALIGN","POINTER_SIZE","ASSERTIONS","getCFunc","ccall","cwrap","uleb128Encode","sigToWasmTypes","generateFuncType","convertJsFunctionToWasm","getEmptyTableSlot","updateTableMap","getFunctionAddress","addFunction","removeFunction","reallyNegative","unSign","strLen","reSign","formatString","intArrayToString","AsciiToString","UTF16ToString","stringToUTF16","lengthBytesUTF16","UTF32ToString","stringToUTF32","lengthBytesUTF32","stringToNewUTF8","stringToUTF8OnStack","writeArrayToMemory","registerKeyEventCallback","maybeCStringToJsString","findEventTarget","getBoundingClientRect","fillMouseEventData","registerMouseEventCallback","registerWheelEventCallback","registerUiEventCallback","registerFocusEventCallback","fillDeviceOrientationEventData","registerDeviceOrientationEventCallback","fillDeviceMotionEventData","registerDeviceMotionEventCallback","screenOrientation","fillOrientationChangeEventData","registerOrientationChangeEventCallback","fillFullscreenChangeEventData","registerFullscreenChangeEventCallback","JSEvents_requestFullscreen","JSEvents_resizeCanvasForFullscreen","registerRestoreOldStyle","hideEverythingExceptGivenElement","restoreHiddenElements","setLetterbox","softFullscreenResizeWebGLRenderTarget","doRequestFullscreen","fillPointerlockChangeEventData","registerPointerlockChangeEventCallback","registerPointerlockErrorEventCallback","requestPointerLock","fillVisibilityChangeEventData","registerVisibilityChangeEventCallback","registerTouchEventCallback","fillGamepadEventData","registerGamepadEventCallback","registerBeforeUnloadEventCallback","fillBatteryEventData","battery","registerBatteryEventCallback","setCanvasElementSize","getCanvasElementSize","jsStackTrace","getCallstack","convertPCtoSourceLocation","checkWasiClock","wasiRightsToMuslOFlags","wasiOFlagsToMuslOFlags","safeSetTimeout","setImmediateWrapped","safeRequestAnimationFrame","clearImmediateWrapped","polyfillSetImmediate","registerPostMainLoop","registerPreMainLoop","getPromise","makePromise","idsToPromises","makePromiseCallback","findMatchingCatch","Browser_asyncPrepareDataCounter","isLeapYear","ydayFromDate","arraySum","addDays","getSocketFromFD","getSocketAddress","FS_unlink","FS_mkdirTree","_setNetworkCallback","heapObjectForWebGLType","toTypedArrayIndex","webgl_enable_ANGLE_instanced_arrays","webgl_enable_OES_vertex_array_object","webgl_enable_WEBGL_draw_buffers","webgl_enable_WEBGL_multi_draw","webgl_enable_EXT_polygon_offset_clamp","webgl_enable_EXT_clip_control","webgl_enable_WEBGL_polygon_mode","emscriptenWebGLGet","computeUnpackAlignedImageSize","colorChannelsInGlTextureFormat","emscriptenWebGLGetTexPixelData","emscriptenWebGLGetUniform","webglGetUniformLocation","webglPrepareUniformLocationsBeforeFirstUse","webglGetLeftBracePos","emscriptenWebGLGetVertexAttrib","__glGetActiveAttribOrUniform","writeGLArray","registerWebGlEventCallback","runAndAbortIfError","ALLOC_NORMAL","ALLOC_STACK","allocate","writeStringToMemory","writeAsciiToMemory","setErrNo","demangle","stackTrace"];Ho.forEach(ao);var Go=["run","addOnPreRun","addOnInit","addOnPreMain","addOnExit","addOnPostRun","addRunDependency","removeRunDependency","out","err","callMain","abort","wasmMemory","wasmExports","writeStackCookie","checkStackCookie","convertI32PairToI53Checked","stackSave","stackRestore","ptrToString","zeroMemory","getHeapMax","growMemory","ENV","ERRNO_CODES","strError","DNS","Protocols","Sockets","timers","warnOnce","readEmAsmArgsArray","jstoi_s","getExecutableName","asyncLoad","alignMemory","mmapAlloc","wasmTable","noExitRuntime","freeTableIndexes","functionsInTableMap","setValue","getValue","PATH","PATH_FS","UTF8Decoder","UTF8ArrayToString","UTF8ToString","stringToUTF8Array","stringToUTF8","lengthBytesUTF8","intArrayFromString","stringToAscii","UTF16Decoder","JSEvents","specialHTMLTargets","findCanvasEventTarget","currentFullscreenStrategy","restoreOldWindowedStyle","UNWIND_CACHE","ExitStatus","getEnvStrings","doReadv","doWritev","initRandomFill","randomFill","promiseMap","uncaughtExceptionCount","exceptionLast","exceptionCaught","ExceptionInfo","Browser","getPreloadedImageData__data","wget","MONTH_DAYS_REGULAR","MONTH_DAYS_LEAP","MONTH_DAYS_REGULAR_CUMULATIVE","MONTH_DAYS_LEAP_CUMULATIVE","SYSCALLS","preloadPlugins","FS_createPreloadedFile","FS_modeStringToFlags","FS_getMode","FS_stdin_getChar_buffer","FS_stdin_getChar","FS_createPath","FS_createDevice","FS_readFile","FS","FS_createDataFile","FS_createLazyFile","MEMFS","TTY","PIPEFS","SOCKFS","tempFixedLengthArray","miniTempWebGLFloatBuffers","miniTempWebGLIntBuffers","GL","AL","GLUT","EGL","GLEW","IDBStore","SDL","SDL_gfx","allocateUTF8","allocateUTF8OnStack","print","printErr"];Go.forEach(un);var Vt;kt=function n(){Vt||_n(),Vt||(kt=n)};function Ko(){vn(),jt()}function _n(){if(Ge>0||(Ko(),qi(),Ge>0))return;function n(){Vt||(Vt=!0,i.calledRun=!0,!O&&(Yi(),s(i),i.onRuntimeInitialized?.(),S(!i._main,'compiled without a main, but one is present. if you added it from JS, use Module["onRuntimeInitialized"]'),Xi()))}i.setStatus?(i.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>i.setStatus(""),1),n()},1)):n(),wt()}if(i.preInit)for(typeof i.preInit=="function"&&(i.preInit=[i.preInit]);i.preInit.length>0;)i.preInit.pop()();_n(),r=d;for(const n of Object.keys(i))n in t||Object.defineProperty(t,n,{configurable:!0,get(){ie(`Access to module property ('${n}') is no longer possible via the module constructor argument; Instead, use the result of the module constructor.`)}});return r}})();const Vn=0,ws=1,qn=2,bs=3,ks=4,ys=5,Es=6,Ss=0,Cs=16384;function Yn(e){return e>>3}function Xn(e){return e&7}function Ps(e){let t=Yn(e),r=Xn(e);return{color:Ts(t),role:Qn(r)}}function Qn(e){switch(e){case ws:return"pawn";case qn:return"knight";case bs:return"bishop";case ks:return"rook";case ys:return"queen";case Es:return"king"}throw"No Piece Type"}function Ts(e){return e===Vn?"white":"black"}function Nt(e){let t=e&63,r=e>>6&63,s=(e&49152)===Cs?Qn((e>>12&3)+qn):void 0;return{from:r,to:t,promotion:s}}class $r{m;static async make(t){let r=await _s({locateFile:t});return r._init(),new $r(r)}constructor(t){this.m=t}create_position(t){return this.m._create_position(this.stringToWasm(t))}delete_position(t){this.m._delete_position(t)}unmake_move(t,r){this.m._unmake_move(t,r)}make_move(t,r){this.m._make_move(t,r)}pos_turn(t){return this.m._get_turn(t)===Vn?"white":"black"}get_legal_moves(t){const r=this.m._malloc(4);let i=this.m._get_legal_moves(t,r);const s=this.m.getValue(r,"i32");let l=[];for(let d=0;d<s;d++){const f=this.m.getValue(i+d*4,"i32");l.push(f)}return this.m._free(r),this.m._free(i),l}pos_occupied(t){const r=this.m._malloc(8);this.m._get_occupied(t,r);const i=this.m.getValue(r,"i32"),s=this.m.getValue(r+4,"i32");return this.m._free(r),new De(i,s)}attacks(t,r,i){const s=this.m._malloc(8);this.m._get_attacks(Xn(t),Yn(t),r,i.lo,i.hi,s);const l=this.m.getValue(s,"i32"),d=this.m.getValue(s+4,"i32");return this.m._free(s),new De(l,d)}pos_attacks(t,r){const i=this.m._malloc(8);this.m._pos_attacks(t,r,i);const s=this.m.getValue(i,"i32"),l=this.m.getValue(i+4,"i32");return this.m._free(i),new De(s,l)}pos_attacks_of_color(t,r){const i=this.m._malloc(8);this.m._pos_attacks_to(t,r,0,i);const s=this.m.getValue(i,"i32"),l=this.m.getValue(i+4,"i32");return this.m._free(i),new De(s,l)}get_pieces_color_bb(t,r){const i=this.m._malloc(8);this.m._get_pieces_color_bb(t,r,i);const s=this.m.getValue(i,"i32"),l=this.m.getValue(i+4,"i32");return this.m._free(i),new De(s,l)}get_pieces_bb(t,r){const i=this.m._malloc(8),s=this.m._malloc(4*r.length);for(let f=0;f<r.length;f++)this.m.setValue(s+f*4,r[f],"i32");this.m._get_pieces_bb(t,s,r.length,i);const l=this.m.getValue(i,"i32"),d=this.m.getValue(i+4,"i32");return this.m._free(i),this.m._free(s),new De(l,d)}get_at(t,r){let i=this.m._get_at(t,r);if(i!==Ss)return i}is_checkmate(t){return this.m._is_checkmate(t)}get_pos_read_fen(t){let r=this.wasmToStringAndFree(this.m._get_fen(t));return ts.fromSetup(rs(r).unwrap()).unwrap()}make_san(t,r){let i=this.get_pos_read_fen(t);return kr(i,Nt(r))}stringToWasm(t){let r=this.m;const i=t.length+1,s=r._malloc(i);return r.stringToUTF8(t,s,i),s}wasmToStringAndFree(t){return this.m.UTF8ToString(t)}}function Jn(e,t){let r=ns(e);is(r);let i=Zn(r),s=R.create_position(t),l=Ns(s);yr(i,[{data:{path:[],move:void 0,before:l,after:l}}],s);let f=ei(i,s);return R.delete_position(s),f}function Zn(e){let t=e.sentence,r=e.children.map(Zn);return{sentence:t,children:r,res:[],children_resolved:!1,line:e}}function yr(e,t,r){let i=[],s=Os(e.sentence,r);for(let f of t){for(let p of f.data.path)R.make_move(r,p);["E","A"].includes(e.sentence.precessor)&&f.data.move&&R.make_move(r,f.data.move);let g=Rs(e.sentence,f,r);g=g.filter(s);for(let p of g)i.push({parent:f,data:p});["E","A"].includes(e.sentence.precessor)&&f.data.move&&R.unmake_move(r,f.data.move);for(let p=f.data.path.length-1;p>=0;p--){let _=f.data.path[p];R.unmake_move(r,_)}}if(i.length===0)return e.children_resolved=!0,e.res=[],e.res;let l=i,d=new Map;for(let f of l){let g=f.data.path.join(" ");d.has(g)||d.set(g,[]),d.get(g).push(f)}if(e.sentence.precessor==="E"||e.sentence.precessor==="."||e.sentence.precessor==="G")for(let[f,g]of d){let p=[],_=[];for(let w of e.children){let C=yr(w,g,r);if(w.children_resolved){for(let P of g)C.find(k=>k===P||k.parent===P)?p.push(P):_.push(P);g=_}}if(e.children.length===0){e.res=i,e.children_resolved=!0;break}if(p.length>0){e.res=p,e.children_resolved=!0;break}}else if(e.sentence.precessor==="A"){e.res=[];let f=[];for(let[g,p]of d){let _=p;for(let w of e.children){let C=yr(w,p,r);w.children_resolved&&(p=p.filter(P=>!C.find(k=>k===P||k.parent===P)))}e.children.length>0&&p.length!==0||f.push(_)}f.length>0&&(e.res=f.flat(),e.children_resolved=!0)}else e.children_resolved=!0;return e.res}function Pn(e,t){re(e.piece),e.attack.map(re);let r=e.blocked.map(([s,l,d])=>[re(s),re(l),re(d)]);e.unblocked.map(([s,l])=>[re(s),re(l)]),e.attacked_by.map(re),e.double_blocked.map(([s,l,d])=>[re(s),re(l),re(d)]),e.undefended_by.map(re),e.zero_defend,e.zero_attack;let i=e.is_mate;return s=>{let l=s.after[e.piece],d=s.after;if(i&&!R.is_checkmate(t))return!1;if(e.zero_defend){for(let f of ti(d))if(R.pos_attacks(t,d[f]).has(l))return!1}if(e.attack.length>0)for(let f=0;f<e.attack.length;f++){let g=d[e.attack[f]];if(g===void 0||!R.pos_attacks(t,l).has(g))return!1}if(e.attacked_by.length>0){for(let f=0;f<e.attacked_by.length;f++){let g=d[e.attacked_by[f]];if(g===void 0||!R.pos_attacks(t,g).has(l))return!1}for(let f of Object.keys(d))if(!e.attacked_by.includes(f)){let g=d[f];if(R.pos_attacks(t,g).has(l))return!1}}if(e.undefended_by.length>0)for(let f=0;f<e.undefended_by.length;f++){let g=e.undefended_by[f];if(R.pos_attacks(t,d[g]).has(l))return!1}if(e.blocked.length>0){let f=R.pos_occupied(t);for(let g=0;g<e.blocked.length;g++){let p=r[g][0],[_,w,C]=e.blocked[g],P=d[_],k=d[w],E=d[C];if(P===void 0||k===void 0||E===void 0)return!1;if(!(Je(p,P,f.without(E)).has(k)&&!Je(p,P,f).has(k)))return!1}}if(e.double_blocked.length>0){let f=R.pos_occupied(t);for(let g=0;g<e.double_blocked.length;g++){let[p,_,w]=e.double_blocked[g],C=d[p],P=d[_],k=d[w];if(C===void 0||P===void 0||k===void 0)return!1;if(!(Je(re(p),C,f.without(P).without(k)).has(l)&&!Je(re(p),C,f.without(P)).has(l)&&!Je(re(p),C,f.without(k)).has(l)))return!1}}return!0}}function As(e,t){re(e.move),e.attack.map(re);let r=e.blocked.map(([s,l,d])=>[re(s),re(l),re(d)]);e.unblocked.map(([s,l])=>[re(s),re(l)]),e.captured&&re(e.captured),e.attacked_by.map(re),e.undefended_by.map(re),e.zero_defend,e.zero_attack;let i=e.is_mate;return s=>{if(!s.move)return!1;let l=s.move,d=Nt(s.move),f=s.before,g=s.after;if(i){if(R.make_move(t,l),!R.is_checkmate(t))return R.unmake_move(t,l),!1;R.unmake_move(t,l)}if(f[e.move]!==d.from||e.captured&&f[e.captured]!==d.to)return!1;if(e.zero_defend){for(let p of ti(g))if(R.pos_attacks(t,g[p]).has(d.to))return!1}if(e.attack.length>0){R.make_move(t,l);for(let p=0;p<e.attack.length;p++){let _=f[e.attack[p]];if(_===void 0)return R.unmake_move(t,l),!1;if(!R.pos_attacks(t,d.to).has(_))return R.unmake_move(t,l),!1}R.unmake_move(t,l)}if(e.attacked_by.length>0){R.make_move(t,l);for(let p=0;p<e.attacked_by.length;p++){let _=f[e.attacked_by[p]];if(_===void 0)return R.unmake_move(t,l),!1;if(!R.pos_attacks(t,_).has(d.to))return R.unmake_move(t,l),!1}for(let p of Object.keys(f))if(!e.attacked_by.includes(p)){let _=f[p];if(R.pos_attacks(t,_).has(d.to))return R.unmake_move(t,l),!1}R.unmake_move(t,l)}if(e.unblocked.length>0){for(let p=0;p<e.unblocked.length;p++){let[_,w]=e.unblocked[p],C=g[_],P=g[w];if(R.pos_attacks(t,C).has(P))return!1}R.make_move(t,l);for(let p=0;p<e.unblocked.length;p++){let[_,w]=e.unblocked[p],C=f[_],P=f[w];if(!R.pos_attacks(t,C).has(P))return R.unmake_move(t,l),!1}R.unmake_move(t,l)}if(e.undefended_by.length>0)for(let p=0;p<e.undefended_by.length;p++){let _=e.undefended_by[p];if(R.pos_attacks(t,f[_]).has(d.to))return!1}if(e.blocked.length>0){let p=R.pos_occupied(t);R.make_move(t,l);for(let _=0;_<e.blocked.length;_++){let w=r[_][0],[C,P,k]=e.blocked[_],E=g[C],F=g[P],A=g[k];if(E===void 0||F===void 0||A===void 0)return R.unmake_move(t,l),!1;if(!(Je(w,E,p.without(A)).has(F)&&!Je(w,E,p).has(F)))return R.unmake_move(t,l),!1}R.unmake_move(t,l)}return!0}}const Ms=()=>!0;function Os(e,t){if(e.type==="move_attack")return As(e,t);if(e.type==="still_attack")return Pn(e,t);if(e.type==="g_still_attack"){let r=e.attacks.map(i=>Pn(i,t));return i=>r.every(s=>s(i))}return Ms}function Rs(e,t,r){if(["E","A","*"].includes(e.precessor)){let i=t.data.path.slice(0);return t.data.move&&i.push(t.data.move),R.get_legal_moves(r).map(s=>({path:i,move:s,before:t.data.after,after:xs(t.data.after,r,s)}))}else return[t.data]}function Fs(e,t){if(!e.data.move)return"";if(!e.parent){let s=Nt(e.data.move);R.make_move(t,e.data.move);let l=R.get_pos_read_fen(t);return R.unmake_move(t,e.data.move),`${kr(l,s)}`}let r=e.data.path.slice(0);r.push(e.data.move);let i=[];for(let s of r){let l=R.get_pos_read_fen(t),d=kr(l,Nt(s));R.make_move(t,s),i.push(d)}r.reverse();for(let s of r)R.unmake_move(t,s);return`${i.join(" ")}`}function ei(e,t){let r=e.line,i="",s=" ".repeat(r.depth+1),l=r.long?150:1,d=(r.no_c,e.res),f=d.slice(0,l).map(p=>Fs(p,t)).join(", ");d.length>1&&(f+=" .."+d.length);let g=e.children_resolved;return i+=" "+r.rule+(g?" OK":" ?")+" <"+(f??"?")+`>
`,e.children.map((p,_)=>{_===e.children.length-1?i+=s+"":_===0?i+=s+"":i+=s+" ",i+=ei(p,t)}).join(""),i}function xs(e,t,r){let i={},s=Nt(r);for(let l of Object.keys(e))e[l]===s.from?i[l]=s.to:e[l]===s.to||(i[l]=e[l]);return i}function Ns(e){let t={};for(let r of De.full()){let i=R.get_at(e,r);if(i!==void 0){let s=Ps(i),l=os(s);if(t[l]!==void 0){for(let d=2;d<=8;d++)if(t[l+d]===void 0){t[l+d]=r;break}}else t[l]=r}}return t}function Ds(e,t){let r=Jn(e,t),s=(r.trim().split(`
`)[1]?.match(/E [^O]*OK <([^>]+)/)??r.trim().split(`
`)[2]?.match(/E [^O]*OK <([^>]+)/))?.[1];return s?.includes(".")?s.slice(0,s.indexOf(".")):s}function ti(e){return Object.keys(e).filter(t=>t[0].toLowerCase()!==t[0])}const ri=e=>{let t=Object.keys(e.has_tags).length,r={...e.has_tags};return t>0&&(r.has_tag=!0,t===1?r.single_tag=!0:r.many_tags=!0),r[`id_${e.id}`]=!0,r},Ir=e=>{let t={...e.tags,...ri(e)};if(e.rules){[...new Set(e.rules.flatMap(Ls))].forEach(l=>t[l]=!0);let i=[],s=e.rules.filter(l=>l.solve===void 0||l.solve>=0);if(s.length>0){let l=s[0];l.solve===void 0?(i.push("matched"),i.push(`matched_${l.rule.name}`)):i.push("unmatched")}i.forEach(l=>t[l]=!0),s.length===1&&(t.single_attempt=!0)}return t},Ls=e=>e.solve===void 0?(e.rule.rule.includes("."),["solved",`solved_${e.rule.name}`]):e.solve>=0?["failed",`failed_${e.rule.name}`]:[""],Tn=e=>t=>{let r=Ir(t),[i,s]=e.split("_!_").map(d=>d.trim()),l=i===""?[]:i.split(" ");return s&&s.split(" ").find(f=>r[f])?!1:l.every(d=>r[d])},$s=""+new URL("hopefox-LFTqDWdf.wasm",import.meta.url).href,Is=["white","black"],Qt=["a","b","c","d","e","f","g","h"],Jt=["1","2","3","4","5","6","7","8"],Us=[...Jt].reverse(),Ur=Array.prototype.concat(...Qt.map(e=>Jt.map(t=>e+t))),Ee=e=>Ur[8*e[0]+e[1]],oe=e=>[e.charCodeAt(0)-97,e.charCodeAt(1)-49],ni=Ur.map(oe);function zs(e){let t;const r=()=>(t===void 0&&(t=e()),t);return r.clear=()=>{t=void 0},r}const Bs=()=>{let e;return{start(){e=performance.now()},cancel(){e=void 0},stop(){if(!e)return 0;const t=performance.now()-e;return e=void 0,t}}},zr=e=>e==="white"?"black":"white",Dt=(e,t)=>{const r=e[0]-t[0],i=e[1]-t[1];return r*r+i*i},Er=(e,t)=>e.role===t.role&&e.color===t.color,Bt=e=>(t,r)=>[(r?t[0]:7-t[0])*e.width/8,(r?7-t[1]:t[1])*e.height/8],Oe=(e,t)=>{e.style.transform=`translate(${t[0]}px,${t[1]}px)`},ii=(e,t,r=1)=>{e.style.transform=`translate(${t[0]}px,${t[1]}px) scale(${r})`},Br=(e,t)=>{e.style.visibility=t?"visible":"hidden"},it=e=>{var t;if(e.clientX||e.clientX===0)return[e.clientX,e.clientY];if(!((t=e.targetTouches)===null||t===void 0)&&t[0])return[e.targetTouches[0].clientX,e.targetTouches[0].clientY]},oi=e=>e.button===2,$e=(e,t)=>{const r=document.createElement(e);return t&&(r.className=t),r};function si(e,t,r){const i=oe(e);return t||(i[0]=7-i[0],i[1]=7-i[1]),[r.left+r.width*i[0]/8+r.width/16,r.top+r.height*(7-i[1])/8+r.height/16]}const tt=(e,t)=>Math.abs(e-t),js=e=>(t,r,i,s)=>tt(t,i)<2&&(e==="white"?s===r+1||r<=1&&s===r+2&&t===i:s===r-1||r>=6&&s===r-2&&t===i),ai=(e,t,r,i)=>{const s=tt(e,r),l=tt(t,i);return s===1&&l===2||s===2&&l===1},li=(e,t,r,i)=>tt(e,r)===tt(t,i),ci=(e,t,r,i)=>e===r||t===i,ui=(e,t,r,i)=>li(e,t,r,i)||ci(e,t,r,i),Ws=(e,t,r)=>(i,s,l,d)=>tt(i,l)<2&&tt(s,d)<2||r&&s===d&&s===(e==="white"?0:7)&&(i===4&&(l===2&&t.includes(0)||l===6&&t.includes(7))||t.includes(l));function Hs(e,t){const r=t==="white"?"1":"8",i=[];for(const[s,l]of e)s[1]===r&&l.color===t&&l.role==="rook"&&i.push(oe(s)[0]);return i}function di(e,t,r){const i=e.get(t);if(!i)return[];const s=oe(t),l=i.role,d=l==="pawn"?js(i.color):l==="knight"?ai:l==="bishop"?li:l==="rook"?ci:l==="queen"?ui:Ws(i.color,Hs(e,i.color),r);return ni.filter(f=>(s[0]!==f[0]||s[1]!==f[1])&&d(s[0],s[1],f[0],f[1])).map(Ee)}function _e(e,...t){e&&setTimeout(()=>e(...t),1)}function Gs(e){e.orientation=zr(e.orientation),e.animation.current=e.draggable.current=e.selected=void 0}function Ks(e,t){for(const[r,i]of t)i?e.pieces.set(r,i):e.pieces.delete(r)}function Vs(e,t){if(e.check=void 0,t===!0&&(t=e.turnColor),t)for(const[r,i]of e.pieces)i.role==="king"&&i.color===t&&(e.check=r)}function qs(e,t,r,i){He(e),e.premovable.current=[t,r],_e(e.premovable.events.set,t,r,i)}function We(e){e.premovable.current&&(e.premovable.current=void 0,_e(e.premovable.events.unset))}function Ys(e,t,r){We(e),e.predroppable.current={role:t,key:r},_e(e.predroppable.events.set,t,r)}function He(e){const t=e.predroppable;t.current&&(t.current=void 0,_e(t.events.unset))}function Xs(e,t,r){if(!e.autoCastle)return!1;const i=e.pieces.get(t);if(!i||i.role!=="king")return!1;const s=oe(t),l=oe(r);if(s[1]!==0&&s[1]!==7||s[1]!==l[1])return!1;s[0]===4&&!e.pieces.has(r)&&(l[0]===6?r=Ee([7,l[1]]):l[0]===2&&(r=Ee([0,l[1]])));const d=e.pieces.get(r);return!d||d.color!==i.color||d.role!=="rook"?!1:(e.pieces.delete(t),e.pieces.delete(r),s[0]<l[0]?(e.pieces.set(Ee([6,l[1]]),i),e.pieces.set(Ee([5,l[1]]),d)):(e.pieces.set(Ee([2,l[1]]),i),e.pieces.set(Ee([3,l[1]]),d)),!0)}function fi(e,t,r){const i=e.pieces.get(t),s=e.pieces.get(r);if(t===r||!i)return!1;const l=s&&s.color!==i.color?s:void 0;return r===e.selected&&Se(e),_e(e.events.move,t,r,l),Xs(e,t,r)||(e.pieces.set(r,i),e.pieces.delete(t)),e.lastMove=[t,r],e.check=void 0,_e(e.events.change),l||!0}function jr(e,t,r,i){if(e.pieces.has(r))if(i)e.pieces.delete(r);else return!1;return _e(e.events.dropNewPiece,t,r),e.pieces.set(r,t),e.lastMove=[r],e.check=void 0,_e(e.events.change),e.movable.dests=void 0,e.turnColor=zr(e.turnColor),!0}function hi(e,t,r){const i=fi(e,t,r);return i&&(e.movable.dests=void 0,e.turnColor=zr(e.turnColor),e.animation.current=void 0),i}function pi(e,t,r){if(Wr(e,t,r)){const i=hi(e,t,r);if(i){const s=e.hold.stop();Se(e);const l={premove:!1,ctrlKey:e.stats.ctrlKey,holdTime:s};return i!==!0&&(l.captured=i),_e(e.movable.events.after,t,r,l),!0}}else if(Js(e,t,r))return qs(e,t,r,{ctrlKey:e.stats.ctrlKey}),Se(e),!0;return Se(e),!1}function mi(e,t,r,i){const s=e.pieces.get(t);s&&(Qs(e,t,r)||i)?(e.pieces.delete(t),jr(e,s,r,i),_e(e.movable.events.afterNewPiece,s.role,r,{premove:!1,predrop:!1})):s&&Zs(e,t,r)?Ys(e,s.role,r):(We(e),He(e)),e.pieces.delete(t),Se(e)}function Sr(e,t,r){if(_e(e.events.select,t),e.selected){if(e.selected===t&&!e.draggable.enabled){Se(e),e.hold.cancel();return}else if((e.selectable.enabled||r)&&e.selected!==t&&pi(e,e.selected,t)){e.stats.dragged=!1;return}}(e.selectable.enabled||e.draggable.enabled)&&(vi(e,t)||Hr(e,t))&&(gi(e,t),e.hold.start())}function gi(e,t){e.selected=t,Hr(e,t)?e.premovable.customDests||(e.premovable.dests=di(e.pieces,t,e.premovable.castle)):e.premovable.dests=void 0}function Se(e){e.selected=void 0,e.premovable.dests=void 0,e.hold.cancel()}function vi(e,t){const r=e.pieces.get(t);return!!r&&(e.movable.color==="both"||e.movable.color===r.color&&e.turnColor===r.color)}const Wr=(e,t,r)=>{var i,s;return t!==r&&vi(e,t)&&(e.movable.free||!!(!((s=(i=e.movable.dests)===null||i===void 0?void 0:i.get(t))===null||s===void 0)&&s.includes(r)))};function Qs(e,t,r){const i=e.pieces.get(t);return!!i&&(t===r||!e.pieces.has(r))&&(e.movable.color==="both"||e.movable.color===i.color&&e.turnColor===i.color)}function Hr(e,t){const r=e.pieces.get(t);return!!r&&e.premovable.enabled&&e.movable.color===r.color&&e.turnColor!==r.color}function Js(e,t,r){var i,s;const l=(s=(i=e.premovable.customDests)===null||i===void 0?void 0:i.get(t))!==null&&s!==void 0?s:di(e.pieces,t,e.premovable.castle);return t!==r&&Hr(e,t)&&l.includes(r)}function Zs(e,t,r){const i=e.pieces.get(t),s=e.pieces.get(r);return!!i&&(!s||s.color!==e.movable.color)&&e.predroppable.enabled&&(i.role!=="pawn"||r[1]!=="1"&&r[1]!=="8")&&e.movable.color===i.color&&e.turnColor!==i.color}function ea(e,t){const r=e.pieces.get(t);return!!r&&e.draggable.enabled&&(e.movable.color==="both"||e.movable.color===r.color&&(e.turnColor===r.color||e.premovable.enabled))}function ta(e){const t=e.premovable.current;if(!t)return!1;const r=t[0],i=t[1];let s=!1;if(Wr(e,r,i)){const l=hi(e,r,i);if(l){const d={premove:!0};l!==!0&&(d.captured=l),_e(e.movable.events.after,r,i,d),s=!0}}return We(e),s}function ra(e,t){const r=e.predroppable.current;let i=!1;if(!r)return!1;if(t(r)){const s={role:r.role,color:e.movable.color};jr(e,s,r.key)&&(_e(e.movable.events.afterNewPiece,r.role,r.key,{premove:!1,predrop:!0}),i=!0)}return He(e),i}function Gr(e){We(e),He(e),Se(e)}function An(e){e.movable.color=e.movable.dests=e.animation.current=void 0,Gr(e)}function ot(e,t,r){let i=Math.floor(8*(e[0]-r.left)/r.width);t||(i=7-i);let s=7-Math.floor(8*(e[1]-r.top)/r.height);return t||(s=7-s),i>=0&&i<8&&s>=0&&s<8?Ee([i,s]):void 0}function na(e,t,r,i){const s=oe(e),l=ni.filter(p=>ui(s[0],s[1],p[0],p[1])||ai(s[0],s[1],p[0],p[1])),f=l.map(p=>si(Ee(p),r,i)).map(p=>Dt(t,p)),[,g]=f.reduce((p,_,w)=>p[0]<_?p:[_,w],[f[0],0]);return Ee(l[g])}const we=e=>e.orientation==="white",_i="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",ia={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},oa={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};function wi(e){e==="start"&&(e=_i);const t=new Map;let r=7,i=0;for(const s of e)switch(s){case" ":case"[":return t;case"/":if(--r,r<0)return t;i=0;break;case"~":{const l=t.get(Ee([i-1,r]));l&&(l.promoted=!0);break}default:{const l=s.charCodeAt(0);if(l<57)i+=l-48;else{const d=s.toLowerCase();t.set(Ee([i,r]),{role:ia[d],color:s===d?"black":"white"}),++i}}}return t}function sa(e){return Us.map(t=>Qt.map(r=>{const i=e.get(r+t);if(i){let s=oa[i.role];return i.color==="white"&&(s=s.toUpperCase()),i.promoted&&(s+="~"),s}else return"1"}).join("")).join("/").replace(/1{2,}/g,t=>t.length.toString())}function bi(e,t){t.animation&&(Kr(e.animation,t.animation),(e.animation.duration||0)<70&&(e.animation.enabled=!1))}function ki(e,t){var r,i,s;if(!((r=t.movable)===null||r===void 0)&&r.dests&&(e.movable.dests=void 0),!((i=t.drawable)===null||i===void 0)&&i.autoShapes&&(e.drawable.autoShapes=[]),Kr(e,t),t.fen&&(e.pieces=wi(t.fen),e.drawable.shapes=((s=t.drawable)===null||s===void 0?void 0:s.shapes)||[]),"check"in t&&Vs(e,t.check||!1),"lastMove"in t&&!t.lastMove?e.lastMove=void 0:t.lastMove&&(e.lastMove=t.lastMove),e.selected&&gi(e,e.selected),bi(e,t),!e.movable.rookCastle&&e.movable.dests){const l=e.movable.color==="white"?"1":"8",d="e"+l,f=e.movable.dests.get(d),g=e.pieces.get(d);if(!f||!g||g.role!=="king")return;e.movable.dests.set(d,f.filter(p=>!(p==="a"+l&&f.includes("c"+l))&&!(p==="h"+l&&f.includes("g"+l))))}}function Kr(e,t){for(const r in t)r==="__proto__"||r==="constructor"||!Object.prototype.hasOwnProperty.call(t,r)||(Object.prototype.hasOwnProperty.call(e,r)&&Mn(e[r])&&Mn(t[r])?Kr(e[r],t[r]):e[r]=t[r])}function Mn(e){if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return t===Object.prototype||t===null}const Qe=(e,t)=>t.animation.enabled?ca(e,t):Ue(e,t);function Ue(e,t){const r=e(t);return t.dom.redraw(),r}const pr=(e,t)=>({key:e,pos:oe(e),piece:t}),aa=(e,t)=>t.sort((r,i)=>Dt(e.pos,r.pos)-Dt(e.pos,i.pos))[0];function la(e,t){const r=new Map,i=[],s=new Map,l=[],d=[],f=new Map;let g,p,_;for(const[w,C]of e)f.set(w,pr(w,C));for(const w of Ur)g=t.pieces.get(w),p=f.get(w),g?p?Er(g,p.piece)||(l.push(p),d.push(pr(w,g))):d.push(pr(w,g)):p&&l.push(p);for(const w of d)p=aa(w,l.filter(C=>Er(w.piece,C.piece))),p&&(_=[p.pos[0]-w.pos[0],p.pos[1]-w.pos[1]],r.set(w.key,_.concat(_)),i.push(p.key));for(const w of l)i.includes(w.key)||s.set(w.key,w.piece);return{anims:r,fadings:s}}function yi(e,t){const r=e.animation.current;if(r===void 0){e.dom.destroyed||e.dom.redrawNow();return}const i=1-(t-r.start)*r.frequency;if(i<=0)e.animation.current=void 0,e.dom.redrawNow();else{const s=ua(i);for(const l of r.plan.anims.values())l[2]=l[0]*s,l[3]=l[1]*s;e.dom.redrawNow(!0),requestAnimationFrame((l=performance.now())=>yi(e,l))}}function ca(e,t){const r=new Map(t.pieces),i=e(t),s=la(r,t);if(s.anims.size||s.fadings.size){const l=t.animation.current&&t.animation.current.start;t.animation.current={start:performance.now(),frequency:1/t.animation.duration,plan:s},l||yi(t,performance.now())}else t.dom.redraw();return i}const ua=e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1,da=["green","red","blue","yellow"];function fa(e,t){if(t.touches&&t.touches.length>1)return;t.stopPropagation(),t.preventDefault(),t.ctrlKey?Se(e):Gr(e);const r=it(t),i=ot(r,we(e),e.dom.bounds());i&&(e.drawable.current={orig:i,pos:r,brush:ga(t),snapToValidMove:e.drawable.defaultSnapToValidMove},Ei(e))}function Ei(e){requestAnimationFrame(()=>{const t=e.drawable.current;if(t){const r=ot(t.pos,we(e),e.dom.bounds());r||(t.snapToValidMove=!1);const i=t.snapToValidMove?na(t.orig,t.pos,we(e),e.dom.bounds()):r;i!==t.mouseSq&&(t.mouseSq=i,t.dest=i!==t.orig?i:void 0,e.dom.redrawNow()),Ei(e)}})}function ha(e,t){e.drawable.current&&(e.drawable.current.pos=it(t))}function pa(e){const t=e.drawable.current;t&&(t.mouseSq&&va(e.drawable,t),Si(e))}function Si(e){e.drawable.current&&(e.drawable.current=void 0,e.dom.redraw())}function ma(e){e.drawable.shapes.length&&(e.drawable.shapes=[],e.dom.redraw(),Ci(e.drawable))}function ga(e){var t;const r=(e.shiftKey||e.ctrlKey)&&oi(e),i=e.altKey||e.metaKey||((t=e.getModifierState)===null||t===void 0?void 0:t.call(e,"AltGraph"));return da[(r?1:0)+(i?2:0)]}function va(e,t){const r=s=>s.orig===t.orig&&s.dest===t.dest,i=e.shapes.find(r);i&&(e.shapes=e.shapes.filter(s=>!r(s))),(!i||i.brush!==t.brush)&&e.shapes.push({orig:t.orig,dest:t.dest,brush:t.brush}),Ci(e)}function Ci(e){e.onChange&&e.onChange(e.shapes)}function _a(e,t){if(!(e.trustAllEvents||t.isTrusted)||t.buttons!==void 0&&t.buttons>1||t.touches&&t.touches.length>1)return;const r=e.dom.bounds(),i=it(t),s=ot(i,we(e),r);if(!s)return;const l=e.pieces.get(s),d=e.selected;if(!d&&e.drawable.enabled&&(e.drawable.eraseOnClick||!l||l.color!==e.turnColor)&&ma(e),t.cancelable!==!1&&(!t.touches||e.blockTouchScroll||l||d||wa(e,i)))t.preventDefault();else if(t.touches)return;const f=!!e.premovable.current,g=!!e.predroppable.current;e.stats.ctrlKey=t.ctrlKey,e.selected&&Wr(e,e.selected,s)?Qe(w=>Sr(w,s),e):Sr(e,s);const p=e.selected===s,_=Ti(e,s);if(l&&_&&p&&ea(e,s)){e.draggable.current={orig:s,piece:l,origPos:i,pos:i,started:e.draggable.autoDistance&&e.stats.dragged,element:_,previouslySelected:d,originTarget:t.target,keyHasChanged:!1},_.cgDragging=!0,_.classList.add("dragging");const w=e.dom.elements.ghost;w&&(w.className=`ghost ${l.color} ${l.role}`,Oe(w,Bt(r)(oe(s),we(e))),Br(w,!0)),Vr(e)}else f&&We(e),g&&He(e);e.dom.redraw()}function wa(e,t){const r=we(e),i=e.dom.bounds(),s=Math.pow(i.width/8,2);for(const l of e.pieces.keys()){const d=si(l,r,i);if(Dt(d,t)<=s)return!0}return!1}function ba(e,t,r,i){const s="a0";e.pieces.set(s,t),e.dom.redraw();const l=it(r);e.draggable.current={orig:s,piece:t,origPos:l,pos:l,started:!0,element:()=>Ti(e,s),originTarget:r.target,newPiece:!0,force:!!i,keyHasChanged:!1},Vr(e)}function Vr(e){requestAnimationFrame(()=>{var t;const r=e.draggable.current;if(!r)return;!((t=e.animation.current)===null||t===void 0)&&t.plan.anims.has(r.orig)&&(e.animation.current=void 0);const i=e.pieces.get(r.orig);if(!i||!Er(i,r.piece))Zt(e);else if(!r.started&&Dt(r.pos,r.origPos)>=Math.pow(e.draggable.distance,2)&&(r.started=!0),r.started){if(typeof r.element=="function"){const l=r.element();if(!l)return;l.cgDragging=!0,l.classList.add("dragging"),r.element=l}const s=e.dom.bounds();Oe(r.element,[r.pos[0]-s.left-s.width/16,r.pos[1]-s.top-s.height/16]),r.keyHasChanged||(r.keyHasChanged=r.orig!==ot(r.pos,we(e),s))}Vr(e)})}function ka(e,t){e.draggable.current&&(!t.touches||t.touches.length<2)&&(e.draggable.current.pos=it(t))}function ya(e,t){const r=e.draggable.current;if(!r)return;if(t.type==="touchend"&&t.cancelable!==!1&&t.preventDefault(),t.type==="touchend"&&r.originTarget!==t.target&&!r.newPiece){e.draggable.current=void 0;return}We(e),He(e);const i=it(t)||r.pos,s=ot(i,we(e),e.dom.bounds());s&&r.started&&r.orig!==s?r.newPiece?mi(e,r.orig,s,r.force):(e.stats.ctrlKey=t.ctrlKey,pi(e,r.orig,s)&&(e.stats.dragged=!0)):r.newPiece?e.pieces.delete(r.orig):e.draggable.deleteOnDropOff&&!s&&(e.pieces.delete(r.orig),_e(e.events.change)),(r.orig===r.previouslySelected||r.keyHasChanged)&&(r.orig===s||!s)?Se(e):e.selectable.enabled||Se(e),Pi(e),e.draggable.current=void 0,e.dom.redraw()}function Zt(e){const t=e.draggable.current;t&&(t.newPiece&&e.pieces.delete(t.orig),e.draggable.current=void 0,Se(e),Pi(e),e.dom.redraw())}function Pi(e){const t=e.dom.elements;t.ghost&&Br(t.ghost,!1)}function Ti(e,t){let r=e.dom.elements.board.firstChild;for(;r;){if(r.cgKey===t&&r.tagName==="PIECE")return r;r=r.nextSibling}}function Ea(e,t){e.exploding={stage:1,keys:t},e.dom.redraw(),setTimeout(()=>{On(e,2),setTimeout(()=>On(e,void 0),120)},120)}function On(e,t){e.exploding&&(t?e.exploding.stage=t:e.exploding=void 0,e.dom.redraw())}function Sa(e,t){function r(){Gs(e),t()}return{set(i){i.orientation&&i.orientation!==e.orientation&&r(),bi(e,i),(i.fen?Qe:Ue)(s=>ki(s,i),e)},state:e,getFen:()=>sa(e.pieces),toggleOrientation:r,setPieces(i){Qe(s=>Ks(s,i),e)},selectSquare(i,s){i?Qe(l=>Sr(l,i,s),e):e.selected&&(Se(e),e.dom.redraw())},move(i,s){Qe(l=>fi(l,i,s),e)},newPiece(i,s){Qe(l=>jr(l,i,s),e)},playPremove(){if(e.premovable.current){if(Qe(ta,e))return!0;e.dom.redraw()}return!1},playPredrop(i){if(e.predroppable.current){const s=ra(e,i);return e.dom.redraw(),s}return!1},cancelPremove(){Ue(We,e)},cancelPredrop(){Ue(He,e)},cancelMove(){Ue(i=>{Gr(i),Zt(i)},e)},stop(){Ue(i=>{An(i),Zt(i)},e)},explode(i){Ea(e,i)},setAutoShapes(i){Ue(s=>s.drawable.autoShapes=i,e)},setShapes(i){Ue(s=>s.drawable.shapes=i,e)},getKeyAtDomPos(i){return ot(i,we(e),e.dom.bounds())},redrawAll:t,dragNewPiece(i,s,l){ba(e,i,s,l)},destroy(){An(e),e.dom.unbind&&e.dom.unbind(),e.dom.destroyed=!0}}}function Ca(){return{pieces:wi(_i),orientation:"white",turnColor:"white",coordinates:!0,coordinatesOnSquares:!1,ranksPosition:"right",autoCastle:!0,viewOnly:!1,disableContextMenu:!1,addPieceZIndex:!1,blockTouchScroll:!1,pieceKey:!1,trustAllEvents:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,defaultSnapToValidMove:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15},purple:{key:"purple",color:"#68217a",opacity:.65,lineWidth:10},pink:{key:"pink",color:"#ee2080",opacity:.5,lineWidth:10},white:{key:"white",color:"white",opacity:1,lineWidth:10}},prevSvgHash:""},hold:Bs()}}const Rn={hilitePrimary:{key:"hilitePrimary",color:"#3291ff",opacity:1,lineWidth:1},hiliteWhite:{key:"hiliteWhite",color:"#ffffff",opacity:1,lineWidth:1}};function Pa(){const e=ce("defs"),t=ve(ce("filter"),{id:"cg-filter-blur"});return t.appendChild(ve(ce("feGaussianBlur"),{stdDeviation:"0.019"})),e.appendChild(t),e}function Ta(e,t,r){var i;const s=e.drawable,l=s.current,d=l&&l.mouseSq?l:void 0,f=new Map,g=e.dom.bounds(),p=s.autoShapes.filter(P=>!P.piece);for(const P of s.shapes.concat(p).concat(d?[d]:[])){if(!P.dest)continue;const k=(i=f.get(P.dest))!==null&&i!==void 0?i:new Set,E=rr(tr(oe(P.orig),e.orientation),g),F=rr(tr(oe(P.dest),e.orientation),g);k.add(Pr(E,F)),f.set(P.dest,k)}const _=s.shapes.concat(p).map(P=>({shape:P,current:!1,hash:Fn(P,Cr(P.dest,f),!1,g)}));d&&_.push({shape:d,current:!0,hash:Fn(d,Cr(d.dest,f),!0,g)});const w=_.map(P=>P.hash).join(";");if(w===e.drawable.prevSvgHash)return;e.drawable.prevSvgHash=w;const C=t.querySelector("defs");Aa(s,_,C),Ma(_,t.querySelector("g"),r.querySelector("g"),P=>Fa(e,P,s.brushes,f,g))}function Aa(e,t,r){var i;const s=new Map;let l;for(const g of t.filter(p=>p.shape.dest&&p.shape.brush))l=Ai(e.brushes[g.shape.brush],g.shape.modifiers),!((i=g.shape.modifiers)===null||i===void 0)&&i.hilite&&s.set(er(l).key,er(l)),s.set(l.key,l);const d=new Set;let f=r.firstElementChild;for(;f;)d.add(f.getAttribute("cgKey")),f=f.nextElementSibling;for(const[g,p]of s.entries())d.has(g)||r.appendChild(Da(p))}function Ma(e,t,r,i){const s=new Map;for(const l of e)s.set(l.hash,!1);for(const l of[t,r]){const d=[];let f=l.firstElementChild,g;for(;f;)g=f.getAttribute("cgHash"),s.has(g)?s.set(g,!0):d.push(f),f=f.nextElementSibling;for(const p of d)l.removeChild(p)}for(const l of e.filter(d=>!s.get(d.hash)))for(const d of i(l))d.isCustom?r.appendChild(d.el):t.appendChild(d.el)}function Fn({orig:e,dest:t,brush:r,piece:i,modifiers:s,customSvg:l,label:d},f,g,p){var _,w;return[p.width,p.height,g,e,t,r,f&&"-",i&&Oa(i),s&&Ra(s),l&&`custom-${xn(l.html)},${(w=(_=l.center)===null||_===void 0?void 0:_[0])!==null&&w!==void 0?w:"o"}`,d&&`label-${xn(d.text)}`].filter(C=>C).join(",")}function Oa(e){return[e.color,e.role,e.scale].filter(t=>t).join(",")}function Ra(e){return[e.lineWidth,e.hilite&&"*"].filter(t=>t).join(",")}function xn(e){let t=0;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r)>>>0;return t.toString()}function Fa(e,{shape:t,current:r,hash:i},s,l,d){var f,g;const p=rr(tr(oe(t.orig),e.orientation),d),_=t.dest?rr(tr(oe(t.dest),e.orientation),d):p,w=t.brush&&Ai(s[t.brush],t.modifiers),C=l.get(t.dest),P=[];if(w){const k=ve(ce("g"),{cgHash:i});P.push({el:k}),p[0]!==_[0]||p[1]!==_[1]?k.appendChild(Na(t,w,p,_,r,Cr(t.dest,l))):k.appendChild(xa(s[t.brush],p,r,d))}if(t.label){const k=t.label;(f=k.fill)!==null&&f!==void 0||(k.fill=t.brush&&s[t.brush].color);const E=t.brush?void 0:"tr";P.push({el:La(k,i,p,_,C,E),isCustom:!0})}if(t.customSvg){const k=(g=t.customSvg.center)!==null&&g!==void 0?g:"orig",[E,F]=k==="label"?Oi(p,_,C).map(T=>T-.5):k==="dest"?_:p,A=ve(ce("g"),{transform:`translate(${E},${F})`,cgHash:i});A.innerHTML=`<svg width="1" height="1" viewBox="0 0 100 100">${t.customSvg.html}</svg>`,P.push({el:A,isCustom:!0})}return P}function xa(e,t,r,i){const s=$a(),l=(i.width+i.height)/(4*Math.max(i.width,i.height));return ve(ce("circle"),{stroke:e.color,"stroke-width":s[r?0:1],fill:"none",opacity:Mi(e,r),cx:t[0],cy:t[1],r:l-s[1]/2})}function er(e){return["#ffffff","#fff","white"].includes(e.color)?Rn.hilitePrimary:Rn.hiliteWhite}function Na(e,t,r,i,s,l){var d;function f(_){var w;const C=Ua(l&&!s),P=i[0]-r[0],k=i[1]-r[1],E=Math.atan2(k,P),F=Math.cos(E)*C,A=Math.sin(E)*C;return ve(ce("line"),{stroke:_?er(t).color:t.color,"stroke-width":Ia(t,s)+(_?.04:0),"stroke-linecap":"round","marker-end":`url(#arrowhead-${_?er(t).key:t.key})`,opacity:!((w=e.modifiers)===null||w===void 0)&&w.hilite?1:Mi(t,s),x1:r[0],y1:r[1],x2:i[0]-F,y2:i[1]-A})}if(!(!((d=e.modifiers)===null||d===void 0)&&d.hilite))return f(!1);const g=ce("g"),p=ve(ce("g"),{filter:"url(#cg-filter-blur)"});return p.appendChild(za(r,i)),p.appendChild(f(!0)),g.appendChild(p),g.appendChild(f(!1)),g}function Da(e){const t=ve(ce("marker"),{id:"arrowhead-"+e.key,orient:"auto",overflow:"visible",markerWidth:4,markerHeight:4,refX:e.key.startsWith("hilite")?1.86:2.05,refY:2});return t.appendChild(ve(ce("path"),{d:"M0,0 V4 L3,2 Z",fill:e.color})),t.setAttribute("cgKey",e.key),t}function La(e,t,r,i,s,l){var d;const g=.4*.75**e.text.length,p=Oi(r,i,s),_=l==="tr"?.4:0,w=ve(ce("g"),{transform:`translate(${p[0]+_},${p[1]-_})`,cgHash:t});w.appendChild(ve(ce("circle"),{r:.4/2,"fill-opacity":l?1:.8,"stroke-opacity":l?1:.7,"stroke-width":.03,fill:(d=e.fill)!==null&&d!==void 0?d:"#666",stroke:"white"}));const C=ve(ce("text"),{"font-size":g,"font-family":"Noto Sans","text-anchor":"middle",fill:"white",y:.13*.75**e.text.length});return C.innerHTML=e.text,w.appendChild(C),w}function tr(e,t){return t==="white"?e:[7-e[0],7-e[1]]}function Cr(e,t){return(e&&t.has(e)&&t.get(e).size>1)===!0}function ce(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function ve(e,t){for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.setAttribute(r,t[r]);return e}function Ai(e,t){return t?{color:e.color,opacity:Math.round(e.opacity*10)/10,lineWidth:Math.round(t.lineWidth||e.lineWidth),key:[e.key,t.lineWidth].filter(r=>r).join("")}:e}function $a(){return[3/64,4/64]}function Ia(e,t){return(e.lineWidth||10)*(t?.85:1)/64}function Mi(e,t){return(e.opacity||1)*(t?.9:1)}function Ua(e){return(e?20:10)/64}function rr(e,t){const r=Math.min(1,t.width/t.height),i=Math.min(1,t.height/t.width);return[(e[0]-3.5)*r,(3.5-e[1])*i]}function za(e,t){const r={from:[Math.floor(Math.min(e[0],t[0])),Math.floor(Math.min(e[1],t[1]))],to:[Math.ceil(Math.max(e[0],t[0])),Math.ceil(Math.max(e[1],t[1]))]};return ve(ce("rect"),{x:r.from[0],y:r.from[1],width:r.to[0]-r.from[0],height:r.to[1]-r.from[1],fill:"none",stroke:"none"})}function Pr(e,t,r=!0){const i=Math.atan2(t[1]-e[1],t[0]-e[0])+Math.PI;return r?(Math.round(i*8/Math.PI)+16)%16:i}function Ba(e,t){return Math.sqrt([e[0]-t[0],e[1]-t[1]].reduce((r,i)=>r+i*i,0))}function Oi(e,t,r){let i=Ba(e,t);const s=Pr(e,t,!1);if(r&&(i-=33/64,r.size>1)){i-=10/64;const l=Pr(e,t);(r.has((l+1)%16)||r.has((l+15)%16))&&l&1&&(i-=.4)}return[e[0]-Math.cos(s)*i,e[1]-Math.sin(s)*i].map(l=>l+.5)}function ja(e,t){e.innerHTML="",e.classList.add("cg-wrap");for(const g of Is)e.classList.toggle("orientation-"+g,t.orientation===g);e.classList.toggle("manipulable",!t.viewOnly);const r=$e("cg-container");e.appendChild(r);const i=$e("cg-board");r.appendChild(i);let s,l,d;if(t.drawable.visible&&(s=ve(ce("svg"),{class:"cg-shapes",viewBox:"-4 -4 8 8",preserveAspectRatio:"xMidYMid slice"}),s.appendChild(Pa()),s.appendChild(ce("g")),l=ve(ce("svg"),{class:"cg-custom-svgs",viewBox:"-3.5 -3.5 8 8",preserveAspectRatio:"xMidYMid slice"}),l.appendChild(ce("g")),d=$e("cg-auto-pieces"),r.appendChild(s),r.appendChild(l),r.appendChild(d)),t.coordinates){const g=t.orientation==="black"?" black":"",p=t.ranksPosition==="left"?" left":"";if(t.coordinatesOnSquares){const _=t.orientation==="white"?w=>w+1:w=>8-w;Qt.forEach((w,C)=>r.appendChild(mr(Jt.map(P=>w+P),"squares rank"+_(C)+g+p)))}else r.appendChild(mr(Jt,"ranks"+g+p)),r.appendChild(mr(Qt,"files"+g))}let f;return t.draggable.enabled&&t.draggable.showGhost&&(f=$e("piece","ghost"),Br(f,!1),r.appendChild(f)),{board:i,container:r,wrap:e,ghost:f,svg:s,customSvg:l,autoPieces:d}}function mr(e,t){const r=$e("coords",t);let i;for(const s of e)i=$e("coord"),i.textContent=s,r.appendChild(i);return r}function Wa(e,t){if(!e.dropmode.active)return;We(e),He(e);const r=e.dropmode.piece;if(r){e.pieces.set("a0",r);const i=it(t),s=i&&ot(i,we(e),e.dom.bounds());s&&mi(e,"a0",s)}e.dom.redraw()}function Ha(e,t){const r=e.dom.elements.board;if("ResizeObserver"in window&&new ResizeObserver(t).observe(e.dom.elements.wrap),(e.disableContextMenu||e.drawable.enabled)&&r.addEventListener("contextmenu",s=>s.preventDefault()),e.viewOnly)return;const i=Ka(e);r.addEventListener("touchstart",i,{passive:!1}),r.addEventListener("mousedown",i,{passive:!1})}function Ga(e,t){const r=[];if("ResizeObserver"in window||r.push(Ot(document.body,"chessground.resize",t)),!e.viewOnly){const i=Nn(e,ka,ha),s=Nn(e,ya,pa);for(const d of["touchmove","mousemove"])r.push(Ot(document,d,i));for(const d of["touchend","mouseup"])r.push(Ot(document,d,s));const l=()=>e.dom.bounds.clear();r.push(Ot(document,"scroll",l,{capture:!0,passive:!0})),r.push(Ot(window,"resize",l,{passive:!0}))}return()=>r.forEach(i=>i())}function Ot(e,t,r,i){return e.addEventListener(t,r,i),()=>e.removeEventListener(t,r,i)}const Ka=e=>t=>{e.draggable.current?Zt(e):e.drawable.current?Si(e):t.shiftKey||oi(t)?e.drawable.enabled&&fa(e,t):e.viewOnly||(e.dropmode.active?Wa(e,t):_a(e,t))},Nn=(e,t,r)=>i=>{e.drawable.current?e.drawable.enabled&&r(e,i):e.viewOnly||t(e,i)};function Va(e){const t=we(e),r=Bt(e.dom.bounds()),i=e.dom.elements.board,s=e.pieces,l=e.animation.current,d=l?l.plan.anims:new Map,f=l?l.plan.fadings:new Map,g=e.draggable.current,p=Ya(e),_=new Set,w=new Set,C=new Map,P=new Map;let k,E,F,A,T,I,te,N,ne,U;for(E=i.firstChild;E;){if(k=E.cgKey,Ri(E))if(F=s.get(k),T=d.get(k),I=f.get(k),A=E.cgPiece,E.cgDragging&&(!g||g.orig!==k)&&(E.classList.remove("dragging"),Oe(E,r(oe(k),t)),E.cgDragging=!1),!I&&E.cgFading&&(E.cgFading=!1,E.classList.remove("fading")),F){if(T&&E.cgAnimating&&A===Rt(F)){const z=oe(k);z[0]+=T[2],z[1]+=T[3],E.classList.add("anim"),Oe(E,r(z,t))}else E.cgAnimating&&(E.cgAnimating=!1,E.classList.remove("anim"),Oe(E,r(oe(k),t)),e.addPieceZIndex&&(E.style.zIndex=gr(oe(k),t)));A===Rt(F)&&(!I||!E.cgFading)?_.add(k):I&&A===Rt(I)?(E.classList.add("fading"),E.cgFading=!0):vr(C,A,E)}else vr(C,A,E);else if(Fi(E)){const z=E.className;p.get(k)===z?w.add(k):vr(P,z,E)}E=E.nextSibling}for(const[z,se]of p)if(!w.has(z)){ne=P.get(se),U=ne&&ne.pop();const O=r(oe(z),t);if(U)U.cgKey=z,Oe(U,O);else{const S=$e("square",se);S.cgKey=z,Oe(S,O),i.insertBefore(S,i.firstChild)}}for(const[z,se]of s)if(T=d.get(z),!_.has(z))if(te=C.get(Rt(se)),N=te&&te.pop(),N){N.cgKey=z,N.cgFading&&(N.classList.remove("fading"),N.cgFading=!1);const O=oe(z);e.addPieceZIndex&&(N.style.zIndex=gr(O,t)),T&&(N.cgAnimating=!0,N.classList.add("anim"),O[0]+=T[2],O[1]+=T[3]),Oe(N,r(O,t))}else{const O=Rt(se),S=$e("piece",O),B=oe(z);S.cgPiece=O,S.cgKey=z,T&&(S.cgAnimating=!0,B[0]+=T[2],B[1]+=T[3]),Oe(S,r(B,t)),e.addPieceZIndex&&(S.style.zIndex=gr(B,t)),i.appendChild(S)}for(const z of C.values())Ln(e,z);for(const z of P.values())Ln(e,z)}function qa(e){const t=we(e),r=Bt(e.dom.bounds());let i=e.dom.elements.board.firstChild;for(;i;)(Ri(i)&&!i.cgAnimating||Fi(i))&&Oe(i,r(oe(i.cgKey),t)),i=i.nextSibling}function Dn(e){var t,r;const i=e.dom.elements.wrap.getBoundingClientRect(),s=e.dom.elements.container,l=i.height/i.width,d=Math.floor(i.width*window.devicePixelRatio/8)*8/window.devicePixelRatio,f=d*l;s.style.width=d+"px",s.style.height=f+"px",e.dom.bounds.clear(),(t=e.addDimensionsCssVarsTo)===null||t===void 0||t.style.setProperty("---cg-width",d+"px"),(r=e.addDimensionsCssVarsTo)===null||r===void 0||r.style.setProperty("---cg-height",f+"px")}const Ri=e=>e.tagName==="PIECE",Fi=e=>e.tagName==="SQUARE";function Ln(e,t){for(const r of t)e.dom.elements.board.removeChild(r)}function gr(e,t){const i=e[1];return`${t?10-i:3+i}`}const Rt=e=>`${e.color} ${e.role}`;function Ya(e){var t,r,i;const s=new Map;if(e.lastMove&&e.highlight.lastMove)for(const f of e.lastMove)Ne(s,f,"last-move");if(e.check&&e.highlight.check&&Ne(s,e.check,"check"),e.selected&&(Ne(s,e.selected,"selected"),e.movable.showDests)){const f=(t=e.movable.dests)===null||t===void 0?void 0:t.get(e.selected);if(f)for(const p of f)Ne(s,p,"move-dest"+(e.pieces.has(p)?" oc":""));const g=(i=(r=e.premovable.customDests)===null||r===void 0?void 0:r.get(e.selected))!==null&&i!==void 0?i:e.premovable.dests;if(g)for(const p of g)Ne(s,p,"premove-dest"+(e.pieces.has(p)?" oc":""))}const l=e.premovable.current;if(l)for(const f of l)Ne(s,f,"current-premove");else e.predroppable.current&&Ne(s,e.predroppable.current.key,"current-premove");const d=e.exploding;if(d)for(const f of d.keys)Ne(s,f,"exploding"+d.stage);return e.highlight.custom&&e.highlight.custom.forEach((f,g)=>{Ne(s,g,f)}),s}function Ne(e,t,r){const i=e.get(t);i?e.set(t,`${i} ${r}`):e.set(t,r)}function vr(e,t,r){const i=e.get(t);i?i.push(r):e.set(t,[r])}function Xa(e,t,r){const i=new Map,s=[];for(const f of e)i.set(f.hash,!1);let l=t.firstElementChild,d;for(;l;)d=l.getAttribute("cgHash"),i.has(d)?i.set(d,!0):s.push(l),l=l.nextElementSibling;for(const f of s)t.removeChild(f);for(const f of e)i.get(f.hash)||t.appendChild(r(f))}function Qa(e,t){const i=e.drawable.autoShapes.filter(s=>s.piece).map(s=>({shape:s,hash:el(s),current:!1}));Xa(i,t,s=>Za(e,s,e.dom.bounds()))}function Ja(e){var t;const r=we(e),i=Bt(e.dom.bounds());let s=(t=e.dom.elements.autoPieces)===null||t===void 0?void 0:t.firstChild;for(;s;)ii(s,i(oe(s.cgKey),r),s.cgScale),s=s.nextSibling}function Za(e,{shape:t,hash:r},i){var s,l,d;const f=t.orig,g=(s=t.piece)===null||s===void 0?void 0:s.role,p=(l=t.piece)===null||l===void 0?void 0:l.color,_=(d=t.piece)===null||d===void 0?void 0:d.scale,w=$e("piece",`${g} ${p}`);return w.setAttribute("cgHash",r),w.cgKey=f,w.cgScale=_,ii(w,Bt(i)(oe(f),we(e)),_),w}const el=e=>{var t,r,i;return[e.orig,(t=e.piece)===null||t===void 0?void 0:t.role,(r=e.piece)===null||r===void 0?void 0:r.color,(i=e.piece)===null||i===void 0?void 0:i.scale].join(",")};function tl(e,t){const r=Ca();ki(r,t||{});function i(){const s="dom"in r?r.dom.unbind:void 0,l=ja(e,r),d=zs(()=>l.board.getBoundingClientRect()),f=_=>{Va(p),l.autoPieces&&Qa(p,l.autoPieces),!_&&l.svg&&Ta(p,l.svg,l.customSvg)},g=()=>{Dn(p),qa(p),l.autoPieces&&Ja(p)},p=r;return p.dom={elements:l,bounds:d,redraw:rl(f),redrawNow:f,unbind:s},p.drawable.prevSvgHash="",Dn(p),f(!1),Ha(p,g),s||(p.dom.unbind=Ga(p,g)),p.events.insert&&p.events.insert(l),p}return Sa(i(),i)}function rl(e){let t=!1;return()=>{t||(t=!0,requestAnimationFrame(()=>{e(),t=!1}))}}const nr=["a","b","c","d","e","f","g","h"],xi=["1","2","3","4","5","6","7","8"],rt=["white","black"],Ae=["pawn","knight","bishop","rook","queen","king"],nl=["a","h"],ir=e=>"role"in e,D=e=>e!==void 0,ge=e=>e==="white"?"black":"white",nt=e=>e>>3,ke=e=>e&7,Tr=(e,t)=>0<=e&&e<8&&0<=t&&t<8?e+8*t:void 0,Ft=e=>{switch(e){case"pawn":return"p";case"knight":return"n";case"bishop":return"b";case"rook":return"r";case"queen":return"q";case"king":return"k"}};function Ar(e){switch(e.toLowerCase()){case"p":return"pawn";case"n":return"knight";case"b":return"bishop";case"r":return"rook";case"q":return"queen";case"k":return"king";default:return}}function qt(e){if(e.length===2)return Tr(e.charCodeAt(0)-97,e.charCodeAt(1)-49)}const Lt=e=>nr[ke(e)]+xi[nt(e)],il=e=>{if(e[1]==="@"&&e.length===4){const t=Ar(e[0]),r=qt(e.slice(2));if(t&&D(r))return{role:t,to:r}}else if(e.length===4||e.length===5){const t=qt(e.slice(0,2)),r=qt(e.slice(2,4));let i;if(e.length===5&&(i=Ar(e[4]),!i))return;if(D(t)&&D(r))return{from:t,to:r,promotion:i}}},qr=(e,t)=>e==="white"?t==="a"?2:6:t==="a"?58:62,Yr=(e,t)=>e==="white"?t==="a"?3:5:t==="a"?59:61,$n=e=>(e=e-(e>>>1&1431655765),e=(e&858993459)+(e>>>2&858993459),Math.imul(e+(e>>>4)&252645135,16843009)>>24),Mr=e=>(e=e>>>8&16711935|(e&16711935)<<8,e>>>16&65535|(e&65535)<<16),In=e=>(e=e>>>1&1431655765|(e&1431655765)<<1,e=e>>>2&858993459|(e&858993459)<<2,e=e>>>4&252645135|(e&252645135)<<4,Mr(e));class y{constructor(t,r){this.lo=t|0,this.hi=r|0}static fromSquare(t){return t>=32?new y(0,1<<t-32):new y(1<<t,0)}static fromRank(t){return new y(255,0).shl64(8*t)}static fromFile(t){return new y(16843009<<t,16843009<<t)}static empty(){return new y(0,0)}static full(){return new y(4294967295,4294967295)}static corners(){return new y(129,2164260864)}static center(){return new y(402653184,24)}static backranks(){return new y(255,4278190080)}static backrank(t){return t==="white"?new y(255,0):new y(0,4278190080)}static lightSquares(){return new y(1437226410,1437226410)}static darkSquares(){return new y(2857740885,2857740885)}complement(){return new y(~this.lo,~this.hi)}xor(t){return new y(this.lo^t.lo,this.hi^t.hi)}union(t){return new y(this.lo|t.lo,this.hi|t.hi)}intersect(t){return new y(this.lo&t.lo,this.hi&t.hi)}diff(t){return new y(this.lo&~t.lo,this.hi&~t.hi)}intersects(t){return this.intersect(t).nonEmpty()}isDisjoint(t){return this.intersect(t).isEmpty()}supersetOf(t){return t.diff(this).isEmpty()}subsetOf(t){return this.diff(t).isEmpty()}shr64(t){return t>=64?y.empty():t>=32?new y(this.hi>>>t-32,0):t>0?new y(this.lo>>>t^this.hi<<32-t,this.hi>>>t):this}shl64(t){return t>=64?y.empty():t>=32?new y(0,this.lo<<t-32):t>0?new y(this.lo<<t,this.hi<<t^this.lo>>>32-t):this}bswap64(){return new y(Mr(this.hi),Mr(this.lo))}rbit64(){return new y(In(this.hi),In(this.lo))}minus64(t){const r=this.lo-t.lo,i=(r&t.lo&1)+(t.lo>>>1)+(r>>>1)>>>31;return new y(r,this.hi-(t.hi+i))}equals(t){return this.lo===t.lo&&this.hi===t.hi}size(){return $n(this.lo)+$n(this.hi)}isEmpty(){return this.lo===0&&this.hi===0}nonEmpty(){return this.lo!==0||this.hi!==0}has(t){return(t>=32?this.hi&1<<t-32:this.lo&1<<t)!==0}set(t,r){return r?this.with(t):this.without(t)}with(t){return t>=32?new y(this.lo,this.hi|1<<t-32):new y(this.lo|1<<t,this.hi)}without(t){return t>=32?new y(this.lo,this.hi&~(1<<t-32)):new y(this.lo&~(1<<t),this.hi)}toggle(t){return t>=32?new y(this.lo,this.hi^1<<t-32):new y(this.lo^1<<t,this.hi)}last(){if(this.hi!==0)return 63-Math.clz32(this.hi);if(this.lo!==0)return 31-Math.clz32(this.lo)}first(){if(this.lo!==0)return 31-Math.clz32(this.lo&-this.lo);if(this.hi!==0)return 63-Math.clz32(this.hi&-this.hi)}withoutFirst(){return this.lo!==0?new y(this.lo&this.lo-1,this.hi):new y(0,this.hi&this.hi-1)}moreThanOne(){return this.hi!==0&&this.lo!==0||(this.lo&this.lo-1)!==0||(this.hi&this.hi-1)!==0}singleSquare(){return this.moreThanOne()?void 0:this.last()}*[Symbol.iterator](){let t=this.lo,r=this.hi;for(;t!==0;){const i=31-Math.clz32(t&-t);t^=1<<i,yield i}for(;r!==0;){const i=31-Math.clz32(r&-r);r^=1<<i,yield 32+i}}*reversed(){let t=this.lo,r=this.hi;for(;r!==0;){const i=31-Math.clz32(r);r^=1<<i,yield 32+i}for(;t!==0;){const i=31-Math.clz32(t);t^=1<<i,yield i}}}const or=(e,t)=>{let r=y.empty();for(const i of t){const s=e+i;0<=s&&s<64&&Math.abs(ke(e)-ke(s))<=2&&(r=r.with(s))}return r},je=e=>{const t=[];for(let r=0;r<64;r++)t[r]=e(r);return t},ol=je(e=>or(e,[-9,-8,-7,-1,1,7,8,9])),sl=je(e=>or(e,[-17,-15,-10,-6,6,10,15,17])),al={white:je(e=>or(e,[7,9])),black:je(e=>or(e,[-7,-9]))},Xr=e=>ol[e],Qr=e=>sl[e],sr=(e,t)=>al[e][t],Or=je(e=>y.fromFile(ke(e)).without(e)),Rr=je(e=>y.fromRank(nt(e)).without(e)),Fr=je(e=>{const t=new y(134480385,2151686160),r=8*(nt(e)-ke(e));return(r>=0?t.shl64(r):t.shr64(-r)).without(e)}),xr=je(e=>{const t=new y(270549120,16909320),r=8*(nt(e)+ke(e)-7);return(r>=0?t.shl64(r):t.shr64(-r)).without(e)}),Nr=(e,t,r)=>{let i=r.intersect(t),s=i.bswap64();return i=i.minus64(e),s=s.minus64(e.bswap64()),i.xor(s.bswap64()).intersect(t)},ll=(e,t)=>Nr(y.fromSquare(e),Or[e],t),cl=(e,t)=>{const r=Rr[e];let i=t.intersect(r),s=i.rbit64();return i=i.minus64(y.fromSquare(e)),s=s.minus64(y.fromSquare(63-e)),i.xor(s.rbit64()).intersect(r)},$t=(e,t)=>{const r=y.fromSquare(e);return Nr(r,Fr[e],t).xor(Nr(r,xr[e],t))},It=(e,t)=>ll(e,t).xor(cl(e,t)),Ni=(e,t)=>$t(e,t).xor(It(e,t)),Di=(e,t)=>{const r=y.fromSquare(t);return Rr[e].intersects(r)?Rr[e].with(e):xr[e].intersects(r)?xr[e].with(e):Fr[e].intersects(r)?Fr[e].with(e):Or[e].intersects(r)?Or[e].with(e):y.empty()},Ut=(e,t)=>Di(e,t).intersect(y.full().shl64(e).xor(y.full().shl64(t))).withoutFirst();class vt{constructor(){}static default(){const t=new vt;return t.reset(),t}reset(){this.occupied=new y(65535,4294901760),this.promoted=y.empty(),this.white=new y(65535,0),this.black=new y(0,4294901760),this.pawn=new y(65280,16711680),this.knight=new y(66,1107296256),this.bishop=new y(36,603979776),this.rook=new y(129,2164260864),this.queen=new y(8,134217728),this.king=new y(16,268435456)}static empty(){const t=new vt;return t.clear(),t}clear(){this.occupied=y.empty(),this.promoted=y.empty();for(const t of rt)this[t]=y.empty();for(const t of Ae)this[t]=y.empty()}clone(){const t=new vt;t.occupied=this.occupied,t.promoted=this.promoted;for(const r of rt)t[r]=this[r];for(const r of Ae)t[r]=this[r];return t}getColor(t){if(this.white.has(t))return"white";if(this.black.has(t))return"black"}getRole(t){for(const r of Ae)if(this[r].has(t))return r}get(t){const r=this.getColor(t);if(!r)return;const i=this.getRole(t),s=this.promoted.has(t);return{color:r,role:i,promoted:s}}take(t){const r=this.get(t);return r&&(this.occupied=this.occupied.without(t),this[r.color]=this[r.color].without(t),this[r.role]=this[r.role].without(t),r.promoted&&(this.promoted=this.promoted.without(t))),r}set(t,r){const i=this.take(t);return this.occupied=this.occupied.with(t),this[r.color]=this[r.color].with(t),this[r.role]=this[r.role].with(t),r.promoted&&(this.promoted=this.promoted.with(t)),i}has(t){return this.occupied.has(t)}*[Symbol.iterator](){for(const t of this.occupied)yield[t,this.get(t)]}pieces(t,r){return this[t].intersect(this[r])}rooksAndQueens(){return this.rook.union(this.queen)}bishopsAndQueens(){return this.bishop.union(this.queen)}kingOf(t){return this.pieces(t,"king").singleSquare()}}class Re{constructor(){}static empty(){const t=new Re;for(const r of Ae)t[r]=0;return t}static fromBoard(t,r){const i=new Re;for(const s of Ae)i[s]=t.pieces(r,s).size();return i}clone(){const t=new Re;for(const r of Ae)t[r]=this[r];return t}equals(t){return Ae.every(r=>this[r]===t[r])}add(t){const r=new Re;for(const i of Ae)r[i]=this[i]+t[i];return r}subtract(t){const r=new Re;for(const i of Ae)r[i]=this[i]-t[i];return r}nonEmpty(){return Ae.some(t=>this[t]>0)}isEmpty(){return!this.nonEmpty()}hasPawns(){return this.pawn>0}hasNonPawns(){return this.knight>0||this.bishop>0||this.rook>0||this.queen>0||this.king>0}size(){return this.pawn+this.knight+this.bishop+this.rook+this.queen+this.king}}class Ze{constructor(t,r){this.white=t,this.black=r}static empty(){return new Ze(Re.empty(),Re.empty())}static fromBoard(t){return new Ze(Re.fromBoard(t,"white"),Re.fromBoard(t,"black"))}clone(){return new Ze(this.white.clone(),this.black.clone())}equals(t){return this.white.equals(t.white)&&this.black.equals(t.black)}add(t){return new Ze(this.white.add(t.white),this.black.add(t.black))}subtract(t){return new Ze(this.white.subtract(t.white),this.black.subtract(t.black))}count(t){return this.white[t]+this.black[t]}size(){return this.white.size()+this.black.size()}isEmpty(){return this.white.isEmpty()&&this.black.isEmpty()}nonEmpty(){return!this.isEmpty()}hasPawns(){return this.white.hasPawns()||this.black.hasPawns()}hasNonPawns(){return this.white.hasNonPawns()||this.black.hasNonPawns()}}class zt{constructor(t,r){this.white=t,this.black=r}static default(){return new zt(3,3)}clone(){return new zt(this.white,this.black)}equals(t){return this.white===t.white&&this.black===t.black}}class Li{unwrap(t,r){const i=this._chain(s=>$.ok(t?t(s):s),s=>r?$.ok(r(s)):$.err(s));if(i.isErr)throw i.error;return i.value}map(t,r){return this._chain(i=>$.ok(t(i)),i=>$.err(r?r(i):i))}chain(t,r){return this._chain(t,r||(i=>$.err(i)))}}class ul extends Li{constructor(t){super(),this.value=void 0,this.isOk=!0,this.isErr=!1,this.value=t}_chain(t,r){return t(this.value)}}class dl extends Li{constructor(t){super(),this.error=void 0,this.isOk=!1,this.isErr=!0,this.error=t}_chain(t,r){return r(this.error)}}var $;(function(e){e.ok=function(t){return new ul(t)},e.err=function(t){return new dl(t||new Error)},e.all=function(t){if(Array.isArray(t)){const s=[];for(let l=0;l<t.length;l++){const d=t[l];if(d.isErr)return d;s.push(d.value)}return e.ok(s)}const r={},i=Object.keys(t);for(let s=0;s<i.length;s++){const l=t[i[s]];if(l.isErr)return l;r[i[s]]=l.value}return e.ok(r)}})($||($={}));var ze;(function(e){e.Empty="ERR_EMPTY",e.OppositeCheck="ERR_OPPOSITE_CHECK",e.PawnsOnBackrank="ERR_PAWNS_ON_BACKRANK",e.Kings="ERR_KINGS",e.Variant="ERR_VARIANT"})(ze||(ze={}));class ft extends Error{}const fl=(e,t,r,i)=>r[t].intersect(It(e,i).intersect(r.rooksAndQueens()).union($t(e,i).intersect(r.bishopsAndQueens())).union(Qr(e).intersect(r.knight)).union(Xr(e).intersect(r.king)).union(sr(ge(t),e).intersect(r.pawn)));class et{constructor(){}static default(){const t=new et;return t.castlingRights=y.corners(),t.rook={white:{a:0,h:7},black:{a:56,h:63}},t.path={white:{a:new y(14,0),h:new y(96,0)},black:{a:new y(0,234881024),h:new y(0,1610612736)}},t}static empty(){const t=new et;return t.castlingRights=y.empty(),t.rook={white:{a:void 0,h:void 0},black:{a:void 0,h:void 0}},t.path={white:{a:y.empty(),h:y.empty()},black:{a:y.empty(),h:y.empty()}},t}clone(){const t=new et;return t.castlingRights=this.castlingRights,t.rook={white:{a:this.rook.white.a,h:this.rook.white.h},black:{a:this.rook.black.a,h:this.rook.black.h}},t.path={white:{a:this.path.white.a,h:this.path.white.h},black:{a:this.path.black.a,h:this.path.black.h}},t}add(t,r,i,s){const l=qr(t,r),d=Yr(t,r);this.castlingRights=this.castlingRights.with(s),this.rook[t][r]=s,this.path[t][r]=Ut(s,d).with(d).union(Ut(i,l).with(l)).without(i).without(s)}static fromSetup(t){const r=et.empty(),i=t.castlingRights.intersect(t.board.rook);for(const s of rt){const l=y.backrank(s),d=t.board.kingOf(s);if(!D(d)||!l.has(d))continue;const f=i.intersect(t.board[s]).intersect(l),g=f.first();D(g)&&g<d&&r.add(s,"a",d,g);const p=f.last();D(p)&&d<p&&r.add(s,"h",d,p)}return r}discardRook(t){if(this.castlingRights.has(t)){this.castlingRights=this.castlingRights.without(t);for(const r of rt)for(const i of nl)this.rook[r][i]===t&&(this.rook[r][i]=void 0)}}discardColor(t){this.castlingRights=this.castlingRights.diff(y.backrank(t)),this.rook[t].a=void 0,this.rook[t].h=void 0}}class hl{constructor(t){this.rules=t}reset(){this.board=vt.default(),this.pockets=void 0,this.turn="white",this.castles=et.default(),this.epSquare=void 0,this.remainingChecks=void 0,this.halfmoves=0,this.fullmoves=1}setupUnchecked(t){this.board=t.board.clone(),this.board.promoted=y.empty(),this.pockets=void 0,this.turn=t.turn,this.castles=et.fromSetup(t),this.epSquare=pl(this,t.epSquare),this.remainingChecks=void 0,this.halfmoves=t.halfmoves,this.fullmoves=t.fullmoves}kingAttackers(t,r,i){return fl(t,r,this.board,i)}playCaptureAt(t,r){this.halfmoves=0,r.role==="rook"&&this.castles.discardRook(t),this.pockets&&this.pockets[ge(r.color)][r.promoted?"pawn":r.role]++}ctx(){const t=this.isVariantEnd(),r=this.board.kingOf(this.turn);if(!D(r))return{king:r,blockers:y.empty(),checkers:y.empty(),variantEnd:t,mustCapture:!1};const i=It(r,y.empty()).intersect(this.board.rooksAndQueens()).union($t(r,y.empty()).intersect(this.board.bishopsAndQueens())).intersect(this.board[ge(this.turn)]);let s=y.empty();for(const d of i){const f=Ut(r,d).intersect(this.board.occupied);f.moreThanOne()||(s=s.union(f))}const l=this.kingAttackers(r,ge(this.turn),this.board.occupied);return{king:r,blockers:s,checkers:l,variantEnd:t,mustCapture:!1}}clone(){var t,r;const i=new this.constructor;return i.board=this.board.clone(),i.pockets=(t=this.pockets)===null||t===void 0?void 0:t.clone(),i.turn=this.turn,i.castles=this.castles.clone(),i.epSquare=this.epSquare,i.remainingChecks=(r=this.remainingChecks)===null||r===void 0?void 0:r.clone(),i.halfmoves=this.halfmoves,i.fullmoves=this.fullmoves,i}validate(){if(this.board.occupied.isEmpty())return $.err(new ft(ze.Empty));if(this.board.king.size()!==2)return $.err(new ft(ze.Kings));if(!D(this.board.kingOf(this.turn)))return $.err(new ft(ze.Kings));const t=this.board.kingOf(ge(this.turn));return D(t)?this.kingAttackers(t,this.turn,this.board.occupied).nonEmpty()?$.err(new ft(ze.OppositeCheck)):y.backranks().intersects(this.board.pawn)?$.err(new ft(ze.PawnsOnBackrank)):$.ok(void 0):$.err(new ft(ze.Kings))}dropDests(t){return y.empty()}dests(t,r){if(r=r||this.ctx(),r.variantEnd)return y.empty();const i=this.board.get(t);if(!i||i.color!==this.turn)return y.empty();let s,l;if(i.role==="pawn"){s=sr(this.turn,t).intersect(this.board[ge(this.turn)]);const d=this.turn==="white"?8:-8,f=t+d;if(0<=f&&f<64&&!this.board.occupied.has(f)){s=s.with(f);const g=this.turn==="white"?t<16:t>=48,p=f+d;g&&!this.board.occupied.has(p)&&(s=s.with(p))}D(this.epSquare)&&gl(this,t,r)&&(l=y.fromSquare(this.epSquare))}else i.role==="bishop"?s=$t(t,this.board.occupied):i.role==="knight"?s=Qr(t):i.role==="rook"?s=It(t,this.board.occupied):i.role==="queen"?s=Ni(t,this.board.occupied):s=Xr(t);if(s=s.diff(this.board[this.turn]),D(r.king)){if(i.role==="king"){const d=this.board.occupied.without(t);for(const f of s)this.kingAttackers(f,ge(this.turn),d).nonEmpty()&&(s=s.without(f));return s.union(Un(this,"a",r)).union(Un(this,"h",r))}if(r.checkers.nonEmpty()){const d=r.checkers.singleSquare();if(!D(d))return y.empty();s=s.intersect(Ut(d,r.king).with(d))}r.blockers.has(t)&&(s=s.intersect(Di(t,r.king)))}return l&&(s=s.union(l)),s}isVariantEnd(){return!1}variantOutcome(t){}hasInsufficientMaterial(t){return this.board[t].intersect(this.board.pawn.union(this.board.rooksAndQueens())).nonEmpty()?!1:this.board[t].intersects(this.board.knight)?this.board[t].size()<=2&&this.board[ge(t)].diff(this.board.king).diff(this.board.queen).isEmpty():this.board[t].intersects(this.board.bishop)?(!this.board.bishop.intersects(y.darkSquares())||!this.board.bishop.intersects(y.lightSquares()))&&this.board.pawn.isEmpty()&&this.board.knight.isEmpty():!0}toSetup(){var t,r;return{board:this.board.clone(),pockets:(t=this.pockets)===null||t===void 0?void 0:t.clone(),turn:this.turn,castlingRights:this.castles.castlingRights,epSquare:ml(this),remainingChecks:(r=this.remainingChecks)===null||r===void 0?void 0:r.clone(),halfmoves:Math.min(this.halfmoves,150),fullmoves:Math.min(Math.max(this.fullmoves,1),9999)}}isInsufficientMaterial(){return rt.every(t=>this.hasInsufficientMaterial(t))}hasDests(t){t=t||this.ctx();for(const r of this.board[this.turn])if(this.dests(r,t).nonEmpty())return!0;return this.dropDests(t).nonEmpty()}isLegal(t,r){if(ir(t))return!this.pockets||this.pockets[this.turn][t.role]<=0||t.role==="pawn"&&y.backranks().has(t.to)?!1:this.dropDests(r).has(t.to);{if(t.promotion==="pawn"||t.promotion==="king"&&this.rules!=="antichess"||!!t.promotion!==(this.board.pawn.has(t.from)&&y.backranks().has(t.to)))return!1;const i=this.dests(t.from,r);return i.has(t.to)||i.has(vl(this,t).to)}}isCheck(){const t=this.board.kingOf(this.turn);return D(t)&&this.kingAttackers(t,ge(this.turn),this.board.occupied).nonEmpty()}isEnd(t){return(t?t.variantEnd:this.isVariantEnd())?!0:this.isInsufficientMaterial()||!this.hasDests(t)}isCheckmate(t){return t=t||this.ctx(),!t.variantEnd&&t.checkers.nonEmpty()&&!this.hasDests(t)}isStalemate(t){return t=t||this.ctx(),!t.variantEnd&&t.checkers.isEmpty()&&!this.hasDests(t)}outcome(t){const r=this.variantOutcome(t);return r||(t=t||this.ctx(),this.isCheckmate(t)?{winner:ge(this.turn)}:this.isInsufficientMaterial()||this.isStalemate(t)?{winner:void 0}:void 0)}allDests(t){t=t||this.ctx();const r=new Map;if(t.variantEnd)return r;for(const i of this.board[this.turn])r.set(i,this.dests(i,t));return r}play(t){const r=this.turn,i=this.epSquare,s=Ii(this,t);if(this.epSquare=void 0,this.halfmoves+=1,r==="black"&&(this.fullmoves+=1),this.turn=ge(r),ir(t))this.board.set(t.to,{role:t.role,color:r}),this.pockets&&this.pockets[r][t.role]--,t.role==="pawn"&&(this.halfmoves=0);else{const l=this.board.take(t.from);if(!l)return;let d;if(l.role==="pawn"){this.halfmoves=0,t.to===i&&(d=this.board.take(t.to+(r==="white"?-8:8)));const f=t.from-t.to;Math.abs(f)===16&&8<=t.from&&t.from<=55&&(this.epSquare=t.from+t.to>>1),t.promotion&&(l.role=t.promotion,l.promoted=!!this.pockets)}else if(l.role==="rook")this.castles.discardRook(t.from);else if(l.role==="king"){if(s){const f=this.castles.rook[r][s];if(D(f)){const g=this.board.take(f);this.board.set(qr(r,s),l),g&&this.board.set(Yr(r,s),g)}}this.castles.discardColor(r)}if(!s){const f=this.board.set(t.to,l)||d;f&&this.playCaptureAt(t.to,f)}}this.remainingChecks&&this.isCheck()&&(this.remainingChecks[r]=Math.max(this.remainingChecks[r]-1,0))}}class $i extends hl{constructor(){super("chess")}static default(){const t=new this;return t.reset(),t}static fromSetup(t){const r=new this;return r.setupUnchecked(t),r.validate().map(i=>r)}clone(){return super.clone()}}const pl=(e,t)=>{if(!D(t))return;const r=e.turn==="white"?5:2,i=e.turn==="white"?8:-8;if(nt(t)!==r||e.board.occupied.has(t+i))return;const s=t-i;if(!(!e.board.pawn.has(s)||!e.board[ge(e.turn)].has(s)))return t},ml=e=>{if(!D(e.epSquare))return;const t=e.ctx(),i=e.board.pieces(e.turn,"pawn").intersect(sr(ge(e.turn),e.epSquare));for(const s of i)if(e.dests(s,t).has(e.epSquare))return e.epSquare},gl=(e,t,r)=>{if(!D(e.epSquare)||!sr(e.turn,t).has(e.epSquare))return!1;if(!D(r.king))return!0;const i=e.turn==="white"?8:-8,s=e.epSquare-i;return e.kingAttackers(r.king,ge(e.turn),e.board.occupied.toggle(t).toggle(s).with(e.epSquare)).without(s).isEmpty()},Un=(e,t,r)=>{if(!D(r.king)||r.checkers.nonEmpty())return y.empty();const i=e.castles.rook[e.turn][t];if(!D(i)||e.castles.path[e.turn][t].intersects(e.board.occupied))return y.empty();const s=qr(e.turn,t),l=Ut(r.king,s),d=e.board.occupied.without(r.king);for(const p of l)if(e.kingAttackers(p,ge(e.turn),d).nonEmpty())return y.empty();const f=Yr(e.turn,t),g=e.board.occupied.toggle(r.king).toggle(i).toggle(f);return e.kingAttackers(s,ge(e.turn),g).nonEmpty()?y.empty():y.fromSquare(i)},Ii=(e,t)=>{if(ir(t))return;const r=t.to-t.from;if(!(Math.abs(r)!==2&&!e.board[e.turn].has(t.to))&&e.board.king.has(t.from))return r>0?"h":"a"},vl=(e,t)=>{const r=Ii(e,t);if(!r)return t;const i=e.castles.rook[e.turn][r];return{from:t.from,to:D(i)?i:t.to}},_l=(e,t)=>{const r=new Map,i=e.ctx();for(const[s,l]of e.allDests(i))if(l.nonEmpty()){const d=Array.from(l,Lt);s===i.king&&ke(s)===4&&(l.has(0)?d.push("c1"):l.has(56)&&d.push("c8"),l.has(7)?d.push("g1"):l.has(63)&&d.push("g8")),r.set(Lt(s),d)}return r},wl="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",bl=wl+" w KQkq -",Jr=bl+" 0 1";var le;(function(e){e.Fen="ERR_FEN",e.Board="ERR_BOARD",e.Pockets="ERR_POCKETS",e.Turn="ERR_TURN",e.Castling="ERR_CASTLING",e.EpSquare="ERR_EP_SQUARE",e.RemainingChecks="ERR_REMAINING_CHECKS",e.Halfmoves="ERR_HALFMOVES",e.Fullmoves="ERR_FULLMOVES"})(le||(le={}));class me extends Error{}const kl=(e,t,r)=>{let i=e.indexOf(t);for(;r-- >0&&i!==-1;)i=e.indexOf(t,i+t.length);return i},gt=e=>/^\d{1,4}$/.test(e)?parseInt(e,10):void 0,Ui=e=>{const t=Ar(e);return t&&{role:t,color:e.toLowerCase()===e?"black":"white"}},_r=e=>{const t=vt.empty();let r=7,i=0;for(let s=0;s<e.length;s++){const l=e[s];if(l==="/"&&i===8)i=0,r--;else{const d=parseInt(l,10);if(d>0)i+=d;else{if(i>=8||r<0)return $.err(new me(le.Board));const f=i+r*8,g=Ui(l);if(!g)return $.err(new me(le.Board));e[s+1]==="~"&&(g.promoted=!0,s++),t.set(f,g),i++}}}return r!==0||i!==8?$.err(new me(le.Board)):$.ok(t)},zn=e=>{if(e.length>64)return $.err(new me(le.Pockets));const t=Ze.empty();for(const r of e){const i=Ui(r);if(!i)return $.err(new me(le.Pockets));t[i.color][i.role]++}return $.ok(t)},yl=(e,t)=>{let r=y.empty();if(t==="-")return $.ok(r);for(const i of t){const s=i.toLowerCase(),l=i===s?"black":"white",d=l==="white"?0:7;if("a"<=s&&s<="h")r=r.with(Tr(s.charCodeAt(0)-97,d));else if(s==="k"||s==="q"){const f=e[l].intersect(y.backrank(l)).intersect(e.rook.union(e.king)),g=s==="k"?f.last():f.first();r=r.with(D(g)&&e.rook.has(g)?g:Tr(s==="k"?7:0,d))}else return $.err(new me(le.Castling))}return rt.some(i=>y.backrank(i).intersect(r).size()>2)?$.err(new me(le.Castling)):$.ok(r)},Bn=e=>{const t=e.split("+");if(t.length===3&&t[0]===""){const r=gt(t[1]),i=gt(t[2]);return!D(r)||r>3||!D(i)||i>3?$.err(new me(le.RemainingChecks)):$.ok(new zt(3-r,3-i))}else if(t.length===2){const r=gt(t[0]),i=gt(t[1]);return!D(r)||r>3||!D(i)||i>3?$.err(new me(le.RemainingChecks)):$.ok(new zt(r,i))}else return $.err(new me(le.RemainingChecks))},El=e=>{const t=e.split(/[\s_]+/),r=t.shift();let i,s=$.ok(void 0);if(r.endsWith("]")){const f=r.indexOf("[");if(f===-1)return $.err(new me(le.Fen));i=_r(r.slice(0,f)),s=zn(r.slice(f+1,-1))}else{const f=kl(r,"/",7);f===-1?i=_r(r):(i=_r(r.slice(0,f)),s=zn(r.slice(f+1)))}let l;const d=t.shift();if(!D(d)||d==="w")l="white";else if(d==="b")l="black";else return $.err(new me(le.Turn));return i.chain(f=>{const g=t.shift(),p=D(g)?yl(f,g):$.ok(y.empty()),_=t.shift();let w;if(D(_)&&_!=="-"&&(w=qt(_),!D(w)))return $.err(new me(le.EpSquare));let C=t.shift(),P;D(C)&&C.includes("+")&&(P=Bn(C),C=t.shift());const k=D(C)?gt(C):0;if(!D(k))return $.err(new me(le.Halfmoves));const E=t.shift(),F=D(E)?gt(E):1;if(!D(F))return $.err(new me(le.Fullmoves));const A=t.shift();let T=$.ok(void 0);if(D(A)){if(D(P))return $.err(new me(le.RemainingChecks));T=Bn(A)}else D(P)&&(T=P);return t.length>0?$.err(new me(le.Fen)):s.chain(I=>p.chain(te=>T.map(N=>({board:f,pockets:I,turn:l,castlingRights:te,remainingChecks:N,epSquare:w,halfmoves:k,fullmoves:Math.max(1,F)}))))})},Sl=e=>{let t=Ft(e.role);return e.color==="white"&&(t=t.toUpperCase()),e.promoted&&(t+="~"),t},Cl=e=>{let t="",r=0;for(let i=7;i>=0;i--)for(let s=0;s<8;s++){const l=s+i*8,d=e.get(l);d?(r>0&&(t+=r,r=0),t+=Sl(d)):r++,s===7&&(r>0&&(t+=r,r=0),i!==0&&(t+="/"))}return t},jn=e=>Ae.map(t=>Ft(t).repeat(e[t])).join(""),Pl=e=>jn(e.white).toUpperCase()+jn(e.black),Tl=(e,t)=>{let r="";for(const i of rt){const s=y.backrank(i);let l=e.kingOf(i);D(l)&&!s.has(l)&&(l=void 0);const d=e.pieces(i,"rook").intersect(s);for(const f of t.intersect(s).reversed())if(f===d.first()&&D(l)&&f<l)r+=i==="white"?"Q":"q";else if(f===d.last()&&D(l)&&l<f)r+=i==="white"?"K":"k";else{const g=nr[ke(f)];r+=i==="white"?g.toUpperCase():g}}return r||"-"},Al=e=>`${e.white}+${e.black}`,Ml=(e,t)=>[Cl(e.board)+(e.pockets?`[${Pl(e.pockets)}]`:""),e.turn[0],Tl(e.board,e.castlingRights),D(e.epSquare)?Lt(e.epSquare):"-",...e.remainingChecks?[Al(e.remainingChecks)]:[],Math.max(0,Math.min(e.halfmoves,9999)),Math.max(1,Math.min(e.fullmoves,9999))].join(" "),Ol=(e,t)=>{let r="";if(ir(t))t.role!=="pawn"&&(r=Ft(t.role).toUpperCase()),r+="@"+Lt(t.to);else{const i=e.board.getRole(t.from);if(!i)return"--";if(i==="king"&&(e.board[e.turn].has(t.to)||Math.abs(t.to-t.from)===2))r=t.to>t.from?"O-O":"O-O-O";else{const s=e.board.occupied.has(t.to)||i==="pawn"&&ke(t.from)!==ke(t.to);if(i!=="pawn"){r=Ft(i).toUpperCase();let l;if(i==="king"?l=Xr(t.to).intersect(e.board.king):i==="queen"?l=Ni(t.to,e.board.occupied).intersect(e.board.queen):i==="rook"?l=It(t.to,e.board.occupied).intersect(e.board.rook):i==="bishop"?l=$t(t.to,e.board.occupied).intersect(e.board.bishop):l=Qr(t.to).intersect(e.board.knight),l=l.intersect(e.board[e.turn]).without(t.from),l.nonEmpty()){const d=e.ctx();for(const f of l)e.dests(f,d).has(t.to)||(l=l.without(f));if(l.nonEmpty()){let f=!1,g=l.intersects(y.fromRank(nt(t.from)));l.intersects(y.fromFile(ke(t.from)))?f=!0:g=!0,g&&(r+=nr[ke(t.from)]),f&&(r+=xi[nt(t.from)])}}}else s&&(r=nr[ke(t.from)]);s&&(r+="x"),r+=Lt(t.to),t.promotion&&(r+="="+Ft(t.promotion).toUpperCase())}}return r},Rl=(e,t)=>{var r;const i=Ol(e,t);return e.play(t),!((r=e.outcome())===null||r===void 0)&&r.winner?i+"#":e.isCheck()?i+"+":i},Fl=(e,t)=>Rl(e.clone(),t),Zr=e=>e.split(" ").slice(0,-1).join(" "),en=e=>$i.fromSetup(El(e).unwrap()).unwrap(),zi=e=>en(e).turn;function xl(e,t=Jr){let r=[],i=en(t),s;for(let l of e){let d=il(l),f=Fl(i,d);i.play(d);let g=Ml(i.toSetup()),p=s?`${s.path} ${l}`:`${l}`,_=s?s.ply+1:1,w=s?.fen??t,C=s?.uci;s={path:p,ply:_,before_fen:w,fen:g,before_uci:C,uci:l,san:f},r.push(s)}return r}function Nl(e){let t=0;return r=>{t+=r.deltaY*(r.deltaMode?40:1),Math.abs(t)>=4?(e(r,!0),t=0):e(r,!1)}}var Dl=de('<div class="is2d chessboard"> ');function Ll(e){let t,r,i=H(()=>{try{return en(e.fen)}catch{return $i.default()}}),s=H(()=>_l(i())),l=H(()=>i().isCheck());return Wn(()=>{let d=e.color,f=i().isCheck(),g={fen:e.fen,check:f,premovable:{enabled:!1},movable:{color:d,free:!1,dests:s(),events:{after:e.play_orig_key}}};r=tl(t,g)}),Yt(()=>{let d;if(e.last_move){let[f]=e.last_move;d=[f.slice(0,2),f.slice(2,4)]}r.set({lastMove:d,fen:e.fen,turnColor:zi(e.fen),orientation:e.orientation??"white",check:l(),movable:{color:e.movable?e.color:void 0,dests:s()}})}),Yt(()=>{r.setAutoShapes(e.shapes??[])}),(()=>{var d=Dl();return Hn(f=>t=f,d),d})()}const $l=e=>({handleEvent:Il(e),passive:!1}),Il=e=>Nl(t=>{const r=t.target;r.tagName!=="PIECE"&&r.tagName!=="SQUARE"&&r.tagName!=="CG-BOARD"||(t.preventDefault(),e(Math.sign(t.deltaY)))});function Bi(e,t={}){const r=t.storage||globalThis.localStorage,i=t.name||`storage-${ss()}`;if(!r)return[e[0],e[1],null];const s=t.storageOptions,l=t.serialize||JSON.stringify.bind(JSON),d=t.deserialize||JSON.parse.bind(JSON),f=r.getItem(i,s),g=typeof e[0]=="function"?_=>{try{const w=d(_);e[1](()=>w)}catch{}}:_=>{try{const w=d(_);e[1](as(w))}catch{}};let p=!0;if(f instanceof Promise?f.then(_=>p&&_&&g(_)):f&&g(f),typeof t.sync?.[0]=="function"){const _=typeof e[0]=="function"?e[0]:()=>e[0];t.sync[0](w=>{w.key!==i||(w.url||globalThis.location.href)!==globalThis.location.href||w.newValue===l(yn(_))||g(w.newValue)})}return[e[0],typeof e[0]=="function"?_=>{const w=e[1](_),C=_!=null?l(w):_;return t.sync?.[1](i,C),C!=null?r.setItem(i,C,s):r.removeItem(i,s),p=!1,w}:(..._)=>{e[1](..._);const w=l(yn(()=>e[0]));t.sync?.[1](i,w),r.setItem(i,w,s),p=!1},f]}var Ul=de('<div class=replay-tree><div class=moves-wrap><div class=moves></div></div><div class=replay-jump><button title=first class="fbt first"data-icon=></button><button title=previous class="fbt prev"data-icon=></button><button title=next class="fbt next"data-icon=></button><button title=last class="fbt last"data-icon=>'),zl=de('<div class=branch-sums><button title=up class="fbt up"data-icon=></button><button title=down class="fbt down"data-icon=>'),ji=de("<span class=index>"),Bl=de("<div class=fbt>"),jl=de("<div class=lines>"),Wl=de("<div class=line>"),Hl=de("<span class=collapsed>..<!> "),Gl=de("<div class=move>"),Kl=de("<span class=nag>");function Vl(e){return Wi(e.steps_tree,e.cursor_path)}function ql(e,t){return ae(e,Zr(t))}function Wi(e,t){let r=[],i=mt(e),s=i.length>1;if(t==="")return i;for(let l of t.split(" ")){let d=i.find(g=>g.step.uci===l);if(!d)return;s&&(r.push(d),s=!1);let f=ae(e,d.step.path);f.length>1&&(s=!0),i=f}return r}function mt(e){return ae(e,"")}function ht(e,t){let r=Le(e,t);return r?[Le(e,Zr(t)),r]:void 0}function Le(e,t){if(t==="")return;let r=Zr(t),i=e.flat_nodes[r];return i===void 0?void 0:i.find(l=>l.step.path===t)}function ae(e,t){return e.flat_nodes[t]??[]}function Yl(e,t){let r=ae(e,t.step.path);if(r.length>1)return 1;if(r.length===0)return 0;let i=1,s=r[0];for(;ae(e,s.step.path).length===1;)i++,s=ae(e,s.step.path)[0];return i}function Xl(e,t){return Ql(e,t)?.length??0}const Ql=(e,t)=>{let r=Hi(e,t);return r?ae(e,r.step.path):void 0},Hi=(e,t)=>{let r=ae(e,t.step.path);if(r.length!==0)return r.length===1?Hi(e,r[0]):t};function Gi(e){const t=H(()=>e.replay_tree.cursor_path),r=H(()=>e.replay_tree.steps_tree),i=H(()=>Le(r(),"")?.step.fen??r().initial_fen??Jr),s=H(()=>Le(r(),t())?.step.fen??i()),l=H(()=>{let k=Le(r(),t())?.step;if(k)return[k.uci,k.san]});let d=[];Yt(cs(t,k=>{Wi(r(),k)?.map(E=>{d.includes(E.step.path)||(ql(r(),E.step.path)?.forEach(F=>{d=d.filter(A=>A!==F.step.path)}),d.push(E.step.path))})}));const f=H(()=>{let k=t();if(k!=="")return k.split(" ").slice(0,-1).join(" ")}),g=H(()=>{let k=t(),E=ae(r(),k);return E.length===1?E[0].step.path:E.find(F=>d.includes(F.step.path))?.step.path??E[0]?.step.path}),p=H(()=>{let k=ht(r(),t());if(!k)return;let E=k;if(!E[0])return"";if(ae(r(),E[0].step.path).length>1)return E[0].step.path;for(;!(!E[0]||ae(r(),E[0].step.path).length>1);){let F=ht(r(),E[0].step.path);if(!F)break;E=F}return E[1].step.path}),_=H(()=>{let k=Le(r(),t());if(!k){let A=mt(r());return(A.find(T=>d.includes(T.step.path))??A[0])?.step.path}let E=k,F=ae(r(),E.step.path);if(F.length>1)return F.find(A=>d.includes(A.step.path))?.step.path??F[0]?.step.path;for(;F.length===1;)E=F[0],F=ae(r(),E.step.path);return E.step.path}),w=H(()=>{let k=ht(r(),t());if(!k)return;let E=k[0]?ae(r(),k[0].step.path):[];if(!k[0])E=mt(r());else if(ae(r(),k[0].step.path).length===1)for(;;){if(k=ht(r(),k[0].step.path),!k)return;if(!k[0]){E=mt(r());break}if(ae(r(),k[0].step.path).length>1){E=ae(r(),k[0].step.path);break}}let F=E.indexOf(k[1]),A=E[F-1];if(A)return A.step.path}),C=H(()=>{let k=ht(r(),t());if(!k)return;let E=k[0]?ae(r(),k[0].step.path):[];if(!k[0])E=mt(r());else if(ae(r(),k[0].step.path).length===1)for(;;){if(k=ht(r(),k[0].step.path),!k)return;if(!k[0]){E=mt(r());break}if(ae(r(),k[0].step.path).length>1){E=ae(r(),k[0].step.path);break}}let F=E.indexOf(k[1]),A=E[F+1];if(A)return A.step.path}),P=H(()=>Le(e.replay_tree.steps_tree,t()));return{get initial_fen(){return i()},get fen(){return s()},get turn(){return zi(s())},get last_move(){return l()},get step_at_cursor_path(){return P()},get cursor_path(){return t()},get get_prev_path(){return f()},get get_next_path(){return g()},get get_first_path(){return p()},get get_last_path(){return _()},get get_down_path(){return C()},get get_up_path(){return w()}}}const Jl=e=>{let t=Gi(e);const r=_=>{e.handle_goto_path(_)},i=_=>{e.handle_goto_path(_)},s=_=>{r(_)},l=(_,w)=>{e.on_context_menu?.(_,w)};let d;Yt(()=>{let _=e.replay_tree.cursor_path,w=d.parentElement;if(!w)return;const C=d.querySelector(".on-path-end");if(!C){w.scrollTop=_.length>0?99999:0;return}let P=C.offsetTop-w.offsetHeight/2+C.offsetHeight;w.scrollTo({behavior:"smooth",top:P})});const f=_=>{if(e.lose_focus)return;let w=!1;_.key==="ArrowLeft"&&(i(t.get_prev_path),w=!0),_.key==="ArrowRight"&&(i(t.get_next_path),w=!0),_.key==="ArrowUp"&&(i(t.get_up_path),w=!0),_.key==="ArrowDown"&&(i(t.get_down_path),w=!0),w&&_.preventDefault()};Wn(()=>{document.addEventListener("keydown",f),us(()=>{document.removeEventListener("keydown",f)})});const g=En(()=>e.features),p=En(()=>e.feature_content);return(()=>{var _=Ul(),w=_.firstChild,C=w.firstChild,P=w.nextSibling,k=P.firstChild,E=k.nextSibling,F=E.nextSibling,A=F.nextSibling;return Hn(T=>d=T,C),G(C,J(Dr,pt({get replay_tree(){return e.replay_tree}},t,{on_set_cursor:s,on_context_menu:l,path:""}))),G(_,J(Fe,{get when(){return p()},get fallback(){return(()=>{var T=zl(),I=T.firstChild,te=I.nextSibling;return I.$$click=()=>i(t.get_up_path),te.$$click=()=>i(t.get_down_path),G(T,J(xt,{get each(){return Vl(e.replay_tree)},children:N=>(()=>{var ne=Bl();return ne.$$click=()=>r(N.step.path),G(ne,J(Fe,{get when(){return N.step.ply&1},get children(){var U=ji();return G(U,()=>Vi(N.step.ply)),U}}),null),G(ne,()=>N.step.san,null),ne})()}),null),Be(N=>{var ne=t.get_up_path===void 0,U=t.get_up_path===void 0,z=t.get_down_path===void 0,se=t.get_down_path===void 0;return ne!==N.e&&(I.disabled=N.e=ne),U!==N.t&&I.classList.toggle("disabled",N.t=U),z!==N.a&&(te.disabled=N.a=z),se!==N.o&&te.classList.toggle("disabled",N.o=se),N},{e:void 0,t:void 0,a:void 0,o:void 0}),T})()},children:T=>T()}),P),G(P,J(Fe,{get when(){return g()},children:T=>T()}),k),k.$$click=()=>i(t.get_first_path),E.$$click=()=>i(t.get_prev_path),F.$$click=()=>i(t.get_next_path),A.$$click=()=>i(t.get_last_path),Be(T=>{var I=t.get_first_path===void 0,te=t.get_first_path===void 0,N=t.get_prev_path===void 0,ne=t.get_prev_path===void 0,U=t.get_next_path===void 0,z=t.get_next_path===void 0,se=t.get_last_path===void 0,O=t.get_last_path===void 0;return I!==T.e&&(k.disabled=T.e=I),te!==T.t&&k.classList.toggle("disabled",T.t=te),N!==T.a&&(E.disabled=T.a=N),ne!==T.o&&E.classList.toggle("disabled",T.o=ne),U!==T.i&&(F.disabled=T.i=U),z!==T.n&&F.classList.toggle("disabled",T.n=z),se!==T.s&&(A.disabled=T.s=se),O!==T.h&&A.classList.toggle("disabled",T.h=O),T},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),_})()};function Dr(e){const t=H(()=>e.replay_tree.steps_tree.flat_nodes[e.path]??[]);return[J(Fe,{get when(){return t().length===1},get children(){return[J(wr,pt(e,{get cursor_path(){return e.replay_tree.cursor_path},get node(){return t()[0]}})),J(Dr,pt(e,{get path(){return t()[0].step.path}}))]}}),J(Fe,{get when(){return t().length>1},get children(){var r=jl();return G(r,J(xt,{get each(){return t()},children:i=>(()=>{var s=Wl();return G(s,J(Fe,{get when(){return e.replay_tree.cursor_path.startsWith(i.step.path)},get fallback(){return[J(wr,pt(e,{get cursor_path(){return e.replay_tree.cursor_path},node:i,show_index:!0,collapsed:!0})),J(Zl,{node:i,get replay_tree(){return e.replay_tree}})]},get children(){return[J(wr,pt(e,{get cursor_path(){return e.replay_tree.cursor_path},node:i,show_index:!0})),J(Dr,pt(e,{get path(){return i.step.path}}))]}})),s})()})),r}})]}function Zl(e){return(()=>{var t=Hl(),r=t.firstChild,i=r.nextSibling;return i.nextSibling,G(t,()=>Yl(e.replay_tree.steps_tree,e.node),i),G(t,()=>Xl(e.replay_tree.steps_tree,e.node),null),t})()}function wr(e){const t=H(()=>e.node.step);let r=H(()=>t().ply%2===1||e.show_index);const i=H(()=>t().path),s=H(()=>e.cursor_path.startsWith(i())),l=H(()=>i()===e.cursor_path),d=H(()=>({collapsed:e.collapsed,"on-path":s(),"on-path-end":l(),[ec[e.node.nags?.[0]??0]]:e.node.nags!==void 0}));return(()=>{var f=Gl();return f.$$click=()=>{e.on_set_cursor(t().path)},f.$$contextmenu=g=>{g.preventDefault(),e.on_context_menu(g,t().path)},G(f,J(Fe,{get when(){return r()},get children(){var g=ji();return G(g,()=>Vi(t().ply)),g}}),null),G(f,()=>t().san,null),G(f,J(Fe,{get when(){return e.node.nags},children:g=>J(tc,{get nags(){return g()}})}),null),Be(g=>ls(f,d(),g)),f})()}let Ki=["","!","?","!!","??","!?","?!"];Ki[22]="";let ec=["","good","mistake","top","blunder","interesting","inaccuracy"];const tc=e=>[" ",(()=>{var t=Kl();return G(t,()=>Ki[e.nags[0]]),t})()," "],Vi=e=>`${Math.ceil(e/2)}.`+(e%2===0?"..":"");Gn(["click","contextmenu"]);const rc=(e,t,r)=>Bi(Kn(e),{name:`.tactics-filter.v0.${t}`});class tn{static create=t=>new tn(t);get id(){return this.puzzle.id}get fen(){return this.puzzle.fen}get tags(){return this.puzzle.tags}_has_tags;get has_tags(){return this._has_tags||(this._has_tags=ri(this.puzzle)),this._has_tags}_all_tags;get all_tags(){return this._all_tags||(this._all_tags=Ir(this.puzzle)),this._all_tags}constructor(t){this.puzzle=t}puzzle}var nc=de('<main class=tactics-filter><div class=code-wrap></div><div class=list-wrap><div class=filter><input type=text placeholder="Filter1: y_filter _!_ n_filter"><input type=text placeholder="Filter2: y_filter _!_ n_filter"></div><div class=stats><span>/10000 Positions</span></div></div><div class=board-wrap></div><div class=replay-wrap><div class=tools><button>Copy FEN</button><button>Copy Puzzle ID'),ic=de("<div class=progress> <!>/<!> "),oc=de("<div class=codebox><div class=rule-list><div class=scroll-wrap></div><div class=tools><div class=rule>+ New rule</div><div class=rule>- Delete rule</div></div></div><div class=text-wrap><textarea class=editor-input title=rules rows=13 cols=21></textarea><div class=ascii><textarea>"),sc=de("<div><span class=name></span><span class=stats>f <!> / s "),ac=de("<span>"),lc=de("<div class=tactics-list><div class=list>"),cc=de("<div class=item><a class=id target=_blank></a><div class=tags></div><div class=tags2>"),uc=de("<span class=tag>");function mc(){const e=Lr(),t=H(()=>e.puzzles??[]),[r,i]=Bi(Sn({filter1:"",filter2:"",puzzle_id:""})),s=H(()=>Tn(r.filter1)),l=H(()=>Tn(r.filter2)),d=H(()=>t().filter(s()).filter(l())),f=H(()=>d().find(O=>O.id===r.puzzle_id)),g=O=>{O!==void 0&&P("cursor_path",O)},p=H(()=>{let O=f();return O?xl(O.moves.split(" "),O.fen):[]}),_=H(()=>{let O=p(),S={},B="";for(let fe of O)S[B]||(S[B]=[]),S[B].push({step:fe}),B=fe.path;return S}),w=H(()=>({flat_nodes:_()})),[C,P]=Sn({get steps_tree(){return w()},cursor_path:""}),k=()=>"white",E=()=>Le(C.steps_tree,C.cursor_path)?.step.fen??f()?.fen??Jr,F=()=>{let O=Le(C.steps_tree,C.cursor_path);if(O)return[O.step.uci,O.step.san]},A=O=>{O!==void 0&&P("cursor_path",O)};let T=Gi({replay_tree:C});const I=O=>{O>0?A(T.get_next_path):A(T.get_prev_path)},te=O=>{i("puzzle_id",O.id),N()},N=()=>{P("cursor_path",""),setTimeout(()=>{console.log("going path",T.get_next_path),A(T.get_next_path)},200)},ne=()=>{navigator.clipboard.writeText(E())},U=()=>{let O=f()?.id;O&&navigator.clipboard.writeText(O)},z=O=>{Xt(()=>{P("cursor_path",""),i("filter1",O)})},se=O=>{Xt(()=>{P("cursor_path",""),i("filter2",O)})};return(()=>{var O=nc(),S=O.firstChild,B=S.nextSibling,fe=B.firstChild,Ce=fe.firstChild,Y=Ce.nextSibling,q=fe.nextSibling,xe=q.firstChild,_t=xe.firstChild,st=B.nextSibling,jt=st.nextSibling,wt=jt.firstChild,bt=wt.firstChild,Wt=bt.nextSibling;return G(S,J(fc,{get fen(){return E()},on_reset_cursor_path:N})),Ce.$$input=at=>z(at.target.value),br(Ce,"spellcheck",!1),Y.$$input=at=>se(at.target.value),br(Y,"spellcheck",!1),G(xe,()=>d().length,_t),G(B,J(hc,{get tactics(){return d().slice(0,1e3)},get selected_id(){return f()?.id},on_selected:te}),null),ds(st,"wheel",$l(I)),G(st,J(Ll,{get color(){return k()},get fen(){return E()},get last_move(){return F()}})),bt.$$click=ne,Wt.$$click=U,G(jt,J(Jl,{handle_goto_path:g,lose_focus:!0,replay_tree:C}),null),G(O,J(dc,{}),null),Be(()=>Ce.value=r.filter1),Be(()=>Y.value=r.filter2),O})()}const dc=()=>{const e=Lr();return J(Fe,{get when(){return e.progress},children:t=>(()=>{var r=ic(),i=r.firstChild,s=i.nextSibling,l=s.nextSibling,d=l.nextSibling;return d.nextSibling,G(r,()=>t()[0],s),G(r,()=>t()[1],d),r})()})};function fc(e){let t=Lr();const r=H(fs(()=>t.all,tn.create)),i=A=>r().filter(T=>T.all_tags[`failed_${A}`]).length,s=A=>r().filter(T=>T.all_tags[`solved_${A}`]).length;function l(){let A=1,T=`rule${A}`,I=d();for(;I.find(te=>te.name===T);)T=`rule${A++}`;return{name:T,rule:"",z:I.length}}const[d,f]=rc([{name:"rule1",rule:"",z:0}],"rule-list"),[g,p]=Kn(0);t.rules(d());const _=H(()=>d()[g()]),w=A=>{if(A.key==="Escape"){let T=A.target.value,I=_(),te={name:I.name,rule:T,z:I.z},N=d(),ne=N.findIndex(U=>U.name===I.name);N.splice(ne,1,te),f([...N]),e.on_reset_cursor_path(),t.rules([te])}},C=()=>{Xt(()=>{f([l(),...d()]),p(0)})},P=()=>{let A=d();if(A.length===1)return;let T=A.splice(g(),1);Xt(()=>{f([...A]),g()===A.length&&p(A.length-1)}),t.rules(T.map(I=>({name:I.name,rule:"",z:-1})))};let k=hs(()=>$r.make(()=>$s)),E=H(()=>{const A=k();let T=_().rule;if(e.fen&&A){Cn(A);try{return Ds(T,e.fen)}catch(I){return`${I}`}}});const F=H(()=>{let A=_();if(!A||!A.rule||!e.fen)return;let T=k();if(T){Cn(T);try{return Jn(A.rule,e.fen)}catch(I){return`${I}`}}});return(()=>{var A=oc(),T=A.firstChild,I=T.firstChild,te=I.nextSibling,N=te.firstChild,ne=N.nextSibling,U=T.nextSibling,z=U.firstChild,se=z.nextSibling,O=se.firstChild;return G(I,J(xt,{get each(){return d()},children:(S,B)=>(()=>{var fe=sc(),Ce=fe.firstChild,Y=Ce.nextSibling,q=Y.firstChild,xe=q.nextSibling;return xe.nextSibling,fe.$$click=()=>p(B()),G(Ce,()=>S.name),G(Y,()=>i(S.name),xe),G(Y,()=>s(S.name),null),Be(()=>ps(fe,"rule"+(B()===g()?" active":""))),fe})()})),N.$$click=C,ne.$$click=P,z.$$keydown=w,O.disabled=!0,G(O,F),G(se,J(Fe,{get when(){return E()},children:S=>(()=>{var B=ac();return G(B,S),B})()}),null),Be(()=>z.value=_()?.rule??"Select a rule"),A})()}function hc(e){const t=H(()=>e.tactics),r=ms(()=>e.selected_id);return(()=>{var i=lc(),s=i.firstChild;return G(s,J(xt,{get each(){return t()},children:l=>(()=>{var d=cc(),f=d.firstChild,g=f.nextSibling,p=g.nextSibling;return d.$$click=()=>e.on_selected(l),G(f,()=>l.id),G(p,J(xt,{get each(){return Object.keys(Ir(l))},children:_=>(()=>{var w=uc();return G(w,_),w})()})),Be(_=>{var w=!!r(l.id),C=l.link;return w!==_.e&&d.classList.toggle("active",_.e=w),C!==_.t&&br(f,"href",_.t=C),_},{e:void 0,t:void 0}),d})()})),i})()}Gn(["input","click","keydown"]);export{mc as default};
